define("bcc/_public/ebsUtil",["require","underscore","../enum"],function(require){var e=require("underscore"),t=require("../enum").DiskType;return{getEbsSizeDesc:function(e,t){if(e&&e.length){var a={},i=[],n=0;t=t||3;for(var s=0,r=e.length;s<r;s++)a[e[s].size]?++a[e[s].size]:(a[e[s].size]=1,++n);r=0;for(s in a){if(r++===t)break;i.push(s+"*"+a[s])}return"（"+i.join("、")+(t>=n?"":"...")+"）"}return""},getAllEbsSize:function(t){return e.reduce(t,function(e,t){return e+ +t.size},0)},getEbsByType:function(a,i){return e.filter(a,function(e){return e.volumeType===t.getValueFromAlias(i)})}}}),define("bcc/_public/filters",["require","etpl"],function(require){function e(e,t){return"string"==typeof e?"<span"+(t?' class="'+t+'"':"")+">"+e+"</span>":e&&e.href?'<a href="'+e.href+'"'+(t?' class="'+t+'"':"")+">"+e.title+"</a>":""}require("etpl").addFilter("makebreadcrumb",function(t,a,i){t=t||[],a=e("产品服务")||a,i=" "+e("/","divider")+" "||i;var n=[];n.push('<p class="breadcrumb">'),n.push(a);for(var s=0,r=t.length-1;s<=r;s++)n.push(i),s===r?n.push(e(t[s],"active")):n.push(e(t[s]));return n.push("</p>"),n.join("")})}),define("bcc/_public/selectUtil",["require","common/constants"],function(require){var e=require("common/constants").DURATION;return{preparePurchaseLength:function(t,a){t.set("purchaseTypeList",[{name:"按月",value:"BY_MONTH"},{name:"按年",value:"BY_YEAR"}]);var i={BY_MONTH:e.MONTH,BY_YEAR:e.YEAR};t.set("purchaseLengthList",i[a||"BY_MONTH"]),t.set("purchaseLengthMap",i)},selectHandler:function(e,t,a,i){var n=e.get(t),s=n.get("selectedIndex");n.setProperties({datasource:a,selectedIndex:i||0}),0===s&&n.fire("change")}}}),define("bcc/app/config",["exports","module","underscore","babel-runtime/helpers/interop-require-default","inf-i18n"],function(exports,module,e,t,a){module.exports=function(e,t){var a=[s,m,r,o,c,l,d,u,p,f];if(function(e,t){var a=t.availableService?t.availableService.split(","):[];return i["default"].contains(a,e)}("GPU",e)&&t.enable_gpu){var n=a.slice(1);a=[s,h].concat(n)}return{hideActions:["#/region/404","#/error/404","#/bcc/landing","#/bcc/cds/create","#/bcc/cds/upgrade_config","#/bcc/instance/upgrade_config","#/bcc/instance/upgrade_network","#/bcc/instance/create","#/bcc/security/create","#/bcc/security/copy","#/dcc/host/create","#/dcc/host/create/step1","#/dcc/host/create/step2","#/dcc/host/create/step3","#/dcc/instance/create","#/dcc/instance/operation/joinSecurityGroups","#/dcc/instance/configChange","#/dcc/operation/welcome"],depth:3,config:a}};var i=t["default"](e),n=t["default"](a),s={title:n["default"]("云服务器BCC")},r={title:n["default"]("实例"),service:"instance",icon:"icon-bccinstance",url:"#/bcc/instance/list",anchors:["#/dcc/instance/list"],navs:[{title:'<i class="iconfont icon-arrow-left"></i>'+n["default"]("BCC实例列表"),url:"#/bcc/instance/list"},{title:n["default"]("实例详情"),service:"instance-detail",url:"#/bcc/instance/detail~[instanceId]"},{title:n["default"]("本实例磁盘"),service:"cds-list",url:"#/bcc/instance/disk/list~[instanceId]"},{title:n["default"]("本实例快照"),service:"snapshot-instance",url:"#/bcc/snapshot/instance~[instanceId]"},{title:n["default"]("安全组"),service:"instance-security_groups",url:"#/bcc/instance/security_groups~[instanceId]"},{title:n["default"]("监控"),service:"instance-monitor",url:"#/bcc/instance/monitor~[instanceId]"}]},o={title:n["default"]("磁盘"),service:"disk",icon:"icon-cds",url:"#/bcc/cds/list",navs:[{title:'<i class="iconfont icon-arrow-left"></i>'+n["default"]("本实例磁盘"),url:"#/bcc/cds/list"},{title:n["default"]("磁盘详情"),service:"cds-detail",url:"#/bcc/cds/detail"},{title:n["default"]("磁盘快照"),service:"snapshot-disk",url:"#/bcc/snapshot/disk"}]},c={title:n["default"]("镜像"),service:"mirror",icon:"icon-bccimage",url:"#/bcc/image/list",anchors:["#/bcc/image/list"]},l={title:n["default"]("快照"),service:"snapshot",icon:"icon-cdndomain",url:"javascript:;",anchors:["#/dcc/snapshot/list"],navs:[{title:n["default"]("快照列表"),service:"snapshot-list",url:"#/bcc/snapshot/list"},{title:n["default"]("自动快照策略"),service:"auto-snapshot-policy",url:"#/bcc/snapshot/aspList"}]},d={title:n["default"]("安全组"),service:"securityinfo",icon:"icon-link",url:"/network/#/vpc/security/list",anchors:["#/bcc/security/list","#/bcc/security/detail"],target:"_blank"},u={title:n["default"]("操作日志"),service:"operationlist",icon:"icon-sendauth",url:"#/bcc/operationlist"},p={title:n["default"]("密钥对"),service:"ssh",icon:"icon-sendauth",url:"#/bcc/ssh/list"},f={title:n["default"]("标签管理"),service:"tag",icon:"icon-link",url:"/tag/#/tag/instance/list",anchors:["#/bcc/tag/list"],target:"_blank"},m=(n["default"]("回收站"),{title:n["default"]("专属服务器"),service:"host",icon:"icon-dcc",url:"#/dcc/host/list",anchors:["#/dcc/disk/list","#/dcc/disk/detail"],navs:[{title:'<i class="iconfont icon-arrow-left"></i>'+n["default"]("专属服务器列表"),url:"#/dcc/host/list"},{title:n["default"]("专属服务器详情"),service:"host-detail",url:"#/dcc/host/detail~[id]"},{title:n["default"]("关联专属实例"),service:"host-instance",url:"#/dcc/host/instance~[id]",anchors:["#/dcc/instance/detail","#/dcc/disk/list","#/dcc/snapshot/list","#/dcc/instance/securityGroups","#/dcc/instance/monitor"]}]}),h={title:n["default"]("GPU服务器"),service:"gpu",icon:"icon-gpu",url:"#/gpu/instance/list"}}),define("bcc/app/manager",["exports","module","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","jquery","promise","inf-ria/sidebar/Sidebar","bat-ria/util","inf-i18n","inf-ria/ui/GuideTip","esui","common/util","common/constants","common/App","./config","../config","../../dcc/util","../flags","../../dcc/startup","../../dcc/config","../../gpu/startup","../../gpu/config","../util","../cds/config","../image/config","../instance/config","../security/config","../snapshot/config","../operationlist/config","../landing/config","../ssh/action.conf","../_public/filters","../control/BccCreateMethod"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p,f,m,h,g,v,b,y,T,x,I,S,E,w,k,C,D,_,A,P){var R=a["default"](t),N=a["default"](i),L=a["default"](n),$=a["default"](s),O=a["default"](o),M=a["default"](l),B=a["default"](d),U=a["default"](u),V=a["default"](f),G=a["default"](m),F=a["default"](h),H=a["default"](g),q=a["default"](b),z=a["default"](T),Y=a["default"](x),K=function(){function t(){e["default"](this,t),this.sidebar=null,this.Tip=null}return t.prototype.keep=function(){return p.frameworkInitialized?this.start():L["default"].resolve()},t.prototype.start=function(){var e=this,t=[];return H["default"].enable_dcc&&(t.push(v.start()),this.genRequesters(q["default"].api),F["default"].deepExtend(G["default"],q["default"])),H["default"].enable_gpu&&(t.push(y.start()),this.genRequesters(z["default"].api),F["default"].deepExtend(G["default"],z["default"])),L["default"].all(t).then(function(){return e.genRequesters(G["default"].api)}).then(function(){H["default"].enable_dcc&&(q["default"].api=G["default"].api),H["default"].enable_gpu&&(z["default"].api=G["default"].api)}).then(function(){var t=V["default"](U["default"],H["default"]);e.sidebar=new $["default"](t),e.sidebar.on("changecomplete",function(t){var a=N["default"]("#new-sidebar .topmenu .ssh"),i=N["default"]("#new-sidebar .submenu-open"),n="/bcc/ssh/list"!==t.actionEvent.url.getPath(),s="bccSshSidebar";i.length<=0?!e.Tip&&a.length>0?(a.attr("data-ui-type","GuideTip"),a.attr("data-ui-id",s),a.attr("data-ui-is-show",B["default"].checkHandler({id:s})&&n),a.attr("data-ui-layer-position","bottom"),a.attr("data-ui-tip-text",O["default"]("SSH密钥对功能上线，点击立即体验")),a.attr("data-ui-layer-skin","ssh-list-custom"),a.attr("data-ui-layer-arrow-left",34),e.Tip=M["default"].init(N["default"]("#new-sidebar")[0])[0],e.Tip&&e.Tip.on("close",function(e){return B["default"].closeHandler(e)})):e.Tip&&(B["default"].checkHandler({id:s})&&n?(e.Tip.show(),e.Tip.resizeHandler()):(e.Tip.hide(),B["default"].closeHandler({target:e.Tip}))):e.Tip&&e.Tip.hide()}),e.sidebar.on("fold",function(t){e.Tip&&e.Tip.resizeHandler()}),e.sidebar.on("actionchanged",function(e){var t=e.actionEvent.action.model.get("isSystemDisk");if(!R["default"].isUndefined(t)){var a=function(){var e=t?"system":"cds";if(!N["default"]("li.menu-item").length||!Y["default"].isUpdateCDSSidebar(e))return{v:undefined};var a=t?"instanceId":"diskId";R["default"].each([{className:"cds-detail",title:"磁盘详情",href:"#/bcc/cds/detail"},{className:"snapshot-disk",title:"磁盘快照",href:"#/bcc/snapshot/disk"}],function(i){var n=N["default"]("li.menu-item."+i.className)[0].firstChild,s=N["default"](n)[0].firstChild,r=i.href+"~["+a+"]";i.href.indexOf("snapshot")>-1&&(r=i.href+"~diskType="+e+"&["+a+"]"),s.innerHTML=t?O["default"]("系统"+i.title):O["default"]("CDS"+i.title),N["default"](n).attr("data-anchors",r+","+i.href),N["default"](n).attr("data-url",r)})}();if("object"==typeof a)return a.v}})})},t.prototype.genRequesters=function(e){return R["default"].each(e,function(t,a){return e[a]=R["default"].isFunction(t)?t:r.genRequesters(t)}),e},t.prototype.dispose=function(){this.Tip&&(this.Tip.dispose(),this.Tip=null)},t}();module.exports=new K}),define("bcc/cds/Attach",["require","bat-ria/mvc/FormAction","underscore","./AttachModel","./AttachView","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("bat-ria/mvc/FormAction"),a=require("underscore");return e.prototype.modelType=require("./AttachModel"),e.prototype.viewType=require("./AttachView"),e.prototype.redirectAfterSubmit=function(){this.model.get("parentAction").reload()},e.prototype.initBehavior=function(){t.prototype.initBehavior.apply(this,arguments),this.view.on("searchBccList",this.searchBccList,this),this.on("beforesubmit",this.validateTable,this)},e.prototype.searchBccList=function(){var e=this,t=this.view.get("keywordType").getValue(),i=a.trim(this.view.get("keyword").getValue()),n=[{keywordType:"logicalZone",keyword:this.model.get("logicalZone")}];t.match("tag")?("空值"===i&&(i=""),"所有值"===i&&(i="@@@"),n.push({keywordType:"tag",subKeywordType:t.substr(4),keyword:i})):n.push({keywordType:t,keyword:i}),this.model.getBccList({filters:n,keywordType:t,serverType:"BCC,DCCBCC",keyword:i}).then(function(t){e.view.get("table").setDatasource(t.result)})},e.prototype.validateTable=function(e){if(!this.view.get("table").getSelectedItems().length)return this.view.showToast("请选择一个实例",{messageType:"alert"}),e.preventDefault()},require("er/util").inherits(e,t),e}),define("bcc/cds/attach.tpl",[],function(){return'\x3c!-- target: TPL_bcc_cds_attach --\x3e\n<div class="cds-attach-dialog-form main-wrap-new">\n    <form data-ui-type="Form" data-ui-id="form"\n        data-ui-auto-validate="true">\n        <div class="form-data-body form-attach">\n            <div class="dialog-row clearfix">\n                <span>请选择一个用于挂载的云服务器实例：</span>\n                <div class="buttons-quick-wrap float-right">\n                    <span class="ui-group ui-search-group" data-intro="${i18n.可以按标签来搜索资源}">\n                        <span data-ui-type="SelectEx" data-ui-id="keywordType"\n                              data-ui-has-child-list="true"></span>\n                        <input class="search-box" data-ui-type="TextBox" data-ui-id="keyword"\n                               data-ui-extension-textbox-type="TextBoxSelect" autocomplete="off"/>\n                        <button data-ui-type="Button" type="button" data-ui-id="searchBtn"></button>\n                    </span>\n                </div>\n            </div>\n            <div data-ui-type="Table" data-ui-id="table"></div>\n            <esui-label data-ui-type="Label" data-ui-id="instanceLabel" class="instance-label"></esui-label>\n\n            <div class="form-row">\n                <div class="tip-yellow">\n                    ${tips.cds.attachTip | raw}\n                </div>\n            </div>\n        </div>\n    </form>\n</div>\n\n\x3c!-- target: TPL_bcc_cds_attach_child --\x3e\n\x3c!-- import: TPL_bcc_cds_attach --\x3e\n'}),define("bcc/cds/AttachModel",["require","bat-ria/mvc/FormModel","underscore","common/region","../config","../tips","er/util"],function(require){function e(){t.apply(this,arguments),this.submitRequester=s.bccCdsAttach}var t=require("bat-ria/mvc/FormModel"),a=require("underscore"),i=require("common/region"),n=require("../config"),s=n.api,r=n.FILTER,o=n.INSTANCE_STATUS;return e.prototype.getExtraData=function(){return{diskId:this.get("diskId")}},e.prototype.prepare=function(){var e=[r.INSTANCE.NAME,r.INSTANCE.ID,r.INSTANCE.PUBLICIP,r.INSTANCE.INTERNALIP],t=this.get("bccTags");if(t){var i=a.map(a.keys(t),function(e){return{name:e,value:e}});e.push({name:"标签",value:"tag",children:i})}this.set("keywordTypeDatasource",e)},e.prototype.getBccList=function(e){return s.bccInstanceList(e,{"x-silent":!0})},e.prototype.datasource={tips:function(){return require("../tips")},instances:function(e){return s.bccInstanceList({keywordType:"logicalZone",serverType:"BCC,DCCBCC",keyword:e.get("logicalZone")}).then(function(e){return e.result=a.filter(e.result,function(e){return a.contains(o.CAN_ATTACH,e.status)}),e.result})},bccTags:function(e){return s.getSearchTagList({serviceType:["BCC"],region:[i.getCurrentRegion().id]}).then(function(e){if(!e.length)return null;var t=a.groupBy(e,"tagKey");return a.each(t,function(e,i){t[i]=a.map(e,function(e){return{name:e.tagValue||"空值",value:e.tagValue}}),t[i].unshift({name:"所有值",value:"@@@"})}),t})}},require("er/util").inherits(e,t),e}),define("bcc/cds/AttachView",["require","bat-ria/tpl!./attach.tpl","underscore","bat-ria/mvc/FormView","../config","er/util"],function(require){function e(){a.apply(this,arguments)}require("bat-ria/tpl!./attach.tpl");var t=require("underscore"),a=require("bat-ria/mvc/FormView"),i=require("../config").INSTANCE_STATUS;e.prototype.template="TPL_bcc_cds_attach";var n=[{title:"实例名称/ID",content:function(e){return e.name+"<br>"+e.instanceId}},{title:"公网IP/内网IP",content:function(e){return(e.publicIp||"未分配")+"/"+e.internalIp}},{title:"标签",content:function(e){if(!e.tags||e.tags.length<1)return"-";var a="",i="";return t.each(e.tags,function(e,t){i+="{"+e.tagKey+":"+e.tagValue+"} ",t<2&&(a+=e.tagKey+" : "+e.tagValue+"<br/>")}),e.tags.length>2&&(a+="..."),'<div title="'+i+'">'+a+"</div>"}}];return e.prototype.getExtraFormData=function(){var e=this.get("table").getSelectedItems()[0];return e?{instanceId:e.id}:{}},e.prototype.uiProperties={table:{select:"single",selectMode:"line",fields:n,datasource:"@instances"},keyword:{datasource:[]},keywordType:{datasource:"@keywordTypeDatasource"}},e.prototype.uiEvents={"table:select":function(e){var t=this.get("table").datasource[e.selectedIndex],a=t.status===i.DELETING||!!t.releaseTime;this.get("instanceLabel").setText(a?"当前实例已在释放，是否确认？":"")},"searchBtn:click":function(e){this.fire("searchBccList")},"keywordType:change":function(e){var t=this.model.get("bccTags"),a=this.get("keyword"),i=[];if(t){var n=e.target.getSelectedItem();if(n.length>1){var s=n[1].value;s&&(i=t[s])}}a.setProperties({datasource:i})}},require("er/util").inherits(e,a),e}),define("bcc/cds/config",["require","er/controller"],function(require){require("er/controller").registerAction([{type:"bcc/cds/List",path:"/bcc/cds/list"},{type:"bcc/cds/List",path:"/bcc/instance/disk/list"},{type:"bcc/cds/Detail",path:"/bcc/cds/detail"},{type:"bcc/cds/Create",path:"/bcc/cds/create"},{type:"bcc/cds/CreateSnapshot",path:"/bcc/cds/create_snapshot"},{type:"bcc/cds/Attach",path:"/bcc/cds/attach"},{type:"bcc/cds/Snapshot",path:"/bcc/cds/snapshot"},{type:"bcc/cds/UpgradeConfig",path:"/bcc/cds/upgrade_config"}]);return{monitorMetric:{bytes:{name:"读写量",unit:"字节",metrics:[{name:"读取量",value:"ReadBytes"},{name:"写入量",value:"WriteBytes"}]},opCount:{name:"读写次数",unit:"次数",metrics:[{name:"读取操作次数",value:"ReadOpCount"},{name:"写入操作次数",value:"WriteOpCount"}]},status:{name:"错误IO",unit:"次数",metrics:[{name:"错误IO",value:"Status"}]}}}}),define("bcc/cds/Create",["require","bat-ria/mvc/FormAction","underscore","promise","inf-ui/x/biz/helper","common/util/orderUtil","common/constants","../events","./helper","./CreateModel","./CreateView","er/util"],function(require){function e(){r.apply(this,arguments)}function t(e){this.model.set("count",e.count),this.model.setDiskSize(e.diskSize),this.quotaCheck()}function a(){var e=this.model.getSubmitData(this.view.getFormData());e.totalCost=undefined,e.rechargeAmount=undefined,e.instanceId=undefined;var t=this.view.get("buyBucket");return e.diskSize.length>0?(t.setValue(o.extend({},e,{loading:!0})),t.disable(),this.loadData("price",{data:e,buyBucket:t})):(t.setValue(o.extend({},e,{totalCost:0})),t.disable(),c.resolve())}function i(e){this.model.set("productType",e.productType),a.call(this)}function n(){var e=this.model.getSubmitData(this.view.getFormData());if(0!==e.count){var t=function(e){var t=this.model.get("price"),a={serviceType:"CDS",productType:e.productType,type:"NEW",price:t.totalCost,items:f.formData2OrderItems(e,t)};return d.make(a)}.call(this,e);this.view.renderOrderConfirm(t,e)}else this.view.waitAlert("CDS磁盘数量不能为0个","购买配置错误")}function s(){var e=this.model.get("snapshotId");e?this.view.initSnapshot({snapshotId:e,snapshotName:this.model.get("snapshotName"),size:this.model.get("diskSize")}):(this.model.set("count",1),a.call(this)),this.view.warningPanel("hide"),this.loadData("snapshot"),this.model.get("instanceId")&&this.loadData("asp")}var r=require("bat-ria/mvc/FormAction"),o=require("underscore"),c=require("promise"),l=require("inf-ui/x/biz/helper"),d=require("common/util/orderUtil"),u=require("common/constants"),p=require("../events"),f=require("./helper");return e.prototype.modelType=require("./CreateModel"),e.prototype.viewType=require("./CreateView"),e.prototype.loadData=function(e,t){var a=this;return"snapshot"===e?a.model.getSnapshotsList().then(function(e){var t=a.view.get("diskSize"),i=a.model.get("quota").cdsRatio;t.getChild("addSnapshot").set("content","从快照创建CDS磁盘"),e&&e.length&&i?(t.datasource=e,t.snapshot.stateDisabled=!1,t.setButtonStatus()):(t.snapshot.stateDisabled=!0,t.setButtonStatus())}):"price"===e?a.model.getPrice(t.data,{"x-silent":!0}).then(function(e){t.buyBucket.setValue(o.extend(t.data,e)),a.model.set("price",e),e.totalCost>0&&!a.model.get("errorInfo")&&a.view.submitButton("enable")},function(){t.buyBucket.setValue(o.extend(t.data,{error:!0}))}):"asp"===e?this.loadAspData():void 0},e.prototype.updateCtlsView=function(e,t,a,i,n){n=n||{};var s=this,r="function"==typeof t;o.each(e,function(e){var a=s.view.get(e);a.setProperties(r?t(e):t),a.render(),a.fire("change",n)}),this.view.get(a)[i]()},e.prototype.loadAspData=function(){var e=this;return e.updateCtlsView(["asp"],{datasource:[{name:"加载中...",value:""}],selectedIndex:0},"aspTip","hide"),e.model.getAspList().then(function(t){e.updateCtlsView(["asp"],function(t){return{datasource:e.model.get("aspList"),selectedIndex:0}},"aspTip","hide")}).fail(function(t){e.updateCtlsView(["asp"],{datasource:[],selectedIndex:-1,emptyText:"加载失败"},"aspTip","show")})},e.prototype.createAsp=function(){var e={parentAction:this};this._AspCreateComp=l.waitActionDialog({title:"新建自动快照策略",width:660,url:"/bcc/snapshot/updatePolicy",needFoot:!1},e)},e.prototype.onOkAspCreate=function(){this.loadAspData(),this.onCloseAspCreate()},e.prototype.onCloseAspCreate=function(){this._AspCreateComp.closeDialog()},e.prototype.quotaCheck=function(){var e=this.model.get("quota"),t=this.view.getFormData(),a=0;o.each(t.diskSize,function(e){a+=+e.size});var i=this.model.get("errorInfo")||{};if(e.cdsUsedCapacityGB+a>e.cdsTotalCapacityGB){var n=e.cdsTotalCapacityGB-e.cdsUsedCapacityGB;return i.diskSize="当前订单要购买的CDS大小超过了您剩余配额"+(n>=1024?(n/1024).toFixed(2)+"TB":n+"GB")+"（总配额"+(e.cdsTotalCapacityGB/1024).toFixed(2)+'TB）。如需增加配额，请到<a href="'+u.domains.ticket+'">工单</a>申请',this.model.set("errorInfo",i),!1}if(t.diskSize.length>e.cdsTotal-e.cdsCreated)return i.diskSize="已创建"+e.cdsCreated+"块磁盘，共可建"+e.cdsTotal+"块，还可建"+Math.max(e.cdsTotal-e.cdsCreated,0)+"块磁盘",this.model.set("errorInfo",i),!1},e.prototype.initBehavior=function(){r.prototype.initBehavior.apply(this,arguments),this.view.on(p.SET_COUNT,t,this),this.view.on(p.GET_PRICE,a,this),this.view.on(p.CHANGE_PRODUCT_TYPE,i,this),this.view.on(p.RELOAD,this.reload,this),this.view.on(p.ORDER_CONFIRM,n,this),this.on("entercomplete",s,this),this.view.on("createAsp",this.createAsp,this),this.view.on("reloadData",function(e){this.loadData(e.key)},this),this.model.setDiskSize(this.view.getUIProperties().diskSize.dragger.min)},e.prototype.syncModelToViewIterator=function(e){switch(e.name){case"errorInfo":this.view.processError();break;case"prePurchaseValid":case"posPurchaseValid":this.view.submitButton(),this.view.warningPanel()}return!0},require("er/util").inherits(e,r),e}),define("bcc/cds/create.tpl",[],function(){return'\x3c!-- target: TPL_bcc_cds_create --\x3e\n<div class="bcc-purchase bcc-cds-create bcc-main-wrap main-wrap-new bcc-main-1col">\n    \x3c!-- import: TPL_inf_ria_page_breadcrumb --\x3e\n        \x3c!-- block: back_link --\x3e#/bcc/cds/list\x3c!-- /block --\x3e\n        \x3c!-- block: create_step --\x3e\n            <div data-ui-type="ViewStep"\n                 data-ui-id="buyStep"\n                 data-ui-current-step="1">\n                <ul>\n                    <li bind-for="tab1">${i18n.选购CDS磁盘}</li>\n                    <li bind-for="tab2">${i18n.确认订单}</li>\n                    <li>${i18n.在线支付}</li>\n                    <li>${i18n.支付成功}</li>\n                </ul>\n            </div>\n        \x3c!-- /block --\x3e\n    \x3c!-- /import --\x3e\n    <div class="content-wrap">\n        <div class="create-content create-content-wrapper">\n            <div id="tab1" class="ui-tab-content">\n                \x3c!-- <p data-ui-type="ToastLabel"\n                        data-ui-id="warningPanel"\n                        data-ui-message-type="alert"\n                        data-ui-hidden="true"\n                        class="cash-warning-panel"></p> --\x3e\n                <div class="create-main">\n                    <form class="setting-form"\n                        data-ui-type="Form"\n                        data-ui-id="form"\n                        data-ui-submit-button="toBuy"\n                        data-ui-auto-validate="true">\n                        <div data-ui-id="buyBucket" data-ui-type="BuyBucket"></div>\n                        <div class="detail-parts-table">\n                            <dl class="detail-create detail-part-1-col">\n                                <dt><h4>${i18n.付费及地域}</h4></dt>\n                                <dd>\n                                    <label>${i18n.付费方式：}</label>\n                                    <div>\n                                        <div data-ui-type="RadioSelect"\n                                            data-ui-id="productType"\n                                            data-ui-name="productType"></div>\n                                    </div>\n                                </dd>\n                                <dd>\x3c!-- import: TPL_common_partial_create_current_region --\x3e</dd>\n                                <dd>\n                                    \x3c!-- import: TPL_common_partial_create_zone --\x3e\n                                </dd>\n                            </dl>\n                            <dl class="detail-create detail-part-1-col">\n                                <dt><h4>${i18n.配置信息}</h4></dt>\n                                <dd data-ui-id="diskSelloutPanel" data-ui-type="Panel" data-ui-hidden="true">\n                                    <label>${i18n.CDS云磁盘：}</label>\n                                    <div><span>${i18n.已售罄}</span> <span data-ui-type="Tip" data-ui-arrow="true" data-ui-id="cdsSellOutTip"\n                                        data-ui-content="${tips.cds.sellOutTip}"></span></div>\n                                </dd>\n                                <dd data-ui-id="diskSetPanel" data-ui-type="Panel" id="diskSizeWrapper" data-index="0" class="diskSize">\n                                    <label>${i18n.CDS云磁盘：}</label>\n                                    <div>\n                                        <div data-ui="id:diskSize;name:diskSize;type:BccCreateMethod;" class="cds-create-btn"></div>\n                                        <div data-ui-type="Tip" class="ebs-doc-link" data-ui-arrow="true"\n                                            data-ui-content="\x3c!-- if: ${instanceId} --\x3e ${tips.instance.cds}\x3c!-- else --\x3e${tips.cds.cds}\x3c!-- /if --\x3e" >\n                                        </div>\n                                        <p id="diskSizeError" data-for="form-error" class="bcc-error"></p>\n                                        <span class="form-field-tip row-tip-grey">${i18n.云磁盘容量5GB～32TB，最多可创建}${quota.cdsRatio}${i18n.块云磁盘}</span>\n                                        <p class="row-tip-grey">${tips.cds.howToSelectTip | raw}</p>\n                                    </div>\n                                </dd>\n                                \x3c!-- if: ${instanceId} --\x3e\n                                <dd data-ui-id="autoAspPanel" data-ui-type="Panel">\n                                    <label>${i18n.绑定快照策略：}</label>\n                                    <div>\n                                        <div data-ui-type="ToggleButton"\n                                          data-ui-id="autoSnaphot"\n                                          data-ui-name="autoSnaphot"\n                                          data-ui-checked="true"></div>\n                                    </div>\n                                </dd>\n                                <dd data-ui-id="aspPanel" data-ui-type="Panel">\n                                    <label>${i18n.选择快照策略：}</label>\n                                    <div>\n                                        <div data-ui-id="asp"\n                                             data-ui-name="aspId"\n                                             data-ui-type="Select"\n                                             data-ui-width="200"\n                                             class="asp-select"></div>\n                                        <span data-ui="type:Button;id:createAsp;skin:stringfy;" class="asp-create">+ ${i18n.创建快照策略}</span>\n                                        <span data-ui="type:Panel;id:aspTip;hidden:true;" class="bcc-error">\n                                            ${i18n.加载失败，请}<span data-ui="type:Button;id:aspReload;skin:stringfy;" class="bcc-error-reload asp-reload">${i18n.刷新}</span>${i18n.重试。}\n                                        </span>\n                                        <label data-ui-type="Validity"\n                                               data-ui-id="aspValidity"></label>\n                                    </div>\n                                </dd>\n                                \x3c!-- /if --\x3e\n                            </dl>\n                            <dl class="detail-create detail-part-1-col"  data-ui-type="Panel" data-ui-id="purchaseTypePanel">\n                                <dt><h4>${i18n.购买信息}</h4></dt>\n                                <dd>\n                                    <label>${i18n.购买时长：}</label>\n                                    <div>\n                                        <div data-ui-id="month" data-ui-name="month"\n                                             data-ui-type="RadioSelect" class="ui-radioselect-pl bcc-purchase-length"></div>\n                                    </div>\n                                </dd>\n                                <dd data-ui-type="Panel" data-ui-id="rechargePanel">\n                                    <label>${i18n.充值金额：}</label>\n                                    <div>\n                                        <div data-ui-type="NumberTextline" data-ui-id="rechargeAmount"\n                                             data-ui-width="100" data-ui-name="rechargeAmount"></div>\n                                    </div>\n                                </dd>\n                                <dd data-ui-id="renewPanel" data-ui-type="Panel">\n                                    <label>${i18n.自动续费：}</label>\n                                    <div>\n                                        <div data-ui-type="ToggleButton"\n                                              data-ui-id="autoRenew"\n                                              data-ui-name="autoRenew"></div>\n                                        <a href="https://cloud.baidu.com/doc/Finance/Renew/24.5C.E8.87.AA.E5.8A.A8.E7.BB.AD.E8.B4.B9.html" target="_blank">什么是自动续费？</a>\n                                        <div data-ui-id="autoRenewPanel" data-ui-type="Panel" data-ui-hidden="true">\n                                            <div class="auto-renew-item">\n                                                <label>${i18n.选择续费周期：}</label>\n                                                <div class="ui-group ui-select-group">\n                                                    <div data-ui-type="Select" data-ui-id="autoRenewTimeUnit" data-ui-name="autoRenewTimeUnit"></div>\n                                                    <div data-ui-type="Select" data-ui-id="autoRenewTime" data-ui-name="autoRenewTime"></div>\n                                                </div>\n                                                <span data-ui="type:Label;id:expireTimeLabel;" class="renew-expire-time"></span>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </dd>\n                            </dl>\n                        </div>\n                    </form>\n                </div>\n            </div>\n            <div id="tab2" class="order-confirm-panel">\n                <div data-ui="id:orderAction;type:ActionPanel"></div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("bcc/cds/CreateModel",["require","bat-ria/mvc/FormModel","underscore","promise","inf-i18n","common/constants","../config","../enum","../flags","../util","../tips","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("bat-ria/mvc/FormModel"),a=require("underscore"),i=require("promise"),n=require("inf-i18n"),s=require("common/constants"),r=require("../config"),o=r.api,c=r.DISK_TYPE,l=require("../enum"),d=require("../flags"),u=l.DiskType,p=l.ProductType,f=require("../util").isRocV2Disk;return e.prototype.datasource={tips:function(){return require("../tips")},snapshots:function(){return[]},quota:function(e){return o.bccQuota({objType:"cds",instanceId:e.get("instanceId")})},zoneDatasource:function(e){return o.getZoneListV3().then(function(t){return e.get("logicalZone")&&(t=a.filter(t,function(t){return t.zone===e.get("logicalZone")})),a.map(t,function(e){return{value:e.zone,name:e.zone.replace(/zone/g,n("可用区")),cdsTypes:e.cdsTypes}})})}},e.prototype.getExtraData=function(){return{orderUuid:this.get("orderUuid"),count:this.get("count"),totalCost:this.get("totalCost"),productType:this.get("productType"),instanceId:this.get("instanceId")}},e.prototype.filterData=function(e){var t=this.get("zoneDatasource"),i=a.find(t,function(t){return t.value===e.logicalZone});return this.get("productType")===p.POSTPAY&&(e.month=undefined),e.logicalZone&&i.cdsTypes.length>0&&e.diskSize?a.each(e.diskSize,function(t){t.logicalZone=e.logicalZone}):e.diskSize=[],e.autoRenew||(e.autoRenewTime=0),e},e.prototype.getPrice=o.bccCdsPrice,e.prototype.getMyAccount=function(e){return d.enable_baixin?i.resolve({cashBalance:1e7,debt:0}):o.getMyAccount(e,{"x-silent":!0})},e.prototype.getPrePurchaseValidation=function(){var e=this;return d.enable_baixin?(e.set("prePurchaseValid",{status:!0,failReason:""}),i.resolve()):o.accountPurchaseValidation({serviceType:"CDS",productType:"prepay"},{"x-silent":!0}).then(function(t){e.set("prePurchaseValid",t)}).fail(function(t){e.set("prePurchaseValid",{status:!1,failReason:n("余额检查异常，请刷新后重试")})})},e.prototype.getPosPurchaseValidation=function(){var e=this;return d.enable_baixin?(e.set("posPurchaseValid",{status:!0,failReason:""}),i.resolve()):o.accountPurchaseValidation({serviceType:"CDS",productType:"postpay"},{"x-silent":!0}).then(function(t){e.set("posPurchaseValid",t)}).fail(function(t){e.set("posPurchaseValid",{status:!1,failReason:n("余额检查异常，请刷新后重试")})})},e.prototype.getSnapshotsList=function(){return o.bccSnapshotList({diskType:c.CDS,orderBy:"createTime"},{"x-silent":!0}).then(function(e){var t=e.result||[];return t=a.filter(t,function(e){return e.status===r.DISK_STATUS.AVAILABLE||f(e)&&e.status===r.DISK_STATUS.ACTIVE})})},e.prototype.getAspList=function(){var e=this;return o.aspList({pageNo:1,pageSize:1e3,orderBy:"createTime",order:"desc"},{"x-silent":!0}).then(function(t){var i=[];return a.each(t.result,function(e){i.push({text:e.name,value:e.aspId})}),e.set("aspList",i),i})},e.prototype.prepare=function(){i.all([this.getPrePurchaseValidation(),this.getPosPurchaseValidation()]);var e=this.get("tips").instance.saleTip;this.set("productType",p.PREPAY),this.set("initDiskCount",this.get("snapshotId")?0:1),this.set("purchaseLengthList",[{name:n("1个月"),value:1},{name:"2",value:2},{name:"3",value:3},{name:"4",value:4},{name:"5",value:5},{name:"6",value:6},{name:"7",value:7},{name:"8",value:8},{name:"9",value:9},{name:n("1年"),value:12,hoverContent:e[12].cds},{name:n("2年"),value:24,hoverContent:e[24].cds},{name:n("3年"),value:36,hoverContent:e[36].cds}]);var t=this.get("zoneDatasource"),s=u.toArray(),r=[];a.each(t,function(e){r=r.concat(e.cdsTypes)}),r=a.uniq(r);var o=[];a.each(s,function(e){a.contains(r,e.value)&&o.push(e)});var c=this.get("type");if(c){var l=0;a.each(o,function(e,t){e.value===c&&(l=t)});var d=o.splice(l,1);o.unshift(d[0])}this.set("diskType",o),this.set("draggerOpt",{max:32765,min:5,value:+this.get("size")||"",step:1,length:320})},e.prototype.setDiskSize=function(e){var t=this.get("quota"),i=this.get("errorInfo")||{};if(t.cdsUsedCapacityGB+e>t.cdsTotalCapacityGB){var r=t.cdsTotalCapacityGB-t.cdsUsedCapacityGB,o=r>=1024?(r/1024).toFixed(2)+"TB":r+"GB",c=(t.cdsTotalCapacityGB/1024).toFixed(2),l='<a href="'+s.domains.ticket+'">'+n("工单")+"</a>";return i.diskSize=a.sprintf(n("当前订单要购买的CDS大小超过了您剩余配额%s（总配额%sTB）。如需增加配额，请到%s申请。"),o,c,l),void this.set("errorInfo",i)}i.diskSize&&delete i.diskSize,a.isEmpty(i)?this.remove("errorInfo",i):this.set("errorInfo",i)},require("er/util").inherits(e,t),e}),define("bcc/cds/CreateSnapshot",["require","bat-ria/mvc/FormAction","./CreateSnapshotModel","./CreateSnapshotView","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("bat-ria/mvc/FormAction");return e.prototype.modelType=require("./CreateSnapshotModel"),e.prototype.viewType=require("./CreateSnapshotView"),e.prototype.submit=function(e){var a=t.prototype.submit.apply(this,arguments),i=this;return a.done(function(){var e=i.view&&i.view.get("form");e&&e.fire("aftermanualvalidate",{isValid:!1})}),a},e.prototype.redirectAfterSubmit=function(){this.model.get("parentAction").reload()},e.prototype.initBehavior=function(){t.prototype.initBehavior.apply(this,arguments)},require("er/util").inherits(e,t),e}),define("bcc/cds/createSnapshot.tpl",[],function(){return'\x3c!-- target: TPL_bcc_cds_createSnapshot --\x3e\n<div class="bcc-dialog-form bcc-cds-createSnapshot">\n    <form data-ui-type="Form" data-ui-id="form"\n        data-ui-auto-validate="true">\n        <div class="form-data-body">\n            <div class="form-row \x3c!-- if: ${isSystemDisk} || !${instanceId} --\x3euns\x3c!-- /if --\x3e">\n                <div class="operation-tip">${i18n.温馨提示：快照内容只包含开始创建时已经写入磁盘的内容，不包括还在缓存中的数据。}\n                    ${i18n.为了保证数据的完整性，建议你先卸载磁盘，或者确认已停止所有的文件写操作。}\n                </div>\n            </div>\n            \x3c!-- if: !${isSystemDisk} --\x3e\n            <div class="form-row">\n                <div class="form-key">${i18n.磁盘ID：}</div>\n                <div class="form-value">${volumeId}</div>\n            </div>\n            \x3c!-- /if --\x3e\n            \x3c!-- if: ${instanceId} --\x3e\n            <div class="form-row">\n                <div class="form-key">${i18n.实例ID：}</div>\n                <div class="form-value form-nowrap-text">${instanceId}</div>\n            </div>\n            \x3c!-- /if --\x3e\n            <div class="form-row">\n                <div class="form-key">${i18n.磁盘属性：}</div>\n                \x3c!-- if: ${isSystemDisk} --\x3e\n                <div class="form-value">${i18n.系统盘}</div>\n                \x3c!-- else --\x3e\n                <div class="form-value">${i18n.CDS盘}</div>\n                \x3c!-- /if --\x3e\n            </div>\n            <div class="form-row">\n                <div class="form-key">${i18n.快照名称：}</div>\n                <div class="form-value">\n                    <input data-ui-type="TextBox" data-ui-id="name"\n                        data-ui-name="name" data-ui-width="370" />\n                    <div data-ui-type="Label" data-ui-id="nameNote" class="bcc-note"></div>\n                    <label data-ui-type="Validity"\n                        data-ui-id="nameValidity"></label>\n                </div>\n            </div>\n        </div>\n    </form>\n</div>\n\n\x3c!-- target: TPL_bcc_cds_createSnapshot_child --\x3e\n\x3c!-- import: TPL_bcc_cds_createSnapshot --\x3e\n'}),define("bcc/cds/CreateSnapshotModel",["require","bat-ria/mvc/FormModel","../config","er/util"],function(require){function e(){t.apply(this,arguments),this.submitRequester=i.bccCdsSnapshotCreate}var t=require("bat-ria/mvc/FormModel"),a=require("../config"),i=a.api,n=a.DISK_TYPE;return e.prototype.prepare=function(){this.set("isSystemDisk",this.get("diskType")===n.SYSTEM)},e.prototype.getExtraData=function(){return{diskId:this.get("diskId"),attachment:this.get("attachment"),needDetach:"false"}},e.prototype.datasource={volumeId:function(e){return e.get("volumeId")||e.get("diskId")}},require("er/util").inherits(e,t),e}),define("bcc/cds/CreateSnapshotView",["require","bat-ria/tpl!./createSnapshot.tpl","bat-ria/mvc/FormView","../config","er/util"],function(require){function e(){t.apply(this,arguments)}require("bat-ria/tpl!./createSnapshot.tpl");var t=require("bat-ria/mvc/FormView");e.prototype.template="TPL_bcc_cds_createSnapshot";var a=require("../config").RULE.NAME;return e.prototype.uiProperties={name:{placeholder:a.placeholder,required:"required",requiredErrorMessage:"快照名称必填",pattern:a.pattern,patternErrorMessage:a.patternErrorMessage,validityLabel:"nameValidity"},nameNote:{text:a.note}},e.prototype.uiEvents={},require("er/util").inherits(e,t),e}),define("bcc/cds/CreateView",["require","bat-ria/tpl!./create.tpl","underscore","jquery","bat-ria/mvc/FormView","inf-ria/app/brpc","inf-i18n","common/region","common/zone","common/constants","common/util/moneyUtil","../events","../_public/ebsUtil","../enum","er/util"],function(require){function e(){i.apply(this,arguments)}require("bat-ria/tpl!./create.tpl");var t=require("underscore"),a=require("jquery"),i=require("bat-ria/mvc/FormView"),n=require("inf-ria/app/brpc"),s=require("inf-i18n"),r=require("common/region"),o=require("common/zone"),c=require("common/constants"),l=require("common/util/moneyUtil"),d=require("../events"),u=require("../_public/ebsUtil"),p=require("../enum"),f=p.DiskType,m=p.ProductType,h=p.TimeType,g=p.Month,v=p.Year,b=[{title:s("地域："),content:function(e){return r.getCurrentRegion().label}},{title:s("可用区"),content:function(e){return o.getLabel(e.logicalZone)}},{title:s("购买配置："),content:function(e){var t=[],a=u.getEbsByType(e.diskSize,"PREMIUM_SSD"),i=u.getEbsByType(e.diskSize,"SSD"),n=u.getEbsByType(e.diskSize,"SATA");return a&&a.length>0&&t.push(f.getTextFromAlias("PREMIUM_SSD")+"："+u.getAllEbsSize(a)+u.getEbsSizeDesc(a)+"GB"),i&&i.length>0&&t.push(f.getTextFromAlias("SSD")+"："+u.getAllEbsSize(i)+u.getEbsSizeDesc(i)+"GB"),n&&n.length>0&&t.push(f.getTextFromAlias("SATA")+"："+u.getAllEbsSize(n)+u.getEbsSizeDesc(n)+"GB"),t.join("<br>")}},{title:s("购买配额："),content:function(e){var a=e.autoRenewTimeUnit===h.MONTH?s("个月"):s("年");return(e.month?t.sprintf(s("%s个"),e.count)+" * "+t.sprintf(s("%s月"),e.month):t.sprintf(s("%s个"),e.count))+(e.autoRenew?"<br>"+s("开通自动续费")+e.autoRenewTime+a:"")}},{title:s("配置费用："),content:function(e){if(e.loading)return'<span class="loading">'+s("努力加载中...请稍候")+"</span>";if(e.error)return'<span class="bcc-error">'+s("请求异常，请刷新后重试。")+' </span><a href="javascript:location.reload();">'+s("刷新")+"</a>";var t=e.productType===m.POSTPAY,a=l.convertPrice(e.totalCost);return""+('<span class="price">￥'+(t?a.getPriceOfMinute(s("/分钟")):a.getPriceOfMinute()))}}];return e.prototype.template="TPL_bcc_cds_create",e.prototype.uiProperties={productType:{datasource:m.toArray("PREPAY","POSTPAY")},month:{datasource:"@purchaseLengthList"},diskSize:{dragger:"@draggerOpt",snapshot:{stateDisabled:!0,content:s("从快照创建CDS磁盘")+'<span class="loading"></span>'},datasource:"@snapshots",maxlength:"@quota.cdsRatio",initDraggerCount:"@initDiskCount",draggerTitle:"@draggerTitle",diskType:"@diskType"},toBuy:{disabled:!0},asp:{custom:function(e){var t=this.viewContext.controls.autoSnaphot;return!t||!t.isChecked()||!!e},customErrorMessage:"请选择自动快照策略",validityLabel:"aspValidity"},rechargeAmount:{min:100,maxlength:5},buyBucket:{fields:b,offsetTop:20,confirmBtn:{text:s("下一步"),skin:"skin-primary-button"}},logicalZone:{datasource:"@zoneDatasource"},autoRenewTimeUnit:{datasource:h.toArray()},autoRenewTime:{datasource:g.toArray()}},e.prototype.uiEvents={"diskSize:change":function(e){var a=0;t.each(e.target.getValue(),function(e){a+=+e.size}),this.fire(d.SET_COUNT,{count:e.count,diskSize:a}),this.fire(d.GET_PRICE),this.warningPanel("show"),this.submitButton()},"month:change":function(e){this.fire(d.GET_PRICE)},"productType:change":function(e){var t=e.target.getValue();t===m.PREPAY?(this.get("purchaseTypePanel").show(),this.get("renewPanel").show()):(this.get("purchaseTypePanel").hide(),this.get("renewPanel").hide()),this.warningPanel(),this.submitButton(),this.fire(d.CHANGE_PRODUCT_TYPE,{productType:t})},"autoSnaphot:change":function(e){e.target.isChecked()?this.get("aspPanel").show():this.get("aspPanel").hide()},"aspReload:click":function(e){this.fire("reloadData",{key:"asp"})},"createAsp:click":function(){this.fire("createAsp")},buyBucket:{confirm:function(){this.get("form").validate()&&this.fire(d.ORDER_CONFIRM)},reset:function(){this.fire(d.RELOAD)}},"logicalZone:change":function(e){var a=this.get("diskSize"),i=this.model.get("diskType"),n=e.target.getSelectedItem().cdsTypes;n&&t.intersection(n,[f.SATA,f.SSD,f.PREMIUM_SSD]).length>0?(t.each(i,function(e){e.disabled=t.indexOf(n,e.value)<0,e.text=e.disabled?f.getTextFromValue(e.value)+s("(已售罄)"):f.getTextFromValue(e.value)}),a.updateDiskType(i),this.get("diskSetPanel").show(),a.show(),this.get("diskSelloutPanel").hide()):(a.hide(),this.get("diskSetPanel").hide(),this.get("diskSelloutPanel").show()),this.fire(d.GET_PRICE)},"autoRenew:change":function(e){e.target.isChecked()?(this.get("autoRenewPanel").show(),this.updateExpireTime()):this.get("autoRenewPanel").hide(),this.fire(d.GET_PRICE)},"autoRenewTimeUnit:change":function(e){var t=e.target.getValue(),a=this.get("autoRenewTime");t===h.MONTH?a.updateDatasource(g.toArray()):a.updateDatasource(v.toArray()),this.updateExpireTime(),this.fire(d.GET_PRICE)},"autoRenewTime:change":function(e){this.updateExpireTime(),this.fire(d.GET_PRICE)}},e.prototype.initSnapshot=function(e){this.get("diskSize").addSnapshot(e),this.get("logicalZone").getSelectedItem().cdsTypes.length<1&&this.get("diskSize").hide()},e.prototype.warningPanel=function(e){var i=this.model.get("prePurchaseValid"),n=this.model.get("posPurchaseValid"),o=this.get("buyBucket"),l="show"===e,d="",u=this.model.get("quota");if("hk02"===r.getCurrentRegion().id)d=t.sprintf(s("温馨提示：售罄！请移步其他地域购买资源。")),l=!0;else if(u.cdsCreated>=u.cdsTotal){if(0===u.cdsTotal)d=""+s("温馨提示：您创建的CDS磁盘已达到限额；")+s("如需增加配额，请")+'<a href="#/bcc/instance/create">'+s("创建新的BCC实例")+"</a>";else{var p='<a href="'+c.domains.ticket+'">'+s("工单")+"</a>";d=t.sprintf(s("温馨提示：您创建的CDS磁盘已达到%s个限额；如需增加配额请到%s申请"),u.cdsTotal,p)}l=!0}else this.get("productType").getValue()===m.PREPAY&&i&&!i.status?(d=t.sprintf(s("温馨提示：%s"),i.failReason)+' <a href="/billing/#/account/recharge">'+s("立即充值")+"</a>",l=!0):this.get("productType").getValue()===m.POSTPAY&&n&&!n.status&&(d=t.sprintf(s("温馨提示：%s"),n.failReason)+' <a href="/billing/#/account/recharge">立即充值</a>',l=!0);var f='<div class="buy-bucket-tip">'+d+"</div>",h=a(o.main).find(".buy-bucket-tip");d&&(h.length>0?h.html(d):a(o.main).append(f)),h[l?"show":"hide"]()},e.prototype.submitButton=function(e){var t=this.model.get("prePurchaseValid"),a=this.model.get("posPurchaseValid"),i=this.model.get("quota");e=e||"enable","hk02"===r.getCurrentRegion().id?e="disable":this.get("diskSize").getValue().length>i.cdsTotal-i.cdsCreated?e="disable":this.get("productType").getValue()===m.PREPAY&&t&&!t.status?e="disable":this.get("productType").getValue()===m.POSTPAY&&a&&!a.status&&(e="disable"),this.get("buyBucket")[e]()},e.prototype.enterDocument=function(){i.prototype.enterDocument.apply(this,arguments),!this.model.get("diskId")&&this.get("rechargePanel").hide(),this.get("logicalZone").fire("change")},e.prototype.updateExpireTime=function(){var e=this.get("autoRenewTimeUnit").getValue(),t="系统将于到期前7天进行扣费，扣费时长为"+this.get("autoRenewTime").getValue()+(e===h.YEAR?"年":"月");this.get("expireTimeLabel").setText(t)},e.prototype.renderOrderConfirm=function(e,t){function a(){c.renderCdsConfig(),s.show(),r.set("currentStep",1)}var i=this.get("orderAction"),s=this.get("productType"),r=this.get("buyStep"),o={order:e,config:t},c=this;n.invokeService("billing://order_confirm",i,o).then(function(){i.on("action@prevPage",a),s.hide(),r.set("currentStep",2)})},e.prototype.renderCdsConfig=function(){var e=this.get("orderAction");this.get("buyStep").set("currentStep",1),e.disposeAction(),e.main.innerHTML=""},e.prototype.processError=function(){a("[data-for=form-error]").html("");var e=this.get("diskSize");t.each(e.children,function(e){e.enable()});var i=this.model.get("errorInfo");t.keys(i).length>0&&(this.get("buyBucket").disable(),t.each(i,function(e,t){a("#"+t+"Error").html(e)}),i.diskSize&&t.each(e.children,function(e){e.disable()}))},require("er/util").inherits(e,i),e}),define("bcc/cds/Detail",["require","bat-ria/mvc/BaseAction","jquery","er/util","underscore","inf-ria/helper","inf-i18n","common/constants","inf-ria/utils/mtools","../events","../config","common/billing/common","common/flags","./DetailModel","./DetailView","../operations","er/events"],function(require){function e(){u.apply(this,arguments)}function t(){var e=this.model.get("disk");w.attachCds.call(this,{diskId:this.model.get("diskId"),logicalZone:e.logicalZone})}function a(){w.confirmHandler({title:g("卸载"),content:g("在物理卸载云磁盘前，为了避免因瞬时中断实例内还可能存在的磁盘读写操作而产生的非预期结果，请确保在实例操作系统内已针对该磁盘执行卸载(umount)操作。")},"cds.detach",this.view,{attachment:this.model.get("disk").attachment,instanceId:this.model.get("disk").instanceUuid})}function i(){var e=this,t=this.model.get("disk");e.model.getSnapshotQuto(t.volumeId).then(function(a){a.snapshotCreated>=a.snapshotTotal?w.snapshotTransfinite.call(e,{id:"2"===t.volumeType?t.instanceUuid:t.id,type:t.type,idName:"2"===t.volumeType?"instanceId":"diskId"}):t.type===I.SYSTEM?w.instanceCreateSnapshot.call(e,{instanceId:t.instanceId}):w.cdsCreateSnapshot.call(e,{diskId:e.model.get("diskId"),volumeId:t.volumeId,diskType:t.type,attachment:t.attachment,instanceId:t.instanceId,instanceUuid:t.instanceUuid})})}function n(){w.instanceCreateImage.call(this,{instanceId:this.model.get("disk").instanceId,instanceUuid:this.model.get("disk").instanceUuid})}function s(e){var t=this;this.view.waitActionDialogExt({title:g("释放前确认"),width:600,needFoot:!0,url:"/bcc/instance/require_auth_code",actionOptions:{extraData:e.extraData,requester:x.bccCdsDelete,tip:g("确认释放您的CDS云磁盘？"),isCds:!0,parentAction:this}}).then(function(e){var a=e.target;t.dialog=a;a.getFoot().getChild("btnOk").on("click",function(){a.hide()})})}function r(e){this.redirect("/bcc/cds/upgrade_config~diskId="+this.model.get("disk").id)}function o(e){var t=this.model.get("monitorMetric"),a=b.adjustToChartMetric(t),i=this;m.each(a,function(a,n){var s=p.extend(!0,{},e.params);s.metricNames=a.metrics,s.statistics=a.statistics,i.view.monitorCharts[n]&&(i.view.monitorCharts[n].dispose(),delete i.view.monitorCharts[n]),p("#js-chart-"+n).data({metricNames:s.metricNames,statistics:s.statistics}),i.model.getMonitorTrends(s).then(function(e){i.view.renderMonitorChart(n,e,t[n],s)},function(e){p("#js-chart-"+n).html('<span class="err-tips">'+e.global+"</span>")})})}function c(e){var t=this.model.get("monitorMetric")[e.chart];this.view.waitActionDialog({title:t.name,width:800,url:"/common/bcm/monitorChart",actionOptions:{scope:this.model.get("monitorScope"),dimensions:this.model.get("dimensions"),statistics:e.statistics,timeRange:e.timeRange,periodInSecond:e.periodInSecond,metric:t,apiType:"metricName"}}).then(function(e){e.target.resize()})}function l(){h.redirectToModule("bcm","/bcm/alarm/rule",{scope:v,dimensions:this.model.get("dimensions")})}function d(e){var t=this;this.model.getAlarmState({scope:v,dimensions:this.model.get("dimensions")}).then(function(e){t.view.refreshAlarmState(e)})}var u=require("bat-ria/mvc/BaseAction"),p=require("jquery"),f=require("er/util"),m=require("underscore"),h=require("inf-ria/helper"),g=require("inf-i18n"),v=require("common/constants").MONITOR_SCOPE.CDS,b=require("inf-ria/utils/mtools"),y=require("../events"),T=require("../config"),x=T.api,I=T.DISK_TYPE,S=require("common/billing/common"),E=require("common/flags");e.prototype.modelType=require("./DetailModel"),e.prototype.viewType=require("./DetailView");var w=require("../operations");return e.prototype.redirectAfterDelete=function(){this.redirect("/bcc/cds/list")},e.prototype.initBehavior=function(){u.prototype.initBehavior.call(this,arguments),this.view.on(y.COMMAND,this.dispatchCommand,this),this.view.on(y.ATTACH_CDS,t,this),this.view.on(y.DETACH_CDS,a,this),this.view.on(y.CREATE_SNAPSHOT,i,this),this.view.on(y.CREATE_IMAGE,n,this),this.view.on(y.DELETE_CDS,s,this),this.view.on(y.EXPAND_CDS,r,this),this.view.on(y.REFRESH,this.reload),this.view.on(y.GET_MONITOR_TRENDS,o,this),this.view.on(y.SHOW_DETAIL_TREND,c,this),this.view.on(y.TO_ALARM_DETAIL,l,this),this.view.on(y.GET_ALARM_STATE,d,this),this.on("beforeleave",function(){clearInterval(this.view.timer),require("er/events").un("monitorChartsResize"),p(window).off("resize.bcc"),p(".icon-show-big").off("click")}),E.enable_baixin||this.view.initMonitor.call(this.view)},e.prototype.syncModelToViewIterator=function(e){switch(e.name){case"name":case"desc":this.view.updateDetailView({key:e.name})}},e.prototype.dispatchCommand=function(e){var t=e.command,a=e.args;try{a=JSON.parse(a)}catch(e){}this[t]&&this[t].call(this,a)},e.prototype.inlineedit=function(e){this.view.showInlineEdit(e)},e.prototype.editName=function(e){var t=this.view.get("inline-edit-for-name-value"),a=this;if(t.validate())return this.model.updateName(e.toUpdate.name,e.data.id).then(function(){a.view.hideInlineEdit({key:"name"})}).fail(f.bind(function(e){e.global?this.view.showToast(e.global,{messageType:"error"}):t.showValidationMessage(!1,e.field&&e.field.name)},a))},e.prototype.editDesc=function(e){var t=this.view.get("inline-edit-for-desc-value"),a=this;if(t.validate())return this.model.updateDesc(e.toUpdate.desc,e.data.id).then(function(){a.view.hideInlineEdit({key:"desc"})}).fail(f.bind(function(e){e.global?this.view.showToast(e.global,{messageType:"error"}):t.showValidationMessage(!1,e.field&&e.field.desc)},a))},e.prototype.recharge=function(){var e=this.model.get("disk");S.recharge("CDS",[e.id+";"+e.volumeId])},e.prototype.relateASP=function(e){var t=""===e.aspId?"设置":"修改";w.relateASP.call(this,{title:t,aspId:e.aspId,volumeId:e.volumeId})},require("er/util").inherits(e,u),e}),define("bcc/cds/detail.tpl",[],function(){return'\x3c!-- target: TPL_bcc_cds_detail --\x3e\n\x3c!-- import: TPL_bcc_cds_detail_main --\x3e\n\x3c!-- target: TPL_bcc_cds_detail_main(master = TPL_bcc_cds_detail_structure) --\x3e\n\x3c!-- block: abstrct-info --\x3e\n<h1 title="${disk.name}">${disk.name}</h1>\n<span class="${statusClass}">\n    ${statusDesc}\n</span>\n\x3c!-- /block --\x3e\n\n\x3c!-- block: operation-info   --\x3e\n<span class="ui-group ui-button-group">\n    \x3c!-- if: !${isSystemDisk} --\x3e\n    <button data-ui="type:Button;id:attachCds;">${i18n.挂载}</button>\n    <button data-ui="type:Button;id:detachCds;">${i18n.卸载}</button>\n    <button data-ui="type:Button;id:expandCds;">${i18n.扩容}</button>\n    <button data-ui="type:Button;id:deleteCds;">${i18n.释放}</button>\n    \x3c!-- /if --\x3e\n    <button data-ui-type="Button"\n        data-ui-id="createSnapshot"\n        data-ui-skin="create">${i18n.创建快照}</button>\n    \x3c!-- if: ${isSystemDisk} --\x3e\n    <button data-ui-type="Button"\n        data-ui-id="createImage"\n        data-ui-skin="create">${i18n.创建镜像}</button>\n    \x3c!-- /if --\x3e\n    \x3c!-- import: TPL_bcc_refreshList --\x3e\n</span>\n\x3c!-- /block --\x3e\n\n\x3c!-- block: detail-info --\x3e\n<div class="instance-info-section">\n    <h2 class="instance-info-title"><em>${i18n.基本信息}</em></h2>\n    <div class="instance-info-content">\n        <ul>\n            <li>\n                ${i18n.区域：}${regionLabel}\n            </li>\n            <li>\n                ID：${disk.volumeId}\n            </li>\n            <li>${i18n.状态：}\n                <span class="${statusClass}">\n                    ${statusDesc}\n                </span>\n            </li>\n            <li>\n                <div class="inline-edit-container">\n                    <div class="inline-edit-label">\n                        ${i18n.名称：}\n                        <span class="truncated update-value" title="${disk.name}">\n                            \x3c!-- if: ${disk.name} --\x3e\n                            ${disk.name}\n                            \x3c!-- else: --\x3e\n                            ${i18n.无}\n                            \x3c!-- /if --\x3e\n                        </span>\n                        \x3c!-- if: ${renameDisable} --\x3e\n                        <span class="link-like state-disabled">${i18n.变更}</span>\n                        \x3c!-- else: --\x3e\n                        <span class="link-like" data-command="inlineedit" data-command-args=\'{"key": "name"}\'>${i18n.变更}</span>\n                        \x3c!-- /if --\x3e\n                    </div>\n                    <div class="inline-edit-main name" for="name">\n                        <input data-ui="id:inline-edit-for-name-value;type:TextBox;value:${disk.name};width:350;" />\n                        <button data-ui="id:inline-edit-for-name-submit;type:Button;skin:ok;">${i18n.保存}</button>\n                        <button data-ui="id:inline-edit-for-name-cancel;type:Button;skin:cancel;">${i18n.取消}</button>\n                        <label data-ui="id:inline-edit-for-name-value-validity;type:Validity"></label>\n                    </div>\n                </div>\n            </li>\n            <li>\n                ${i18n.容量：}${disk.diskSize}GB\n            </li>\n            <li>\n                ${i18n.磁盘类型：}${diskTypeLabel}\n            </li>\n            <li>\n                ${i18n.挂载设备名：}${disk.device}\n            </li>\n            \x3c!-- if: !${isSystemDisk} --\x3e\n                <li>\n                    <div class="inline-edit-container">\n                        <div class="inline-edit-label">\n                            ${i18n.描述：}\n                            <span class="truncated update-value" title="${disk.desc}">\n                                \x3c!-- if: ${disk.desc} --\x3e\n                                ${disk.desc}\n                                \x3c!-- else: --\x3e\n                                ${i18n.无}\n                                \x3c!-- /if --\x3e\n                            </span>\n                            \x3c!-- if: ${!oprationEnable} --\x3e\n                            <span class="link-like state-disabled">${i18n.变更}</span>\n                            \x3c!-- else: --\x3e\n                            <span class="link-like" data-command="inlineedit" data-command-args=\'{"key": "desc"}\'>${i18n.变更}</span>\n                            \x3c!-- /if --\x3e\n                        </div>\n                        <div class="inline-edit-main desc" for="desc">\n                            <input data-ui="id:inline-edit-for-desc-value;type:TextBox;value:${disk.desc};width:350;" />\n                            <button data-ui="id:inline-edit-for-desc-submit;type:Button;skin:ok;">${i18n.保存}</button>\n                            <button data-ui="id:inline-edit-for-desc-cancel;type:Button;skin:cancel;">${i18n.取消}</button>\n                            <label data-ui="id:inline-edit-for-desc-value-validity;type:Validity"></label>\n                        </div>\n                    </div>\n                </li>\n            \x3c!-- /if --\x3e\n            <li>\n                ${i18n.挂载实例名：}\n                \x3c!-- if: ${disk.instanceId} --\x3e\n                    \x3c!-- if: ${disk.status} === \'in-use\' --\x3e\n                        \x3c!-- if: (${disk.instanceType} === \'1\' || ${disk.instanceType} === 1) && !${isSubUser} --\x3e\n                        <a href="#/dcc/instance/detail~instanceId=${disk.instanceUuid}">${disk.instanceName}</a>\n                        \x3c!-- else: --\x3e\n                        <a href="#/bcc/instance/detail~instanceId=${disk.instanceUuid}">${disk.instanceName}</a>\n                        \x3c!-- /if --\x3e\n                    \x3c!-- else: --\x3e\n                    ${disk.instanceName}\n                    \x3c!-- /if --\x3e\n                \x3c!-- else: --\x3e\n                ${i18n.未挂载}\n                \x3c!-- /if --\x3e\n            </li>\n            <li>\n                ${i18n.自动快照策略：}\n                <span>\n                    ${aspName}\n                    \x3c!-- if: ${aspName} !== \'--\' --\x3e\n                    <span data-ui-type="Tip">\n                        ${aspNameTip|raw}\n                    </span>\n                    \x3c!-- /if --\x3e\n                    \x3c!-- if: ${aspBtnDisplay} --\x3e\n                    <span class="link-like" data-command="relateASP" data-command-args=\'{"aspId": "${aspId}", "volumeId": "${disk.volumeId}"}\'>${aspBtnText}</span>\n                    \x3c!-- /if --\x3e\n                </span>\n            </li>\n        </ul>\n    </div>\n</div>\n<div class="separator"></div>\n<div class="instance-info-section">\n    <h2 class="instance-info-title"><em>${i18n.支付信息}</em></h2>\n    <div class="instance-info-content">\n        <ul>\n            <li>${i18n.支付方式：}\n                <span>${payment}</span>\n                \x3c!-- if: !${rechargeDisable} --\x3e\n                <span data-command="recharge"\n                        class="link-like">${i18n.续费}</button>\n                \x3c!-- /if --\x3e\n            </li>\n            <li>\n                ${i18n.创建时间：}${disk.createTime|formatTime}\n            </li>\n            <li>${i18n.到期时间：}\n                <span>\n                    \x3c!-- if: ${isPostpay} --\x3e\n                    ${i18n.未设置释放时间}\n                    \x3c!-- else --\x3e\n                    ${disk.expireTime|formatTime}\n                    \x3c!-- /if --\x3e\n                </span>\n            </li>\n        </ul>\n    </div>\n</div>\n<div class="separator"></div>\n<div class="cb"></div>\n    \x3c!-- if: !${consoleContext.FLAGS.enable_baixin} --\x3e\n    <div class="instance-profile-wrap instance-profile-monitor monitor">\n        <h2 class="instance-info-title"><em>${i18n.监控信息}</em></h2>\n        \x3c!-- import: TPL_alarm_state_summary --\x3e\n        \x3c!-- use: monitor_trend_search(type="monitor") --\x3e\n        <div class="monitor-trends">\n            \x3c!-- for: ${monitorMetric} as ${chartMetric}, ${chart} --\x3e\n            <div class="monitor-trend-box">\n                <div class="monitor-trend-wrap">\n                    <span class="title">${chartMetric.name}</span>\n                    <span class="icon-show-big" data-chart="${chart}"></span>\n                    <div class="chart" id="js-chart-${chart}"></div>\n                </div>\n            </div>\n            \x3c!-- /for --\x3e\n        </div>\n    </div>\n    \x3c!-- /if --\x3e\n\x3c!-- /block --\x3e\n\x3c!-- block: detail-monitor --\x3e\n    <div class="cb"></div>\n    \x3c!-- if: !${consoleContext.FLAGS.enable_baixin} --\x3e\n    <div class="instance-profile-wrap instance-profile-monitor monitor">\n        <h2 class="instance-info-title"><em>${i18n.监控信息}</em></h2>\n        \x3c!-- import: TPL_alarm_state_summary --\x3e\n        \x3c!-- use: monitor_trend_search(type="monitor") --\x3e\n        <div class="monitor-trends">\n            \x3c!-- for: ${monitorMetric} as ${chartMetric}, ${chart} --\x3e\n            <div class="monitor-trend-box">\n                <div class="monitor-trend-wrap">\n                    <span class="title">${chartMetric.name}</span>\n                    <span class="icon-show-big" data-chart="${chart}"></span>\n                    <div class="chart" id="js-chart-${chart}"></div>\n                </div>\n            </div>\n            \x3c!-- /for --\x3e\n        </div>\n    </div>\n    \x3c!-- /if --\x3e\n\x3c!-- /block --\x3e'}),define("bcc/cds/DetailModel",["require","bat-ria/mvc/BaseModel","underscore","lodash","common/region","common/zone","common/util","common/util/PermissionChecker","./rules","../config","../enum","../util","er/events","./config","common/constants","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("bat-ria/mvc/BaseModel"),a=require("underscore"),i=require("lodash"),n=require("common/region"),s=require("common/zone"),r=require("common/util").isSubUser(),o=require("common/util/PermissionChecker"),c=require("./rules"),l=require("../config"),d=require("../enum"),u=require("../util"),p=l.api,f=l.DISK_STATUS,m=l.SYSTEM_DISK_STATUS;return e.prototype.defaultArgs=function(){return{diskId:this.get("diskId")}},e.prototype.datasource={menu:function(e){return"disk"},disk:function(e){return p.bccDiskDetail({diskId:e.get("diskId"),instanceId:e.get("instanceId")},{globalFailCallback:function(){require("er/events").fire("globalError",{service:"CDS"})}}).then(function(t){return e.set("oprationEnable",!a.contains(f.CAN_DO_NOTHING,t.status)),t.volumeId=t.volumeId||t.id,e.set("regionLabel",[n.getCurrentRegion().label,s.getLabel(t.logicalZone)].join("，")),t})},tab:function(){return{detail:"ui-tab-item-active"}},monitorMetric:function(e){return require("./config").monitorMetric}},e.prototype.prepare=function(){var e=l.DISK_TYPE,t=l.PAYMENT,a=this.get("disk"),n=a.type===e.SYSTEM,s=a.payment===t.POSTPAY;n&&(a.device="/dev/vda"),!a.device&&(a.device="--"),this.set("isSystemDisk",n),this.set("isPostpay",s),this.set("diskTypeLabel",e.TXT[a.type]||a.type||"");var p=this;i.each(["rename","recharge","attach","detach","EXPAND_CDS","DELETE","createImage","createSnapshot"],function(e){p.set(e.toLowerCase()+"Disable",o.check(c,a,e)[e].disable)});var h=require("common/constants"),g=n?m:f;this.set("statusDesc",g.TXT[a.status]||a.status),this.set("statusClass",g.CLASS[a.status]||"status error"),this.set("payment",l.PAYMENT_DESC[a.payment]),this.set("monitorScope",h.MONITOR_SCOPE.CDS),this.set("dimensions","VolumeId:"+this.get("disk").id),this.set("isSubUser",r);var v=a.aspDetail,b="",y="--",T="关联自动快照策略";if(v&&!i.isEmpty(v)){b=v.aspId,y=v.name;var x=u.get24HoursTime(),I="";i.each(v.timePoints,function(e){I+=x[e]+"、"});var S="";i.each(v.repeatWeekdays,function(e){S+=d.Week.getTextFromValue(e)+"、"});var E='<span><label>创建时间：</label><span class="cds-detail-time-span">'+i.trimRight(I,"、")+"</span></span>"+"<br>"+('<span><label>重复日期：</label><span class="cds-detail-time-span">'+i.trimRight(S,"、")+"</span></span>")+"<br>"+("<span>保留时间："+(-1===v.retentionDays?"永久保留":v.retentionDays+"天后自动删除")+"</span>");this.set("aspNameTip",E),T="修改"}this.set("aspId",b),this.set("aspName",y),this.set("aspBtnText",T),"in-use"===a.status&&this.set("aspBtnDisplay",!0)},e.prototype.getMonitorTrends=function(e){return p.bcmMetricDataMetricName(e)},e.prototype.getAlarmState=function(e){return p.bcmAlarmStateSummary(e)},e.prototype.updateName=function(e,t){var a=this;return p.bccCdsRename({diskId:t,name:e},{"x-silent":!0}).then(function(){a.get("disk").name=e,a.set("name",e)})},e.prototype.updateDesc=function(e,t){var a=this;return p.bccCdsUpdateDesc({diskId:t,desc:e},{"x-silent":!0}).then(function(){a.get("disk").desc=e,a.set("desc",e)})},e.prototype.getSnapshotQuto=function(e){return p.bccQuota({objType:"snapshot",volumeId:e},{"x-silent":!0}).then(function(e){return{snapshotTotal:e.snapshotTotal,snapshotCreated:e.snapshotCreated}})},require("er/util").inherits(e,t),e}),define("bcc/cds/DetailView",["require","bat-ria/tpl!./detail.tpl","bat-ria/mvc/BaseView","../events","jquery","underscore","inf-ria/echarts","inf-ria/utils/mtools","common/constants","common/util","../config","../util","er/events","er/util"],function(require){function e(){t.apply(this,arguments)}require("bat-ria/tpl!./detail.tpl");var t=require("bat-ria/mvc/BaseView"),a=require("../events"),i=require("jquery"),n=require("underscore"),s=require("inf-ria/echarts"),r=require("inf-ria/utils/mtools"),o=require("common/constants"),c=require("common/util").isSubUser(),l=require("../config"),d=require("../util");return e.prototype.template="TPL_bcc_cds_detail",e.prototype.uiProperties={"inline-edit-for-name-value":n.defaults({validityLabel:"inline-edit-for-name-value-validity"},l.RULE.NAME),"inline-edit-for-desc-value":n.defaults({validityLabel:"inline-edit-for-desc-value-validity"},l.RULE.DESCRIPTION),detailTab:{activeIndex:0},attachCds:{disabled:"@attachDisable"},detachCds:{disabled:"@detachDisable"},createSnapshot:{disabled:"@createsnapshotDisable"},createImage:{disabled:"@createimageDisable"},deleteCds:{disabled:"@deleteDisable"},expandCds:{disabled:"@expand_cdsDisable"},toAlarm:{hidden:c}},e.prototype.uiEvents={"cdsInfoDetailPanel:command":function(e){var t=n.extend(e.args||{},{data:this.model.get("disk")});d.triggerCommand.call(this,e.name,t),e.stopPropagation(),e.preventDefault()},"inline-edit-for-name-submit:click":function(e){d.triggerCommand.call(this,"editName",{data:this.model.get("disk"),toUpdate:{name:this.get("inline-edit-for-name-value").getValue()}})},"inline-edit-for-desc-submit:click":function(e){d.triggerCommand.call(this,"editDesc",{data:this.model.get("disk"),toUpdate:{desc:this.get("inline-edit-for-desc-value").getValue()}})},"inline-edit-for-name-cancel:click":function(e){this.get("inline-edit-for-name-value").setValue(this.model.get("disk").name),this.hideInlineEdit({key:"name"})},"inline-edit-for-desc-cancel:click":function(e){this.get("inline-edit-for-desc-value").setValue(this.model.get("disk").desc),this.hideInlineEdit({key:"desc"})},"attachCds:click":function(e){this.fire(a.ATTACH_CDS)},"detachCds:click":function(e){this.fire(a.DETACH_CDS)},"createSnapshot:click":function(e){this.fire(a.CREATE_SNAPSHOT)},"createImage:click":function(e){this.fire(a.CREATE_IMAGE)},"deleteCds:click":function(e){this.fire(a.DELETE_CDS,{extraData:{diskId:this.getDiskId()}})},"expandCds:click":function(e){this.fire(a.EXPAND_CDS)},"recharge:click":function(e){this.fire(a.RECHARGE)},"refreshList:click":function(e){this.fire(a.REFRESH)},"monitorTimeRange:change":function(){this.getMonitorTrends()},"monitorRefresh:click":function(){this.getMonitorTrends()},"toAlarm:click":function(){this.fire(a.TO_ALARM_DETAIL)}},e.prototype.getDiskId=function(){return this.model.get("diskId")},e.prototype.initMonitor=function(){var e=this;e.monitorCharts={},e.registerMonitorEvents(),e.fire(a.GET_ALARM_STATE),e.getMonitorTrends(),e.timer=setInterval(function(){e.fire(a.GET_ALARM_STATE)},o.ALARM_STATE_QUERY_PERIOD),require("er/events").on("monitorChartsResize",function(e){n.each(this.monitorCharts,function(e,t){e&&e.resize()})},this)},e.prototype.registerMonitorEvents=function(){var e=this;i(window).on("resize.bcc",function(){require("er/events").fire("monitorChartsResize")}),i(".icon-show-big").click(function(t){var n=i(this).attr("data-chart"),s=i("#js-chart-"+n).data("statistics"),r=e.get("monitorTimeRange").getValue(),o=l.monitorDefaultPeriod[r]||60;e.fire(a.SHOW_DETAIL_TREND,{chart:n,statistics:s,timeRange:r,periodInSecond:o})})},e.prototype.getMonitorTrends=function(){var e=this.get("monitorTimeRange").getValue(),t=l.monitorDefaultPeriod[e]||60,i={periodInSecond:t,startTime:(e=r.getUTCTimeRange(e,t)).startTime,endTime:e.endTime,dimensions:this.model.get("dimensions"),scope:this.model.get("monitorScope")};this.fire(a.GET_MONITOR_TRENDS,{params:i})},e.prototype.renderMonitorChart=function(e,t,a,i){a.statistics=i.statistics,r.adjustSeriesData(t,i.statistics);var n=r.getChartOptions(t,a,{type:"line"},{period:i.periodInSecond});this.monitorCharts[e]=s.init(document.getElementById("js-chart-"+e)),this.monitorCharts[e].setOption(n,!0)},e.prototype.refreshAlarmState=function(e){i("#js-alarm-state-ok").text(e.okStateCount),i("#js-alarm-state-alarm").text(e.alarmStateCount),i("#js-alarm-state-insufficient").text(e.insufficientStateCount)},e.prototype.updateDetailView=function(e){var t=e.key,a=n.escape(this.model.get("disk")[t]);i(".inline-edit-main[for="+t+"]").parent(".inline-edit-container").find(".update-value").html(a)},e.prototype.showInlineEdit=function(e){var t=e.key;i(".inline-edit-main[for="+t+"]").show()},e.prototype.hideInlineEdit=function(e){var t=e.key;i(".inline-edit-main[for="+t+"]").hide()},require("er/util").inherits(e,t),e}),define("bcc/cds/helper",["exports","underscore","babel-runtime/helpers/interop-require-default","common/constants","common/region","common/zone","common/util/moneyUtil","../enum","../config"],function(exports,e,t,a,i,n,s,r,o){exports.__esModule=!0,exports.formData2OrderItems=function(e){var t=arguments.length<=1||arguments[1]===undefined?{pricePerDiskList:[]}:arguments[1],a=l["default"].SERVICE_TYPE.CDS.chargeType[e.productType],i=e.productType===o.PAYMENT.PREPAY?e.month||e.purchaseLength:"",n=e.productType===o.PAYMENT.PREPAY?"/个":"/分钟/个",s=e.purchaseNum||1,f=c["default"].reduce(e.ebsSize||e.diskSize,function(o,l,f){var m=l.size+l.snapshotId+l.volumeType,h=o[m],g=t.pricePerDiskList[f]||0,v=["地域："+d["default"].getLabel(e.region),"可用区："+u["default"].getLabel(e.logicalZone),"容量："+l.size+"GB"+(l.snapshotName?'（从快照"'+l.snapshotName+'"创建）':""),"类型："+r.DiskTypeConfirm.getTextFromValue(l.volumeType)];return h?(h.count+=s,h.price+=g*s):o[m]=c["default"].extend({},{serviceType:"CDS",productType:e.productType,count:s,time:i,timeUnit:"MONTH",unitPrice:g,unitPriceShow:"￥"+p["default"].convertPrice(g).getPriceOfMinute()+n,price:g*s,chargeType:a,configuration:v}),o},{});return c["default"].map(f,function(e){return e})};var c=t["default"](e),l=t["default"](a),d=t["default"](i),u=t["default"](n),p=t["default"](s)}),define("bcc/cds/List",["require","../mvc/ListAction","underscore","er/util","inf-i18n","inf-ria/app/brpc","common/billing/common","../events","../util","../config","../enum","./ListModel","./ListView","er/URL","../operations"],function(require){function e(){f.apply(this,arguments)}function t(){var e=this.model.get("instanceId");this.redirect("/bcc/cds/create"+(e?"~instanceId="+e+"&logicalZone="+this.model.get("instance").logicalZone:""))}function a(){this.view.showToast(g("已复制到剪贴板"))}function i(e){this.redirect(require("er/URL").withQuery("/bcc/cds/detail",{diskId:e.diskId}))}function n(e){k.attachCds.call(this,{diskId:e.item.id,logicalZone:e.item.logicalZone})}function s(e){k.confirmHandler({title:g("卸载"),content:this.model.get("tips").cds.detachTip,width:480,encode:!1},"cds.detach",this.view,{attachment:e.item.attachment,instanceId:e.item.instanceUuid})}function r(e){o({instanceIds:[e.item.id+";"+e.item.volumeId]})}function o(e){b.recharge("CDS",e.instanceIds)}function c(e){var t=e.item,a=this;a.model.getSnapshotQuto(t.volumeId).then(function(e){e.snapshotCreated>=e.snapshotTotal?k.snapshotTransfinite.call(a,{id:"2"===t.volumeType?t.instanceUuid:t.id,type:t.type,idName:"2"===t.volumeType?"instanceId":"diskId"}):t.type===E.SYSTEM?k.instanceCreateSnapshot.call(a,{instanceId:t.instanceId}):k.cdsCreateSnapshot.call(a,{diskId:t.id,volumeId:t.volumeId,diskType:t.type,attachment:t.attachment,instanceId:t.instanceId})})}function l(e){var t=!m.isEmpty(e.item.aspDetail)&&e.item.aspDetail.aspId,a=e.item.volumeId,i=""===t?"设置":"修改";k.relateASP.call(this,{title:i,aspId:t,volumeId:a})}function d(e){k.instanceCreateImage.call(this,{instanceId:e.item.instanceId,instanceUuid:e.item.instanceUuid})}function u(e){var t=this,a=this.model.get("tableData")[parseInt(e.rowIndex,10)];k.handler("cds.rename",this.view,{name:e.value,diskId:a.id},null,function(e){t.view.get("table").showEditError(e.field.name)})}function p(e){var t=this;this.view.waitActionDialogExt({title:"释放前确认",width:600,needFoot:!0,url:"/bcc/instance/require_auth_code",actionOptions:{extraData:{diskId:e.diskIds.join(",")},requester:S.bccCdsDelete,tip:"确认释放您的CDS云磁盘？",isCds:!0,parentAction:this}}).then(function(e){var a=e.target;t.dialog=a;a.getFoot().getChild("btnOk").on("click",function(){a.hide()}),a.on("cancel",function(){t.view.resetMoreOperation()}),a.on("close",function(){t.view.resetMoreOperation()})})}var f=require("../mvc/ListAction"),m=require("underscore"),h=require("er/util"),g=require("inf-i18n"),v=require("inf-ria/app/brpc"),b=require("common/billing/common"),y=require("../events"),T=require("../util"),x=require("../config"),I=require("../enum"),S=x.api,E=x.DISK_TYPE,w=I.ProductType;e.prototype.modelType=require("./ListModel"),e.prototype.viewType=require("./ListView");var k=require("../operations");return e.prototype.refreshTableStatus=function(e){var t=this.view.get("table");this.model.listRequester(this.model.getQuery(),{"X-silence":!0}).then(function(a){a&&a.result&&a.result.length>1&&m.each(t.datasource,function(i,n){var s=a.result[n]&&a.result[n].id===i.id&&a.result[n].status||i.status;if(i.status!==s){var r='<span class="'+(x.SYSTEM_DISK_STATUS.CLASS[s]||"status normal")+'">'+(x.SYSTEM_DISK_STATUS.TXT[s]||"正常")+"</span>";x.DISK_TYPE.SYSTEM!==a.result[n].type&&(r='<span class="'+(x.DISK_STATUS.CLASS[s]||"status error")+'">'+(x.DISK_STATUS.TXT[s]||s)+"</span>"),t.setCellText(r,n,e,!1),i.status=s}})})},e.prototype.setIntervalListenStatus=function(){var e=T.getStatusColumnIndex(this.view.get("table"),"status");this.timer=setInterval(h.bind(function(){this.refreshTableStatus(e)},this),x.BCC_LISTEN_INTERVAL)},e.prototype.redirectAfterDelete=function(){this.redirect(this.getURLForPage(this.model.get("pageNo")||1))},e.prototype.initBehavior=function(){f.prototype.initBehavior.apply(this,arguments),this.view.on(y.FILTER,this.filterList,this),this.view.on(y.REFRESH,this.refresh,this),this.view.on(y.CREATE_DISK,t,this),this.view.on(y.TO_DETAIL,i,this),this.view.on(y.RECHARGE,r,this),this.view.on(y.SAVE_EDIT,u,this),this.view.on(y.ATTACH_CDS,n,this),this.view.on(y.DETACH_CDS,s,this),this.view.on(y.CREATE_SNAPSHOT,c,this),this.view.on(y.RELATE_ASP,l,this),this.view.on(y.CREATE_IMAGE,d,this),this.view.on(y.EXPAND_CDS,k.expandDisk,this),this.view.on(y.DELETE_CDS,p,this),this.view.on(y.COPYID,a,this),this.view.on(y.RECHARGE_BATCH,o,this),this.view.on(y.ALTER_PRODUCTTYPE,this.alterProductType,this),this.view.on(y.CANCEL_ALTER_PRODUCTTYPE,this.cancelAlterProductType,this),this.view.on(y.EDIT_TAG,this.editTag,this),this.view.initTableSelectItem("id",this.model.get("id")),this.setIntervalListenStatus(),this.on("beforeleave",function(){clearInterval(this.timer)}),this.on("listDataFailed",this.listDataFailedHandler,this)},e.prototype.filterList=function(e){this.model.setFilters(e.condition),this.view.submitSearch(e)},e.prototype.refresh=function(){var e=this.model.getQuery();if(e.keyword||m.isArray(e.filters)&&e.filters.length)return delete e.filters,delete e.keyword,delete e.keywordType,this.redirect(require("er/URL").withQuery("/bcc/cds/list",e));this.asyncListPage()},e.prototype.alterProductType=function(e){if(m.chain(e.productTypes).uniq().value().length>1)return this.view.waitAlert({title:"温馨提示",content:"计费变更已经支持预付费转后付费和后付费转预付费两种模式。<br>请您将预付费资源和后付费资源分开操作，谢谢！",encode:!1});var t=e.productTypes[0]===w.PREPAY?"TO_POSTPAY":"TO_PREPAY";b.alterProductType("CDS",e.instanceIds,t)},e.prototype.cancelAlterProductType=function(e){k.confirmHandler({title:"取消计费变更",content:"确认取消计费变更？<br/>您已开通计费变更-预付费转后付费功能。<br/>实例将会在到期后自动转换为后付费的计费方式。",width:420,encode:!1},"cds.cancelAlterProductType",this.view,{serviceType:"CDS",instanceIds:e.instanceIds})},e.prototype.editTag=function(e){var t=this;m.each(e.data,function(e){e.resoureId=e.volumeId});var a={serviceType:"CDS",instances:e.data,submitRequester:S.bccTagAssign};v.invokeService("tag://edit",a).then(function(){t.reload()})},e.prototype.listDataFailedHandler=function(){this.view.updatePageData({tableData:[]},"<div><p>列表数据加载异常，请刷新页面！</p></div>")},e.prototype.syncModelToViewIterator=function(e){switch(e.name){case"quota":this.view.showQuotaTip()}},e.prototype.filterRedirect=function(e){if(this.context.isChildAction&&e.getPath()!==this.context.url.getPath())return location.href="/bcc/"+location.search+"#"+e.toString(),!1},require("er/util").inherits(e,f),e}),define("bcc/cds/list.tpl",[],function(){return'\x3c!-- target: TPL_bcc_disk --\x3e\n<div class="bcc-disk bcc-main-wrap main-wrap-new">\n    <div class="content-wrap">\n        \x3c!-- if: ${instanceId} --\x3e\n        <p class="breadcrumb">\n            <span>${i18n.产品服务}</span>\n            <span class="divider">/</span>\n            <a href="#/bcc/instance/list">${i18n.云服务器BCC}-${i18n.实例列表}</a>\n            <span class="divider">/</span>\n            <span class="active">${i18n.本实例磁盘}</span>\n        </p>\n        <div class="instance-info">\n            <h1 title="${instance.name}">${instance.name}</h1>\n            <span class="${statusClass}">${statusDesc}</span>\n        </div>\n        <div class="detail-content">\n            <div class="ui-tab-content">\n            \x3c!-- import: TPL_bcc_cds_list_body--\x3e\n            </div>\n        </div>\n        \x3c!-- else --\x3e\n        <p class="breadcrumb">\n            <span>${i18n.产品服务}</span>\n            <span class="divider">/</span>\n            <span class="active">${i18n.云磁盘CDS}-${i18n.磁盘列表}</span>\n        </p>\n        <div class="list-content">\n            \x3c!-- import: TPL_bcc_cds_list_body--\x3e\n        </div>\n        \x3c!-- /if --\x3e\n    </div>\n</div>\n\n\x3c!-- target: TPL_bcc_disk_child --\x3e\n\x3c!-- import: TPL_bcc_cds_list_body --\x3e\n\n\x3c!-- target: TPL_bcc_cds_list_body --\x3e\n\x3c!-- if: !${instanceId} --\x3e\n<h2>\n    ${i18n.磁盘列表}\n    <span class="quota-tip"></span>\n</h2>\n\x3c!-- /if --\x3e\n<div class="table-full-wrap">\n    <div class="link-wrap">\n        \x3c!-- import: TPL_cds_common_quick_search --\x3e\n        <a href="/billing/#/renew/list~serviceType=CDS"><i class="iconfont icon-renewmanage"></i>${i18n.自动续费}</a>\n    </div>\n    <div class="operation-wrap" data-follow-thead="table">\n        <div class="buttons-wrap">\n            <div data-ui-id="createDisk"\n                data-ui-type="Button"\n                data-ui-skin="create"\n                data-ui-extension-popover-type="PopoverEx" data-ui-placement={"center":"top"}>${i18n.创建CDS磁盘}</div>\n            <div data-ui-type="Button"\n                data-ui-id="recharge"\n                title="${i18n.批量续费}" data-ui-extension-popover-type="PopoverEx" data-ui-placement={"center":"top"}>${i18n.续费}</div>\n            <div data-ui-type="Button"\n                data-ui-id="editTag"\n                title="${i18n.标签}" data-ui-extension-popover-type="PopoverEx" data-ui-placement={"center":"top"}>${i18n.编辑标签}</div>\n            <span data-ui-type="Select" data-ui-id="moreOpt" data-ui-skin="light" \n                data-ui-extension-popover-type="PopoverEx"></span>\n        </div>\n        <div class="buttons-quick-wrap">\n            \x3c!-- import: TPL_bcc_search_ex --\x3e\n            <button type="button"\n                data-ui-type="Button" data-ui-id="refreshList" title="${i18n.刷新表格数据，取消筛选条件}">\n                <i class="iconfont icon-cdnrefresh"></i>\n            </button>\n            <button data-ui="type:Button;id:downloadList;" title="${i18n.下载当前列表展现的磁盘信息，编码格式为utf-8}">\n                <i class="iconfont icon-download"></i>\n            </button>\n            <div id="table-custom-fields-container"></div>\n        </div>\n    </div>\n    <div data-ui-type="Table" data-ui-id="table"\n         data-ui-datasource="@tableData"\n         data-ui-order-by="@orderBy" data-ui-order="@order"\n         data-ui-select="@selectMode" data-ui-extension-tip-type="TableTip"\n         data-ui-extension-command-type="Command"\n         data-ui-extension-tableedit-type="TableEdit"\n         data-ui-extension-tableex-type="TableEx"\n         data-ui-extension-customfields-type="TableCustomFields"\n         data-ui-extension-tablefilter-type="TableFilter">\n    </div>\n    <div class="ui-row clearfix">\n        \x3c!-- import: listPager --\x3e\n    </div>\n</div>\n'}),define("bcc/cds/ListModel",["require","../mvc/ListModel","underscore","common/util","common/region","../config","../tips","er/URL","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("../mvc/ListModel"),a=require("underscore"),i=require("common/util").isSubUser(),n=require("common/region"),s=require("../config"),r=s.api,o=s.INSTANCE_STATUS,c=s.FILTER,l={"X-silence":!0};return e.prototype.datasource={menu:function(e){return e.get("instanceId")?"instance":"disk"},tips:function(){return require("../tips")},instance:function(e){var t=e.get("instanceId");if(t)return r.bccInstanceDetail({instanceId:t})},bccTags:function(e){return r.getSearchTagList({serviceType:["BCC","CDS"],region:[n.getCurrentRegion().id]}).then(function(e){var t=a.groupBy(e,"tagKey");return a.each(t,function(e,i){t[i]=a.map(e,function(e){return{name:e.tagValue||"空值",value:e.tagValue}}),t[i].unshift({name:"所有值",value:"@@@"})}),t})},tab:function(){return{cds:"ui-tab-item-active"}},aspQuota:function(){return r.bccQuota({objType:"asp"},{"x-silent":!0}).then(function(e){return{aspCreated:e.aspCreated,aspTotal:e.aspTotal}})}},e.prototype.listRequester=function(e){var t=this.get("aspQuota");return r.bccDiskList(e,{"x-silent":!0}).then(function(e){return a.each(e.result,function(e){e.existASP=t.aspCreated>0}),e})},e.prototype.getExtraQuery=function(){var e=this.get("instanceId");if(e)return{instanceId:e}},e.prototype.filterQuery=function(e){var t=[],i=e.keyword,n=e.keywordType;if(e.filters){var s=e.filters;delete e.filters;try{s=JSON.parse(s)}catch(r){}a.each(s,function(a){"expiredDate<7"===a.join("")?e.showMode="WILLEXPIRED":"asp<7"===a.join("")?e.noSnapshotDay=7:("type"===a[0]&&(a[0]="storageType"),t.push({keywordType:a[0],keyword:a[1]}))})}return n.match(/^tag\/([\u4e00-\u9fa5\w\-\/\.]{0,64})$/)&&(n="tag","空值"===i&&(i=""),"所有值"===i&&(i="@@@")),(e.keyword||"tag"===n)&&t.push({keywordType:n,subKeywordType:e.subKeywordType||"",keyword:i||""}),e.filters=t,"id"===e.orderBy&&(e.orderBy="name"),e},e.prototype.prepare=function(){var e=this,t=this.get("instance");if(t){var n=t.status;this.set("statusDesc",o.TXT[n]||n),this.set("statusClass",o.CLASS[n]),this.set("createDisabled",!a.contains(o.CAN_CREATE_DISK,t.status)||i)}else this.set("createDisabled",i);var s="<div><p>你还没创建任何实例！</br>",c=this.get("instanceId");s+=c?'<a href="#/bcc/instance/create~instanceId='+c+'">马上创建&gt;&gt;</a>':'<a href="#/bcc/instance/create">马上创建&gt;&gt;</a>',s+="</p></div>",this.set("createUrl",s),r.bccQuota({objType:"cds"},l).then(function(t){e.set("quota",t)});var d=this.get("filters");if("string"==typeof d){try{d=JSON.parse(d)}catch(p){}this.set("filters",d);var u={};a.each(d,function(e){u[e.join("")]=!0}),this.set("filterMapper",u)}this.set("keywordTypeDatasource",this.getSeachDatasource())},e.prototype.getSeachDatasource=function(){var e=a.map(a.keys(this.get("bccTags")),function(e){return{name:e,value:e}});return[c.DISK.NAME,c.DISK.ID,c.DISK.INSTANCE_NAME,c.DISK.ASPID,{name:"标签",value:"tag",children:e}]},e.prototype.getSnapshotQuto=function(e){return r.bccQuota({objType:"snapshot",volumeId:e},{"x-silent":!0}).then(function(e){return{snapshotTotal:e.snapshotTotal,snapshotCreated:e.snapshotCreated}})},e.prototype.defaultArgs={keywordType:s.FILTER.DISK.NAME.value,order:"desc",orderBy:"createTime",pageSize:s.pageSize},e.prototype.getDownloadUrl=function(){var e=this.getQuery();return e.filters&&(e.filters=JSON.stringify(e.filters)),delete e.pageNo,delete e.pageSize,"/api/bcc/cds/download?"+require("er/URL").serialize(e)},e.prototype.setFilters=function(e){this.set("filters",e)},require("er/util").inherits(e,t),e}),define("bcc/cds/ListView",["require","bat-ria/tpl!./list.tpl","inf-ria/ui/Clipboard","inf-ria/ui/extension/PopoverEx","underscore","etpl","jquery","../mvc/ListView","inf-i18n","common/util/timeUtil","common/util/tableUtil","common/zone","common/util","common/region","../events","../enum","../config","./rules","common/util/PermissionChecker","er/util"],function(require){function e(){r.apply(this,arguments)}function t(e){return e.type===T.SYSTEM}function a(e,t,a){var s=!1;s=a?i.contains(y.CAN_CREATE_SNAPSHOT,e.status)&&e.imageType!==I.MKT:i.contains(b.CAN_CREATE_SNAPSHOT,e.status);return n.compile(w)({label:o("创建快照"),command:f.CREATE_SNAPSHOT,args:t,className:s?"":"state-disabled",disabled:s?"":"disabled"})}require("bat-ria/tpl!./list.tpl"),require("inf-ria/ui/Clipboard"),require("inf-ria/ui/extension/PopoverEx");var i=require("underscore"),n=require("etpl"),s=require("jquery"),r=require("../mvc/ListView"),o=require("inf-i18n"),c=require("common/util/timeUtil"),l=require("common/util/tableUtil"),d=require("common/zone"),u=require("common/util").isSubUser(),p=require("common/region"),f=require("../events"),m=require("../enum"),h=require("../config"),g=require("./rules"),v=require("common/util/PermissionChecker"),b=h.DISK_STATUS,y=h.SYSTEM_DISK_STATUS,T=h.DISK_TYPE,x=h.PAYMENT,I=m.ImageType,S=m.MoreOperation;e.prototype.template="TPL_bcc_disk";var E=[{field:"id",title:o("磁盘名称/ID"),width:"15%",minWidth:120,sortable:!0,content:function(e,a,n){var s=e.volumeId||e.id,r='<span class="instance-id">'+s+'</span><button data-ui-type="Clipboard" class="link-like link-copy"data-ui-clipboard-text="'+s+'"data-ui-x-event-name="clipboard"data-ui-x-event-type="aftercopy,error"data-ui-x-event-bubble="true"data-ui-id="copyId'+a+'"><i class="iconfont icon-copy" title='+o("复制到剪贴板")+"></i></button>";if(!e.name)return r;var c=!t(e)&&e.status!==b.CREATING&&e.status!==b.ERROR,l=i.escape(e.name),d=c?'<span class="ui-table-cell-editentry"data-row="'+a+'" data-col="'+n+'"><i class="iconfont icon-edit"></i></span>':"",u=t(e)?"instanceId="+e.instanceUuid:"diskId="+e.id,p="";if(e.aspDetail&&"active"===e.aspDetail.status){var f="磁盘自动快照已开启",m="";"suspend"===e.aspDetail.taskStatus?(f="磁盘快照已达上限，无法继续自动快照策略",m="asp-warn"):"active"!==e.status&&"in-use"!==e.status&&(f="未成功挂载的磁盘不能进行自动快照",m="asp-warn"),p='<i class="iconfont icon-auto-snapshot '+m+'" title='+o(f)+"></i>"}return'<a href="#/bcc/cds/detail~'+u+'" title="'+l+'" class="instance-name">'+l+"</a>"+p+d+"<br/>"+r},editable:function(e){return!t(e)&&e.status!==b.CREATING&&e.status!==b.ERROR},editContent:function(e){return i.escape(e.name)},editNote:h.RULE.NAME.placeholder,editRules:i.omit(h.RULE.NAME,"placeholder")},{field:"status",title:o("状态"),width:"9%",minWidth:75,filter:{datasource:m.DiskStatus.getFilterStatus()},content:function(e){var a=e.status;"to_prepay"===e.orderStatus&&(a=b.BILLING_CHANGING);var i='<span class="'+(y.CLASS[a]||"status normal")+'">'+(y.TXT[a]||"正常")+"</span>";return t(e)||(i='<span class="'+(b.CLASS[a]||"status error")+'">'+(b.TXT[a]||a)+"</span>"),i}},{field:"payment",title:o("支付方式"),width:"9%",minWidth:98,filter:{datasource:[{name:o("全部"),value:""},{name:o("预付费"),value:"prepay"},{name:o("后付费"),value:"postpay"}]},content:function(e){var a=o("该实例已开通计费变更-预付费转后付费，将会在到期后转为后付费资源，请关注！<br>如需进行续费、升配等操作，请先取消计费变更，谢谢！");return e.payment!==x.PREPAY||"to_postpay"!==e.orderStatus||t(e)||i.contains(b.CAN_DO_NOTHING,e.status)||u?h.PAYMENT_DESC[e.payment]:h.PAYMENT_DESC[e.payment]+'&nbsp;<span data-ui-type="Tip"data-ui-id="alterProductTip${row}"data-ui-skin="warning"data-ui-arrow="true"data-ui-content="'+a+'"></span>'}},{title:o("创建时间"),field:"createTime",width:"11%",minWidth:96,sortable:!0,content:function(e){return c.toDate(e.createTime)}},{title:o("到期时间"),field:"expireTime",width:"11%",minWidth:96,sortable:!0,content:function(e,a,n){var s="",r="",l="<a href='/billing/#/billing/recharge/list~serviceType=CDS&instanceIds="+e.id+";"+e.volumeId+"&region="+p.getCurrentRegion().id+"'>"+o("续费入口")+">></a>";return t(e)||(r=e.status===b.EXPIRED?o("您的磁盘已经过期，请您尽快续费。")+l:i.sprintf(o("您的磁盘还有%s天到期​，请您尽快续费。"),e.expireDate-1)+l,e.expireDate<7&&!e.orderStatus&&(s='<span data-ui-type="Tip"data-ui-id="expireTimeTip${row}"data-ui-skin="warning"data-ui-arrow="true"data-ui-content="'+r+'"></span>')),e.payment===x.PREPAY?c.toDate(e.expireTime)+s:"-"}},{field:"instance",title:o("所属实例名称"),width:"10%",minWidth:"80",content:function(e){var t=i.escape(e.instanceName),a=e.instanceId?'<span class="instance-name" title="'+t+'">'+t+"</span>":"-";return e.instanceId&&e.status===b.IN_USE&&(a="1"!==e.instanceType&&1!==e.instanceType||u?'<a href="#/bcc/instance/detail~instanceId='+e.instanceUuid+'" class="instance-name" title="'+t+'">'+t+"</a>":'<a href="#/dcc/instance/detail~instanceId='+e.instanceUuid+'" class="instance-name" title="'+t+'">'+t+"</a>"),a}},{field:"volumeType",title:o("磁盘作用"),width:"9%",minWidth:100,filter:{datasource:m.VolumeType.getFilterType()},content:function(e){return m.VolumeType.getTextFromValue(e.volumeType)||""}},{field:"type",title:o("磁盘类型"),width:"9%",minWidth:100,filter:{datasource:m.StorageType.getFilterType()},content:function(e){return m.StorageType.getTextFromValue(e.storageType)||""}},{field:"device",title:o("挂载设备名"),width:"11%",content:function(e){return t(e)?"/dev/vda":i.escape(e.device)||"-"}},{field:"diskSize",title:o("容量"),width:"9%",content:function(e){return i.escape(e.diskSize)+"GB"}},{field:"logicalZone",title:o("所在可用区"),width:"9%",minWidth:80,content:function(e){return d.getLabel(e.logicalZone)}},{field:"tag",title:o("标签"),sortable:!0,width:"9%",content:function(e,t,a){if(!e.tags||e.tags.length<1)return"-";var n="",s="";return i.each(e.tags,function(e,t){s+="{"+e.tagKey+":"+e.tagValue+"} ",t<2&&(n+=e.tagKey+" : "+e.tagValue+"<br/>")}),e.tags.length>2&&(n+="..."),'<div title="'+s+'">'+n+"</div>"}},{field:"operation",title:o("操作"),width:"12%",minWidth:97,content:function(e,s){var r="";return t(e)?(r+=a(e,s,!0),r+=function(e,t){var a=i.contains(y.CAN_CREATE_IMAGE,e.status)&&e.imageType!==I.MKT;return n.compile(w)({label:o("创建镜像"),command:f.CREATE_IMAGE,args:t,className:a?"":"state-disabled",disabled:a?"":"disabled"})}(e,s)):(r+=function(e,t){var a=i.contains(b.CAN_ATTACH,e.status);return n.compile(w)({label:o("挂载"),command:f.ATTACH_CDS,args:t,className:a?"":"state-disabled",disabled:a?"":"disabled"})}(e,s),r+=function(e,t){var a=i.contains(b.CAN_DETACH,e.status)||e.status===b.EXPIRED&&e.instanceId;return n.compile(w)({label:o("卸载"),command:f.DETACH_CDS,args:t,className:a?"":"state-disabled",disabled:a?"":"disabled"})}(e,s),r+=a(e,s)),"5"!==e.storageType&&(r+=function(e,t){var a=!e.existASP||e.status!==b.IN_USE,i=a?'data-ui-disabled="true" ':"",s="";e.status!==b.IN_USE&&(s=o("策略只能关联至已挂载实例的磁盘上")),!e.existASP&&(s=o("<span>请先去创建自动快照策略<a href=#/bcc/snapshot/aspList>立即创建</a><span>"));var r='<span class="oprations"><div '+(a?"":'data-command="${command}" data-command-args="${args}" ')+i+'data-ui-type="Button" class="cmd-button ${className}" data-ui-extension-popover-type="PopoverEx" data-ui-popover="'+s+'">${label}</div><span>';return n.compile(r)({label:o("关联自动快照策略"),command:f.RELATE_ASP,args:t})}(e,s)),r}}],w='<span class="oprations"><button data-command="${command}" data-command-args="${args}" class="cmd-button ${className}" ${disabled}>${label}</button></span>';return e.prototype.uiProperties={createDisk:{disabled:"@createDisabled"},keywordType:{datasource:"@keywordTypeDatasource"},keyword:{placeholder:o("请输入磁盘名称进行搜索")},table:l.tableProperty(E,{followHead:!0,followHeadOffsetH:50,noFollowHeadCache:!0,followDoms:[s(".operation-wrap")[0]],editable:1,select:"multi",noDataHtml:"<div><p>"+o("没有可选择的磁盘!")+"</p></div>",extTableEx:["id","payment","expireTime","operation"],extTableCustomFields:{container:"#table-custom-fields-container",defaults:["id","status","payment","expireTime","instance","volumeType","type","diskSize","operation"],locked:{head:["id"],tail:["operation"]},maxFields:9}}),pager:{pageSizes:[10,20,50,100]},moreOpt:{width:130,datasource:S.getOperation("CDS"),emptyText:o("更多操作"),selectedIndex:-1}},e.prototype.bindEvents=function(){r.prototype.bindEvents.apply(this);var e=this;s(".quick-search-filters").on("click","a",function(t){var a=s(this),n=a.hasClass("actived");s(".quick-search-filters a").each(function(e,t){s(t).removeClass("actived")}),n?a.removeClass("actived"):a.addClass("actived");var r=e.model.get("filters")||[],o=i.reject(r,function(e){return"expiredDate<7"===e.join("")||"asp<7"}),c=a.data();a.hasClass("actived")&&o.push([c.key,c.op,c.value]),e.fire(f.FILTER,{condition:o})})},e.prototype.uiEvents=i.extend({},l.getListEvents({"keyword:enter":function(e){this.submitSearch(e)},"createDisk:click":function(e){this.fire(f.CREATE_DISK)},"downloadList:click":function(e){window.open(this.model.getDownloadUrl())},"table:command":function(e){var t=parseInt(e.args,10);this.fire(e.name,{item:e.target.datasource[t]})},"table:clipboard@aftercopy":function(e){this.fire(f.COPYID)},"table:clipboard@error":function(e){e.originalTarget.hide()},"table:select":function(e){var t=this.get("table").getSelectedItems(),a=v.check(g,t);delete a.createDisk,l.setButtonStatusAndTip(this,a,t),l.setSelectStatusAndTip(this,"moreOpt",a,t)},"recharge:click":function(e){var t=this.get("table").getSelectedItems(),a=i.map(t,function(e){return e.id+";"+e.volumeId});this.fire(f.RECHARGE_BATCH,{instanceIds:a})},"editTag:click":function(e){this.fire(f.EDIT_TAG,this.get("table").getSelectedItems())},"moreOpt:change":function(e){var t=e.target.getValue(),a=this.get("table").getSelectedItems();if(a.length>0&&t){var n=[];switch(t){case S.DELETE:var s=i.map(a,function(e){return e.id});this.fire(f.DELETE_CDS,{diskIds:s});break;case S.ALTER_PRODUCTTYPE:var r=[];i.each(a,function(e){n.push(e.id+";"+e.volumeId),r.push(e.payment)}),this.fire(f.ALTER_PRODUCTTYPE,{instanceIds:n,productTypes:r});break;case S.CANCEL_ALTER_PRODUCTTYPE:n=i.pluck(a,"id"),this.fire(f.CANCEL_ALTER_PRODUCTTYPE,{instanceIds:n});break;case S.EXPAND_CDS:this.fire(f.EXPAND_CDS,{item:a[0]});break;default:this.fire(f[t],a)}}},"table:filter":function(e){var t=this.get("table").fields[e.fieldIndex],a=this.model.get("filters")||[],n=i.reject(a,function(e){return e[0]===t.field});n.push([t.field,e.value]),this.fire(f.FILTER,{condition:n})}}),{"keywordType:change":function(e){var t=this.model.get("bccTags"),a=e.target.getSelectedItem(),n=a[0].name||a[0].text,s=[];if(a.length>1){var r=a[1].value;n="",r&&(n="标签值",s=t[r])}this.get("keyword").setProperties({placeholder:n?i.sprintf(o("请输入%s进行搜索"),n):o("搜索无标签磁盘"),datasource:s})}}),e.prototype.enterDocument=function(){this.setTableFilterValue(),r.prototype.enterDocument.apply(this,arguments),this.model.get("keywordType")&&this.get("keywordType").fire("change");var e=this.model.get("instance"),t=v.check(g,e,"createDisk");l.setButtonStatusAndTip(this,t)},e.prototype.updatePageData=function(e,t){this.get("table").setProperties({selectedIndex:[]}),r.prototype.updatePageData.call(this,e,t)},e.prototype.showQuotaTip=function(){var e=this.model.get("quota"),t=i.sprintf(o("(已创建%s个CDS磁盘，共可建%s个)"),e.cdsCreated,e.cdsTotal);s(".quota-tip").html(t)},e.prototype.getSearchArgs=function(){var e=r.prototype.getSearchArgs.call(this),t=this.get("keywordType"),a=this.model.get("pageNo");if(+a>0&&(e.pageNo=a),t){var i=t.getSelectedItem();e.keywordType=t.getValue(),e.subKeywordType=i[1]&&i[1].value}var n=this.model.get("filters");return n&&n.length>0&&(e.filters=JSON.stringify(n)),e},e.prototype.setTableFilterValue=function(){var e=this.model.get("filters");e&&e.length>0?i.each(E,function(t){t.filter&&i.each(e,function(e){e[0]===t.field&&(t.filter.value=e[1])})}):i.each(E,function(e){e.filter&&(e.filter.value=null)})},e.prototype.resetMoreOperation=function(e){var t=this.get("moreOpt");t&&t.get("selectedIndex")>-1&&t.setProperties({selectedIndex:-1})},e.prototype.initTableSelectItem=l.initTableSelectItem,require("er/util").inherits(e,r),e}),define("bcc/cds/rules",["exports","module","../config","../enum","babel-runtime/helpers/interop-require-default","common/region","lodash"],function(exports,module,e,t,a,i,n){var s=a["default"](t),r=a["default"](i),o=a["default"](n);module.exports={createDisk:[{subUserAble:!1,message:"子帐号没有权限创建磁盘"},{custom:function(t){return"hk02"===r["default"].getCurrentRegion().id?{disable:!0,message:"售罄！请移步其他地域购买资源。"}:t[0]&&!o["default"].includes(e.INSTANCE_STATUS.CAN_CREATE_DISK,t[0].status)?{disable:!0,message:""}:void 0}}],recharge:[{status:e.DISK_STATUS.CAN_RECHARGE,message:function(e){return e.length>1?"部分磁盘当前状态无法续费":"该磁盘当前状态无法续费"}},{productType:["prepay"],message:"后付费的磁盘不能续费"},{orderAble:!1,message:"磁盘存在其他订单，请处理后重试"},{subUserAble:!1,message:"子帐号没有权限对磁盘续费"},{custom:function(t){if(o["default"].filter(t,function(t){return t.type===e.DISK_TYPE.SYSTEM}).length>0)return{disable:!0,message:t.length>1?"部分磁盘类型无法续费":"该磁盘类型无法续费"}}}],editTag:[{custom:function(t){return o["default"].filter(t,function(t){return t.type===e.DISK_TYPE.SYSTEM}).length>0?{disable:!0,message:t.length>1?"部分磁盘类型无法编辑标签":"该磁盘类型无法编辑标签"}:o["default"].filter(t,function(t){return t.status===e.DISK_STATUS.CREATING}).length>0?{disable:!0,message:t.length>1?"部分磁盘当前状态无法编辑标签":"该磁盘当前状态无法编辑标签"}:void 0}}],DELETE:[{status:e.DISK_STATUS.CAN_DELETE,message:function(e){return e.length>1?"部分磁盘当前状态无法释放":"该磁盘当前状态无法释放"}},{subUserAble:!1,message:"子帐号没有权限对磁盘释放"},{custom:function(t){if(o["default"].filter(t,function(t){return t.payment===e.PAYMENT.PREPAY&&t.expireDate>0||t.instanceId}).length>0)return{disable:!0,message:""}}}],ALTER_PRODUCTTYPE:[{status:e.DISK_STATUS.CAN_ALTER_PRODUCTTYPE,message:function(e){return e.length>1?"部分磁盘当前状态无法计费变更":"该磁盘当前状态无法计费变更"}},{orderAble:!1,message:"磁盘存在其他订单，请处理后重试"},{subUserAble:!1,message:"子帐号没有权限对磁盘计费变更"},{custom:function(t){if(o["default"].filter(t,function(t){return t.type===e.DISK_TYPE.SYSTEM}).length>0)return{disable:!0,message:t.length>1?"部分磁盘类型无法计费变更":"该磁盘类型无法计费变更"}}}],CANCEL_ALTER_PRODUCTTYPE:[{status:e.DISK_STATUS.CAN_ALTER_PRODUCTTYPE,message:function(e){return e.length>1?"部分磁盘当前状态无法取消计费变更":"该磁盘当前状态无法取消计费变更"}},{subUserAble:!1,message:"子帐号没有权限对磁盘取消计费变更"},{custom:function(t){return o["default"].filter(t,function(t){return t.type===e.DISK_TYPE.SYSTEM}).length>0?{disable:!0,message:t.length>1?"部分磁盘类型无法取消计费变更":"该磁盘类型无法取消计费变更"}:o["default"].filter(t,function(e){return"to_postpay"!==e.orderStatus}).length>0?{disable:!0,message:""}:void 0}}],EXPAND_CDS:[{isSingle:!0,message:"无法批量扩容"},{orderAble:!1,message:"磁盘存在其他订单，请处理后重试"},{subUserAble:!1,message:"子帐号没有权限对磁盘扩容"},{custom:function(t){if(t[0].volumeType===s["default"].VolumeType.SYSTEM){if(t[0].storageType!==s["default"].StorageType.SSD&&t[0].storageType!==s["default"].StorageType.PREMIUM_SSD||t[0].status!==e.DISK_STATUS.IN_USE)return{disable:!0,message:""}}else if(t[0].status!==e.DISK_STATUS.IN_USE&&t[0].status!==e.DISK_STATUS.AVAILABLE)return{disable:!0,message:"该磁盘当前状态无法扩容"}}}],rename:[{custom:function(t){if(t[0].status===e.DISK_STATUS.CREATING||t[0].status===e.DISK_STATUS.ERROR)return{disable:!0,message:"该磁盘当前状态无法修改名称"}}}],attach:[{status:e.DISK_STATUS.CAN_ATTACH,message:function(e){return"该磁盘当前状态无法挂载"}}],detach:[{status:e.DISK_STATUS.CAN_DETACH,message:function(e){return"该磁盘当前状态无法卸载"}}],createImage:[{status:e.SYSTEM_DISK_STATUS.CAN_CREATE_IMAGE,message:function(e){return"该磁盘当前状态无法挂载"}}],createSnapshot:[{custom:function(t){if(t[0].type===e.DISK_TYPE.SYSTEM?!o["default"].contains(e.SYSTEM_DISK_STATUS.CAN_CREATE_SNAPSHOT,t[0].status)||t[0].imageType===s["default"].ImageType.MKT:!o["default"].contains(e.DISK_STATUS.CAN_CREATE_SNAPSHOT,t[0].status))return{disable:!0,message:"该磁盘当前状态无法创建快照"}}}]}}),define("bcc/cds/Snapshot",["require","bat-ria/mvc/ListAction","../events","common/constants","moment","../config","common/util/dialog","./SnapshotModel","./SnapshotView","er/URL","../operations","../../common/util/dialog","er/util"],function(require){function e(){l.apply(this,arguments)}function t(e){return e.type===h.SYSTEM}function a(){var e={};this.model.get("instanceId")?e.instanceId=this.model.get("instanceId"):e.diskId=this.model.get("diskId"),this.redirect(require("er/URL").withQuery("/bcc/cds/detail",e))}function i(e){var t=this,a=this.model.get("tableData")[parseInt(e.rowIndex,10)],i="snapshot.rename",n={name:e.value,snapshotId:a.id};a.type===h.SYSTEM?n.instanceId=a.instanceId||this.model.get("instanceId"):(n.diskId=a.diskId||this.model.get("diskId"),i="cds.snapshot.rename"),b.handler(i,this.view,n,null,function(e){t.view.get("table").showEditError(e.field.name)})}function n(){var e=this.model.get("disk");e.type===h.SYSTEM?b.instanceCreateSnapshot.call(this,{instanceId:e.instanceId}):b.cdsCreateSnapshot.call(this,{diskId:this.model.get("diskId"),diskType:e.type,attachment:e.attachment,instanceId:this.model.get("instanceId")})}function s(e){var a,i=this,n=i.view.get("table").datasource[e.itemIndex],s=p(n.createTime).format(u.TIME_FORMAT);t(n)?m.bccInstanceDetail({instanceId:n.instanceId}).then(function(e){a='系统盘在"'+s+'"后的所有更新内容将被清除，确定回滚吗？',e.status===g.ACTIVE&&(a+="回滚快照需要先停止实例，导致服务器停止几分钟，为保证你的服务不受影响，请在确认执行此操作前做好预案准备。"),r.call(i,{operation:"snapshot.rollback",message:a,data:{instanceId:n.instanceId,snapshotId:n.id},item:n})}):m.bccDiskDetail({diskId:n.diskId}).then(function(e){a='回滚后云磁盘"'+e.name+'"在"'+s+'"后的数据将丢失，确定回滚吗？',r.call(i,{operation:"cds.snapshot.rollback",message:a,data:{diskId:n.diskId,snapshotId:n.id},item:n})})}function r(e){var a=t(e.item),i={snapshotId:e.item.id};a?i.instanceId=e.item.instanceId:i.diskId=e.item.diskId,v.waitActionDialog(this.view,{title:"回滚前确认",width:500,needFoot:!0,url:"/bcc/instance/require_auth_code",actionOptions:{extraData:i,requester:a?m.bccSnapshotRollback:m.bccCdsSnapshotRollback,tip:e.message,parentAction:this}}).then(function(e){var t=e.target;t.getFoot().getChild("btnOk").on("click",function(){t.hide()})})}function o(e){var t=this.view.get("table").datasource[e.itemIndex];this.redirect(require("er/URL").withQuery("/bcc/cds/create",{snapshotId:t.id,snapshotName:t.name,diskSize:t.size}))}function c(e){var t=this.view.get("table").datasource[e.itemIndex];b.snapshotCreateImage.call(this,{instanceId:t.instanceId,instanceUuid:t.instanceUuid,snapshotId:t.snapshotId,snapshotUuid:t.id})}var l=require("bat-ria/mvc/ListAction"),d=require("../events"),u=require("common/constants"),p=require("moment"),f=require("../config"),m=f.api,h=f.DISK_TYPE,g=f.INSTANCE_STATUS,v=require("common/util/dialog");e.prototype.modelType=require("./SnapshotModel"),e.prototype.viewType=require("./SnapshotView");var b=require("../operations");return e.prototype.deleteSnapshot=function(e){var a=this.view.get("table").datasource[e.itemIndex],i={snapshotId:a.id};t(a)?i.instanceId=a.instanceId||this.model.get("instanceId"):i.diskId=a.diskId||this.model.get("diskId");require("../../common/util/dialog").waitActionDialog(this.view,{title:"删除前确认",width:600,needFoot:!0,url:"/bcc/instance/require_auth_code",actionOptions:{extraData:i,requester:m.bccSnapshotDelete,tip:"快照删除后不可恢复，确定删除吗？",parentAction:this}}).then(function(e){var t=e.target;t.getFoot().getChild("btnOk").on("click",function(){t.hide()})})},e.prototype.initBehavior=function(){l.prototype.initBehavior.apply(this,arguments),this.view.on(d.REFRESH,this.reload),this.view.on(d.TO_DETAIL,a,this),this.view.on(d.SAVE_EDIT,i,this),this.view.on(d.CREATE_SNAPSHOT,n,this),this.view.on(d.ROLLBACK_SNAPSHOT,s,this),this.view.on(d.DELETE_SNAPSHOT,this.deleteSnapshot,this),this.view.on(d.CREATE_DISK,o,this),this.view.on(d.CREATE_IMAGE,c,this),this.view.initTableSelectItem("id",this.model.get("id"))},require("er/util").inherits(e,l),e}),define("bcc/cds/snapshot.tpl",[],function(){return'\x3c!-- target: TPL_bcc_cds_snapshot --\x3e\n<div class="bcc-cds-snapshot bcc-main-wrap main-wrap-new">\n    <div class="content-wrap">\n        <p class="breadcrumb">\n            <span>${i18n.产品服务}</span>\n            <span class="divider">/</span>\n            <a href="#/bcc/cds/list">${i18n.云磁盘CDS}-${i18n.磁盘列表}</a>\n            <span class="divider">/</span>\n            \x3c!-- if: ${isSystemDisk} --\x3e\n            <span class="active">${i18n.系统盘快照}</span>\n            \x3c!-- else --\x3e\n            <span class="active">${i18n.CDS盘快照}</span>\n            \x3c!-- /if --\x3e\n        </p>\n\n        <div class="instance-info">\n            <h1 title="${disk.name}">${disk.name}</h1>\n            <span class="${statusClass}">${statusDesc}</span>\n        </div>\n\n        <div class="detail-content">\n            <esui-tab data-ui-id="detailTab" class="bec-tab ui-tab-navigator">\n                <ul data-role="navigator" >\n                    \x3c!-- if: ${isSystemDisk} --\x3e\n                    <li>${i18n.系统盘详情}</li>\n                    <li>${i18n.系统盘快照}</li>\n                    \x3c!-- else --\x3e\n                    <li>${i18n.CDS盘详情}</li>\n                    <li>${i18n.CDS盘快照}</li>\n                    \x3c!-- /if --\x3e\n                </ul>\n            </esui-tab>\n\n            <div class="ui-tab-content">\n                <div class="table-wrap">\n                    <div class="ui-row">\n                        <button data-ui-id="createSnapshot" data-ui-type="Button"\n                                data-ui-skin="create">${i18n.创建快照}</button>\n                        \x3c!-- import: TPL_bcc_search --\x3e\n                        \x3c!-- import: TPL_bcc_refreshList --\x3e\n                    </div>\n                    \x3c!-- import: listEditableTableWithCommand --\x3e\n                    <div class="ui-row clearfix">\n                        \x3c!-- import: listPager --\x3e\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("bcc/cds/SnapshotModel",["require","bat-ria/mvc/ListModel","underscore","../config","er/events","er/util"],function(require){function e(){t.apply(this,arguments),this.listRequester=n.bccSnapshotList}var t=require("bat-ria/mvc/ListModel"),a=require("underscore"),i=require("../config"),n=i.api,s=i.DISK_STATUS,r=i.SYSTEM_DISK_STATUS;return e.prototype.datasource={menu:function(e){return"disk"},disk:function(e){return n.bccDiskDetail({diskId:e.get("diskId"),instanceId:e.get("instanceId")},{globalFailCallback:function(){require("er/events").fire("globalError",{service:"CDS"})}})}},e.prototype.getExtraQuery=function(){var e={diskType:this.get("diskType")};return this.get("instanceId")?e.instanceId=this.get("instanceId"):e.diskId=this.get("diskId"),e},e.prototype.prepare=function(){var e=this.get("disk"),t=i.DISK_TYPE,n=e.type===t.SYSTEM;this.set("isSystemDisk",n);var o=n?r:s;this.set("statusDesc",o.TXT[e.status]||(n?"正常":e.status)),this.set("statusClass",o.CLASS[e.status]||"status error"),this.set("createSnapshotDisable",n?!a.contains(r.CAN_CREATE_SNAPSHOT,e.status):e.status===s.ERROR||a.contains(s.DOING_STATUS,e.status)||a.contains(s.CAN_DO_NOTHING,e.status));for(var c=this.store.tableData,l=c.length-1;l>=0;l--)c[l].diskStatus=e.status},e.prototype.defaultArgs={keywordType:i.FILTER.SNAPSHOT.NAME.value,pageSize:i.pageSize},require("er/util").inherits(e,t),e}),define("bcc/cds/SnapshotView",["require","bat-ria/tpl!./snapshot.tpl","bat-ria/mvc/ListView","../events","etpl","inf-i18n","common/constants","moment","underscore","../config","common/util/tableUtil","er/util"],function(require){function e(){a.apply(this,arguments)}function t(e){return e.type===f.SYSTEM}require("bat-ria/tpl!./snapshot.tpl");var a=require("bat-ria/mvc/ListView"),i=require("../events"),n=require("etpl"),s=require("inf-i18n");e.prototype.template="TPL_bcc_cds_snapshot";var r=require("common/constants"),o=require("moment"),c=require("underscore"),l=require("../config"),d=c.deepClone(l.DISK_STATUS);d.TXT.available="已完成";var u=l.SYSTEM_DISK_STATUS,p=l.SYSTEM_SNAPSHOT_STATUS,f=l.DISK_TYPE,m=[{field:"id",breakLine:1,title:s("快照名称/ID"),content:function(e,t,a){var i=e.status!==p.SAVING&&e.status!==d.CREATING?'<span class="ui-table-cell-editentry"data-row="'+t+'" data-col="'+a+'"><i class="iconfont icon-edit"></i></span>':"",n=c.escape(e.name);return'<span title="'+n+'" class="instance-name">'+n+"</span>"+i+'<br/><span title="'+e.id+'">'+e.id+"</span>"},editable:function(e){return e.status!==p.SAVING&&e.status!==d.CREATING},editContent:function(e){return c.escape(e.name)},editRules:l.RULE.NAME},{title:s("创建时间"),content:function(e){return o(e.createTime).format(r.TIME_FORMAT)}},{field:"status",title:s("进度/状态"),content:function(e){var a=t(e)?p:d;return'<span class="'+(a.CLASS[e.status]||"status error")+'">'+(a.TXT[e.status]||e.status)+"</span>"}},{title:s("所属磁盘ID"),content:function(e){return e.instanceId?'<a href="#/bcc/cds/detail~instanceId='+e.instanceId+'" class="instance-name">sys-disk-'+e.instanceId+"</a>":e.diskId?'<a href="#/bcc/cds/detail~diskId='+e.diskId+'" class="instance-name">'+e.diskId+"</a>":"--"}},{title:s("磁盘大小"),content:function(e){return c.escape(e.size)+"GB"}},{title:s("操作"),width:210,stable:!0,content:function(e,a){var r=t(e),o=function(e,t,a){var r=!1;return r=a?c.contains(u.CAN_ROLLBACK,e.diskStatus)&&c.contains(p.CAN_ROLLBACK,e.status):c.contains(d.CAN_ROLLBACK,e.status),n.compile(h)({label:s("回滚快照"),command:i.ROLLBACK_SNAPSHOT,args:t,className:r?"":"state-disabled",disabled:r?"":"disabled"})}(e,a,r);return o+=r?function(e,t){var a=c.contains(u.CAN_CREATE_IMAGE,e.diskStatus)&&c.contains(p.CAN_CREATE_IMAGE,e.status);return n.compile(h)({label:s("创建自定义镜像"),command:i.CREATE_IMAGE,args:t,className:a?"":"state-disabled",disabled:a?"":"disabled"})}(e,a):function(e,t){var a=e.status!==d.ERROR&&!c.contains(d.DOING_STATUS,e.status);return n.compile(h)({label:s("创建CDS磁盘"),command:i.CREATE_DISK,args:t,className:a?"":"state-disabled",disabled:a?"":"disabled"})}(e,a),o+=function(e,t,a){var r=!1;return r=a?c.contains(u.CAN_DELETE_SNAPSHOT,e.diskStatus):c.contains(d.CAN_DELETE,e.status),n.compile(h)({label:s("删除"),command:i.DELETE_SNAPSHOT,args:t,className:r?"":"state-disabled",disabled:r?"":"disabled"})}(e,a,r)}}],h='<span class="oprations"><button data-command="${command}" data-command-args="${args}" class="cmd-button ${className}" ${disabled}>${label}</button></span>',g=require("common/util/tableUtil"),v=l.FILTER;return e.prototype.uiProperties={detailTab:{activeIndex:1},keywordType:{datasource:[v.SNAPSHOT.NAME]},keyword:{placeholder:s("请输入快照名称进行搜索")},createSnapshot:{disabled:"@createSnapshotDisable"},table:g.tableProperty(m,{editable:1,select:""})},e.prototype.getDiskId=function(){return this.model.get("diskId")},e.prototype.uiEvents=g.getListEvents({"detailTab:activate":function(e){0===e.activeIndex&&this.fire(i.TO_DETAIL)},"createSnapshot:click":function(e){this.fire(i.CREATE_SNAPSHOT)},"table:command":function(e){this.fire(e.name,{itemIndex:+e.args})}}),e.prototype.getSearchArgs=g.getSearchArgs,e.prototype.initTableSelectItem=g.initTableSelectItem,require("er/util").inherits(e,a),e}),define("bcc/cds/upgrade_config.tpl",[],function(){return'\x3c!-- target: TPL_bcc_cds_upgradeconfig --\x3e\n<div class="bcc-cds-upgrade bcc-main-1col bcc-main-wrap main-wrap-new">\n    <div class="content-wrap">\n        <p class="breadcrumb">\n            <span>产品服务</span>\n            <span class="divider">/</span>\n            <a href="#/bcc/cds/list">云磁盘CDS-磁盘列表</a>\n            <span class="divider">/</span>\n            <span class="active">CDS云磁盘扩容</span>\n        </p>\n        <div class="create-content">\n            <div data-ui-type="ViewStep"\n                 data-ui-id="buyStep"\n                 data-ui-current-step="1">\n                <ul>\n                    <li bind-for="tab1">扩容CDS磁盘</li>\n                    <li bind-for="tab2">确认订单</li>\n                    <li>在线支付</li>\n                    <li>支付成功</li>\n                </ul>\n            </div>\n            <div data-ui-type="Tab" data-ui-id="productType"\n                 data-ui-active-index="0" class="bec-tab">\n                <ul data-role="navigator" class="ui-tab-navigator"></ul>\n            </div>\n            <div id="tab1" class="create-main">\n                <p data-ui-type="ToastLabel"\n                        data-ui-id="warningPanel"\n                        data-ui-message-type="alert"\n                        data-ui-hidden="true"\n                        class="cash-warning-panel"></p>\n                <form class="setting-form"\n                    data-ui-type="Form"\n                    data-ui-id="form"\n                    data-ui-submit-button="toBuy"\n                    data-ui-auto-validate="true">\n                    <div data-ui-id="buyBucket"\n                        data-ui-type="BuyBucket"\n                        data-ui-disabled="true"></div>\n                    <div class="detail-parts-table">\n                        <dl class="detail-part-1-col">\n                            <dt><h4>当前配置</h4></dt>\n                            <dd>\n                                <div class="detail-cell">\n                                    <label>磁盘名称：</label>\n                                    <span class="nowrap-text" title="${disk.name}">${disk.name}</span>\n                                </div>\n                                <div class="detail-cell">\n                                    <label>磁盘类型：</label>\n                                    <span>${disk.storageTypeLabel}</span>\n                                </div>\n                                <div class="detail-cell">\n                                    <label>磁盘作用：</label>\n                                    <span>${disk.volumeTypeLabel}</span>\n                                </div>\n                            </dd>\n                            <dd>\n                                <div class="detail-cell">\n                                    <label>磁盘ID：</label>\n                                    <span class="nowrap-text" title="${disk.volumeId}">${disk.volumeId}</span>\n                                </div>\n                                <div class="detail-cell">\n                                    <label>当前容量：</label>\n                                    <span>${disk.diskSize}GB</span>\n                                </div>\n                                <div class="detail-cell">\n                                    <label>挂载设备名：</label>\n                                    <span>${disk.device}</span>\n                                </div>\n                            </dd>\n                            <dd>\n                                <div class="detail-cell">\n                                    <label>支付方式：</label>\n                                    <span>${disk.productTypeLabel}</span>\n                                </div>\n                                <div class="detail-cell">\n                                    <label>所属实例IP：</label>\n                                    <span>${disk.instanceIp}</span>\n                                </div>\n                                <div class="detail-cell">\n                                    <label>磁盘状态：</label>\n                                    <span class="${disk.statusClass}">${disk.statusLabel}</span>\n                                </div>\n                            </dd>\n                            <dd>\n                                <div class="detail-cell">\n                                    <label>描述：</label>\n                                    <span class="nowrap-text" title="${disk.desc}">${disk.desc}</span>\n                                </div>\n                                <div class="detail-cell">\n                                    <label>创建时间：</label>\n                                    <span>${disk.createTimeLabel}</span>\n                                </div>\n                                <div class="detail-cell">\n                                    <label>到期时间：</label>\n                                    <span>${disk.expireTimeLabel}</span>\n                                </div>\n                            </dd>\n                            <dd>\n                                <div class="detail-cell">\n                                    <label>所属实例名称：</label>\n                                    <span class="nowrap-text" title="${disk.instanceName}">${disk.instanceName}</span>\n                                </div>\n                            </dd>\n                        </dl>\n                        <dl class="detail-create detail-part-1-col">\n                            <dt><h4>变更配置</h4></dt>\n                            <dd>\n                                <label>磁盘大小：</label>\n                                <div>\n                                    <div data-ui-id="diskSizeExpand"\n                                        data-ui-name="size"\n                                        data-ui-value="@diskSizeExpandMin"\n                                        data-ui-type="Dragger"></div>\n                                    <p id="diskSizeExpandError" data-for="form-error" class="bcc-error"></p>\n                                </div>\n                            </dd>\n                            <dd>\n                                <label></label>\n                                <div>\n                                    <span class="key-label">扩容：</span>\n                                    <span data-ui-id="expandSize" data-ui-type="Label">${expandSize}</span>\n                                    \x3c!-- if: ${disk.payment} === \'prepay\' --\x3e\n                                    <span class="key-label key-label-daysToPay">需付费时长：</span>\n                                    <span data-ui-id="daysToPay" data-ui-type="Label">${disk.daysToPay} 天</span>\n                                    \x3c!-- /if --\x3e\n                                </div>\n                            </dd>\n                        </dl>\n                    </div>\n                </form>\n            </div>\n            <div id="tab2">\n                <div class="ui-tab-navigator"></div>\n                <div data-ui="id:orderAction;type:ActionPanel" class="clearfix ui-tab-content"></div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("bcc/cds/UpgradeConfig",["require","bat-ria/mvc/FormAction","underscore","common/region","common/constants","common/util/orderUtil","../events","../config","../enum","./UpgradeConfigModel","./UpgradeConfigView","er/util"],function(require){function e(){a.apply(this,arguments)}function t(){var e=this.model.getSubmitData(this.view.getFormData()),t=function(e){var t=["地域："+n.getCurrentRegion().label],a=this.model.get("disk").payment,o=s.SERVICE_TYPE.CDS.chargeType[a],u=this.model.get("price"),p=a===c.POSTPAY?"￥"+u.money+"/分钟":null;t.push("容量："+e.upgradedConfig.size+"G"),t.push("类型："+l.getTextFromValue(this.model.get("disk").storageType));var f={serviceType:"CDS",productType:a,type:"RESIZE",instanceId:e.diskId,price:u.money,items:[{serviceType:"CDS",productType:a,count:u.count,price:u.money,time:u.dayCount,timeUnit:"DAY",unitPrice:u.money,unitPriceShow:p,chargeType:o,configuration:t}]};this.model.get("disk").volumeType===d.SYSTEM&&i.extend(f.items[0],{serviceName:"系统盘（CDS云磁盘）"});return r.make(f)}.call(this,e);this.view.renderOrderConfirm(t,e)}var a=require("bat-ria/mvc/FormAction"),i=require("underscore"),n=require("common/region"),s=require("common/constants"),r=require("common/util/orderUtil"),o=require("../events"),c=require("../config").PAYMENT,l=require("../enum").StorageType,d=require("../enum").VolumeType;return e.prototype.modelType=require("./UpgradeConfigModel"),e.prototype.viewType=require("./UpgradeConfigView"),e.prototype.initBehavior=function(){a.prototype.initBehavior.apply(this,arguments),this.view.on("DISK_SIZE_EXPEND",this.onDiskSizeExpendChange,this),this.view.on(o.ORDER_CONFIRM,t,this),this.view.on(o.RELOAD,this.reload,this),this.refreshConfigInfo("init")},e.prototype.onDiskSizeExpendChange=function(e){var t=this,a=e.value,i=t.model.get("diskSizeExpandMin");a<i?setTimeout(function(){t.view.get("diskSizeExpand").setValue(Math.max(i,e.old))},500):(t.model.setDiskSize(e.value),t.refreshConfigInfo({diskSize:a}))},e.prototype.refreshConfigInfo=function(e){var t=this,a=t.model.getSubmitData(t.view.getFormData()),n=this.model.get("disk").payment===c.POSTPAY,s=t.view.get("buyBucket");"init"===e&&t.model.set("oldConfig",a.upgradedConfig),t.model.calculateTheBudget(a).then(function(e){a.upgradedConfig&&(a.upgradedConfig.volumeType=t.model.get("disk").type),s.setValue(i.extend(a,e,{isPostpay:n})),t.model.set("price",e),t.model.get("errorInfo")||i.isEqual(t.model.get("oldConfig"),a.upgradedConfig)||e.money<=0?s.disable():s.enable()})},e.prototype.syncModelToViewIterator=function(e){switch(e.name){case"errorInfo":this.view.processError();break;case"expandSize":this.view.repaintExpandSize()}return!0},require("er/util").inherits(e,a),e}),define("bcc/cds/UpgradeConfigModel",["require","bat-ria/mvc/FormModel","moment","underscore","lodash","common/constants","../config","../enum","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("bat-ria/mvc/FormModel"),a=require("moment"),i=require("underscore"),n=require("lodash"),s=require("common/constants"),r=require("../config"),o=r.api,c=r.DISK_STATUS,l=require("../enum");return e.prototype.datasource={disk:function(e){var t=e.get("diskId");return t?o.bccDiskDetail({diskId:t}).then(function(e){return e.instanceName=e.instanceName||"--",e.instanceIp=e.instanceIp||"--",e.desc=e.desc||"--",e.device=e.device||"--",e.volumeId=e.volumeId||e.id,e.diskTypeLabel=e.type&&r.DISK_TYPE.TXT[e.type]||"--",e.productTypeLabel=e.payment&&r.PAYMENT_DESC[e.payment]||"--",e.statusLabel=e.status&&c.TXT[e.status]||"--",e.statusClass=e.status&&c.CLASS[e.status]||"--",e.createTimeLabel=e.createTime?a(e.createTime).format(s.TIME_FORMAT):"--",e.expireTimeLabel=e.expireTime?a(e.expireTime).format(s.TIME_FORMAT):"--",e.storageTypeLabel=l.StorageType.getTextFromValue(e.storageType)||e.storageType||"--",e.volumeTypeLabel=l.VolumeType.getTextFromValue(e.volumeType)||e.volumeType||"--","prepay"===e.payment&&(e.daysToPay=parseInt(a.duration(a(e.expireTime)-a()).as("days"),10)),e}):null},quota:function(e){return o.bccQuota({objType:"cds"})},expandSize:function(){return"0 GB"}},e.prototype.calculateTheBudget=function(e){return o.bccCdsUpgradeConfigBudget(e).then(function(e){if(typeof e.money!==undefined)return e.money=parseFloat(e.money),e})},e.prototype.prepare=function(){var e=this.get("disk");this.set("diskSizeExpandMin",e?e.diskSize:0),this.set("origDiskSize",e.diskSize),this.set("isSystemDisk",e.volumeType===l.VolumeType.SYSTEM)},e.prototype.filterData=function(e){return{diskId:this.get("diskId"),upgradedConfig:e}},e.prototype.setDiskSize=function(e){var t=this.get("quota"),a=e-this.get("origDiskSize");this.set("expandSize",a+" GB");var r=n.clone(this.get("errorInfo")||{});if(t.cdsUsedCapacityGB+a>t.cdsTotalCapacityGB){var o=t.cdsTotalCapacityGB-t.cdsUsedCapacityGB;return r.diskSizeExpand="当前订单要扩容的CDS大小（"+a+"GB）超过了您剩余配额"+(o>=1024?(o/1024).toFixed(2)+"TB":o+"GB")+"（总配额"+(t.cdsTotalCapacityGB/1024).toFixed(2)+'TB）。如需增加配额，请到<a href="'+s.domains.ticket+'">工单</a>申请',void this.set("errorInfo",r)}r.diskSizeExpand&&delete r.diskSizeExpand,i.isEmpty(r)?this.remove("errorInfo",r):this.set("errorInfo",r)},require("er/util").inherits(e,t),e}),define("bcc/cds/UpgradeConfigView",["require","bat-ria/tpl!./upgrade_config.tpl","underscore","jquery","bat-ria/mvc/FormView","inf-ria/app/brpc","common/util/moneyUtil","../events","../enum","er/util"],function(require){function e(){i.apply(this,arguments)}require("bat-ria/tpl!./upgrade_config.tpl");var t=require("underscore"),a=require("jquery"),i=require("bat-ria/mvc/FormView"),n=require("inf-ria/app/brpc"),s=require("common/util/moneyUtil"),r=require("../events"),o=require("../enum").DiskType,c=[{title:"配置：",content:function(e){if(e&&e.upgradedConfig)return o.getTextFromValue(e.upgradedConfig.volumeType)+e.upgradedConfig.size+"GB"}},{title:"配置费用：",content:function(e){if(typeof e.money!==undefined){var t=s.convertPrice(e.money);return'<span class="price">￥'+(e.isPostpay?t.getPriceOfMinute("/分钟"):t.getPriceOfMinute())+"</span>"}}}];return e.prototype.template="TPL_bcc_cds_upgradeconfig",e.prototype.uiProperties={toBuy:{disabled:!0},diskSizeExpand:{min:0,max:32765,length:349,unit:"GB",step:1,value:"@diskSizeExpandMin"},buyBucket:{fields:c,offsetTop:20,confirmBtn:{text:"下一步",skin:"skin-primary-button"},disabled:!0}},e.prototype.uiEvents={"diskSizeExpand:change":function(e){this.fire("DISK_SIZE_EXPEND",{value:e.now,old:e.old})},buyBucket:{confirm:function(){this.get("form").validate()&&this.fire(r.ORDER_CONFIRM)},reset:function(){this.fire(r.RELOAD)}}},e.prototype.renderOrderConfirm=function(e,t){function a(){c.renderCdsConfig(),s.show(),r.set("currentStep",1)}var i=this.get("orderAction"),s=this.get("productType"),r=this.get("buyStep"),o={order:e,config:t},c=this;n.invokeService("billing://order_confirm",i,o).then(function(){i.on("action@prevPage",a),s.hide(),r.set("currentStep",2)})},e.prototype.renderCdsConfig=function(){var e=this.get("orderAction");this.get("buyStep").set("currentStep",1),e.disposeAction(),e.main.innerHTML=""},e.prototype.processError=function(){a("[data-for=form-error]").html("");var e=this.model.get("errorInfo");t.keys(e).length>0&&(this.get("buyBucket").disable(),t.each(e,function(e,t){a("#"+t+"Error").html(e)}))},e.prototype.repaintExpandSize=function(){this.get("expandSize").setProperties({text:this.model.get("expandSize")})},require("er/util").inherits(e,i),e.prototype.enterDocument=function(){if(i.prototype.enterDocument.apply(this,arguments),this.model.get("isSystemDisk")){var e=this.get("diskSizeExpand");e.setProperties({max:100}),e.repaint()}},e}),define("bcc/common",["exports","common/region","babel-runtime/helpers/interop-require-default","underscore"],function(exports,e,t,a){exports.__esModule=!0;var i=t["default"](e),n=t["default"](a);exports.isRegionHK=function(e){return"hk"===(e||i["default"].getCurrentRegion().id)};exports.isSysCdsRequiredRegion=function(e){var t=e||i["default"].getCurrentRegion().id;return n["default"].contains(["bj","su","gz","hkg","bd","fwh","fsh"],t)}}),define("bcc/common.tpl",[],function(){return'\x3c!-- target: TPL_bcc_breadcrumb_new --\x3e\n<span>产品服务</span>\n<span class="divider">/</span>\n\x3c!-- if: ${fatherPage} --\x3e\n    <span><a href="${fatherUrl}" data-track-id="ti_bcc_breadcrumb" data-track-name="面包屑">${fatherPage}</a></span>\n    <span class="divider">/</span>\n\x3c!-- /if --\x3e\n<span class="active">${currentPage}</span>\n\n\n\x3c!-- target: TPL_bcc_breadcrumb --\x3e\n<p class="breadcrumb">\n    <span>产品服务</span>\n    \x3c!-- for: ${breadcrumb} as ${item}, ${index} --\x3e\n        \x3c!-- if: ${item.url} --\x3e\n        <a href="${item.url}">${item.title}</a>\n        \x3c!-- else --\x3e\n        <span class="active">${item.title}</span>\n        \x3c!-- /if --\x3e\n    \x3c!-- /for --\x3e\n\n    <span class="divider">/</span>\n    <a href="#/bcc/instance/list">${i18n.云服务器BCC} - ${i18n.实例列表}</a>\n    <span class="divider">/</span>\n    <span class="active">${i18n.本实例快照}</span>\n</p>\n\n\x3c!-- target: TPL_bcc_instance_detail_loading(master = TPL_bcc_instance_detail_structure) --\x3e\n\x3c!-- block: abstrct-info --\x3e\n<div class="loading-container">\n    <span class="loading">数据加载中，请稍后…</span>\n</div>\n\x3c!-- /block --\x3e\n\x3c!-- block: detail-info --\x3e\n<div class="loading-container">\n    <span class="loading">数据加载中，请稍后…</span>\n</div>\n\x3c!-- /block --\x3e\n\n\x3c!-- target: TPL_bcc_instance_detail_structure --\x3e\n<div class="bcc-wrapper main-wrap-new bcc-detail">\n    <div class="content-wrap">\n        <div class="breadcrumb">\n            \x3c!-- block: detail-breadcrumb --\x3e\n            \x3c!-- use: TPL_bcc_breadcrumb_new(fatherUrl=\'#/bcc/instance/list\', fatherPage=\'云服务器BCC - 实例列表\', currentPage=\'实例详情\') --\x3e\n            \x3c!-- /block --\x3e\n        </div>\n        <div class="instance-info">\n        \x3c!-- block: abstrct-info --\x3e\x3c!-- /block --\x3e\n        \x3c!-- block: operation-info --\x3e\x3c!-- /block --\x3e\n        </div>\n        <div class="detail-content">\n            \x3c!-- block: detail-navigator --\x3e\x3c!-- /block --\x3e\n            <div class="instance-info-detail ui-tab-content"\n                data-ui-type="Panel"\n                data-ui-id="instanceInfoDetailPanel"\n                data-ui-extension-command-type="Command">\n                \x3c!-- block: detail-info --\x3e\x3c!-- /block --\x3e\n            </div>\n        </div>\n    </div>\n</div>\n\n\x3c!-- target: TPL_bcc_cds_detail_structure --\x3e\n<div class="bcc-wrapper main-wrap-new bcc-detail">\n    <div class="content-wrap">\n        <div class="breadcrumb">\n            \x3c!-- block: detail-breadcrumb --\x3e\n            \x3c!-- use: TPL_bcc_breadcrumb_new(fatherUrl=\'#/bcc/instance/list\', fatherPage=\'云磁盘CDS - 磁盘列表\', currentPage=\'系统盘详情\') --\x3e\n            \x3c!-- /block --\x3e\n        </div>\n        <div class="instance-info">\n        \x3c!-- block: abstrct-info --\x3e\x3c!-- /block --\x3e\n        \x3c!-- block: operation-info --\x3e\x3c!-- /block --\x3e\n        </div>\n        <div class="detail-content">\n            \x3c!-- block: detail-navigator --\x3e\x3c!-- /block --\x3e\n            <div class="cds-info-detail ui-tab-content"\n                data-ui-type="Panel"\n                data-ui-id="cdsInfoDetailPanel"\n                data-ui-extension-command-type="Command">\n                \x3c!-- block: detail-info --\x3e\x3c!-- /block --\x3e\n            </div>\n        </div>\n    </div>\n</div>\n\n\x3c!-- target: TPL_bcc_common_quick_search --\x3e\n<span class="quick-search-wrap">\n    <ul class="quick-search-filters">\n        <li><a\n            \x3c!-- if: ${filterMapper.expiredDate<7} --\x3e\n            class="link-like actived"\n            title="${i18n.清除快捷筛选：7天即将到期}"\n            data-track-id="ti_bcc_cancel_expiredate_search" data-track-name="取消7天即将到期"\n            \x3c!-- else: --\x3e\n            class="link-like"\n            title="${i18n.快捷筛选：7天即将到期}"\n            data-track-id="ti_bcc_expiredate_search" data-track-name="7天即将到期"\n            \x3c!-- /if --\x3e\n            data-key="expiredDate" data-op="<" data-value="7">\n            ${i18n.7天即将到期}\n\n            <span class="close">×</span>\n        </a>\n        </li>\n    </ul>\n</span>\n\n\x3c!-- target: TPL_cds_common_quick_search --\x3e\n<span class="quick-search-wrap">\n    <ul class="quick-search-filters">\n        <li><a\n            \x3c!-- if: ${filterMapper.asp<7} --\x3e\n            class="link-like actived"\n            title="${i18n.清除快捷筛选：7天内无快照}"\n            \x3c!-- else: --\x3e\n            class="link-like"\n            title="${i18n.快捷筛选：7天内无快照}"\n            \x3c!-- /if --\x3e\n            data-key="asp" data-op="<" data-value="7">\n            ${i18n.7天内无快照}\n\n            <span class="close">×</span>\n        </a>\n        </li>\n        <li><a\n            \x3c!-- if: ${filterMapper.expiredDate<7} --\x3e\n            class="link-like actived"\n            title="${i18n.清除快捷筛选：7天即将到期}"\n            \x3c!-- else: --\x3e\n            class="link-like"\n            title="${i18n.快捷筛选：7天即将到期}"\n            \x3c!-- /if --\x3e\n            data-key="expiredDate" data-op="<" data-value="7">\n            ${i18n.7天即将到期}\n            <span class="close">×</span>\n        </a>\n        </li>\n    </ul>\n</span>\n\n\x3c!-- target: TPL_bcc_instance_list_navigator --\x3e\n<ul class="ui-tab-navigator">\n    <li class="ui-tab-item\x3c!-- if: ${activedTab} == \'instance\' --\x3e ui-tab-item-active\x3c!-- /if --\x3e">\n        <a href="#/bcc/instance/list~from=dccInstanceList">${i18n.实例}</a>\n    </li>\n    <li class="ui-tab-item\x3c!-- if: ${activedTab} == \'hostInstance\' --\x3e ui-tab-item-active\x3c!-- /if --\x3e">\n        <a href="#/dcc/instance/list">${i18n.专属实例}</a>\n    </li>\n</ul>\n\n\x3c!-- target: TPL_bcc_search --\x3e\n<span class="ui-group ui-search-group">\n    <span data-ui-type="Select" data-ui-id="keywordType"\n          data-ui-value="@keywordType"></span>\n    <input class="search-box" data-ui-type="TextBox"\n           data-ui-id="keyword" data-ui-value="@keyword" />\n    <button data-ui-type="Button" data-ui-id="searchBtn"></button>\n</span>\n\n\x3c!-- target: TPL_bcc_search_ex --\x3e\n<span class="ui-group ui-search-group">\n    <span data-ui-type="SelectEx" data-ui-id="keywordType"\n          data-ui-value="@keywordType"\n          data-ui-has-child-list="true"></span>\n    <input class="search-box" data-ui-type="TextBox"\n           data-ui-id="keyword" data-ui-value="@keyword"\n           data-ui-extension-textbox-type="TextBoxSelect"/>\n    <button data-ui-type="Button" data-ui-id="searchBtn"></button>\n</span>\n\n\x3c!-- target: TPL_bcc_refreshList --\x3e\n<button data-ui-type="Button" data-ui-id="refreshList"\n        data-ui-skin="refresh"></button>\n\n\x3c!-- target: TPL_bcc_instance_tab --\x3e\n<ul class="ui-tab-navigator">\n    <li class="ui-tab-item ${tab.detail}">\n        <a href="#/bcc/instance/detail~instanceId=${instance.id}">${i18n.实例详情}</a>\n    </li>\n    <li class="ui-tab-item ${tab.cds}">\n        <a href="#/bcc/instance/disk/list~instanceId=${instance.id}">${i18n.本实例磁盘}</a>\n    </li>\n    <li class="ui-tab-item ${tab.snapshot}">\n        <a href="#/bcc/snapshot/instance~instanceId=${instance.id}">${i18n.本实例快照}</a>\n    </li>\n    <li class="ui-tab-item ${tab.security}">\n        <a href="#/bcc/instance/security_groups~instanceId=${instance.id}">${i18n.安全组}</a>\n    </li>\n    \x3c!-- if: !${consoleContext.FLAGS.enable_baixin} --\x3e\n    <li class="ui-tab-item ${tab.monitor}">\n        <a href="#/bcc/instance/monitor~instanceId=${instance.id}">${i18n.监控}</a>\n    </li>\n    \x3c!-- /if --\x3e\n</ul>\n\n\x3c!-- target: TPL_bcc_cds_tab --\x3e\n<ul class="ui-tab-navigator">\n    \x3c!-- if: ${isSystemDisk} --\x3e\n    <li class="ui-tab-item ${tab.detail}">\n        <a href="#/bcc/cds/detail~instanceId=${instanceId}">${i18n.系统磁盘详情}</a>\n    </li>\n    <li class="ui-tab-item ${tab.snapshot}">\n        <a href="#/bcc/snapshot/disk~diskType=system&instanceId=${instanceId}">${i18n.系统磁盘快照}</a>\n    </li>\n    \x3c!-- else --\x3e\n    <li class="ui-tab-item ${tab.detail}">\n        <a href="#/bcc/cds/detail~diskId=${diskId}">${i18n.CDS磁盘详情}</a>\n    </li>\n    <li class="ui-tab-item ${tab.snapshot}">\n        <a href="#/bcc/snapshot/disk~diskType=cds&diskId=${diskId}">${i18n.CDS磁盘快照}</a>\n    </li>\n    \x3c!-- /if --\x3e\n</ul>\n\n\x3c!-- target: TPL_bcc_instance_notice --\x3e\n<div data-ui-type="Panel" data-ui-id="instanceNotice" class="bcc-instance-notice">\n    <a href="${notice.url}" target="_blank" data-track-id="ti_bcc_instance_notice" data-track-name="安全公告">\n        <i class="iconfont icon-huodongicon"></i>${notice.text}\n    </a>\n    <i data-ui-type="Button" data-ui-id="instanceNoticeClose" class="iconfont icon-close" data-track-id="ti_bcc_instance_notice_close" data-track-name="关闭安全公告"></i>\n</div>\n\n\x3c!-- target: TPL_bcc_list_pager --\x3e\n<div data-ui-type="Pager" data-ui-id="pager" data-ui-page-type="plain"\n    data-ui-count="@totalCount" data-ui-page="@pageNo" data-ui-page-size="@pageSize"\n    data-ui-url-template="@urlTemplate" data-ui-layout="alignRight"\n    data-track-id="ti_bcc_pager" data-track-name="翻页">\n</div>\n'}),define("bcc/config",["require","underscore","inf-i18n","../common/config","./enum"],function(require){var e=require("underscore"),t=require("inf-i18n"),a=require("../common/config").getConfig(),i=require("./enum").DiskType;a.index="/bcc/instance/list",a.LIMIT={INSTANCE:{MAX_AT_ONE_TIME:100}};e.extend(a.api,{accountPurchaseValidation:"/api/account/purchase_validation",bccVNCUrl:"/api/bcc/instance/vnc",bccConsole:"/api/bcc/console",bccPurchasePay:"/api/bcc/purchase/pay",bccPurchasePaySubmit:"/api/bcc/purchase/pay_submit",getZoneListV3:"/api/zone/list/v3",getFlavorList:"/api/bcc/instance/flavor/list",bccInstanceList:"/api/bcc/instance/list",bccInstanceDetail:"/api/bcc/instance/detail",bccInstanceCreate:"/api/bcc/instance/create",bccInstancePrice:"/api/bcc/instance/price",bccInstancePriceV2:"/api/bcc/instance/priceV2",bccInstanceRebuild:"/api/bcc/instance/rebuild",bccInstanceReboot:"/api/bcc/instance/reboot",bccInstanceDelete:"/api/bcc/instance/delete",bccInstanceRename:"/api/bcc/instance/rename",bccInstanceStart:"/api/bcc/instance/start",bccInstanceStop:"/api/bcc/instance/stop",systemVolumeMap:"/api/bcc/instance/systemVolumeMap",natWhiteList:"/api/network/v1/nat/whiteList",bccInstanceJoinSecurityGroups:"/api/network/v1/security/join_security_groups",bccInstanceQuitSecurityGroup:"/api/network/v1/security/quit_security_group",bccInstanceSecurityGroups:"/api/network/v1/security/security_groups",bccInstanceChangePwd:"/api/bcc/instance/change_pwd",bccInstanceChangePwd2:"/api/bcc/instance/changepwd",bccInstanceCreateImage:"/api/bcc/instance/create_image",bccInstanceRecharge:"/api/bcc/instance/recharge",bccInstanceCreateOrder:"/api/bcc/instance/order",bccInstanceUpdateDesc:"/api/bcc/instance/update_desc",bccInstanceUpgradeConfigBudget:"/api/bcc/instance/upgrade_config/budget",bccInstanceUpgradeConfigCreate:"/api/bcc/instance/upgrade_config/create",bccInstanceUpdateConfigBudget:"/api/bcc/instance/update_config/budget",bccInstanceUpdateConfigCreate:"/api/bcc/instance/update_config/create",bccInstanceSnapshotSheduledSet:"/api/bcc/snapshot/scheduled/set",bccInstanceSnapshotSheduledUpdate:"/api/bcc/snapshot/scheduled/update",bccInstanceSnapshotSheduledQuery:"/api/bcc/snapshot/scheduled/query",bccInstanceExpiredRelease:"/api/bcc/instance/expired/release",bccCancelAlterProductType:"/api/bcc/order/v2/confirm?orderType=CANCEL_TO_POSTPAY",dccCancelAlterProductType:"/api/bcc/dcc/order/v2/confirm?orderType=CANCEL_TO_POSTPAY",bccImageList:"/api/bcc/image/list",bccImageDetail:"/api/bcc/image/detail",bccImageDelete:"/api/bcc/image/delete",bccImageRename:"/api/bcc/image/rename",mktImageDetail:"/api/bcc/image/mkt/product",getMKTCategory:"/api/bcc/image/mkt/category",getMKTList:"/api/bcc/image/mkt/product/list",getMKTSelectedList:"/api/bcc/image/mkt/product/recommend",bccSnapshotList:"/api/bcc/snapshot/list",bccSnapshotDetail:"/api/bcc/snapshot/detail",bccSnapshotCreate:"/api/bcc/snapshot/create",bccSnapshotDelete:"/api/bcc/snapshot/delete",bccSnapshotRename:"/api/bcc/snapshot/rename",bccSnapshotRollback:"/api/bcc/snapshot/rollback",bccSnapshotCreateImage:"/api/bcc/snapshot/create_image",bccSnapshotBatchDelete:"/api/bcc/snapshot/batch_delete",bccWhiteTags:"/api/bcc/instance/white_tags",bccDiskList:"/api/bcc/disk/list",bccCdsCreate:"/api/bcc/cds/create",bccCdsPrice:"/api/bcc/cds/price",bccCdsCreateOrder:"/api/bcc/cds/order",bccDiskDetail:"/api/bcc/disk/detail",bccCdsAttach:"/api/bcc/cds/attach",bccCdsDetach:"/api/bcc/cds/detach",bccCdsDelete:"/api/bcc/cds/delete",bccCdsRename:"/api/bcc/cds/rename",bccCdsRecharge:"/api/bcc/cds/recharge",bccCdsCancelAlterProductType:"/api/cds/order/v2/confirm?orderType=CANCEL_TO_POSTPAY",bccCdsSnapshotCreate:"/api/bcc/cds/snapshot/create",bccCdsSnapshotDelete:"/api/bcc/cds/snapshot/delete",bccCdsSnapshotRename:"/api/bcc/cds/snapshot/rename",bccCdsSnapshotRollback:"/api/bcc/cds/snapshot/rollback",bccCdsUpdateDesc:"/api/bcc/cds/update_desc",bccCdsUpgradeOrder:"/api/bcc/cds/update_config/create",bccCdsUpgradeConfigBudget:"/api/bcc/cds/update_config/budget",bccSecurityList:"/api/network/v1/security/list",bccSecurityDelete:"/api/network/v1/security/delete",bccSecurityListSelect:"/api/network/v1/security/list_select",bccSecurityBatchDelete:"/api/network/v1/security/batch_delete",bccSecurityCreate:"/api/network/v1/security/create",bccSecurityCopy:"/api/network/v1/security/copy",bccSecurityDetail:"/api/network/v1/security/detail",bccSecurityUpdate:"/api/network/v1/security/update",bccSecurityUpdateField:"/api/network/v1/security/update_field",bccTagAssign:"/api/bcc/tag/assign",dccTagAssign:"/api/bcc/tag/dcc/assign",dbccTagAssign:"/api/bcc/tag/dbcc/assign",getSearchTagList:"/api/tag/list",bccSendAuthCode:"/api/bcc/authcode/send",bccInvalidateAuthCode:"/api/bcc/authcode/invalidate",bccQuota:"/api/bcc/instance/quota",bccRealname:"/api/bcc/instance/realname",getTraceLogList:"/api/bcc/tracelog/list",bccEipInstanceList:"/api/bcc/eip/unused_eips",bccEipBind:"/api/bcc/eip/bind",bccEipUnbind:"/api/bcc/eip/unbind",eipInstanceQuota:"/api/eip/quota",getVpcDetail:"/api/bcc/vpc/vpcInfos",subnetList:"/api/network/v1/subnets",vpcList:"/api/network/v1/vpcs",getDccHostList:"/api/bcc/dcc/host/list",bccUpdatePrivateIP:"/api/bcc/instance/updatePrivateIP",bccchangeSubnet:"/api/bcc/instance/changeSubnet",vpcSubnetList:"/api/network/v1/subnet/list",sshList:"/api/bcc/keypair/list",sshDetail:"/api/bcc/keypair/detail",sshCreate:"/api/bcc/keypair/create",sshImport:"/api/bcc/keypair/import",sshAttach:"/api/bcc/keypair/attach",sshDetach:"/api/bcc/keypair/detach",sshDelete:"/api/bcc/keypair/delete",sshRename:"/api/bcc/keypair/rename",sshUpdateDesc:"/api/bcc/keypair/update_desc",aspList:"/api/bcc/asp/list",aspCreate:"/api/bcc/asp/create",aspUpdate:"/api/bcc/asp/update",aspDelete:"/api/bcc/asp/delete",aspAttach:"/api/bcc/asp/attach",aspDetach:"/api/bcc/asp/detach",aspUpdateAttach:"/api/bcc/asp/updateAttach"});var n={FILTER:{INSTANCE:{NAME:{name:t("实例名称"),value:"name"},ID:{name:t("实例ID"),value:"instanceId"},INTERNALIP:{name:t("实例内网IP"),value:"internalIp"},PUBLICIP:{name:t("实例公网IP"),value:"publicIp"},VPC:{name:t("所在网络"),value:"vpcName"},SUBNET:{name:t("所在子网"),value:"subnetName"},SSHNAME:{name:t("密钥对名称"),value:"keypairName"},SSHID:{name:t("密钥对ID"),value:"keypairId"},SUBNETID:{name:t("子网ID"),value:"subnetId"}},SNAPSHOT:{NAME:{name:"快照名称",value:"SNAPSHOT_NAME"},ID:{name:"快照ID",value:"SNAPSHOT_ID"}},MIRROR:{NAME:{name:"镜像名称",value:"MIRROR_NAME"},ID:{name:"镜像ID",value:"MIRROR_ID"}},DISK:{NAME:{name:t("磁盘名称"),value:"name"},ID:{name:t("磁盘ID"),value:"volumeId"},INSTANCE_NAME:{name:t("所属实例名称"),value:"instanceName"},ASPID:{name:t("自动快照策略ID"),value:"aspId"}},SECURITY:{NAME:{name:"安全组名称",value:"SECURITY_NAME"},ID:{name:"安全组ID",value:"SECURITY_ID"}},RELATEDISK:[{text:t("磁盘名称"),value:"name"},{text:t("磁盘ID"),value:"volumeId"}],RELATEASP:[{text:t("快照策略名称"),value:"name"},{text:t("快照策略ID"),value:"aspId"}],ASPLIST:[{text:t("策略名称"),value:"name"},{text:t("策略ID"),value:"aspId"},{text:t("磁盘名称"),value:"volumeName"}]},RULE:{NAME:{placeholder:t("请输入名称"),note:t("大小写字母、数字、中文以及-_ /.特殊字符，必须以字母开头，长度1-65"),required:"required",requiredErrorMessage:t("名称必填"),pattern:/^[a-zA-Z][\u4e00-\u9fa5\w\-\/\.]{0,64}$/,patternErrorMessage:t("名称不符合规则：支持大小写字母、数字、中文以及-_ /.特殊字符，必须以字母开头，长度1-65")},SCRIPTADDRESS:{pattern:/^(https|http):\/\/.+/,patternErrorMessage:t("地址不符合规则：只支持以http://或https://开头")},DESCRIPTION:{placeholder:"长度0~140",maxLength:140,patternErrorMessage:"描述长度必须在0~140个字符之间"},NAME_SUPPORT_CHINESE:{placeholder:"大小写字母、数字，中文以及-_ /.特殊字符，必须以字母、中文开头，但不能以default开头，长度1-65",required:"required",requiredErrorMessage:"名称必填",pattern:/^(?!default)[a-zA-Z\u4e00-\u9fa5][\u4e00-\u9fa5\w\-\/\.]{0,64}$/,patternErrorMessage:"名称不符合规则：大小写字母、数字，中文以及-_ /.特殊字符，必须以字母、中文开头，但不能以default开头，长度1-65"},PASSWORD:{required:"required",requiredErrorMessage:"密码必填",custom:function(e){return e.length>7&&e.length<33&&/[a-zA-Z]/.test(e)&&/\d/.test(e)&&/[!@#$%^*()]/.test(e)&&/^[a-zA-Z\d!@#$%^*()]+$/.test(e)},customErrorMessage:"8～32位字符，英文、数字和符号必须同时存在，符号仅限!@#$%^*()"},SECURITY_NAME:{placeholder:"字母、数字，中文以及-_ /.字符，字母或中文开头，长度1-64",required:"required",requiredErrorMessage:"安全组名称必填",pattern:/^[a-zA-Z\u4e00-\u9fa5][a-zA-Z\u4e00-\u9fa50-9\-_ \/\.]{0,63}$/,patternErrorMessage:"不符合规则：字母、数字，中文以及-_ /.字符，字母或中文开头，长度1-64"},SECURITY_DESCRIPTION:{placeholder:"最多255个字符",pattern:/^.{0,255}$/,patternErrorMessage:"最多255个字符"}},INSTANCE_STATUS:{ACTIVE:"ACTIVE",SHUTOFF:"SHUTOFF",PAUSED:"PAUSED",SUSPENDED:"SUSPENDED",RESCUE:"RESCUE",ERROR:"ERROR",SOFT_DELETED:"SOFT_DELETED",BUILD:"BUILD",VERIFY_RESIZE:"VERIFY_RESIZE",REVERT_RESIZE:"REVERT_RESIZE",EXPIRED:"EXPIRED",SHELVED:"SHELVED",SHELVED_OFFLOADED:"SHELVED_OFFLOADED",SNAPSHOT:"SNAPSHOT",ROLLBACK_SNAPSHOT:"ROLLBACK_SNAPSHOT",DELETE_SNAPSHOT:"DELETE_SNAPSHOT",TEMPLATE:"TEMPLATE",REBOOT:"REBOOT",HARD_REBOOT:"HARD_REBOOT",PASSWORD:"PASSWORD",REBUILD:"REBUILD",MIGRATING:"MIGRATING",RESIZE:"RESIZE",DELETING:"DELETING",BINDING:"BINDING",UNBINDING:"UNBINDING",BILLING_CHANGING:"BILLING_CHANGING",RECHARGE:"RECHARGE",POWERING_OFF:"POWERING_OFF",POWERING_ON:"POWERING_ON",VOLUME_RESIZE:"VOLUME_RESIZE",BINDKEYPAIR:"BINDKEYPAIR",UNBINDKEYPAIR:"UNBINDKEYPAIR",TXT:{ACTIVE:t("运行中"),SHUTOFF:t("已关机"),PAUSED:t("已睡眠"),SUSPENDED:t("已休眠"),RESCUE:t("已修复"),ERROR:t("错误"),SOFT_DELETED:t("已删除"),BUILD:t("创建中"),VERIFY_RESIZE:t("扩容确认中"),REVERT_RESIZE:t("扩容回滚中"),EXPIRED:t("已到期"),SHELVED:t("搁置"),SHELVED_OFFLOADED:t("搁置"),SNAPSHOT:t("创建快照中"),ROLLBACK_SNAPSHOT:t("回滚快照中"),DELETE_SNAPSHOT:t("删除快照中"),TEMPLATE:t("创建镜像中"),REBOOT:t("重启中"),HARD_REBOOT:t("重启中"),PASSWORD:t("重置密码中"),REBUILD:t("重建中"),MIGRATING:t("迁移中"),RESIZE:t("资源扩展中或未支付"),DELETING:t("释放中"),BINDING:t("绑定中"),UNBINDING:t("解绑中"),BILLING_CHANGING:t("计费变更中"),RECHARGE:t("续费中"),POWERING_OFF:t("关机中"),POWERING_ON:t("开机中"),VOLUME_RESIZE:t("磁盘扩容中"),UNBINDKEYPAIR:t("解绑密钥对中"),BINDKEYPAIR:t("绑定密钥对中")},CLASS:{ACTIVE:"status normal",SHUTOFF:"status unavailable",PAUSED:"status warning",SUSPENDED:"status warning",RESCUE:"status warning",ERROR:"status error",SOFT_DELETED:"status warning",BUILD:"status warning",VERIFY_RESIZE:"status warning",REVERT_RESIZE:"status warning",EXPIRED:"status error",SHELVED:"status warning",SHELVED_OFFLOADED:"status warning",SNAPSHOT:"status warning",ROLLBACK_SNAPSHOT:"status warning",DELETE_SNAPSHOT:"status warning",TEMPLATE:"status warning",REBOOT:"status warning",HARD_REBOOT:"status warning",PASSWORD:"status warning",REBUILD:"status warning",MIGRATING:"status warning",RESIZE:"status warning",DELETING:"status warning",BINDING:"status warning",UNBINDING:"status warning",BILLING_CHANGING:"status warning",RECHARGE:"status warning",POWERING_OFF:"status warning",POWERING_ON:"status warning",VOLUME_RESIZE:"status warning",UNBINDKEYPAIR:"status warning",BINDKEYPAIR:"status warning"}},DISK_STATUS:{ACTIVE:"active",CREATING:"creating",AVAILABLE:"available",IN_USE:"in-use",ATTACHING:"attaching",DETACHING:"detaching",DELETING:"deleting",ERROR_DELETING:"error_deleting",ERROR:"error",IN_SNAPSHOT:"in-snapshot",IN_CLONE:"in-clone",IN_ROLLBACK:"in-rollback",EXPIRED:"expired",EXTENDING:"extending",UNAVAILABLE:"unavailable",RECHARGE:"recharge",BILLING_CHANGING:"billing_changing",TXT:{active:t("运行中"),creating:t("创建中"),available:t("未挂载"),"in-use":t("已挂载"),attaching:t("挂载中"),detaching:t("卸载中"),deleting:t("删除中"),"error-deleting":t("删除失败"),error:t("卷错误"),"in-snapshot":t("快照中"),"in-clone":t("克隆中"),"in-rollback":t("回滚中"),expired:t("已到期"),extending:t("扩容中"),unavailable:t("不可用"),recharge:t("续费中"),billing_changing:t("计费变更中")},CLASS:{active:"status normal",creating:"status warning",available:"status warning","in-use":"status normal",attaching:"status warning",detaching:"status warning",deleting:"status warning","error-deleting":"status error",error:"status error","in-snapshot":"status warning","in-clone":"status warning","in-rollback":"status warning",expired:"status error",extending:"status warning",unavailable:"status error",recharge:"status warning",billing_changing:"status warning"}},SYSTEM_DISK_STATUS:{CREATING:"creating",AVAILABLE:"available",IN_USE:"in-use",DELETING:"deleting",ERROR:"error",IN_SNAPSHOT:"in-snapshot",IN_ROLLBACK:"in-rollback",EXPIRED:"expired",UNAVAILABLE:"unavailable",EXTENDING:"extending",BILLING_CHANGING:"billing_changing",TXT:{creating:t("创建中"),available:t("正常"),"in-use":t("运行中"),deleting:t("删除中"),error:t("卷错误"),"in-snapshot":t("快照中"),"in-rollback":t("回滚中"),expired:t("已到期"),unavailable:t("不可用"),extending:t("扩容中"),billing_changing:t("计费变更中")},CLASS:{creating:"status warning",available:"status normal","in-use":"status normal",deleting:"status warning",error:"status error","in-snapshot":"status warning","in-rollback":"status warning",expired:"status error",unavailable:"status error",extending:"status warning",billing_changing:"status warning"}},IMAGE_STATUS:{ACTIVE:"active",ERROR:"error",QUEUED:"queued",SAVING:"saving",TXT:{active:"已完成",error:"错误",queued:"创建中",saving:"创建中"},CLASS:{active:"status normal",error:"status error",queued:"status warning rolling",saving:"status warning rolling"}},SNAPSHOT_STATUS:{ACTIVE:"active",CREATING:"creating",AVAILABLE:"available",IN_USE:"in-use",ATTACHING:"attaching",DETACHING:"detaching",DELETING:"deleting",ERROR_DELETING:"error_deleting",ERROR:"error",IN_SNAPSHOT:"in-snapshot",IN_CLONE:"in-clone",IN_ROLLBACK:"in-rollback",EXPIRED:"expired",EXTENDING:"extending",UNAVAILABLE:"unavailable",TXT:{active:t("运行中"),creating:t("创建中"),available:t("已完成"),"in-use":t("已挂载"),attaching:t("挂载中"),detaching:t("卸载中"),deleting:t("删除中"),error_deleting:t("删除失败"),error:t("卷错误"),"in-snapshot":t("快照中"),"in-clone":t("克隆中"),"in-rollback":t("回滚中"),expired:t("已到期"),extending:t("扩容中"),unavailable:t("不可用")},CLASS:{active:"status normal",creating:"status warning rolling",available:"status normal","in-use":"status warning",attaching:"status warning",detaching:"status warning",deleting:"status warning",error_deleting:"status error",error:"status error","in-snapshot":"status warning","in-clone":"status warning","in-rollback":"status warning rolling",expired:"status error",extending:"status warning",unavailable:"status error"}},SYSTEM_SNAPSHOT_STATUS:{ACTIVE:"active",ERROR:"error",QUEUED:"queued",SAVING:"saving",DELETING:"deleting",TXT:{active:"已完成",error:"错误",queued:"创建中",saving:"创建中",deleting:"删除中"},CLASS:{active:"status normal",error:"status error",queued:"status warning rolling",saving:"status warning rolling",deleting:"status warning"}},DISK_TYPE:{SYSTEM:"system",CDS:"cds",TXT:{system:t("系统盘"),ssd:i.getTextFromAlias("SSD"),sata:i.getTextFromAlias("SATA"),premium_ssd:i.getTextFromAlias("PREMIUM_SSD")},SNAPSHOT_TXT:{system:t("系统盘"),cds:t("数据盘")}},PAYMENT:{FREE:"FREE",PREPAY:"prepay",POSTPAY:"postpay"},CREATE_METHOD:{AUTO:"AUTO",MANUAL:"MANUAL",MIGRATION:"MIGRATION",TXT:{AUTO:t("自动"),MANUAL:t("手动"),MIGRATION:t("迁移")}},PASSWORD_TYPE:{RANDOM:"random",CUSTOM:"custom",SSH:"ssh"},IMAGE_TYPE:{COMMON:"common",CUSTOM:"custom",INTEGRATION:"integration",SHARING:"sharing"},OS_TYPE:{linux:"linux",windows:"windows"},OS_ADMIN_NAME:{linux:"root",windows:"Administrator"},BCC_LISTEN_INTERVAL:6e4,PAYMENT_DESC:{FREE:t("试用"),prepay:t("预付费"),postpay:t("后付费")},FLAVOR_LIST:[{name:"磁盘型",children:[{name:"小型",cpu:0,memory:0,diskSize:{selectedIndex:2,datasource:[40,80,120]}},{name:"中型",cpu:1,memory:1,diskSize:{selectedIndex:2,datasource:[80,160,240]}},{name:"大型",cpu:2,memory:3,diskSize:{selectedIndex:2,datasource:[160,240,480]}}]},{name:"内存型",children:[{name:"小型",cpu:0,memory:2,diskSize:{selectedIndex:1,datasource:[20,40,60]}},{name:"中型",cpu:2,memory:5,diskSize:{selectedIndex:1,datasource:[40,80,120]}},{name:"大型",cpu:3,memory:7,diskSize:{selectedIndex:1,datasource:[60,120,180]}}]},{name:"均衡型",children:[{name:"小型",cpu:0,memory:1,diskSize:{selectedIndex:1,datasource:[25,50,75]}},{name:"中型",cpu:2,memory:3,diskSize:{selectedIndex:1,datasource:[100,200,300]}},{name:"大型",cpu:3,memory:5,diskSize:{selectedIndex:1,datasource:[200,400,600]}}]},{name:"计算型",children:[{name:"小型",cpu:1,memory:1,diskSize:{selectedIndex:1,datasource:[25,50,75]}},{name:"中型",cpu:2,memory:2,diskSize:{selectedIndex:1,datasource:[50,100,150]}},{name:"大型",cpu:4,memory:4,diskSize:{selectedIndex:1,datasource:[150,300,450]}}]}],OS_IMAGE_NAME:["ubuntu","windows-server","centos","debian","windows","linux","suse"],FORBIDDENTIP:'因违反<a target="_blank" href="http://bce.baidu.com/doc/UserGuide/info_safety.html">《百度云信息安全规定》</a>，您的BCC产品服务已被封禁，请清理违规内容后通过<a target="_blank" href="http://ticket.bce.baidu.com/#/ticket/create">工单</a>申请解禁'},s=n.INSTANCE_STATUS;return e.extend(s,{CAN_START:[s.SHUTOFF],CAN_STOP:[s.ACTIVE,s.ERROR,s.RESCUE],CAN_REBOOT:[s.ACTIVE],CAN_RESET_PASSWORD:[s.ACTIVE,s.SHUTOFF],CAN_ROLLBACK_SNAPSHOT:[s.ACTIVE,s.SHUTOFF],CAN_CREATE_DISK:[s.ACTIVE,s.SHUTOFF],CAN_CREATE_SNAPSHOT:[s.ACTIVE,s.SHUTOFF],CAN_REBUILD:[s.ACTIVE,s.SHUTOFF],CAN_CREATE_IMAGE:[s.ACTIVE,s.SHUTOFF],CAN_RESIZE:[s.ACTIVE,s.SHUTOFF],CAN_ATTACH:[s.ACTIVE,s.SHUTOFF,s.RESCUE,s.PAUSED],CANT_RECHARGE:[s.BUILD,s.ERROR,s.VERIFY_RESIZE,s.REVERT_RESIZE,s.RESIZE,s.DELETING],CAN_RECHARGE:[s.ACTIVE,s.EXPIRED,s.SHUTOFF],CAN_ALTER_PRODUCTTYPE:[s.ACTIVE,s.SHUTOFF],CANT_RELEASE:[s.BUILD,s.DELETING,s.SNAPSHOT,s.PASSWORD,s.REBUILD,s.RECHARGE,s.BINDING,s.UNBINDING,s.RESIZE,s.REBOOT],CAN_BINDEIP:[s.ACTIVE,s.SHUTOFF,s.PAUSED,s.SUSPENDED,s.RESCUE],CAN_UNBINDEIP:[s.ACTIVE,s.SHUTOFF,s.PAUSED,s.SUSPENDED,s.RESCUE,s.EXPIRED],CAN_CHANGEIP:[s.ACTIVE,s.SHUTOFF],CAN_EDITNAME:[s.ACTIVE,s.SHUTOFF]}),s=n.DISK_STATUS,e.extend(s,{CAN_ATTACH:[s.AVAILABLE],CAN_DETACH:[s.IN_USE],CAN_ROLLBACK:[s.AVAILABLE],CAN_CREATE_SNAPSHOT:[s.AVAILABLE,s.IN_USE],CAN_DELETE:[s.AVAILABLE,s.ERROR,s.EXPIRED],CANT_RECHARGE:[s.CREATING,s.RECHARGE,s.EXTENDING,s.UNAVAILABLE,s.DELETING,s.ERROR,s.ERROR_DELETING],CAN_RECHARGE:[s.AVAILABLE,s.EXPIRED,s.IN_USE],CAN_ALTER_PRODUCTTYPE:[s.AVAILABLE,s.IN_USE],CAN_DO_NOTHING:[s.CREATING,s.RECHARGE],DOING_STATUS:[s.CREATING,s.ATTACHING,s.DETACHING,s.IN_SNAPSHOT,s.DELETING,s.IN_CLONE,s.IN_ROLLBACK]}),s=n.SYSTEM_DISK_STATUS,e.extend(s,{CAN_ROLLBACK:[s.AVAILABLE,s.IN_USE],CAN_CREATE_SNAPSHOT:[s.AVAILABLE,s.IN_USE],CAN_DELETE_SNAPSHOT:[s.AVAILABLE,s.IN_USE,s.ERROR],CAN_CREATE_IMAGE:[s.AVAILABLE,s.IN_USE]}),s=n.IMAGE_STATUS,e.extend(s,{CAN_DELETE:[s.ACTIVE,s.ERROR]}),s=n.SNAPSHOT_STATUS,e.extend(s,{CAN_ATTACH:[s.AVAILABLE],CAN_DETACH:[s.IN_USE],CAN_ROLLBACK:[s.AVAILABLE],CAN_CREATE_SNAPSHOT:[s.AVAILABLE,s.IN_USE],CAN_DELETE:[s.AVAILABLE,s.ERROR,s.EXPIRED],CAN_DO_NOTHING:[s.CREATING],DOING_STATUS:[s.CREATING,s.ATTACHING,s.DETACHING,s.IN_SNAPSHOT,s.DELETING,s.IN_CLONE,s.IN_ROLLBACK]}),s=n.SYSTEM_SNAPSHOT_STATUS,e.extend(s,{CAN_ROLLBACK:[s.ACTIVE],CAN_CREATE_IMAGE:[s.ACTIVE],DOING_STATUS:[s.QUEUED,s.SAVING]}),a.pageSize=10,e.extend(a,n),a}),define("bcc/control/BccCreateMethod",["require","moment","underscore","jquery","esui","esui/lib","esui/InputControl","esui/controlHelper","common/constants","common/util/tableUtil","inf-ria/ui/Dragger","inf-ria/ui/MultiColumnBox"],function(require){function e(e){u.apply(this,arguments)}function t(e,t){var a=d.g(e.id+"Wrapper"),i=function(e){if((e=d.g(e)).previousElementSibling)return e.previousElementSibling;for(var t=e.previousSibling;t;t=t.previousSibling)if(1===t.nodeType)return t;return null}(a);(!i||!d.getAttribute(i,"data-index"))&&(i=a);var n=parseInt(d.getAttribute(i,"data-index"),10)+1,s=o.extend({id:e.id,index:n},t),r=function(e,t){var a=document.createElement("dd");return t.otherClass&&d.addClass(a,t.otherClass),d.addClass(a,t.id),d.setAttribute(a,"data-index",t.index),a.innerHTML=d.format(e,t),a}(t.tpl,s);return t.tpl===x?d.insertAfter(r,d.dom.last(d.dom.first(d.dom.last(a)))):d.insertBefore(r,a),{ele:r,index:n}}function a(e,t){if(e&&t){var a="",i="";switch(e){case"sata":a="数百",i="30 - 40";break;case"ssd":a=o.min([5e3,Math.round(8*+t)+1e3]),i=o.min([130,Math.round(.16*+t)+50]);break;case"premium_ssd":a=o.min([24e3,Math.round(30*+t)]),i=o.min([260,Math.round(.263*+t)+50])}return"峰值性能：随机IO "+a+" IOPS，吞吐量 "+i+" MB/s"}}function i(){function e(e){var t=l.get(i.id+c),n="premium_ssd"===e?50:5,s=o.max([t.getValue(),n]);t.setProperties({min:n}),t.setValue(s),m.setText(a(e,s)),i.setValue(c-1,s)}var i=this,n=t(i,{tpl:T}),r=n.ele,c=n.index,u={};u[i.id+c]=i.dragger;var p=l.init(r,{properties:u}),f=p[1],m=p[2],h=p[0];h.setProperties({datasource:i.__getDiskTypes()}),e(h.getValue()),h.on("change",function(t){e(t.target.getValue())}),f.on("change",function(e){return function(t){var n=l.get(g+i.id+(e.index+1)),s=l.get(y+i.id+(e.index+1));s&&n&&s.setText(a(n.getValue(),t.now)),i.setValue(e.index,t.now)}}({index:c-1})),f.on("delete",function(e){return function(){i.setValue(e.index,null),i.setButtonStatus(),e.ctrl.dispose(),e.select.dispose(),d.removeNode(e.ele),s.call(i)}}({index:c-1,ele:r,ctrl:f,select:h})),m.setText(a(h.getValue(),i.dragger.value||i.dragger.min)),i.setValue(c-1,i.dragger.value||i.dragger.min),i.setButtonStatus(),s.call(i)}function n(){function e(t){i.dragger.stateDisabled=i.snapshot.stateDisabled=!1,i.setButtonStatus();var n=v.datasource[t.selectedIndex];i.addSnapshot({snapshotId:n.id,snapshotName:n.name,size:n.size.toString()}),v.un("select",e),g.un("click",a),f.dispose(),m.dispose(),g.dispose(),v.dispose(),d.removeNode(s)}function a(){var e=f.getValue(),t=o.trim(m.getValue()),a=i.datasource;if(t){var n=o.filter(a,function(a){return a[e]&&a[e].match(t)});v.setDatasource(n)}else v.setDatasource(a)}var i=this,n=t(i,{tpl:x,otherClass:h}),s=n.ele,r=n.index,c={};c[i.id+r]=o.extend({datasource:i.datasource},i.snapshot);var u=l.init(s,{properties:c}),f=u[0],m=u[1],g=u[2],v=u[3];f.setProperties({datasource:[{name:"快照名称",value:"name"},{name:"快照ID",value:"snapshotId"}]}),g.on("click",a),v.on("select",e),i.dragger.stateDisabled=i.snapshot.stateDisabled=!0,i.setButtonStatus(),p.addDOMEvent(this,s,"click",function(t){var n=t.target||t.srcElement,r=d.getAttribute(n,"class");/ui-dialog-close-icon/.test(r)&&(v.un("select",e),g.un("click",a),f.dispose(),m.dispose(),g.dispose(),v.dispose(),d.removeNode(s),i.dragger.stateDisabled=i.snapshot.stateDisabled=!1,i.setButtonStatus())})}function s(){var e=document.getElementsByClassName(this.id);o.each(e,function(e){d.addClass(e,"without-title")}),e.length>0&&d.removeClass(e[0],"without-title")}var r=require("moment"),o=require("underscore"),c=require("jquery"),l=require("esui"),d=require("esui/lib"),u=require("esui/InputControl"),p=require("esui/controlHelper"),f=require("common/constants"),m=require("common/util/tableUtil");require("inf-ria/ui/Dragger"),require("inf-ria/ui/MultiColumnBox"),e.prototype.type="BccCreateMethod";var h="ui-bcccreatemethod",g="bcccreatemethod-cds-",v="bcccreatemethod-cds-select",b="bcccreatemethod-cds-tip",y="bcccreatemethod-cds-tip-",T=["<label>CDS云磁盘：</label>","<div>","<table><tr>",'<td width="130px">','<div data-ui-id="'+g+'${id}${index}" data-ui-width="120"','data-ui-type="Select" class="'+v+'"></div>',"</td>","<td>",'<div data-ui-id="${id}${index}" data-ui-type="Dragger"></div>',"</td>","</tr></table>",'<p class="'+b+'" data-ui-type="Label" data-ui-id="'+y+'${id}${index}"></p>',"</div>"].join(""),x=['<div class="snapshot-wrapper">',"<h3>快照列表</h3>",'<span class="ui-group ui-search-group">','<span data-ui-type="Select" data-ui-id="keywordType"></span>','<input class="search-box" data-ui-type="TextBox" data-ui-id="keyword"/>','<button data-ui-type="Button" data-ui-id="searchBtn"></button>',"</span>",'<div data-ui-id="${id}${index}" data-ui-type="Table"></div>','<div class="ui-dialog-close-icon">&nbsp;</div>',"</div>"].join(""),I=["<label>CDS云磁盘：</label>",'<div class="ui-bcccreatemethod">',"<table><tr>",'<td colspan="2"><div class="snapshot-item">从快照"${shortName}"创建CDS磁盘(${size}GB)</div></td>',"</tr>","<tr>",'<td width="130px">','<div data-ui-type="Select" data-ui-width="120" data-ui-id="'+g+'${id}${index}" class="'+v+'"></div>',"</td>","<td>",'<div data-ui-id="${id}${index}" data-ui-type="Dragger"></div>','<div class="snapshot-icon-delete" id="${id}${index}SnapshotDelete"></div>',"</td>","</tr></table>",'<p class="'+b+'" data-ui-type="Label" data-ui-id="'+y+'${id}${index}"></p>',"</div>"].join(""),S=['<button type="button" data-ui-id="${btnId}" ','class="btn btn-action btn-add ${btnClass}" ','data-ui-child-name="${btnName}" data-ui-type="Button">',"${content}</button>"].join("");return e.prototype.initStructure=function(){this.main.innerHTML=function(e){return[d.format(S,{btnId:e.helper.getId("addDragger"),btnName:"addDragger",btnClass:"btn-add-cds",content:e.dragger.content||"创建CDS磁盘"}),d.format(S,{btnId:e.helper.getId("addSnapshot"),btnName:"addSnapshot",btnClass:"btn-add-cds-snapshot",content:e.snapshot.content||"从快照创建CDS磁盘"})].join("")}(this),this.initChildren(this.main),this.setButtonStatus();for(var e=0,t=this.initDraggerCount;e<t;e++)i.call(this)},e.prototype.addSnapshot=function(e){var i=this;e.shortName=e.snapshotName.length>24?e.snapshotName.substr(0,23)+"...":e.snapshotName;var n=t(i,o.extend({tpl:I},e)),r=n.ele,c=n.index,u={};u[i.id+c]=o.clone(i.dragger),u[i.id+c].min=o.max([i.dragger.min,+e.size]),u[i.id+c].opMode="";var f=l.init(r,{properties:u}),m=f[0],h=f[1],v=f[2];m.setProperties({datasource:i.__getDiskTypes()}),m.on("change",function(t){var n=l.get(i.id+c),s=t.target.getValue(),r="premium_ssd"===s?50:5,d=o.max([n.getValue(),r,+e.size]);n.setProperties({min:o.max([r,+e.size])}),n.setValue(d),v.setText(a(s,d));var u=o.clone(e);u.size=d+"",i.setValue(c-1,u)}),h.on("change",function(t){return function(n){var s=l.get(g+i.id+(t.index+1)),r=l.get(y+i.id+(t.index+1));r&&s&&r.setText(a(s.getValue(),n.now));var c=o.clone(e);c.size=n.now+"",i.setValue(t.index,c)}}({index:c-1})),p.addDOMEvent(this,d.g(i.id+c+"SnapshotDelete"),"click",function(e){return function(){i.setValue(e.index,null),i.setButtonStatus(),e.select.dispose(),d.removeNode(e.ele),s.call(i)}}({index:c-1,ele:n.ele,select:m})),v.setText(a(m.getValue(),e.size)),i.setValue(c-1,e),i.dragger.stateDisabled=i.snapshot.stateDisabled=!1,i.setButtonStatus(),s.call(i)},e.prototype.initOptions=function(e){var t={dragger:{max:2048,min:0,unit:"GB",length:349,opMode:"delete",stateDisabled:!1},snapshot:{stateDisabled:!1},currentValue:[],maxlength:999,initDraggerCount:0};o.extend(t.snapshot,m.tableProperty([{title:"快照名称",width:150,stable:!0,content:function(e){return'<span title="'+e.name+'" class="instance-name">'+e.name+"</span>"}},{title:"快照ID",width:100,stable:!0,content:function(e){return"<span>"+e.snapshotId+"</span>"}},{title:"创建时间",width:145,stable:!0,content:function(e){return r(e.createTime).format(f.TIME_FORMAT)}}],{select:"single"})),o.extend(t.dragger,e.dragger),delete e.dragger,o.extend(t.snapshot,e.snapshot),delete e.snapshot,o.extend(t,e),this.setProperties(t)},e.prototype.initEvents=function(){this.getChild("addDragger").on("click",i,this),this.getChild("addSnapshot").on("click",n,this)},e.prototype.setButtonStatus=function(){var e=this.getValue().length,t=this.dragger.stateDisabled||e>=this.maxlength,a=this.snapshot.stateDisabled||e>=this.maxlength;this.getChild("addDragger").setDisabled(t),this.getChild("addSnapshot").setDisabled(a)},e.prototype.setValue=function(e,t,a){var i=l.get(g+this.id+(e+1)),n={};if(i&&(n={volumeType:i.getValue()}),this.currentValue[e]="number"==typeof t?{size:t.toString(),snapshotId:""}:t,o.extend(this.currentValue[e],n),!a){var s=this;setTimeout(function(){s.fire("change",{count:s.getValue().length})},300)}},e.prototype.updateDiskType=function(e){c("."+v).each(function(t,a){var i=c(a).data("ui-id"),n=l.get(i);if(n){var s=o.find(e,function(e){return!e.disabled}).value;n.updateDatasource(e),n.setValue(s)}}),this.set("diskType",e)},e.prototype.hide=function(){c("."+this.id).hide()},e.prototype.show=function(){c("."+this.id).show()},e.prototype.__disableSATA__=function(){this.__sataDisabled=!0;var e=this.__getDiskTypes();c("."+v).each(function(t,a){var i=c(a).data("ui-id"),n=l.get(i);n&&n.setProperties({datasource:e,value:"ssd"})})},e.prototype.__enableSATA__=function(){this.__sataDisabled=!1;var e=this.__getDiskTypes();c("."+v).each(function(t,a){var i=c(a).data("ui-id"),n=l.get(i);n&&n.setProperties({datasource:e})})},e.prototype.__getDiskTypes=function(){return this.get("diskType")},e.prototype.getValue=function(){for(var e=[],t=0;t<this.currentValue.length;++t)this.currentValue[t]&&e.push(this.currentValue[t]);return e},e.prototype.getRawValue=e.prototype.getValue,e.prototype.dispose=function(){var e=this;o.each(this.currentValue,function(t,a){if(t){var i=l.get(g+e.id+(a+1));i&&i.dispose()}}),u.prototype.dispose.apply(this,arguments)},d.inherits(e,u),require("esui").register(e),e}),define("bcc/enum",["exports","inf-ria/EnumX","babel-runtime/helpers/interop-require-default","inf-i18n","./tips"],function(exports,e,t,a,i){exports.__esModule=!0;var n=t["default"](e),s=t["default"](a),r=t["default"](i),o=new n["default"]({alias:"PREPAY",text:s["default"]("预付费"),value:"prepay"},{alias:"POSTPAY",text:s["default"]("后付费"),value:"postpay"},{alias:"PREPAYEIP",text:s["default"]("包年包月计费"),value:""},{alias:"BANDWIDTH",text:s["default"]("按使用带宽计费"),value:"bandwidth"},{alias:"NETRAFFIC",text:s["default"]("按使用流量计费"),value:"netraffic"});exports.ProductType=o;var c=new n["default"]({alias:"ACTIVE",text:s["default"]("运行中"),value:"ACTIVE",klass:"normal"},{alias:"SHUTOFF",text:s["default"]("已关机"),value:"SHUTOFF",klass:"unavailable"},{alias:"PAUSED",text:s["default"]("已睡眠"),value:"PAUSED",klass:"warning"},{alias:"SUSPENDED",text:s["default"]("已休眠"),value:"SUSPENDED",klass:"warning"},{alias:"RESCUE",text:s["default"]("已修复"),value:"RESCUE",klass:"warning"},{alias:"ERROR",text:s["default"]("错误"),value:"ERROR",klass:"error"},{alias:"SOFT_DELETED",text:s["default"]("已删除"),value:"SOFT_DELETED",klass:"warning"},{alias:"BUILD",text:s["default"]("创建中"),value:"BUILD",klass:"warning rolling"},{alias:"VERIFY_RESIZE",text:s["default"]("扩容确认中"),value:"VERIFY_RESIZE",klass:"warning"},{alias:"REVERT_RESIZE",text:s["default"]("扩容回滚中"),value:"REVERT_RESIZE",klass:"warning"},{alias:"EXPIRED",text:s["default"]("已到期"),value:"EXPIRED",klass:"error"},{alias:"SHELVED",text:s["default"]("搁置"),value:"SHELVED",klass:"warning"},{alias:"SHELVED_OFFLOADED",text:s["default"]("搁置"),value:"SHELVED_OFFLOADED",klass:"warning"},{alias:"SNAPSHOT",text:s["default"]("创建快照中"),value:"SNAPSHOT",klass:"warning rolling"},{alias:"ROLLBACK_SNAPSHOT",text:s["default"]("回滚快照中"),value:"ROLLBACK_SNAPSHOT",klass:"warning"},{alias:"DELETE_SNAPSHOT",text:s["default"]("删除快照中"),value:"DELETE_SNAPSHOT",klass:"warning"},{alias:"TEMPLATE",text:s["default"]("创建镜像中"),value:"TEMPLATE",klass:"warning rolling"},{alias:"REBOOT",text:s["default"]("重启中"),value:"REBOOT",klass:"warning"},{alias:"HARD_REBOOT",text:s["default"]("重启中"),value:"HARD_REBOOT",klass:"warning"},{alias:"PASSWORD",text:s["default"]("重置密码中"),value:"PASSWORD",klass:"warning"},{alias:"REBUILD",text:s["default"]("重建中"),value:"REBUILD",klass:"warning"},{alias:"MIGRATING",text:s["default"]("迁移中"),value:"MIGRATING",klass:"warning"},{alias:"RESIZE",text:s["default"]("资源扩展中或未支付"),value:"RESIZE",klass:"warning"},{alias:"DELETING",text:s["default"]("释放中"),value:"DELETING",klass:"warning"},{alias:"BINDING",text:s["default"]("绑定中"),value:"BINDING",klass:"warning"},{alias:"UNBINDING",text:s["default"]("解绑中"),value:"UNBINDING",klass:"warning"},{alias:"BILLING_CHANGING",text:s["default"]("计费变更中"),value:"BILLING_CHANGING",klass:"warning"},{alias:"RECHARGE",text:s["default"]("续费中"),value:"RECHARGE",klass:"warning"},{alias:"POWERING_OFF",text:s["default"]("关机中"),value:"POWERING_OFF",klass:"warning"},{alias:"POWERING_ON",text:s["default"]("开机中"),value:"POWERING_ON",klass:"warning"},{alias:"VOLUME_RESIZE",text:s["default"]("磁盘扩容中"),value:"VOLUME_RESIZE",klass:"warning"},{alias:"BINDKEYPAIR",text:s["default"]("绑定密钥对中"),value:"BINDKEYPAIR",klass:"warning"},{alias:"UNBINDKEYPAIR",text:s["default"]("解绑密钥对中"),value:"UNBINDKEYPAIR",klass:"warning"});exports.InstanceStatus=c,c.getFilterStatus=function(){return[{name:s["default"]("全部状态"),value:""}].concat(c.toArray("ACTIVE","SHUTOFF","EXPIRED","BUILD","REBUILD"))};var l=new n["default"]({alias:"DEFAULT",text:s["default"]("普通型"),value:"0"},{alias:"DEFAULTII",text:s["default"]("普通型II"),value:"7"},{alias:"DEFAULTIII",text:s["default"]("普通型III"),value:"10"},{alias:"CALCULATION",text:s["default"]("计算优化型"),value:"4"},{alias:"STORAGE",text:s["default"]("存储优化型"),value:"5"},{alias:"FPGA",text:s["default"]("FPGA实例"),value:"8"},{alias:"GPU",text:s["default"]("GPU实例"),value:"9"});exports.InstanceType=l,l.getFilterStatus=function(){return[{name:s["default"]("全部类型"),value:""}].concat(l.toArray("DEFAULT","DEFAULTII","DEFAULTIII","CALCULATION","STORAGE"))};var d=new n["default"]({alias:"NTESLAV100",text:"NVIDIA Telsa V100",value:"nTeslaV100"},{alias:"NTESLAP40",text:"NVIDIA Tesla P40",value:"nTeslaP40"},{alias:"NTESLAP4",text:"NVIDIA Tesla P4",value:"nTeslaP4"},{alias:"NTESLAK40",text:"NVIDIA Tesla K40",value:"nTeslaK40"},{alias:"NTITANX",text:s["default"]("NVIDIA 深度学习开发卡"),value:"nTitanX"},{alias:"NQUADROK1200",text:"NVIDIA Quadro K1200",value:"nQuadroK1200"});exports.GpuCard=d;var u=new n["default"]({alias:"ACTIVE",text:s["default"]("运行中"),value:"active",klass:"normal"},{alias:"CREATING",text:s["default"]("创建中"),value:"creating",klass:"warning rolling"},{alias:"AVAILABLE",text:s["default"]("未挂载"),value:"available",klass:"warning"},{alias:"IN_USE",text:s["default"]("已挂载"),value:"in-use",klass:"normal"},{alias:"ATTACHING",text:s["default"]("挂载中"),value:"attaching",klass:"warning"},{alias:"DETACHING",text:s["default"]("卸载中"),value:"detaching",klass:"warning"},{alias:"DELETING",text:s["default"]("删除中"),value:"deleting",klass:"warning"},{alias:"ERROR_DELETING",text:s["default"]("删除失败"),value:"error_deleting",klass:"error"},{alias:"ERROR",text:s["default"]("卷错误"),value:"error",klass:"error"},{alias:"IN_SNAPSHOT",text:s["default"]("快照中"),value:"in-snapshot",klass:"warning"},{alias:"IN_CLONE",text:s["default"]("克隆中"),value:"in-clone",klass:"warning"},{alias:"IN_ROLLBACK",text:s["default"]("回滚中"),value:"in-rollback",klass:"warning"},{alias:"EXPIRED",text:s["default"]("已到期"),value:"expired",klass:"error"},{alias:"EXTENDING",text:s["default"]("扩容中"),value:"extending",klass:"warning"},{alias:"UNAVAILABLE",text:s["default"]("不可用"),value:"unavailable",klass:"error"},{alias:"RECHARGE",text:s["default"]("续费中"),value:"recharge",klass:"warning"},{alias:"BILLING_CHANGING",text:s["default"]("计费变更中"),value:"billing_changing",klass:"warning"});exports.DiskStatus=u,u.getFilterStatus=function(){return[{name:s["default"]("全部状态"),value:""}].concat(u.toArray("AVAILABLE","IN_USE","EXPIRED"))};var p=new n["default"]({alias:"IN_USE",text:s["default"]("运行中"),value:"in-use",klass:"normal"},{alias:"CREATING",text:s["default"]("创建中"),value:"creating",klass:"warning rolling"},{alias:"AVAILABLE",text:s["default"]("正常"),value:"available",klass:"normal"},{alias:"DELETING",text:s["default"]("删除中"),value:"deleting",klass:"warning"},{alias:"ERROR",text:s["default"]("卷错误"),value:"error",klass:"error"},{alias:"IN_SNAPSHOT",text:s["default"]("快照中"),value:"in-snapshot",klass:"warning"},{alias:"IN_ROLLBACK",text:s["default"]("回滚中"),value:"in-rollback",klass:"warning"},{alias:"EXPIRED",text:s["default"]("已到期"),value:"expired",klass:"error"},{alias:"EXTENDING",text:s["default"]("扩容中"),value:"extending",klass:"warning"},{alias:"UNAVAILABLE",text:s["default"]("不可用"),value:"unavailable",klass:"error"});exports.SystemDiskStatus=p;var f=new n["default"]({alias:"SATA",text:s["default"]("普通云磁盘"),value:"sata"},{alias:"SSD",text:s["default"]("高性能云磁盘"),value:"ssd"},{alias:"SYSTEM",text:s["default"]("系统盘"),value:"system"},{alias:"PREMIUM_SSD",text:s["default"]("SSD云磁盘"),value:"premium_ssd"});exports.DiskType=f,f.getFilterType=function(){return[{name:s["default"]("全部"),value:""}].concat(f.toArray("SYSTEM","SSD","SATA","PREMIUM_SSD"))};var m=new n["default"]({alias:"SATA",text:s["default"]("普通型"),value:"sata"},{alias:"SSD",text:s["default"]("高性能型"),value:"ssd"},{alias:"PREMIUM_SSD",text:"SSD",value:"premium_ssd"});exports.DiskTypeConfirm=m;var h=new n["default"]({alias:"NVME",text:s["default"]("高性能"),value:"nvme"},{alias:"SSD",text:s["default"]("普通"),value:"ssd"});exports.TempDiskType=h;var g=new n["default"]({alias:"CDS",text:s["default"]("数据盘"),value:"1"},{alias:"SYSTEM",text:s["default"]("系统盘"),value:"2"});exports.VolumeType=g,g.getFilterType=function(){return[{name:s["default"]("全部"),value:""}].concat(g.toArray("SYSTEM","CDS"))};var v=new n["default"]({alias:"SSD",text:s["default"]("高性能云磁盘"),value:"1"},{alias:"SATA",text:s["default"]("普通云磁盘"),value:"2"},{alias:"NVME",text:s["default"]("存储优化型磁盘"),value:"3"},{alias:"PREMIUM_SSD",text:s["default"]("SSD云磁盘"),value:"4"},{alias:"EPHEMERAL",text:s["default"]("本地盘磁盘"),value:"5"});exports.StorageType=v,v.getFilterType=function(){return[{name:s["default"]("全部"),value:""}].concat(v.toArray("SSD","SATA","PREMIUM_SSD","EPHEMERAL"))};var b=new n["default"]({alias:"COMMON",text:s["default"]("公共镜像"),value:"common",popover:r["default"].imageTips.common},{alias:"CUSTOM",text:s["default"]("自定义镜像"),value:"custom",popover:r["default"].imageTips.custom},{alias:"INTEGRATION",text:s["default"]("服务集成镜像"),value:"integration",popover:r["default"].imageTips.integration},{alias:"SHARING",text:s["default"]("共享镜像"),value:"sharing",popover:r["default"].imageTips.sharing},{alias:"FPGAIMAGE",text:s["default"]("FPGA公共镜像"),value:"fpgaImage",name:"公共镜像",popover:r["default"].imageTips.fpgaImage},{alias:"FPGACUSTOM",text:s["default"]("FPGA自定义镜像"),value:"fpgaCustom",name:"自定义镜像",popover:r["default"].imageTips.fpgaCustom},{alias:"GPU_BCC_IMAGE",text:s["default"]("GPU公共镜像"),value:"gpuBccImage",name:"公共镜像",popover:r["default"].imageTips.gpuBccImage},{alias:"GPU_BCC_CUSTOM",text:s["default"]("GPU自定义镜像"),value:"gpuBccCustom",name:"自定义镜像",popover:r["default"].imageTips.gpuBccCustom},{alias:"MKT",text:s["default"]("云市场镜像"),value:"mkt",popover:r["default"].imageTips.mkt});exports.ImageType=b;var y=new n["default"]({alias:"ACTIVE",text:s["default"]("运行中"),value:"active",klass:"normal"},{alias:"CREATING",text:s["default"]("创建中"),value:"creating",klass:"warning rolling"},{alias:"AVAILABLE",text:s["default"]("已完成"),value:"available",klass:"normal"},{alias:"IN_USE",text:s["default"]("已挂载"),value:"in-use",klass:"normal"},{alias:"ATTACHING",text:s["default"]("挂载中"),value:"attaching",klass:"warning"},{alias:"DETACHING",text:s["default"]("卸载中"),value:"detaching",klass:"warning"},{alias:"DELETING",text:s["default"]("删除中"),value:"deleting",klass:"warning"},{alias:"ERROR_DELETING",text:s["default"]("删除失败"),value:"error_deleting",klass:"error"},{alias:"ERROR",text:s["default"]("卷错误"),value:"error",klass:"error"},{alias:"IN_SNAPSHOT",text:s["default"]("快照中"),value:"in-snapshot",klass:"warning"},{alias:"IN_CLONE",text:s["default"]("克隆中"),value:"in-clone",klass:"warning"},{alias:"IN_ROLLBACK",text:s["default"]("回滚中"),value:"in-rollback",klass:"warning"},{alias:"EXPIRED",text:s["default"]("已到期"),value:"expired",klass:"error"},{alias:"EXTENDING",text:s["default"]("扩容中"),value:"extending",klass:"warning"},{alias:"UNAVAILABLE",text:s["default"]("不可用"),value:"unavailable",klass:"error"});exports.SnapshotStatus=y;var T=new n["default"]({alias:"ACTIVE",text:s["default"]("已完成"),value:"active",klass:"normal"},{alias:"ERROR",text:s["default"]("错误"),value:"error",klass:"error"},{alias:"QUEUED",text:s["default"]("创建中"),value:"queued",klass:"warning rolling"},{alias:"SAVING",text:s["default"]("创建中"),value:"saving",klass:"warning rolling"},{alias:"EXPIRED",text:s["default"]("已到期"),value:"expired",klass:"error"},{alias:"DELETING",text:s["default"]("删除中"),value:"deleting",klass:"warning"});exports.SysSnapshotStatus=T;var x=new n["default"]({alias:"RELEASE_SHEDULE",text:s["default"]("定时释放"),value:"RELEASE_SHEDULE"},{alias:"START",text:s["default"]("开启"),value:"START"},{alias:"REBOOT",text:s["default"]("重启"),value:"REBOOT"},{alias:"DELETE",text:s["default"]("释放"),value:"DELETE"},{alias:"STOP",text:s["default"]("停止"),value:"STOP"},{alias:"RENAME",text:s["default"]("修改名称"),value:"RENAME"},{alias:"RESET_PASSWORD",text:s["default"]("重置密码"),value:"RESET_PASSWORD"},{alias:"JOIN_SECURITY",text:s["default"]("关联安全组"),value:"JOIN_SECURITY"},{alias:"CREATE_SNAPSHOT",text:s["default"]("创建快照"),value:"CREATE_SNAPSHOT"},{alias:"CREATE_AUTOSNAPSHOT",text:s["default"]("设置自动快照"),value:"CREATE_AUTOSNAPSHOT"},{alias:"CREATE_IMAGE",text:s["default"]("创建自定义镜像"),value:"CREATE_IMAGE"},{alias:"REBUILD_INSTANCE",text:s["default"]("重装操作系统"),value:"REBUILD_INSTANCE"},{alias:"ALTER_PRODUCTTYPE",text:s["default"]("计费变更"),value:"ALTER_PRODUCTTYPE"},{alias:"CANCEL_ALTER_PRODUCTTYPE",text:s["default"]("取消计费变更"),value:"CANCEL_ALTER_PRODUCTTYPE"},{alias:"UPGRADE_CONFIG",text:s["default"]("升级"),value:"UPGRADE_CONFIG"},{alias:"EXPAND_CDS",text:s["default"]("扩容"),value:"EXPAND_CDS"},{alias:"BIND_SSH",text:s["default"]("绑定密钥对"),value:"BIND_SSH"},{alias:"UNBIND_SSH",text:s["default"]("解绑密钥对"),value:"UNBIND_SSH"});exports.MoreOperation=x,x.getOperation=function(e){switch(e){case"BCC":return x.toArray("RELEASE_SHEDULE","START","REBOOT","DELETE","STOP","RENAME","RESET_PASSWORD","JOIN_SECURITY","CREATE_SNAPSHOT","CREATE_IMAGE","REBUILD_INSTANCE","ALTER_PRODUCTTYPE","CANCEL_ALTER_PRODUCTTYPE","UPGRADE_CONFIG","BIND_SSH","UNBIND_SSH");case"CDS":return x.toArray("DELETE","EXPAND_CDS","ALTER_PRODUCTTYPE","CANCEL_ALTER_PRODUCTTYPE");case"DCCDISK":return x.toArray("DELETE","ALTER_PRODUCTTYPE")}};var I=new n["default"]({alias:"AVAILABLE",text:s["default"]("可用"),value:"available",klass:"normal"},{alias:"BINDED",text:s["default"]("已绑定"),value:"binded",klass:"normal"},{alias:"PAUSING",text:s["default"]("停止中"),value:"pausing",klass:"warning"},{alias:"PAUSED",text:s["default"]("停止"),value:"paused",klass:"unavailable"},{alias:"UNBINDING",text:s["default"]("解绑中"),value:"unbinding",klass:"warning"},{alias:"BINDING",text:s["default"]("绑定中"),value:"binding",klass:"warning"},{alias:"STOPED",text:s["default"]("已欠费"),value:"stoped",klass:"error"},{alias:"EXPIRED",text:s["default"]("已过期"),value:"expired",klass:"error"},{alias:"CREATING",text:s["default"]("创建中"),value:"creating",klass:"warning rolling"},{alias:"UPDATING",text:s["default"]("更新中"),value:"updating",klass:"warning"},{alias:"UNAVAILABLE",text:s["default"]("暂不可用"),value:"unavailable",klass:"unavailable"},{alias:"RECOVERING",text:s["default"]("恢复中"),value:"recovering",klass:"warning"},{alias:"DELETING",text:s["default"]("删除中"),value:"deleting",klass:"warning"},{alias:"BILLING_CHANGING",text:s["default"]("计费变更中"),value:"billing_changing",klass:"warning"});exports.EipStatus=I;var S=new n["default"]({alias:"MONTH",text:s["default"]("按月"),value:"month"},{alias:"YEAR",text:s["default"]("按年"),value:"year"});exports.TimeType=S;var E=new n["default"]({alias:"OME",text:"1个月",value:1},{alias:"TWO",text:"2个月",value:2},{alias:"THREE",text:"3个月",value:3},{alias:"FPUR",text:"4个月",value:4},{alias:"FIVE",text:"5个月",value:5},{alias:"SIX",text:"6个月",value:6},{alias:"SEVEN",text:"7个月",value:7},{alias:"EIGHT",text:"8个月",value:8},{alias:"NINE",text:"9个月",value:9});exports.Month=E;var w=new n["default"]({alias:"ONE",text:s["default"]("1年"),value:1},{alias:"TWO",text:s["default"]("2年"),value:2},{alias:"THREE",text:s["default"]("3年"),value:3});exports.Year=w;var k=new n["default"]({alias:"MONDAY",text:s["default"]("周一"),value:1},{alias:"TUESDAY",text:s["default"]("周二"),value:2},{alias:"WEDNESDAY",text:s["default"]("周三"),value:3},{alias:"THURSDAY",text:s["default"]("周四"),value:4},{alias:"FRIDAY",text:s["default"]("周五"),value:5},{alias:"SATURDAY",text:s["default"]("周六"),value:6},{alias:"SUNDAY",text:s["default"]("周日"),value:0});exports.Week=k}),define("bcc/events",["require"],function(require){return{REGION_CHANGE:"region_changed",AFTER_REGION_CHANGED:"after_region_changed",FILTER:"filter",ENTER_BCC_LIST:"enterbcclist",CREATE_INSTANCE:"createinstance",CREATE_SNAPSHOT:"createsnapshot",CREATE_DISK:"createdisk",CREATE_IMAGE:"createimage",PICK:"pick",PICK_EIP:"pick_eip",START_INSTANCE:"startinstance",STOP_INSTANCE:"stopinstance",REBOOT_INSTANCE:"rebootinstance",REBUILD_INSTANCE:"rebuildinstance",GET_VNC_URL:"getvncurl",BUY_SAME:"buysame",DELETE_INSTANCE:"deleteinstance",UPGRADE_CONFIG:"upgradeconfig",CREATE_AUTOSNAPSHOT:"createautosnapshot",QUOTA_REMIND:"quotaRemind",RELEASE_SHEDULE:"relaseshedule",ALTER_PRODUCTTYPE:"alterproducttype",CANCEL_ALTER_PRODUCTTYPE:"cancelalterproducttype",ADD_TAG:"addTag",ATTACH_CDS:"attachcds",DETACH_CDS:"detachcds",DELETE_CDS:"deletecds",EXPAND_CDS:"expansioncds",CHECK_CREATE_CDS:"check_create_cds",CHANGE_CDS_SIZE:"change_cds_size",BATCH_ROLLBACK_SNAPSHOT:"batchrollbacksnapshot",BATCH_DELETE_SNAPSHOT:"batchdeletesnapshot",RELATE_ASP:"relateAutoSnapshotPolicy",TO_DETAIL:"todetail",TO_SNAPSHOT:"tosnapshot",CHANGE_IMAGE_TYPE:"changeimagetype",REFRESH:"refreshList",SAVE_EDIT:"saveedit",RECHARGE:"recharge",CHANGE_PWD:"changepwd",CHANGE_NAME:"changename",SUBMIT_PAY:"submitpay",GET_PRICE:"getprice",UPDATE_OS_TYPE:"updateostype",UPDATE_OS_VERSION:"updateosversion",UPDATE_PURCHASE_TYPE:"updatepurchasetype",UPDATE_EXPIRE_TIME:"updateexpiretime",SET_COUNT:"setcount",SET_IMAGE_ID:"setimageid",ROLLBACK_SNAPSHOT:"rollbacksnapshot",DELETE_SNAPSHOT:"deletesnapshot",CHANGE_PRODUCT_TYPE:"changeproducttype",RELOAD:"reload",BIND2EIP:"bind2eip",UNBINDEIP:"unbindeip",EDIT_TAG:"editag",CHANGE_PURCHASE_NUM:"changepurchasenum",GET_ALARM_STATE:"getAlarmState",SHOW_DETAIL_TREND:"showDetailTrend",TO_ALARM_DETAIL:"toAlarmDetail",GET_MONITOR_TRENDS:"getMonitorTrends",CREATE_SECURITY:"createsecurity",EDIT_SECURITY:"editsecurity",DELETE_SECURITY:"deletesecurity",CREATE_SECURITY_RULE:"createsecurityrule",DELETE_SECURITY_RULE:"deletesecurityrule",RESET_SECURITY:"resetsecurity",CREATE_RULE:"create_rule",DELETE_RULES:"delete_rules",TOGGLE_ALLALLOWED_RULE:"toggle_allallowed_rule",UPDATE_ALLALLOWED_RULE:"update_allallowed_rule",INIT_RULETAB:"init_ruletab",EDIT_RULE:"editrule",EDIT_RULE_SUBMIT:"editrulesubmit",EDIT_RULE_CANCEL:"editrulecancel",ORDER_CONFIRM:"order_confirm",COPYID:"copyId",RECHARGE_BATCH:"recharge_batch",CHOOSE_MKT_PRODUCT:"choose_mkt_product",COMMAND:"command"}}),define("bcc/flags",["exports","module","underscore","babel-runtime/helpers/interop-require-default","common/flags"],function(exports,module,e,t,a){var i=t["default"](e),n=t["default"](a);module.exports=i["default"].extend({enable_rsa_encrypt:!0,enable_dcc:!0,enable_gpu:!0},n["default"])}),define("bcc/helper",["exports","crypt/rsa","babel-runtime/helpers/interop-require-default","common/constants"],function(exports,e,t,a){exports.__esModule=!0;var i=t["default"](e),n=t["default"](a);exports.rsaEncrypt=function(e){if(!n["default"].publicKey)return e;var t=new i["default"];t.setPublicKey(n["default"].publicKey);var a=t.encrypt(e);return!1===a?e:a}}),define("bcc/image/config",["require","er/controller"],function(require){require("er/controller").registerAction([{type:"bcc/image/List",path:"/bcc/image/list"},{type:"bcc/image/Create",path:"/bcc/image/create"}]);return{}}),define("bcc/image/Create",["require","bat-ria/mvc/FormAction","./CreateModel","./CreateView","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("bat-ria/mvc/FormAction");return e.prototype.modelType=require("./CreateModel"),e.prototype.viewType=require("./CreateView"),e.prototype.redirectAfterSubmit=function(){this.model.get("parentAction").reload()},e.prototype.initBehavior=function(){t.prototype.initBehavior.apply(this,arguments)},require("er/util").inherits(e,t),e}),define("bcc/image/create.tpl",[],function(){return'\x3c!-- target: TPL_bcc_image_create --\x3e\n<div class="bcc-dialog-form image-create">\n    <form data-ui-type="Form" data-ui-id="form"\n        data-ui-auto-validate="true">\n        <div class="form-data-body">\n            <div class="form-row">\n                <div class="form-key" style="width:112px;">${i18n.实例ID：}</div>\n                <div class="form-value form-nowrap-text">${instanceId}</div>\n            </div>\n            <div class="form-row">\n                <div class="form-key">${i18n.自定义镜像名称：}</div>\n                <div class="form-value">\n                    <input data-ui-type="TextBox" data-ui-id="name"\n                        data-ui-name="name" data-ui-width="370" />\n                    <div data-ui-type="Label" data-ui-id="nameNote" class="bcc-note"></div>\n                    <label data-ui-type="Validity"\n                        data-ui-id="nameValidity"></label>\n                </div>\n            </div>\n            \x3c!--<div class="form-row">--\x3e\n                \x3c!--<div class="form-key">自定义镜像描述：</div>--\x3e\n                \x3c!--<div class="form-value">--\x3e\n                    \x3c!--<textarea data-ui-type="TextBox" data-ui-id="desc"--\x3e\n                           \x3c!--data-ui-name="desc" data-ui-width="300" data-ui-height="100"></textarea>--\x3e\n                \x3c!--</div>--\x3e\n            \x3c!--</div>--\x3e\n        </div>\n    </form>\n</div>\n\n\x3c!-- target: TPL_bcc_image_create_child --\x3e\n\x3c!-- import: TPL_bcc_image_create --\x3e\n'}),define("bcc/image/CreateModel",["require","bat-ria/mvc/FormModel","../config","er/util"],function(require){function e(){t.apply(this,arguments),this.submitRequester=a.bccInstanceCreateImage}var t=require("bat-ria/mvc/FormModel"),a=require("../config").api;return e.prototype.getExtraData=function(){return{instanceId:this.get("instanceUuid")}},e.prototype.datasource=null,require("er/util").inherits(e,t),e}),define("bcc/image/CreateView",["require","bat-ria/tpl!./create.tpl","bat-ria/mvc/FormView","inf-i18n","../config","er/util"],function(require){function e(){t.apply(this,arguments)}require("bat-ria/tpl!./create.tpl");var t=require("bat-ria/mvc/FormView"),a=require("inf-i18n");e.prototype.template="TPL_bcc_image_create";var i=require("../config").RULE.NAME;return e.prototype.uiProperties={name:{placeholder:i.placeholder,required:"required",requiredErrorMessage:"自定义镜像名称必填",pattern:i.pattern,patternErrorMessage:i.patternErrorMessage,validityLabel:"nameValidity"},nameNote:{text:a(i.note)}},e.prototype.uiEvents={},require("er/util").inherits(e,t),e}),define("bcc/image/List",["require","inf-ria/mvc/ListAction","../events","underscore","../util","../config","er/util","./ListModel","./ListView","../operations","er/URL","../../common/util/dialog"],function(require){function e(){n.apply(this,arguments)}function t(e){var t=this,a=this.model.get("tableData")[parseInt(e.rowIndex,10)];f.handler("image.rename",this.view,{name:e.value,imageId:a.id},null,function(e){t.view.get("table").showEditError(e.field.name)})}function a(e){var t=this,a=this.view.get("table").datasource[e.itemIndex],i={imageType:u.CUSTOM,osType:a.osName,osVersion:a.osVersion,imageId:a.id};l.bccImageDetail({imageId:a.id}).then(function(e){i.osType=e.osType,i.osName=e.osName,i.osVersion=e.osVersion,i.imageId=e.id,i.cpu=e.cpu,i.memory=e.memory,i.diskSize=e.diskSize,t.redirect(require("er/URL").withQuery("/bcc/instance/create",i))})}function i(){var e=this.getAction().model;e&&e.get("authCodeSent")&&l.bccInvalidateAuthCode()}var n=require("inf-ria/mvc/ListAction"),s=require("../events"),r=require("underscore"),o=require("../util"),c=require("../config"),l=c.api,d=c.IMAGE_STATUS,u=c.IMAGE_TYPE,p=require("er/util");e.prototype.modelType=require("./ListModel"),e.prototype.viewType=require("./ListView");var f=require("../operations");return e.prototype.deleteImages=function(e){require("../../common/util/dialog").waitActionDialog(this.view,{title:"删除前确认",width:600,needFoot:!0,url:"/bcc/instance/require_auth_code",actionOptions:{extraData:e.extraData,requester:l.bccImageDelete,parentAction:this}}).then(function(e){var t=e.target;t.on("cancel",i),t.on("close",i)})},e.prototype.refreshTableStatus=function(e){var t=this.view.get("table");this.model.listRequester(this.model.getQuery(),{"X-silence":!0}).then(function(a){a&&a.result&&a.result.length>0&&r.each(t.datasource,function(i,n){var s=a.result[n]&&a.result[n].id===i.id&&a.result[n].status||i.status;if(i.status!==s){var r=['<span class=" ',d.CLASS[s]||"status error",'">',d.TXT[s]||s,"</span>"].join("");t.setCellText(r,n,e,!1),i.status=s}})})},e.prototype.setIntervalListenStatus=function(){var e=o.getStatusColumnIndex(this.view.get("table"),"status");this.timer=setInterval(p.bind(function(){this.refreshTableStatus(e)},this),c.BCC_LISTEN_INTERVAL)},e.prototype.redirectAfterDelete=function(){this.redirect(this.getURLForPage(this.model.get("pageNo")||1))},e.prototype.initBehavior=function(){n.prototype.initBehavior.apply(this,arguments),this.view.on(s.REFRESH,this.reload),this.view.on(s.SAVE_EDIT,t,this),this.view.on(s.CREATE_INSTANCE,a,this),this.view.on("DELETE_IMAGES",this.deleteImages,this),this.view.initTableSelectItem("id",this.model.get("id")),this.setIntervalListenStatus(),this.on("beforeleave",function(){clearInterval(this.timer)})},e.prototype.syncModelToViewIterator=function(e){switch(e.name){case"quota":this.view.showQuotaTip()}},require("er/util").inherits(e,n),e}),define("bcc/image/list.tpl",[],function(){return'\x3c!-- target: TPL_bcc_image --\x3e\n<div class="bcc-mirror bcc-main-wrap main-wrap-new">\n    <div class="content-wrap">\n        <p class="breadcrumb">\n            <span>${i18n.产品服务}</span>\n            <span class="divider">/</span>\n            <span class="active">${i18n.云服务器BCC}-${i18n.镜像列表}</span>\n        </p>\n\n        <div class="list-content">\n            <h2>${i18n.镜像列表} <span class="quota-tip"></span></h2>\n            <div class="table-full-wrap">\n                <div class="operation-wrap" data-follow-thead="table">\n                    <div class="buttons-wrap">\n                        <button data-ui-type="Button" data-ui-id="deleteImage"\n                            class="skin-danger-button">${i18n.删除镜像}</button>\n                    </div>\n                    <div class="buttons-quick-wrap">\n                        \x3c!-- import: TPL_bcc_search --\x3e\n                        <button type="button"\n                            data-ui-type="Button" data-ui-id="refreshList" title="${i18n.刷新表格数据}">\n                            <i class="iconfont icon-cdnrefresh"></i>\n                        </button>\n                    </div>\n                </div>\n                \x3c!-- import: listEditableTableWithCommand --\x3e\n                <div class="ui-row clearfix">\n                    \x3c!-- import: listPager --\x3e\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("bcc/image/ListModel",["require","inf-ria/mvc/ListModel","../config","er/util"],function(require){function e(){t.apply(this,arguments),this.listRequester=i.bccImageList}var t=require("inf-ria/mvc/ListModel"),a=require("../config"),i=a.api,n={"X-silence":!0};return e.prototype.datasource={menu:function(e){return"mirror"}},e.prototype.defaultArgs={imageType:a.IMAGE_TYPE.CUSTOM,keywordType:a.FILTER.MIRROR.NAME.value,order:"desc",orderBy:"createTime",pageSize:a.pageSize},e.prototype.prepare=function(){var e=this;i.bccQuota({objType:"template"},n).then(function(t){e.set("quota",t)})},require("er/util").inherits(e,t),e}),define("bcc/image/ListView",["require","bat-ria/tpl!./list.tpl","inf-ria/mvc/ListView","underscore","etpl","jquery","common/util/tableUtil","common/util/timeUtil","common/util","../config","../events","er/util"],function(require){function e(){t.apply(this,arguments)}require("bat-ria/tpl!./list.tpl");var t=require("inf-ria/mvc/ListView"),a=require("underscore"),i=require("etpl"),n=require("jquery"),s=require("common/util/tableUtil"),r=require("common/util/timeUtil"),o=require("common/util"),c=require("../config"),l=require("../events"),d=c.FILTER,u=c.IMAGE_STATUS;e.prototype.template="TPL_bcc_image";var p=[{field:"name",title:"镜像名称/ID",width:100,breakLine:1,sortable:!0,content:function(e,t,i){var n=e.status!==u.CREATING&&!o.isSubUser()?'<span class="ui-table-cell-editentry"data-row="'+t+'" data-col="'+i+'"><i class="iconfont icon-edit"></i></span>':"",s=a.escape(e.name);return'<span title="'+s+'" class="instance-name">'+s+"</span>"+n+'<br/><span class="instance-id">'+(e.imageId||e.id)+"</span>"},editable:function(e){return e.status!==u.SAVING&&!o.isSubUser()},editContent:function(e){return a.escape(e.name)},editRules:c.RULE.NAME},{title:"创建时间",content:function(e){return r.toTime(e.createTime)}},{field:"status",title:"状态",content:function(e){return'<span class="'+(u.CLASS[e.status]||"status error")+'">'+(u.TXT[e.status]||e.status)+"</span>"}},{title:"操作系统/版本",content:function(e){return a.escape(e.osName||e.osType)+" / "+a.escape(e.osVersion)}},{title:"操作",content:function(e,t){var a=e.status===u.ACTIVE&&!o.isSubUser();return i.compile('<span class="oprations"><button data-command="${command}" data-command-args="${args}" class="cmd-button ${className}" ${disabled}>${label}</button></span>')({label:"创建实例",command:l.CREATE_INSTANCE,args:t,className:a?"":"state-disabled",disabled:a?"":"disabled"})}}];e.prototype.uiProperties={keywordType:{datasource:[d.MIRROR.NAME]},keyword:{placeholder:"请输入镜像名称进行搜索"},table:s.tableProperty(p,{editable:!0,select:"multi",noDataHtml:"<div><p>没有可选择的镜像！</p></div>"}),pager:{pageSizes:[10,20,50,100]}},e.prototype.uiEvents=s.getListEvents({"keyword:enter":function(e){this.submitSearch(e)},"deleteImage:click":function(e){var t=this.get("table"),i=a.map(t.getSelectedItems(),function(e){return e.id});this.fire("DELETE_IMAGES",{extraData:{imageId:i.join(",")}})},"table:select":function(e){s.setButtonStatusOfTable(this,{deleteImage:{rule:function(e){return a.contains(u.CAN_DELETE,e.status)&&!o.isSubUser()}}})},"table:command":function(e){this.fire(e.name,{itemIndex:+e.args})}}),e.prototype.enterDocument=function(){t.prototype.enterDocument.apply(this,arguments),this.get("keywordType").fire("change")},e.prototype.getSearchArgs=s.getSearchArgs,e.prototype.initTableSelectItem=s.initTableSelectItem;var f=i.compile("(已创建${templateCreated}个，共可建${templateTotal}个)");return e.prototype.showQuotaTip=function(){var e=this.model.get("quota");n(".quota-tip").html(f(e))},require("er/util").inherits(e,t),e}),define("bcc/instance/auto_snapshot.tpl",[],function(){return'\x3c!-- target: TPL_bcc_instance_autosnapshot --\x3e\n<div class="bcc-autosnapshot-dialog skin-confirm-dialog bcc-dialog-form">\n    <form data-ui-type="Form"\n        data-ui-id="form"\n        data-ui-auto-validate="true">\n        <div class="form-data-body">\n            <div class="form-row">\n                <div class="form-key">${i18n.策略名称：}</div>\n                <div class="form-value">\n                    <input\n                        data-ui-required-error-message="${i18n.策略名称必填}"\n                        data-ui-required="required"\n                        data-ui-type="TextBox"\n                        data-ui-id="policyName"\n                        data-ui-name="policyName"\n                        data-ui-width="300" />\n                    <label data-ui-type="Validity"\n                        data-ui-id="policyNameValidity"></label>\n                </div>\n            </div>\n            <div data-ui-type="Panel"\n                data-ui-id="cdsPanel"\n                \x3c!-- if: ${imageType} === \'mkt\' --\x3e data-ui-hidden="true"\x3c!-- /if --\x3eclass="form-row">\n                <div class="form-key">${i18n.系统盘：}</div>\n                <div class="form-value">\n                    <div\n                        data-ui-type="ToggleButton"\n                        data-ui-name="containsSystemVolume"\n                        data-ui-id="containsSystemVolume"></div>\n                </div>\n            </div>\n            <div class="form-row">\n                <div class="form-key">${i18n.云磁盘CDS：}</div>\n                <div class="form-value">\n                    <div\n                        data-ui-type="ToggleButton"\n                        data-ui-name="constainsCdsVolume"\n                        data-ui-id="constainsCdsVolume"></div>\n                </div>\n            </div>\n            <div class="form-row">\n                <div class="form-key">${i18n.自动快照时间：}</div>\n                <div class="form-value">\n                    <div data-ui-type="Select"\n                         data-ui-width="125"\n                         data-ui-name="snapshotTime"\n                         data-ui-id="snapshotTime"></div>\n                </div>\n            </div>\n            <div class="form-row">\n                <div class="form-key">${i18n.自动快照保留天数：}</div>\n                <div class="form-value">\n                    <div\n                        data-ui-type="NumberTextline"\n                        data-ui-id="retainDays"\n                        data-ui-name="retainDays"\n                        data-ui-width="30"\n                        class="retain-days"></div>\n                </div>\n            </div>\n            \x3c!-- <div class="form-row">\n                <div class="form-key">\n                    <input type="checkbox"\n                        data-ui-type="CheckBox"\n                        data-ui-name="autoSnapshot"\n                        data-ui-id="autoSnapshot" />云磁盘CDS自动快照跟随实例释放\n                </div>\n            </div> --\x3e\n        </div>\n        <div class="reminder">\n            \x3c!-- if: ${serviceType} == \'DCC\' --\x3e\n            ${tips.instance.snapshotRemenderDcc | raw}\n            \x3c!-- else: --\x3e\n            ${tips.instance.snapshotRemender | raw}\n            \x3c!-- /if --\x3e\n            ${i18n.3. 当前自动快照会占用}\n            <span data-ui-type="Label"\n                data-ui-id="quotaRemind"\n                class="network-note"></span>${i18n.个快照额度。}\n            \x3c!-- if: ${serviceType} === \'DCC\' --\x3e\n            <br/>\n            ${i18n.4. 专属实例的快照数据不占用专属服务器磁盘的可用容量。}\n            \x3c!-- /if --\x3e\n        </div>\n    </form>\n</div>\n\n\x3c!-- target: TPL_bcc_instance_autosnapshot_child --\x3e\n\x3c!-- import: TPL_bcc_instance_autosnapshot --\x3e\n'}),define("bcc/instance/AutoSnapshot",["require","bat-ria/mvc/FormAction","../events","../config","./AutoSnapshotModel","./AutoSnapshotView","er/util"],function(require){function e(){i.apply(this,arguments)}function t(){var e=this.model,t=this.view,i=e.get("formData"),n=!1,r=t.get("containsSystemVolume"),o=t.get("constainsCdsVolume");i&&i.instanceId?(t.get("policyName").setValue(i.policyName),t.get("snapshotTime").setRawValue(i.snapshotTime),t.get("retainDays").setValue(i.retainDays),r.checked!==i.containsSystemVolume&&(n=!0,r.set("checked",i.containsSystemVolume)),o.checked!==i.constainsCdsVolume&&(n=!0,o.set("checked",i.constainsCdsVolume)),!n&&a.call(this,{}),e.submitRequester=s.bccInstanceSnapshotSheduledUpdate):(a.call(this,{}),e.submitRequester=s.bccInstanceSnapshotSheduledSet)}function a(e){var t=this.view,a=this.model,i="sysDisk"===e.changeItem?e.value?1:0:t.get("containsSystemVolume").isChecked()?1:0,n="cdsDisk"===e.changeItem?e.value?a.get("instanceCdsCount"):0:t.get("constainsCdsVolume").isChecked()?a.get("instanceCdsCount"):0,s="retainDays"===e.changeItem?e.value:t.get("retainDays").getValue(),r=t.get("quotaRemind");r&&(r.main.innerHTML=(i+n)*s)}var i=require("bat-ria/mvc/FormAction"),n=require("../events"),s=require("../config").api;return e.prototype.modelType=require("./AutoSnapshotModel"),e.prototype.viewType=require("./AutoSnapshotView"),e.prototype.initBehavior=function(){i.prototype.initBehavior.apply(this,arguments),this.view.on(n.QUOTA_REMIND,a,this),this.on("entercomplete",t,this)},e.prototype.redirectAfterSubmit=function(){this.model.get("parentAction").reload()},require("er/util").inherits(e,i),e}),define("bcc/instance/AutoSnapshotModel",["require","bat-ria/mvc/FormModel","underscore","../config","../enum","../tips","er/util"],function(require){function e(){t.apply(this,arguments),this.formRequester=i.bccInstanceSnapshotSheduledQuery}var t=require("bat-ria/mvc/FormModel"),a=require("underscore"),i=require("../config").api,n=require("../enum").ImageType,s={"x-silent":!0};return e.prototype.datasource={tips:function(){return require("../tips")},instanceCdsCount:function(e){return i.bccDiskList({instanceId:e.get("instanceId")},s).then(function(e){return e.result&&e.result.length-1||0}).fail(function(e){return 0})}},e.prototype.getDefaultArgs=function(){var e=this.defaultArgs;return a.extend(e,{instanceId:this.get("instanceId")})},e.prototype.getExtraData=function(){return{instanceId:this.get("instanceId")}},e.prototype.prepare=function(){var e=function(){for(var e=[],t=function(e){return e<10?"0"+e:e},a="",i=0;i<24;i++)a=t(i)+":00-"+t(23===i?0:i+1)+":00",e[i]={name:a,value:a};return e}();this.set("snapshotTimeDatasource",e),this.set("containsSystemVolumeChecked",this.get("imageType")!==n.MKT)},require("er/util").inherits(e,t),e}),define("bcc/instance/AutoSnapshotView",["require","bat-ria/tpl!./auto_snapshot.tpl","bat-ria/mvc/FormView","../events","er/util"],function(require){function e(){t.apply(this,arguments)}require("bat-ria/tpl!./auto_snapshot.tpl");var t=require("bat-ria/mvc/FormView"),a=require("../events");return e.prototype.template="TPL_bcc_instance_autosnapshot",e.prototype.uiEvents={"containsSystemVolume:change":function(e){this.fire(a.QUOTA_REMIND,{changeItem:"sysDisk",value:e.target.isChecked()})},"constainsCdsVolume:change":function(e){this.fire(a.QUOTA_REMIND,{changeItem:"cdsDisk",value:e.target.isChecked()})},"retainDays:change":function(e){this.fire(a.QUOTA_REMIND,{changeItem:"retainDays",value:e.now})}},e.prototype.uiProperties={policyName:{placeholder:"大小写字母、数字以及_，长度1-10",required:"required",requiredErrorMessage:"自动快照策略名称必填",pattern:/^[0-9A-Za-z_]{1,10}$/,patternErrorMessage:"名称不符合规则：大小写字母、数字以及_，长度1-10",validityLabel:"policyNameValidity"},snapshotTime:{datasource:"@snapshotTimeDatasource"},retainDays:{max:7},containsSystemVolume:{checked:"@containsSystemVolumeChecked"}},e.prototype.getExtraFormData=function(){return{containsSystemVolume:this.get("containsSystemVolume").isChecked(),constainsCdsVolume:this.get("constainsCdsVolume").isChecked()}},require("er/util").inherits(e,t),e}),define("bcc/instance/bcmDetail",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","san-xui","san","san-xui/x/components/BcmChart","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t,a,i,n,s,r){var o=r["default"](s),c=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),t["default"](n,[{key:"template",get:function(){return'\n            <template>\n                <xui-bcmchart\n                    title="CPU使用率"\n                    api-type="metricName"\n                    scope="BCE_BCC"\n                    height="{{230}}"\n                    width="{{350}}"\n                    dimensions="InstanceId:{{payload.id}}"\n                    metrics="vCPUUsagePercent(CPU使用率)"\n                    unit="百分比"\n                />\n                <xui-bcmchart\n                    title="内存使用率"\n                    api-type="metricName"\n                    width="{{350}}"\n                    height="{{230}}"\n                    scope="BCE_BCC"\n                    dimensions="InstanceId:{{payload.id}}"\n                    metrics="MemUsedPercent(内存使用率)"\n                    unit="百分比"\n                />\n                <xui-bcmchart\n                    title="每秒磁盘IO读写次数"\n                    api-type="metricName"\n                    width="{{350}}"\n                    height="{{230}}"\n                    scope="BCE_BCC"\n                    dimensions="InstanceId:{{payload.id}}"\n                    metrics="vDiskReadOpCountPerSecond(读取次数),vDiskWriteOpCountPerSecond(写入次数)"\n                    unit="次/秒"\n                />\n            </template>\n        '}},{key:"components",get:function(){return{"xui-bcmchart":o["default"]}}}]),n}(n.Component),l=n.defineComponent({trimWhitespace:"blank",template:'\n        <template>\n            <xui-as-drawer class="bcm-body" top="{{\'51px\'}}" expand="{= expand =}"\n                payload="{{payload}}" expandTo="{{expandTo}}">\n                <div slot="header" class="bcm-header">实例：{{payload.name}}\n                    <a href="#/bcc/instance/monitor~instanceId={{payload.id}}" target="_blank"\n                        data-track-id="ti_bcc_instance_monitor_more" data-track-name="监控浮层/查看更多">查看更多></a>\n                </div>\n            </xui-as-drawer>\n        </template>\n    ',components:{"xui-as-drawer":i.asDrawer(c)},initData:function(){return{expand:!1,expandTo:"right"}},show:function(){this.data.set("expand",!0)}}),d=undefined;l.from=function(e){return d&&d.dispose(),(d=new l({data:{payload:e}})).attach(document.body),d},module.exports=l}),define("bcc/instance/change_name.tpl",[],function(){return'\x3c!-- target: TPL_bcc_instance_changeName --\x3e\n<div class="bcc-dialog-form change-name-dialog-form">\n    <form data-ui-type="Form" data-ui-id="form"\n        data-ui-auto-validate="true">\n        <div class="form-data-body">\n            <div class="form-row">\n                <div class="form-key">您选择的实例：</div>\n                <ul class="form-value">\n                    \x3c!-- for: ${instanceNames} as ${instanceName} --\x3e\n                    <li class="instance-name nowrap-text" title="${instanceName}">${instanceName}</li>\n                    \x3c!-- /for --\x3e\n                </ul>\n            </div>\n            <div class="form-row">\n                <div class="form-key">实例名称前缀：</div>\n                <div class="form-value">\n                    <input data-ui-validity-label="nameValidity"\n                        data-ui-required="required"\n                        data-ui-required-error-message="实例名称前缀必填"\n                        data-ui-type="TextBox"\n                        data-ui-id="name"\n                        data-ui-name="name"\n                        data-ui-width="370" />\n                    <div data-ui-type="Label" data-ui-id="nameNote" class="bcc-note"></div>\n                    <label data-ui-type="Validity"\n                        data-ui-id="nameValidity"></label>\n                </div>\n            </div>\n        </div>\n    </form>\n</div>\n\n\x3c!-- target: TPL_bcc_instance_changeName_child --\x3e\n\x3c!-- import: TPL_bcc_instance_changeName --\x3e\n'}),define("bcc/instance/ChangeName",["require","bat-ria/mvc/FormAction","./ChangeNameModel","./ChangeNameView","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("bat-ria/mvc/FormAction");return e.prototype.modelType=require("./ChangeNameModel"),e.prototype.viewType=require("./ChangeNameView"),e.prototype.submit=function(e){var a=t.prototype.submit.apply(this,arguments),i=this;return a.done(function(){var e=i.view.get("form");e&&e.fire("aftermanualvalidate",{isValid:!1})}),a},e.prototype.handleSubmitError=function(e){e&&e.field&&this.view.notifyErrors(e.field),this.view.showToast(e&&e.global?e.global:"保存失败",{messageType:"error"})},e.prototype.redirectAfterSubmit=function(){this.model.get("parentAction").reload()},require("er/util").inherits(e,t),e}),define("bcc/instance/ChangeNameModel",["require","bat-ria/mvc/FormModel","../config","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("bat-ria/mvc/FormModel"),a=require("../config").api,i={"x-silent":!0};return e.prototype.submitRequester=function(e){return a.bccInstanceRename(e,i)},e.prototype.getExtraData=function(){return{instanceIds:(this.get("instanceIds")||[]).join(",")}},require("er/util").inherits(e,t),e}),define("bcc/instance/ChangeNameView",["require","bat-ria/tpl!./change_name.tpl","bat-ria/mvc/FormView","underscore","../config","er/util"],function(require){function e(){t.apply(this,arguments)}require("bat-ria/tpl!./change_name.tpl");var t=require("bat-ria/mvc/FormView"),a=require("underscore"),i=require("../config").RULE;return e.prototype.template="TPL_bcc_instance_changeName",e.prototype.uiProperties={name:a.extend({},i.NAME,{placeholder:"请输入名称前缀"}),nameNote:{text:i.NAME.note}},require("er/util").inherits(e,t),e}),define("bcc/instance/ChangePwd",["require","bat-ria/mvc/FormAction","./ChangePwdModel","./ChangePwdView","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("bat-ria/mvc/FormAction");return e.prototype.modelType=require("./ChangePwdModel"),e.prototype.viewType=require("./ChangePwdView"),e.prototype.submit=function(e){var a=this;return a.view.waitConfirm({title:"重置密码温馨提示",content:"重启您的BCC云服务器，并重置密码？"}).then(function(){return t.prototype.submit.call(a,e)})},e.prototype.redirectAfterSubmit=function(){this.model.get("parentAction").reload()},e.prototype.initBehavior=function(){t.prototype.initBehavior.apply(this,arguments)},e.prototype.dispose=function(){t.prototype.dispose.apply(this,arguments)},e.prototype.handleSubmitError=function(e){var t=this.model.get("parentAction");t&&t.dialog&&t.dialog.show(),e.field&&e.field.mfa||this.view.showToast(e&&e.global?e.global:"操作失败",{messageType:"error"})},require("er/util").inherits(e,t),e}),define("bcc/instance/changePwd.tpl",[],function(){return'\x3c!-- target: TPL_bcc_instance_changePwd --\x3e\n<div class="bcc-dialog-form bcc-change-password-dialog-form">\n    <form data-ui-type="Form" data-ui-id="form"\n        data-ui-auto-validate="true">\n        <div class="form-data-body">\n            <div class="form-row">\n                <div class="operation-tip">\n                    \x3c!-- if: ${isActive} --\x3e\n                    ${i18n.温馨提示：重置密码会重启服务器，导致服务器停止几分钟，为保证你的服务不受影响，请在确认执行此操作前做好预案准备。}\n                    \x3c!-- else --\x3e\n                    ${i18n.温馨提示：重置的新密码在控制台重新启动服务器后才能生效。}\n                    \x3c!-- /if --\x3e\n                </div>\n            </div>\n            <div class="form-row">\n                <div class="form-key">${i18n.实例ID：}</div>\n                <div class="form-value form-nowrap-text">${instanceIds}</div>\n            </div>\n            <div class="form-row">\n                <div class="form-key">${i18n.管理员用户名：}</div>\n                <div class="form-value form-nowrap-text">${i18n.linux系统为root，windows系统为Administrator}</div>\n            </div>\n            <div class="form-row">\n                <div class="form-key">${i18n.管理员新密码：}</div>\n                <div class="form-value">\n                    <input type="password"\n                        data-ui-custom-error-message="密码不符合规则"\n                        data-ui-required="required"\n                        data-ui-required-error-message="新密码必填"\n                        data-ui-type="TextBox"\n                        data-ui-id="password"\n                        data-ui-name="password"\n                        data-ui-width="320" />\n                    <br />\n                    <label data-ui-type="Validity"\n                        data-ui-id="passwordValidity" ></label>\n                    <div data-ui="type:Label;id:passwordTip;" class="bcc-note password-tip"></div>\n                </div>\n            </div>\n            <div class="form-row">\n                <div class="form-key">${i18n.确认密码：}</div>\n                <div class="form-value">\n                    <input type="password"\n                        data-ui-type="TextBox"\n                        data-ui-required="required"\n                        data-ui-required-error-message="确认密码必填"\n                        data-ui-id="confirm"\n                        data-ui-name="confirm"\n                        data-ui-width="320" />\n                    <br />\n                    <label data-ui-type="Validity"\n                        data-ui-id="confirmValidity" ></label>\n                </div>\n            </div>\n        </div>\n    </form>\n</div>\n\n\x3c!-- target: TPL_bcc_instance_changePwd_child --\x3e\n\x3c!-- import: TPL_bcc_instance_changePwd --\x3e\n'}),define("bcc/instance/ChangePwdModel",["require","bat-ria/mvc/FormModel","../flags","../helper","../config","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("bat-ria/mvc/FormModel"),a=require("../flags"),i=require("../helper"),n=require("../config"),s=n.api,r=n.INSTANCE_STATUS,o={"x-silent":!0};return e.prototype.submitRequester=function(e){return s.bccInstanceChangePwd2(e,o)},e.prototype.getExtraData=function(){return a.enable_baixin?{authCode:"123456",instanceIds:(this.get("instanceUuids")||[]).join(",")}:{instanceIds:(this.get("instanceUuids")||[]).join(",")}},e.prototype.datasource={instance:function(e){var t=e.get("instanceIds");return t.length>1?(e.set("isActive",!1),null):s.bccInstanceDetail({instanceId:t[0]}).then(function(t){return e.set("isActive",t.status===r.ACTIVE),t})}},e.prototype.filterData=function(e){return a.enable_rsa_encrypt&&e.password&&e.confirm&&(e.password=i.rsaEncrypt(e.password),e.confirm=e.password),e},require("er/util").inherits(e,t),e}),define("bcc/instance/ChangePwdView",["require","bat-ria/tpl!./changePwd.tpl","bat-ria/mvc/FormView","../config","er/util"],function(require){function e(){t.apply(this,arguments)}require("bat-ria/tpl!./changePwd.tpl");var t=require("bat-ria/mvc/FormView"),a=require("../config").RULE;return e.prototype.template="TPL_bcc_instance_changePwd",e.prototype.uiProperties={password:{custom:function(e){return a.PASSWORD.custom(e)},validityLabel:"passwordValidity"},passwordTip:{text:a.PASSWORD.customErrorMessage},confirm:{custom:function(e){return this.viewContext.controls.password.getValue()===this.getValue()},customErrorMessage:"确认密码和新密码不一致",validityLabel:"confirmValidity"}},e.prototype.uiEvents={"password:input":function(e){e.target.validate()},"confirm:input":function(e){this.viewContext.controls.password.getValue()!==e.target.getValue()?this.notifyErrors({confirm:"确认密码和新密码不一致"}):e.target.hideValidity()}},require("er/util").inherits(e,t),e}),define("bcc/instance/config",["require","er/controller"],function(require){require("er/controller").registerAction([{type:"bcc/instance/UpgradeConfig",path:"/bcc/instance/upgrade_config"},{type:"bcc/instance/UpgradeNetwork",path:"/bcc/instance/upgrade_network"},{type:"bcc/instance/RequireAuthCode",path:"/bcc/instance/require_auth_code"},{type:"bcc/instance/SecurityGroups",path:"/bcc/instance/security_groups"},{type:"bcc/instance/JoinSecurityGroups",path:"/bcc/instance/join_security_groups"},{type:"bcc/instance/listPageRouter",path:"/bcc/instance/list",skipRegionCheck:!0},{type:"bcc/instance/detail/Action",path:"/bcc/instance/detail"},{type:"bcc/instance/create/Action",path:"/bcc/instance/create"},{type:"bcc/instance/create/dialog/List",path:"/bcc/instance/create/mktlist"},{type:"bcc/instance/ChangePwd",path:"/bcc/instance/change_pwd"},{type:"bcc/instance/Rebuild",path:"/bcc/instance/rebuild"},{type:"bcc/instance/ChangeName",path:"/bcc/instance/change_name"},{type:"bcc/instance/AutoSnapshot",path:"/bcc/instance/auto_snapshot"},{type:"bcc/instance/Release",path:"/bcc/instance/release"},{type:"bcc/instance/Monitor",path:"/bcc/instance/monitor"},{type:"bcc/instance/ip/Action",path:"/bcc/instance/change_ip"},{type:"bcc/instance/subnet/Action",path:"/bcc/instance/change_subnet"}]);return{extraMetric:[{title:"CPU",items:[{name:"CPU空闲率",value:"CpuIdlePercent",unit:"百分比",statistics:"minimum"},{name:"等待IO CPU时间比率",value:"CpuWaitPercent",unit:"百分比",statistics:"maximum"},{name:"最近一分钟服务器负载",value:"CpuLoadAvg1",unit:"个",statistics:"maximum"},{name:"最近五分钟服务器负载",value:"CpuLoadAvg5",unit:"个",statistics:"maximum"},{name:"最近十五分钟服务器负载",value:"CpuLoadAvg15",unit:"个",statistics:"maximum"},{name:"每秒上下文切换次数",value:"CpuContextSwitchSecond",unit:"次/秒",statistics:"average"},{name:"每秒CPU的中断次数",value:"CpuInterruptSecond",unit:"次",statistics:"average"},{name:"系统CPU时间比率",value:"CpuSystemPercent",unit:"百分比",statistics:"average"},{name:"用户CPU时间比率",value:"CpuUserPercent",unit:"百分比",statistics:"average"}]},{title:"内存",items:[{name:"块设备读写内存缓冲量",value:"MemBufferBytes",unit:"字节",statistics:"average"},{name:"文件系统内存cache值",value:"MemCacheBytes",unit:"字节",statistics:"average"},{name:"内存空闲量",value:"MemFreeBytes",unit:"字节",statistics:"minimum"},{name:"内存总量",value:"MemTotalBytes",unit:"字节",statistics:"average"}]},{title:"SWAP",items:[{name:"交换分区总量",value:"SwapTotalBytes",unit:"字节",statistics:"average"},{name:"交换分区使用量",value:"SwapUsedBytes",unit:"字节",statistics:"maximum"},{name:"交换分区空闲量",value:"SwapFreeBytes",unit:"字节",statistics:"minimum"}]},{title:"磁盘",items:[{name:"整台服务器的磁盘空间总量",value:"DiskTotalBytes",unit:"字节",statistics:"average"},{name:"整台服务器的磁盘空闲总量",value:"DiskFreeBytes",unit:"字节",statistics:"minimum"},{name:"整台服务器的磁盘使用总量",value:"DiskUsedBytes",unit:"字节",statistics:"maximum"},{name:"整台服务器的磁盘使用率",value:"DiskUsedPercent",unit:"百分比",statistics:"maximum"},{name:"服务器inode总数",value:"DiskTotalInodes",unit:"个",statistics:"average"},{name:"服务器inode总空闲数",value:"DiskFreeInodes",unit:"个",statistics:"minimum"},{name:"服务器inode总使用数",value:"DiskUsedInodes",unit:"个",statistics:"maximum"},{name:"服务器inode总使用率",value:"DiskInodesUsedPercent",unit:"百分比",statistics:"maximum"}]},{title:"网络",items:[{name:"已建立的TCP连接数",value:"TcpCurrentEstab",unit:"个",statistics:"average"},{name:"TCP接收包数",value:"TcpInSegs",unit:"个",statistics:"average"},{name:"TCP发送包数",value:"TcpOutSegs",unit:"个",statistics:"average"},{name:"TCP丢包数",value:"TcpLossSegs",unit:"个",statistics:"average"}]}],monitorMetric:{cpu:{name:"CPU使用率",unit:"百分比",metrics:[{name:"CPU使用率",value:"vCPUUsagePercent"}]},diskIoCps:{name:"每秒磁盘IO读写次数",unit:"次/秒",metrics:[{name:"每秒磁盘IO读取次数",value:"vDiskReadOpCountPerSecond"},{name:"每秒磁盘IO写入次数",value:"vDiskWriteOpCountPerSecond"}]},diskIoBps:{name:"每秒磁盘IO读写量",unit:"字节/秒",metrics:[{name:"每秒磁盘IO读取量",value:"vDiskReadBytesPerSecond"},{name:"每秒磁盘IO写入量",value:"vDiskWriteBytesPerSecond"}]},network:{name:"网络监控",unit:"字节",filter:"eip",metrics:[{name:"网卡输入流量",value:"vNicInBytes"},{name:"网卡输出流量",value:"vNicOutBytes"},{name:"从外网进入的流量",value:"WebInBytes",filter:"eip",filterValue:!0},{name:"流向外网的流量",value:"WebOutBytes",filter:"eip",filterValue:!0}]},webOutBitsPerSecond:{name:"出口带宽",unit:"bps",metrics:[{name:"出口带宽",value:"WebOutBitsPerSecond"}]},mem:{name:"内存使用量",unit:"字节",metrics:[{name:"内存使用量",value:"MemUsedBytes"}]},memPercent:{name:"内存使用率",unit:"百分比",metrics:[{name:"内存使用率",value:"MemUsedPercent"}]},diskUsed:{name:"磁盘空间使用量",unit:"字节",metrics:[{name:"HOME磁盘空间使用量",value:"HomeUsedBytes"},{name:"根磁盘空间使用量",value:"RootUsedBytes"}]},diskUsedPercent:{name:"磁盘空间使用率",unit:"百分比",metrics:[{name:"HOME磁盘空间使用率",value:"HomeUsedPercent"},{name:"根磁盘空间使用率",value:"RootUsedPercent"}]}},gpuMonitorMetric:{title:"GPU",items:[{name:"gpu使用率",value:"UtilizationGpu",unit:"百分比",statistics:"minimum"},{name:"内存使用率",value:"UtilizationMemory",unit:"百分比",statistics:"maximum"},{name:"内存总量",value:"MemoryTotal",unit:"MB",statistics:"maximum"},{name:"内存使用量",value:"MemoryUsed",unit:"MB",statistics:"maximum"},{name:"内存空闲量",value:"MemoryFree",unit:"MB",statistics:"maximum"},{name:"gpu的温度",value:"Temperature",unit:"℃",statistics:"average"},{name:"gpu卡的ECC错误数",value:"EccErrors",unit:"",statistics:"average"},{name:"gpu卡状态",value:"Status",unit:"",statistics:"average"},{name:"gpu卡错误信息",value:"Error",unit:"",statistics:"average"},{name:"所有gpu的平均gpu使用率",value:"GpuAvgGpuUtilizationForall",unit:"百分比",statistics:"average"},{name:"所有gpu的平均内存使用率",value:"GpuAvgMemoryUtilizationForall",unit:"百分比",statistics:"average"},{name:"所有gpu的最大gpu使用率",value:"GpuMaxGpuUtilization",unit:"百分比",statistics:"maximum"},{name:"最大gpu使用率的gpu编号",value:"GpuMaxGpuUtilizationIndex",unit:"",statistics:""},{name:"所有gpu的最大内存使用率",value:"GpuMaxMemoryUtilization",unit:"百分比",statistics:"maximum"},{name:"最大内存使用率的gpu编号",value:"GpuMaxMemoryUtilizationIndex",unit:"",statistics:""},{name:"所有gpu的最高温度",value:"GpuMaxTemperature",unit:"℃",statistics:"maximum"},{name:"最高温度的gpu编号",value:"GpuMaxTemperatureIndex",unit:"",statistics:""},{name:"所有gpu卡的ECC错误数",value:"GpuAllEccErrors",unit:"",statistics:""},{name:"最高ECC错误数的gpu卡编号",value:"GpuMaxEccErrorsIndex",unit:"",statistics:""},{name:"gpu卡整体状态",value:"GpuStatus",unit:"",statistics:""},{name:"gpu卡错误信息",value:"GpuError",unit:"",statistics:""}]}}}),define("bcc/instance/create/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","jquery","babel-runtime/helpers/interop-require-default","bat-ria/mvc/FormAction","inf-ria/decorators","inf-ui/x/biz/helper","er/events","./Model","./View","underscore","lodash","promise","inf-ria/app/brpc","common/constants","common/region","common/zone","common/util","common/util/orderUtil","common/util/moneyUtil","../../ssh/create","../../cds/helper","../../_public/selectUtil","../../events","../../config","../../enum","../../operations"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p,f,m,h,g,v,b,y,T,x,I,S,E,w,k){function C(e){if(e.imageType){var t=this.model.get("_osData");if(t){var a=t.osTypeMap[e.imageType],i=this.view.get("instanceType").getValue(),n=this.view.get("imageType").getValue();i===w.InstanceType.GPU&&n===w.ImageType.GPU_BCC_IMAGE&&(a=U["default"].filter(a,function(e){return"windows"!==e.osType})),X["default"].selectHandler(this.view,"osType",a)}}}function D(e){if(e.imageType&&e.osType){var t=e.osVersionIndex||0,a=U["default"].clone(this.model.get("_osData").osVersionMap[e.imageType][e.osType]);a=U["default"].each(a,function(t){return t.memInvalid=!!t.minMem&&t.minMem>e.memory,t.cpuInvalid=!!t.minCpu&&t.minCpu>e.cpu,t.maxRamGbInvalid=!!t.maxRamGb&&e.memory>t.maxRamGb,t.disabled=t.memInvalid||t.cpuInvalid||t.maxRamGbInvalid,t.popover=t.maxRamGbInvalid?"您选择的内存已大于当前镜像支持的最大内存":"",t}),U["default"].every(a,function(e){return!0===e.disabled})?t=-1:a[t]&&a[t].disabled&&(t=V["default"].findIndex(a,function(e){return!e.disabled})),U["default"].some(a,function(e){return e.memInvalid||e.cpuInvalid})?this.view.get("osVersionTip").show():this.view.get("osVersionTip").hide(),X["default"].selectHandler(this.view,"osVersion",a,t),this.view.updateOsDisksizeTip()}}function _(e){this.model.set("productType",e.productType),this.getPrice(),this.quotaCheck(e.productType),this.view.warningPanelShow(),this.view.enableSubmitBtn(!0)}function A(e){this.quotaCheck(),this.view.processError(),this.getPrice()}function P(){this.model.get("instance")?function(){var e=this.view,t=this.model.get("instance");!e.get("tempDiskPanel").isHidden()&&+t.diskSize&&(e.get("diskSize").setValue(t.diskSize),e.get("tempDiskPanelSet").show(),e.get("tempDiskPanelOn").hide());return t}.call(this):this.model.get("image")&&function(){var e=this.view,t=this.model.get("image");!e.get("tempDiskPanel").isHidden()&&+t.diskSize&&(e.get("diskSize").setValue(t.diskSize),e.get("tempDiskPanelSet").show(),e.get("tempDiskPanelOn").hide());return t}.call(this),this.getPrice({init:!0}),this.loadData("image",{},{initial:!0}),this.loadData("snapshot"),this.loadData("vpc"),this.loadData("asp"),this.loadData("keypair"),this.model.get("mktImage")&&this.view.loadMKTImageInfo(),this.quotaCheck(),this.view.warningPanelShow(),this.view.processError()}function R(e){var t=this,a=this.model.getSubmitData(this.view.getFormData());if(this.customValidate(a)){var i=this.view.get("vpc").getValue(),n=U["default"].find(this.model.get("vpcDatasource"),function(e){return e.value===i}),s=U["default"].find(this.model.get("subnetDatasource"),function(e){return e.value===a.subnetUuid});this.model.getPrice(a).then(function(i){var r=function(e,t,a,i){var n=t.priceDetail,s=U["default"].find(n,function(e){return"BCC"===e.servicetype}),r=s.price[0]/e.purchaseNum,o="￥"+W["default"].convertPrice(r).getPriceOfMinute()+(e.productType===w.ProductType.PREPAY?"/台":"/分钟/台"),c=[],l={serviceType:"BCC",productType:e.productType,type:"NEW",price:t.money,items:[{serviceType:"BCC",productType:e.productType,count:e.purchaseNum,time:e.purchaseLength,timeUnit:"MONTH",price:s.price[0],unitPrice:r,unitPriceShow:o,chargeType:H["default"].SERVICE_TYPE.BCC.chargeType[e.productType],configuration:["地域："+q["default"].getCurrentRegion().label,"可用区："+z["default"].getLabel(e.logicalZone),"CPU："+e.cpu+"核","内存："+e.memory+"GB","操作系统："+e.osType,"操作系统版本："+e.osVersion,"本地磁盘："+e.diskSize+"GB","所在网络："+Y["default"].getVpcName(a?a.text:""),"所在子网："+Y["default"].getSubnetName(i?i.text:""),"安全组："+e.securityGroupName]}]};e.instanceType===w.InstanceType.GPU?c=["云服务器类型："+w.InstanceType.getTextFromValue(e.instanceType),"GPU型号："+w.GpuCard.getTextFromValue(e.gpuCard),"GPU数量："+e.gpuCount+"块"]:e.instanceType===w.InstanceType.FPGA&&(c=["云服务器类型："+w.InstanceType.getTextFromValue(e.instanceType),"FPGA：Xilinx KU115*1块"]);if(c.length){var d;(d=l.items[0].configuration).splice.apply(d,[2,0].concat(c))}return K["default"].make(l)}(a,i,n,s),o=U["default"].clone(a);o.ebsSize=[];var c={bcc:U["default"].extend({},o,{serviceType:"BCC"})};if(a.ebsSize.length>0){var l=U["default"].find(i.priceDetail,function(e){return"CDS"===e.servicetype})||{},d=Q["default"].formData2OrderItems(U["default"].clone(a),{pricePerDiskList:l.pricePerResourceList});r.items=r.items.concat(d),c.cds=U["default"].extend({},function(e){var t=U["default"].pick(e,"logicalZone","productType","region","purchaseNum","purchaseLength","autoRenewTime","autoRenewTimeUnit");return U["default"].extend(t,{cdsDiskSize:e.ebsSize})}(a),{serviceType:"CDS"})}if(t.model.get("isSysCdsRequiredRegion")&&(r.items.push(function(e,t){var a=q["default"].getCurrentRegion(),i=e.productType===w.ProductType.PREPAY,n=i?e.purchaseLength:"",s=U["default"].find(t.priceDetail,function(e){return"SYS-CDS"===e.servicetype}),r=s.price[0]/e.purchaseNum,o=W["default"].convertPrice(r).getPriceOfMinute(),c=i?"￥"+o+"/个":"配置费用：￥"+o+"/分钟/个",l=["地域："+a.label,"可用区："+z["default"].getLabel(e.logicalZone),"容量："+e.rootDiskSizeInGb+"GB（内含赠送40GB）","类型："+w.DiskType.getTextFromValue(e.rootDiskStorageType)];return{serviceName:"系统盘（CDS云磁盘）",serviceType:"CDS",productType:e.productType,count:e.purchaseNum,price:s.price[0],region:a.id,regionName:a.label,time:n,timeUnit:"MONTH",unitPrice:r,unitPriceShow:c,chargeType:H["default"].SERVICE_TYPE.CDS.chargeType[e.productType],configuration:l}}(a,i)),c.cds?c.cds.cdsDiskSize.push(N(a)):c.cds=U["default"].extend({},function(e){var t=U["default"].pick(e,"logicalZone","productType","region","purchaseNum","purchaseLength","autoRenewTime","autoRenewTimeUnit");return U["default"].extend(t,{cdsDiskSize:[N(e)]})}(a),{serviceType:"CDS"})),e.ifBuyEip&&(r.items.push(function(e,t){var a=q["default"].getCurrentRegion(),i=e.subProductType===w.ProductType.PREPAYEIP?e.purchaseLength:"",n=U["default"].find(t.priceDetail,function(e){return"EIP"===e.servicetype}),s=n.price[0]/e.purchaseNum,r=W["default"].convertPrice(s).getPriceOfMinute(),o=e.subProductType===w.ProductType.PREPAYEIP?"￥"+r+"/个":"配置费用：￥"+r+"/分钟/个";e.subProductType===w.ProductType.NETRAFFIC&&(o+=",流量费用：￥"+W["default"].convertPrice(n.networkMoney).getPriceOfMinute("/"+n.networkUnit));var c=e.subProductType===w.ProductType.PREPAYEIP?w.ProductType.PREPAY:[w.ProductType.POSTPAY,e.subProductType].join("_"),l=["地域："+a.label];return e.subProductType===w.ProductType.PREPAYEIP||e.subProductType===w.ProductType.BANDWIDTH?l.push("公网带宽："+e.bandwidthInMbps+"Mbps"):0===e.bandwidthInMbps?l.push("不限制公网带宽"):l.push("公网带宽峰值："+e.bandwidthInMbps+"Mbps"),{serviceType:"EIP",productType:e.subProductType===w.ProductType.PREPAYEIP?w.ProductType.PREPAY:w.ProductType.POSTPAY,count:e.purchaseNum,price:n.price[0],region:a.id,regionName:a.label,time:i,timeUnit:"MONTH",unitPrice:s,unitPriceShow:o,chargeType:H["default"].SERVICE_TYPE.EIP.chargeType[c],configuration:l}}(a,i)),c.eip=U["default"].extend({},function(e){var t=U["default"].pick(e,"bandwidthInMbps","region","subProductType","purchaseNum","purchaseLength","autoRenewTime","autoRenewTimeUnit");return U["default"].extend(t,{name:e.eipName},{productType:e.subProductType===w.ProductType.PREPAYEIP?w.ProductType.PREPAY:w.ProductType.POSTPAY})}(a),{serviceType:"EIP"})),a.productId&&a.imageType===w.ImageType.MKT){var u=t.model.get("mktImage");r.items.push(function(e,t,a){var i=q["default"].getCurrentRegion(),n=e.productType===w.ProductType.PREPAY,s=n?e.purchaseLength:"",r=U["default"].find(a.priceDetail,function(e){return"MKT"===e.servicetype}),o=r.price[0]/e.purchaseNum,c=W["default"].convertPrice(o).getPriceOfMinute(),l=n?"￥"+c+"/个":"￥"+c+"/分钟/个";return{serviceType:"MKT",productType:e.productType,count:e.purchaseNum,price:r.price[0],region:i.id,regionName:i.label,time:s,timeUnit:"MONTH",unitPrice:o,unitPriceShow:l,chargeType:t.chargeType===w.ProductType.PREPAY?["cpt2"]:[t.chargeType],configuration:["名称："+t.productName,"规格："+t.packageName]}}(a,u,i));var p=U["default"].pick(a,"productType","region","purchaseNum","purchaseLength","imageId","imageType","productId","packageId");c.mkt=U["default"].extend({},p,{serviceType:"MKT"})}var f=t.model.get("privilegeName"),m=t.model.get("mktProductTag"),h=U["default"].compact([f,m]).join();h&&(c.privilegeName=h),t.model.set("order",r),t.model.set("config",a),t.view.renderOrderConfirm(r,c)})}}function N(e){return{size:e.rootDiskSizeInGb,volumeType:e.rootDiskStorageType,type:"system"}}var L=i["default"](a),$=i["default"](n),O=i["default"](o),M=i["default"](c),B=i["default"](l),U=i["default"](d),V=i["default"](u),G=i["default"](p),F=i["default"](f),H=i["default"](m),q=i["default"](h),z=i["default"](g),Y=i["default"](v),K=i["default"](b),W=i["default"](y),j=i["default"](T),Q=i["default"](x),X=i["default"](I),Z=i["default"](S),J=i["default"](E),ee=0,te=function(a){function i(){t["default"](this,n),a.apply(this,arguments)}e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.view.on(Z["default"].GET_PRICE,this.getPrice,this),this.view.on(Z["default"].UPDATE_OS_TYPE,C,this),this.view.on(Z["default"].UPDATE_OS_VERSION,D,this),this.view.on(Z["default"].CHANGE_CDS_SIZE,A,this),this.view.on(Z["default"].CHANGE_PRODUCT_TYPE,_,this),this.view.on(Z["default"].CHANGE_PURCHASE_NUM,this.changePurchaseNum,this),this.view.on(Z["default"].RELOAD,this.reload,this),this.view.on(Z["default"].PICK,R,this),this.view.on(Z["default"].CHOOSE_MKT_PRODUCT,this.selectMKTImage,this),this.view.on(Z["default"].ADD_TAG,this.addTag,this),this.view.on(Z["default"].REGION_CHANGE,this.regionChange,this),this.view.on("reloadData",function(e){this.loadData(e.key)},this),this.view.on("createSubnet",this.createSubnet,this),this.view.on("createAsp",this.createAsp,this),this.view.on("createKeypair",this.createKeypair,this),this.on("mkt.picked",this.pickMKTProduct),this.on("dialog.close",this.resetImageType),this.on("entercomplete",P,this),L["default"](this.view.get("mktImagePanel").main).on("click",'[action-type="repick"]',U["default"].bind(this.selectMKTImage,this))},i.prototype.syncModelToViewIterator=function(e){switch(e.name){case"prePurchaseValid":case"posPurchaseValid":this.view.warningPanelShow(),this.view.enableSubmitBtn(!0)}},i.prototype.regionChange=function(e){this.model.setRegion(e.regionId).then(function(){return O["default"].fire(Z["default"].AFTER_REGION_CHANGED)})},i.prototype.changePurchaseNum=function(){this.quotaCheck(),this.view.processError(),this.getPrice()},i.prototype.quotaCheck=function(e){e=(e=e||this.model.get("productType"))===w.ProductType.PREPAY?"pre":"post";var t=this.model.get("quota"),a=t[e+"InstanceTotal"]-t[e+"InstanceCreated"];if(a<=0)return this.view.get("buyBucket").disable(),this.model.set("instanceQuotaCheck",!1),!1;var i=this.view.getFormData(),n=0;U["default"].each(i.ebsSize,function(e){n+=+e.size});var s=this.model.get("errorInfo")||{};if(t.cdsUsedCapacityGB+n*i.purchaseNum>t.cdsTotalCapacityGB){var r=t.cdsTotalCapacityGB-t.cdsUsedCapacityGB;return s.ebsSize="当前订单要购买的CDS大小超过了您剩余配额"+(r>=1024?(r/1024).toFixed(2)+"TB":r+"GB")+"（总配额"+(t.cdsTotalCapacityGB/1024).toFixed(2)+'TB）。如需增加配额，请到<a href="'+H["default"].domains.ticket+'">工单</a>申请',this.model.set("errorInfo",s),!1}i.ebsSize.length===t.cdsRatio-t.cdsCreated?this.model.set("ebsCountReachMax",!0):this.model.set("ebsCountReachMax",!1),s.ebsSize&&delete s.ebsSize,U["default"].isEmpty(s)?this.model.remove("errorInfo",s):this.model.set("errorInfo",s),t.keypairCreated>=t.keypairTotal?this.view.get("createKeypair").setProperties({disabled:!0,popover:"一个地域下最多只能创建500个密钥"}):this.view.get("createKeypair").setProperties({disabled:!1,popover:""});var o=this.view.get("purchaseNum"),c=J["default"].LIMIT.INSTANCE.MAX_AT_ONE_TIME;return o.set("max",a<c?a:c),o.currentValue===a?L["default"](".purchase-num-tip").html("最多可购买"+a+'台，如需增加配额请到<a href="'+H["default"].domains.ticket+'">工单</a>申请'):L["default"](".purchase-num-tip").html(""),this.model.set("instanceQuotaCheck",!0),!0},i.prototype.customValidate=function(e){return this.view.get("form").validate()&&this.view.checkAllTag()},i.prototype.createSubnet=function(){var e=this,t=this.view.get("vpc").getValue(),a=this.view.get("logicalZone").getValue(),i=this.model.get("rawVpcData"),n={vpcInfo:U["default"].find(i,function(e){return e.vpcId===t}),zone:a,subnetTypes:[1,3]};F["default"].invokeService("network://create_subnet",n).then(function(t){e.loadSubnetData()})},i.prototype.createKeypair=function(){var e=this;this._KeyPairCreateComponent&&this._KeyPairCreateComponent.dispose(),this._KeyPairCreateComponent=new j["default"]({data:{keypairCreate:!0}}),this._KeyPairCreateComponent.attach(document.body),this._KeyPairCreateComponent.on("ok",function(t){e.loadKeypairData(),e.quotaCheck()})},i.prototype.createAsp=function(){var e={parentAction:this};this._AspCreateComp=r.waitActionDialog({title:"新建自动快照策略",width:660,url:"/bcc/snapshot/updatePolicy",needFoot:!1},e)},i.prototype.onOkAspCreate=function(){this.loadAspData(),this.onCloseAspCreate()},i.prototype.onCloseAspCreate=function(){this._AspCreateComp.closeDialog()},i.prototype.selectMKTImage=function(e){k.chooseMKTProduct.call(this,{parentAction:this})},i.prototype.pickMKTProduct=function(e){var t=this,a=e.item.pid;return this.model.getMKTImageDetail({productId:a}).done(function(e){t.model.set("mktImage",e),t.view.loadMKTImageInfo(),t.view.get("purchaseLength").setValue(e.months||1),t.view.get("adminName").setText(J["default"].OS_ADMIN_NAME[e.osType.toLowerCase()])})},i.prototype.resetImageType=function(e){this.view.get("imageType").setValue(w.ImageType.COMMON)},i.prototype.updateCtlsView=function(e,t,a,i){var n=this,s=arguments.length<=4||arguments[4]===undefined?{}:arguments[4],r="function"==typeof t;U["default"].each(e,function(e){var a=n.view.get(e);a.setProperties(r?t(e):t),a.render(),a.fire("change",s)}),this.view.get(a)[i]()},i.prototype.loadSnapshotData=function(){var e=this;return this.model.getSnapshotsList().then(function(t){var a=e.view.get("ebsSize");a.getChild("addSnapshot").set("content","从快照创建CDS磁盘"),t&&t.length?(a.datasource=t,a.snapshot.stateDisabled=!1,a.setButtonStatus()):(a.snapshot.stateDisabled=!0,a.setButtonStatus())})},i.prototype.loadImageData=function(){var e=this,t=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],a=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];t=U["default"].extend(t,this.model.get("instance")||this.model.get("image")),this.updateCtlsView(["osType","osVersion"],{disabled:!0,datasource:[{name:"加载中...",value:""}],selectedIndex:0},"osTip","hide");var i=[this.model.getImageList(["common"]),this.model.getImageList(["custom"]),this.model.getImageList(["integration"]),this.model.getImageList(["sharing"])];return U["default"].find(this.model.get("zoneDatasource"),function(e){return U["default"].contains(e.bccInstanceTypes,w.InstanceType.FPGA)})&&(i.push(this.model.getImageList(["fpgaImage"])),i.push(this.model.getImageList(["fpgaCustom"]))),U["default"].find(this.model.get("zoneDatasource"),function(e){return U["default"].contains(e.bccInstanceTypes,w.InstanceType.GPU)})&&(i.push(this.model.getImageList(["gpuBccImage","common"])),i.push(this.model.getImageList(["gpuBccCustom","custom"]))),G["default"].all(i).then(function(){t&&t.imageId?e.model.prepareDataForOs(t.imageId):e.model.prepareDataForOs(),e.updateCtlsView(["imageType","osType","osVersion"],function(t){return{disabled:!1,datasource:e.model.get(t+"List"),selectedIndex:e.model.get(t+"Index")}},"osTip","hide",a),e.view.updateOsDisksizeTip(),e.view.updateImageTip(),e.getPrice()},function(t){e.updateCtlsView(["osType","osVersion"],{disabled:!0,datasource:[{name:"加载失败",value:""}],selectedIndex:0},"osTip","show")})},i.prototype.loadVpcData=function(){var e=this;return this.updateCtlsView(["vpc","subnet"],{disabled:!0,datasource:[{name:"加载中...",value:""}],selectedIndex:0},"vpcTip","hide"),this.model.getVpcList().then(function(t){e.updateCtlsView(["vpc"],function(t){return{disabled:!1,datasource:e.model.get("vpcDatasource"),selectedIndex:0}},"vpcTip","hide")},function(t){e.updateCtlsView(["vpc","subnet","securityGroups"],{disabled:!0,datasource:[],selectedIndex:-1,emptyText:"加载失败"},"vpcTip","show")})},i.prototype.loadSubnetData=function(){var e=this,t=this.view.get("buyBucket"),a=this.view.get("logicalZone").getValue(),i=this.view.get("vpc").getValue(),n=U["default"].find(this.model.get("vpcDatasource"),function(e){return e.value===i});if(t.disable(),n)return this.updateCtlsView(["subnet"],{disabled:!0,datasource:[{name:"加载中...",value:""}],selectedIndex:0},"vpcTip","hide"),this.view.get("subnetEmptyTip").hide(),this.model.getSubnetList(i,a).then(function(t){var a=e.model.get("subnetDatasource"),i=a&&a.length>0;i?e.view.enableSubmitBtn(!0):e.view.get("subnetEmptyTip").show(),e.updateCtlsView(["subnet"],{disabled:!i,datasource:a,selectedIndex:i?0:-1,emptyText:"暂无数据"},"vpcTip","hide")},function(t){e.updateCtlsView(["subnet"],{disabled:!0,datasource:[],selectedIndex:-1,emptyText:"加载失败"},"vpcTip","show")})},i.prototype.loadSecurityData=function(){var e=this,t=this.view.get("buyBucket"),a=this.view.get("vpc").getValue();t.disable();if(U["default"].find(this.model.get("vpcDatasource"),function(e){return e.value===a}))return this.updateCtlsView(["securityGroups"],{disabled:!0,datasource:[{name:"加载中...",value:""}],selectedIndex:0},"securityTip","hide"),this.model.getAllSecurityGroups(a).then(function(t){var a=e.model.get("securityGroups"),i=a.length>0;e.updateCtlsView(["securityGroups"],function(t){return{disabled:!i,datasource:i?a:[],selectedIndex:i?e.model.get("securityGroupsSelectedIndex"):-1,emptyText:"暂无数据"}},"securityTip","hide"),i&&e.view.enableSubmitBtn(!0)},function(t){e.updateCtlsView(["securityGroups"],{disabled:!0,datasource:[],selectedIndex:-1,emptyText:"加载失败"},"securityTip","show")})},i.prototype.loadKeypairData=function(){var e=this;return this.updateCtlsView(["keypair"],{disabled:!0,datasource:[{name:"加载中...",value:""}],selectedIndex:0},"keypairTip","hide"),this.model.getKeypairList().then(function(t){e.updateCtlsView(["keypair"],function(t){return{disabled:!1,datasource:e.model.get("keyPairList"),selectedIndex:0}},"keypairTip","hide")}).fail(function(t){e.updateCtlsView(["keypair"],{disabled:!0,datasource:[],selectedIndex:-1,emptyText:"加载失败"},"keypairTip","show")})},i.prototype.loadAspData=function(){var e=this;return this.updateCtlsView(["asp"],{disabled:!0,datasource:[{name:"加载中...",value:""}],selectedIndex:0},"aspTip","hide"),this.model.getAspList().then(function(t){e.updateCtlsView(["asp"],function(t){return{disabled:!1,datasource:e.model.get("aspList"),selectedIndex:0}},"aspTip","hide")}).fail(function(t){e.updateCtlsView(["asp"],{disabled:!0,datasource:[],selectedIndex:-1,emptyText:"加载失败"},"aspTip","show")})},i.prototype.loadPrice=function(){var e=this,t=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],a=this.model.get("mktImage");return this.model.set("myFormDataOld",t.formData),this.model.getPrice(t.formData,{"x-silent":!0}).then(function(i){t.pricecount<ee||(t.buyBucket.setValue(U["default"].extend({},t.formData,i,{mktImage:a})),e.model.set("price",i.money),e.view.enableSubmitBtn(!0))},function(e){t.buyBucket.setValue(U["default"].extend({},t.formData,{error:!0}))})},i.prototype.loadData=function(e){var t=arguments.length<=1||arguments[1]===undefined?{}:arguments[1],a=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];switch(e){case"snapshot":return this.loadSnapshotData();case"price":return this.loadPrice(t);case"image":return this.loadImageData(t,a);case"vpc":return this.loadVpcData();case"subnet":return this.loadSubnetData();case"security":return this.loadSecurityData();case"keypair":return this.loadKeypairData();case"asp":return this.loadAspData()}},i.prototype.getPrice=function(e){var t=this.model.getSubmitData(this.view.getFormData()),a=this.model.get("myFormDataOld"),i=this.view.get("buyBucket");return e&&e.init||!t.imageId&&t.imageType===w.ImageType.MKT?(i.setValue(U["default"].extend({},t,{money:0})),void i.disable()):(delete t.adminPass,delete t.adminPassConfirm,delete t.money,U["default"].isEqual(t,a)?void 0:(i.setValue(U["default"].extend({},t,{loading:!0})),i.disable(),this.loadData("price",{PRICECOUNT:ee,pricecount:++ee,formData:t,buyBucket:i})))},i.prototype.addTag=function(){this.view.addTag()};var n=i;return i=s.action(M["default"],B["default"])(i)||i}($["default"]);module.exports=te}),define("bcc/instance/create/dialog/List",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","inf-ria/mvc/ListAction","babel-runtime/helpers/interop-require-default","jquery","underscore","er/URL","./ListModel","./ListView"],function(exports,module,e,t,a,i,n,s,r,o,c,l){function d(e){var t=undefined;f["default"].isString(e)?t=m["default"].parse(e):e instanceof m["default"]&&(t=e);var a=this.view.getSearchArgs(),i=this.model.getQuery(),n=t.getQuery()||{},s=f["default"].extend(i,a,n),r=this.view.get("searchBtn");r.setDisabled(!0),this.asyncListPage(s).ensure(function(e){return r.setDisabled(!1)})}var u=n["default"](i),p=n["default"](s),f=n["default"](r),m=n["default"](o),h=n["default"](c),g=n["default"](l),v=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.initBehavior=function(){i.prototype.initBehavior.call(this),p["default"]("#categoryWrapper").on("click",'[action-type="pick"]',f["default"].bind(this.pickCategory,this)),p["default"]("#categoryWrapper").on("click",'[action-type="selected"]',f["default"].bind(this.pickSelected,this)),p["default"]("#listWrapper,#selectedWrapper").on("click",'[action-type="purchase"]',f["default"].bind(this.pickProduct,this)),this.on("listDataLoaded",this.listDataLoaded),this.redirect=f["default"].bind(d,this)},n.prototype.listDataLoaded=function(e){this.fire("dialog.resize",e)},n.prototype.pickCategory=function(e){p["default"]("#selectedWrapper").hide(),p["default"]("#listWrapper").show();var t=parseInt(p["default"](e.currentTarget).attr("action-data"),10);this.model.set("cid",t),p["default"]("#categoryWrapper li").removeClass("active"),p["default"]('#categoryWrapper [action-data="'+t+'"]').parent().addClass("active"),this.view.submitSearch(e),this.view.adjustLayout()},n.prototype.pickSelected=function(e){p["default"]("#categoryWrapper li").removeClass("active"),p["default"]('#categoryWrapper [action-type="selected"]').parent().addClass("active"),p["default"]("#selectedWrapper").show(),p["default"]("#listWrapper").hide()},n.prototype.pickProduct=function(e){var t=p["default"](e.currentTarget).attr("action-data").split(","),a=t[0],i=t[1];this.model.get("parentAction").fire("mkt.picked",{item:{pid:a,tag:i}}),this.fire("dialog.dispose",e)},t["default"](n,[{key:"viewType",get:function(){return g["default"]}},{key:"modelType",get:function(){return h["default"]}}]),n}(u["default"]);module.exports=v}),define("bcc/instance/create/dialog/list.tpl",[],function(){return'\x3c!-- target: TPL_bcc_create_mkt_list --\x3e\n<div class="bcc-mkt-list main-wrap-new">\n    <div class="list-content">\n        <div class="category-wrapper" id="categoryWrapper">\n            <ul class="category-list">\n                \x3c!-- if: ${selectedList.length} --\x3e\n                <li class="active">\n                    <span action-type="selected" class="selected">精选镜像</span>\n                </li>\n                \x3c!-- /if --\x3e\n                <li \x3c!-- if: ${cid} == 0 --\x3eclass="active"\x3c!-- /if --\x3e>\n                    <span action-type="pick" action-data="0" class="all">全部</span>\n                </li>\n                \x3c!-- for: ${category} as ${topItem} --\x3e\n                <li \x3c!-- if: ${cid} == ${topItem.cid} --\x3eclass="active"\x3c!-- /if --\x3e>\n                    <span action-type="pick" action-data="${topItem.cid}">${topItem.name}</span>\n                    \x3c!-- if: ${topItem.children.length} --\x3e\n                    <ul>\n                        \x3c!-- for: ${topItem.children} as ${secondItem} --\x3e\n                        <li \x3c!-- if: ${cid} == ${secondItem.cid} --\x3eclass="active"\x3c!-- /if --\x3e>\n                            <span action-type="pick" action-data="${secondItem.cid}">${secondItem.name}</span>\n                        </li>\n                        \x3c!-- /for --\x3e\n                    </ul>\n                    \x3c!-- /if --\x3e\n                </li>\n                \x3c!-- /for --\x3e\n            </ul>\n        </div>\n\n        \x3c!-- if: ${selectedList.length} --\x3e\n        <div class="selected-list-mkt-wrap" id="selectedWrapper">\n            <div class="hot-recommend">热门镜像推荐</div>\n            <ul>\n                \x3c!-- for: ${selectedList} as ${item}, ${index} --\x3e\n                <li>\n                    <div class="img">\n                        <a href="https://cloud.baidu.com/market/detail/${item.pid}" target="_blank">\n                            <img src="${item.thumbnail}" title="${item.title}" alt="${item.title}" />\n                        </a>\n                        <p class="price">¥${item.price}/${item.timeUnit}</p>\n                    </div>\n                    <div class="text">\n                        <div class="title">\n                            <h3>\n                                <a href="https://cloud.baidu.com/market/detail/${item.pid}"\n                                    title="${item.title}"\n                                    target="_blank">${item.title}</a>\n                            </h3>\n                        </div>\n                        <p class="digest">${item.digest}</p>\n                        <div action-type="purchase" action-data="${item.pid},HOT_RECOMMEND" class="button">购买</div>\n                    </div>\n                </li>\n                \x3c!-- /for --\x3e\n            </ul>\n        </div>\n        \x3c!-- /if --\x3e\n\n        <div class="table-full-wrap list-mkt-wrap" id="listWrapper"\n            \x3c!-- if: ${selectedList.length} --\x3estyle="display:none"\x3c!-- /if --\x3e>\n            <div class="operation-wrap">\n                <div class="buttons-quick-wrap">\n                    <span class="ui-group ui-search-group">\n                        <input class="search-box"\n                            data-ui-type="TextBox"\n                            data-ui-id="keyword" />\n                        <span data-ui-type="Button"\n                            data-ui-id="searchBtn"\n                            class="search-button"></span>\n                    </span>\n                </div>\n            </div>\n\n            <div data-ui-type="Table" data-ui-id="table"\n                 data-ui-datasource="@tableData"\n                 data-ui-order-by="@orderBy" data-ui-order="@order"\n                 data-ui-select="@selectMode" data-ui-extension-tip-type="TableTip"\n                 data-ui-extension-command-type="Command"\n                 data-ui-extension-tableedit-type="TableEdit"\n                 data-ui-extension-tableex-type="TableEx"\n                 data-ui-extension-tablefilter-type="TableFilter">\n            </div>\n\n            <div class="ui-row bcc-row-foot">\n                <div class="ui-pager-box">\n                    \x3c!-- import: listPager --\x3e\n                </div>\n                <input type="checkbox"\n                    data-ui-type="CheckBox"\n                    data-ui-id="selectAllItems"\n                    data-ui-hidden="true" />\n            </div>\n        </div>\n    </div>\n</div>\n\x3c!-- target: TPL_bcc_create_mkt_list_child --\x3e\n\x3c!-- import: TPL_bcc_create_mkt_list --\x3e\n'}),define("bcc/instance/create/dialog/ListModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","inf-ria/mvc/ListModel","babel-runtime/helpers/interop-require-default","underscore","../../../config"],function(exports,module,e,t,a,i,n,s,r){var o=n["default"](i),c=n["default"](s),l="",d=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.prepare=function(){this.set("keywordTypeSource",c["default"].map(r.KEYWORD_TYPE))},t["default"](n,[{key:"getMKTCategory",get:function(){return r.api.getMKTCategory}},{key:"listRequester",get:function(){return r.api.getMKTList}},{key:"getMKTSelectedList",get:function(){return r.api.getMKTSelectedList}},{key:"datasource",get:function(){return{generator:[{category:function(e){return e.getMKTCategory()},selectedList:function(e){return e.getMKTSelectedList().then(function(e){return e.result})}},{cid:function(e){return e.get("selectedList").length?"999":"0"}}]}}},{key:"defaultArgs",get:function(){return{cid:"0",keyword:l,order:"desc",orderBy:"createTime",pageSize:6}}}]),n}(o["default"]);module.exports=d}),define("bcc/instance/create/dialog/ListView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./list.tpl","inf-ria/mvc/ListView","babel-runtime/helpers/interop-require-default","inf-i18n","common/util/tableUtil","./tableFields"],function(exports,module,e,t,a,i,n,s,r,o,c){var l=s["default"](n),d=s["default"](r),u=s["default"](o),p=s["default"](c),f=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.getUIEvents=function(){return u["default"].getListEvents({"keyword:enter":function(e){this.submitSearch(e)},"searchBtn:click":function(e){this.submitSearch(e)}})},n.prototype.getSearchArgs=function(e){return e=i.prototype.getSearchArgs.call(this,e),e.cid=this.model.get("cid")||0,e},t["default"](n,[{key:"template",get:function(){return"TPL_bcc_create_mkt_list"}},{key:"uiProperties",get:function(){return{keyword:{width:435,value:"@keyword",placeholder:"搜索镜像名称"},table:{select:"",columnResizable:!1,fields:p["default"],noDataHtml:d["default"]("暂无相关云市场产品")}}}},{key:"initTableSelectItem",get:function(){return u["default"].initTableSelectItem}}]),n}(l["default"]);module.exports=f}),define("bcc/instance/create/dialog/tableFields",["exports","module","underscore","babel-runtime/helpers/interop-require-default","inf-i18n","common/util/moneyUtil"],function(exports,module,e,t,a,i){var n=t["default"](e),s=t["default"](a);module.exports=[{title:s["default"]("产品名称"),field:"title",content:function(e,t){var a=n["default"].escape(e.title),i=n["default"].escape(e.digest);return'\n                <a href="https://cloud.baidu.com/market/detail/'+e.pid+'"\n                    target="_blank" class="title">'+a+'</a>\n                <span class="digest">'+i+"</span>\n            "}},{title:s["default"]("价格"),field:"originalPrice",width:144,stable:!0,content:function(e,t){var a=i.showMoney(e.originalPrice),n=i.showMoney(e.price);return'\n                <div class="operation">\n                    <p>'+(e.originalPrice>e.price?'<span class="original-price">￥'+a+"/"+e.timeUnit+"</span>":"")+" "+('<span class="price">￥'+n+"/"+e.timeUnit+"</span>")+'</p>\n                    <div action-type="purchase"\n                        action-data="'+e.pid+'"\n                        class="ui-button skin-primary-button purchase-btn">购买</div>\n                </div>\n            '}}]}),define("bcc/instance/create/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormModel","babel-runtime/helpers/interop-require-default","underscore","lodash","promise","common/region","common/util","inf-ria/utils/mtools","common/storage","../../flags","../../util","../../config","../../helper","../../enum","../../common","../../tips","../flavor"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p,f,m,h,g,v,b,y){var T=n["default"](i),x=n["default"](s),I=n["default"](r),S=n["default"](o),E=n["default"](c),w=n["default"](l),k=n["default"](d),C=n["default"](u),D=n["default"](p),_=n["default"](f),A=n["default"](h),P=n["default"](v),R=n["default"](b),N=n["default"](y),L={"x-silent":!0},$=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.getMKTImageDetail=function(){var e=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];return m.api.mktImageDetail(e,L)},n.prototype.prepare=function(){S["default"].all([this.getPrePurchaseValidation(),this.getPosPurchaseValidation()]),this.prepareFlavor(),this.prepareImageType(),this.prepareDisk(),this.set("productType",g.ProductType.PREPAY),this.set("nameType",m.PASSWORD_TYPE.RANDOM),this.set("adminPassType",m.PASSWORD_TYPE.RANDOM);var e=[{name:I["default"]("1个月"),value:1},{name:"2",value:2},{name:"3",value:3},{name:"4",value:4},{name:"5",value:5},{name:"6",value:6},{name:"7",value:7},{name:"8",value:8},{name:"9",value:9},{name:I["default"]("1年"),value:12},{name:I["default"]("2年"),value:24},{name:I["default"]("3年"),value:36}];this.set("purchaseLenDatasource",e)},n.prototype.prepareFlavor=function(){var e=this.get("instance"),t=this.get("image"),a=P["default"].isRegionHK(),i=0,n=0,s=g.InstanceType.DEFAULTIII,r=N["default"].getCpu("prepay",s),o=N["default"].getMemory("","prepay",s),c=this.get("zoneDatasource"),l=this.get("zoneIndex")||0,d=this.get("flavorList"),u=N["default"].getGpuCardByApi(d,c[l].value),p=[],f=0,m=1;e?(r=N["default"].getCpu(e.payment,e.instanceType),o=N["default"].getMemory(+e.cpu,e.payment,e.instanceType),i=Math.max(x["default"].indexOf(r,+e.cpu),0),n=Math.max(x["default"].indexOf(o,+e.memory),0),(s=e.instanceType)===g.InstanceType.GPU&&(f=Math.max(I["default"].findIndex(u,function(t){return t.value===e.gpuCard}),0),m=+e.gpuCount)):t&&(t.instanceType&&(s=t.instanceType),t.imageType&&(x["default"].contains([g.ImageType.FPGAIMAGE,g.ImageType.FPGACUSTOM],t.imageType)&&(s=g.InstanceType.FPGA),x["default"].contains([g.ImageType.GPU_BCC_IMAGE,g.ImageType.GPU_BCC_CUSTOM],t.imageType)&&(s=g.InstanceType.GPU)),r=N["default"].getCpu("prepay",s),o=N["default"].getMemory(+t.cpu,"prepay",s),i=Math.max(x["default"].indexOf(r,+t.cpu),0),n=Math.max(x["default"].indexOf(o,+t.memory),0),s===g.InstanceType.GPU&&(f=Math.max(I["default"].findIndex(u,function(e){return e.value===t.gpuCard}),0),m=+t.gpuCount)),x["default"].contains(c[l].bccInstanceTypes,s)||(l=Math.max(I["default"].findIndex(c,function(e){return x["default"].contains(e.bccInstanceTypes,s)}),0),s===g.InstanceType.GPU&&(u=N["default"].getGpuCardByApi(d,c[l].value)));var h=x["default"].filter(g.InstanceType.toArray("DEFAULTIII","DEFAULTII","DEFAULT","CALCULATION","STORAGE","FPGA","GPU"),function(e){return x["default"].contains(c[l].bccInstanceTypesForShow,e.value)}),v=x["default"].each(h,function(e){e.disable=!x["default"].contains(c[l].bccInstanceTypes,e.value),e.popover=R["default"].instance.instanceType[e.value],e.value!==g.InstanceType.FPGA&&e.disable?e.popover="售罄！请您移步其他可用区购买资源。":e.value===g.InstanceType.FPGA&&e.disable&&(e.popover+='<a href="https://cloud.baidu.com/survey/FPGAnewApply.html" target="_blank">申请公测></a>')});u[f=!u[f]||u[f].disable?I["default"].findIndex(u,function(e){return!e.disable}):f]&&(p=N["default"].getGpuCount(u[f].value)),this.set("isRegionHK",a),this.set("cpuDatasource",r),this.set("memoryDatasource",o),this.set("cpuIndex",i),this.set("memoryIndex",n),this.set("maxDiskSize",a?300:500),this.set("minDiskSize",t&&t.diskSize?t.diskSize:0),this.set("instanceTypeValue",s),this.set("instanceTypeDatasource",v),this.set("zoneIndex",l),this.set("gpuCardDatasource",u),this.set("gpuCountDatasource",x["default"].map(p,function(e){return{name:e,value:e}})),this.set("gpuCardIndex",f),this.set("gpuCountIndex",Math.max(x["default"].indexOf(p,m),0))},n.prototype.prepareImageType=function(){var e=this.get("instance"),t=this.get("image"),a=g.ImageType.toArray("COMMON","CUSTOM","INTEGRATION","SHARING","MKT"),i=0;x["default"].contains(["fsh","hkg","fwh"],E["default"].getCurrentRegion().id)&&(a=g.ImageType.toArray("COMMON","CUSTOM","INTEGRATION","SHARING")),e&&e.instanceType===g.InstanceType.FPGA?(a=g.ImageType.toArray("FPGAIMAGE","FPGACUSTOM"),i=Math.max(x["default"].indexOf(x["default"].pluck(a,"value"),e.imageType),0)):e&&e.instanceType===g.InstanceType.GPU?(a=g.ImageType.toArray("GPU_BCC_IMAGE","GPU_BCC_CUSTOM","SHARING"),i=Math.max(x["default"].indexOf(x["default"].pluck(a,"value"),e.imageType),0)):t?(x["default"].contains([g.ImageType.FPGAIMAGE,g.ImageType.FPGACUSTOM],t.imageType)||t.instanceType===g.InstanceType.FPGA?a=g.ImageType.toArray("FPGAIMAGE","FPGACUSTOM"):(x["default"].contains([g.ImageType.GPU_BCC_IMAGE,g.ImageType.GPU_BCC_CUSTOM],t.imageType)||t.instanceType===g.InstanceType.GPU)&&(a=g.ImageType.toArray("GPU_BCC_IMAGE","GPU_BCC_CUSTOM","SHARING")),i=Math.max(x["default"].indexOf(x["default"].pluck(a,"value"),t.imageType),0)):this.get("productId")&&!x["default"].contains(["fsh","hkg","fwh"],E["default"].getCurrentRegion().id)&&(i=Math.max(x["default"].indexOf(x["default"].pluck(a,"value"),g.ImageType.MKT),0)),this.set("imageTypeList",a),this.set("imageTypeIndex",i)},n.prototype.prepareDisk=function(){var e=this.get("zoneDatasource"),t=g.DiskType.toArray(),a=[];x["default"].each(e,function(e){return a=a.concat(e.cdsTypes)}),a=x["default"].uniq(a);var i=[];x["default"].each(t,function(e){x["default"].contains(a,e.value)&&i.push(e)}),this.set("diskType",i)},n.prototype.getPrePurchaseValidation=function(){var e=this;return D["default"].enable_baixin?(this.set("prePurchaseValid",{status:!0,failReason:""}),S["default"].resolve()):m.api.accountPurchaseValidation({serviceType:"BCC",productType:"prepay"},L).then(function(t){return e.set("prePurchaseValid",t)}).fail(function(t){e.set("prePurchaseValid",{status:!1,failReason:"余额检查异常，请刷新后重试"})})},n.prototype.getPosPurchaseValidation=function(){var e=this;return D["default"].enable_baixin?(this.set("posPurchaseValid",{status:!0,failReason:""}),S["default"].resolve()):m.api.accountPurchaseValidation({serviceType:"BCC",productType:"postpay"},L).then(function(t){return e.set("posPurchaseValid",t)}).fail(function(t){e.set("posPurchaseValid",{status:!1,failReason:"余额检查异常，请刷新后重试"})})},n.prototype.getPrice=function(e){e.ephemeralSizeGb=e.diskSize;var t={purchaseNum:e.purchaseNum,purchaseLength:e.purchaseLength,bcc:I["default"].pick(e,"productType","instanceType","cpu","memory","ephemeralSizeGb","fpgaCard","fpgaCount","containsFpga","gpuCard","gpuCount","rootDiskSizeInGb","rootDiskStorageType")};if(e.ebsSize){var a=I["default"].map(e.ebsSize,function(e){return{sizeInGB:e.size,storageType:e.volumeType,snapshotId:e.snapshotId}});I["default"].extend(t,{cds:{productType:e.productType,diskConfigs:a}})}return"1"===e.ifBuyEip&&I["default"].extend(t,{eip:{productType:e.subProductType?g.ProductType.POSTPAY:g.ProductType.PREPAY,subProductType:e.subProductType,bandwidthInMbps:e.bandwidthInMbps}}),e.productId&&e.imageType===g.ImageType.MKT&&I["default"].extend(t,{mkt:{productType:e.subProductType?g.ProductType.POSTPAY:g.ProductType.PREPAY,imageId:e.imageId,productId:e.productId,packageId:e.packageId}}),m.api.bccInstancePriceV2(t,L)},n.prototype.getSnapshotsList=function(){var e=this;return m.api.bccSnapshotList({diskType:m.DISK_TYPE.CDS,orderBy:"createTime"},L).then(function(t){var a=t.result||[];return a=x["default"].filter(a,function(e){return e.status===g.DiskStatus.AVAILABLE||_["default"].isRocV2Disk(e)&&e.status===g.DiskStatus.ACTIVE}),e.set("snapshots",a),a})},n.prototype.getImageList=function(e){var t=this,a="os"+I["default"].capitalize(e[0]),i={imageTypes:e,keyword:"active",keywordType:"status"};return I["default"].contains(e,"common")&&I["default"].extend(i,{orderBy:"osVersion",order:"desc"}),m.api.bccImageList(i,L).then(function(e){return t.set(a,e.result),e.result})},n.prototype.getAllSecurityGroups=function(e){var t=this;return m.api.bccSecurityListSelect({vpcId:e},L).then(function(e){return e.result}).then(function(e){var a=x["default"].map(e,function(e){return{name:e.name,value:e.id,desc:e.desc}});t.set("securityGroups",a);var i=0;if(a.length>0)for(var n=a.length-1;n>=0;n--)if("默认安全组"===a[n].name){i=n;break}return t.set("securityGroupsSelectedIndex",i),a})},n.prototype.getVpcList=function(){var e=this;return m.api.vpcList({},L).then(function(t){e.set("rawVpcData",t);var a=[];return x["default"].each(t||[],function(e){var t=w["default"].getVpcName(e.name)+(e.cidr?"（"+e.cidr+"）":"");a.push({value:e.vpcId,text:t,title:t,defaultVpc:e.defaultVpc})}),e.set("vpcDatasource",a),a})},n.prototype.getSubnetList=function(e,t){var a=this;return m.api.subnetList({vpcId:e,zone:t,subnetTypes:[1,3]},L).then(function(e){var t=[];return x["default"].each(e,function(e){var a=w["default"].getSubnetName(e.name)+(e.cidr?"（"+e.cidr+"）":"");t.push({value:e.subnetId,text:a,title:a,subnetType:e.subnetType})}),a.set("subnetDatasource",t),t})},n.prototype.getKeypairList=function(){var e=this;return m.api.sshList({pageNo:1,pageSize:500},L).then(function(t){var a=[{text:"选择密钥对",value:""}];return x["default"].each(t.result,function(e){a.push({text:e.name,value:e.keypairId})}),e.set("keyPairList",a),a})},n.prototype.getAspList=function(){var e=this;return m.api.aspList({pageNo:1,pageSize:1e3,orderBy:"createTime",order:"desc"},L).then(function(t){var a=[];return x["default"].each(t.result,function(e){a.push({text:e.name,value:e.aspId})}),e.set("aspList",a),a})},n.prototype.prepareDataForOs=function(e){var t=this,a=this.get("_osData");a||(a=this.getOsData());var i=undefined,n=undefined,s=undefined,r=undefined,o=undefined,c=undefined,l=undefined,d=this.get("imageTypeList");x["default"].each(d,function(e){var a=I["default"].capitalize(e.value);e.value!==g.ImageType.MKT&&(e.disable=0===t.get("os"+a).length)});var u=e&&this.getImageTypeById(e);if(u)i=u.key,n=Math.max(x["default"].indexOf(x["default"].pluck(d,"value"),i),0),s=u.osName,o=a.osTypeMap[i],x["default"].find(o,function(e,t){if(e.name===s)return r=t,!0}),l=a.osVersionMap[i][s],x["default"].find(l,function(t,a){if(t.imageId===e)return c=a,!0});else if(this.get("mktImage"))i=g.ImageType.MKT,n=Math.max(x["default"].indexOf(x["default"].pluck(d,"value"),i),0),e=this.get("mktImage").imageId;else{i=g.ImageType.COMMON;var p=this.get("image");if(p&&p.instanceType)switch(p.instanceType){case g.InstanceType.GPU:i=g.ImageType.GPU_BCC_IMAGE;break;case g.InstanceType.FPGA:i=g.ImageType.FPGAIMAGE}n=0,o=a.osTypeMap[i],s=o[r=0].name,l=a.osVersionMap[i][s],e=l[c=0].imageId}this.set("osTypeList",o),this.set("osVersionList",l),this.set("osTypeIndex",r),this.set("osVersionIndex",c),this.set("imageTypeIndex",n),this.set("imageId",e)},n.prototype.getImageTypeById=function(e){var t=this,a=undefined,i=x["default"].find(["Common","Custom","Integration","Sharing","FpgaImage","FpgaCustom","GpuBccImage","GpuBccCustom"],function(i){return!!(a=x["default"].find(t.get("os"+i),function(t){return t.id===e}))});return a?{originData:a,minDiskSize:a.ephemeralSize,minMem:a.minMem,minCpu:a.minCpu,osName:a.osName,osVersion:a.osVersion,key:I["default"].camelCase(i),minDiskGb:a.minDiskGb}:a},n.prototype.getOsData=function(){var e=this,t={common:[],custom:[],integration:[],sharing:[],fpgaImage:[],fpgaCustom:[],gpuBccImage:[],gpuBccCustom:[]},a={common:{},custom:{},integration:{},sharing:{},fpgaImage:{},fpgaCustom:{},gpuBccImage:{},gpuBccCustom:{}};if(x["default"].each(g.ImageType.toArray(),function(i){var n=I["default"].capitalize(i.value);e.get("os"+n)&&_["default"].formatOsData(i.value,e.get("os"+n),t,a)}),t.gpuBccImage.length){var i=I["default"].remove(t.gpuBccImage,function(e){return"ubuntu"===e.name.toLowerCase()});t.gpuBccImage=[].concat(i,t.gpuBccImage)}return this.set("_osData",{osTypeMap:t,osVersionMap:a}),{osTypeMap:t,osVersionMap:a}},n.prototype.setRegion=function(e){return m.api.setRegion({regionId:e})},n.prototype.getExtraData=function(){return{osName:this.get("osName"),money:this.get("money"),securityGroupName:this.get("securityGroupName"),orderUuid:this.get("orderUuid")}},n.prototype.filterData=function(e){var t=this.get("zoneDatasource"),a=x["default"].find(t,function(t){return t.value===e.logicalZone});return e.instanceType===g.InstanceType.FPGA&&(e.fpgaCount=1),a.cdsTypes.length<1&&(e.ebsSize=[]),e.nameType===m.PASSWORD_TYPE.RANDOM&&(e.name=undefined),e.adminPassType===m.PASSWORD_TYPE.RANDOM&&(e.adminPass=undefined,e.adminPassConfirm=undefined),e.adminPassType===m.PASSWORD_TYPE.CUSTOM&&D["default"].enable_rsa_encrypt&&e.adminPass&&e.adminPassConfirm&&(e.adminPass=A["default"].rsaEncrypt(e.adminPass),e.adminPassConfirm=e.adminPass),e.adminPassType===m.PASSWORD_TYPE.SSH&&(e.keypairId=e.keypair,delete e.keypair),e.ifBuyEip&&(e.ifBuyEip=e.ifBuyEip[0]),"on"===e.flavorCustomCheck&&(e.cpu=+e.cpuCustom,e.memory=+e.memoryCustom),e.autoRenew||(e.autoRenewTime=0),e.autoRelease?e.releaseTime=k["default"].local2utc(e.releaseTime):delete e.releaseTime,e.containsFpga="on"!==e.withoutFPGA,x["default"].each(e.tagIndexList,function(t){delete e["tagKey"+t],delete e["tagValue"+t]}),delete e.tagIndexList,delete e.nameType,delete e.adminPassType,e},t["default"](n,[{key:"datasource",get:function(){return{natWhiteList:function(e){return!D["default"].enable_baixin&&m.api.natWhiteList({},{"X-silence":!0}).then(function(e){return e})},tips:function(){return R["default"]},osData:[{osIntegration:function(){return[]},osCommon:function(){return[]},osCustom:function(){return[]}}],snapshots:function(){return[]},securityGroups:function(e){return[{name:"加载中...",value:""}]},quota:function(e){return m.api.bccQuota({objType:"bcc",needGlobalQuota:!0})},eipQuota:function(e){return m.api.eipInstanceQuota().then(function(e){return e.eipCreateAble=e.quotaTotal>=e.eipCreated,e})},instanceQuotaCheck:function(){return!0},instance:function(e){var t=e.get("instanceId");return t?m.api.bccInstanceDetail({instanceId:t}):null},image:function(e){var t=x["default"].pick(e.store,"cpu","memory","imageType","imageId","osName","osType","osVersion","diskSize","instanceType","gpuCard","gpuCount");if(!x["default"].isEmpty(t))return t},mktImage:function(e){var t=e.get("productId"),a=e.get("packageId"),i=e.get("periodId");if(t&&a&&i)return e.getMKTImageDetail({productId:t,packageId:a,periodId:i})},diskType:function(e){return x["default"].deepClone(g.DiskType.toArray("SATA","SSD"))},vpcDatasource:function(e){return[]},subnetDatasource:function(e){return[]},zoneDatasource:function(e){return m.api.getZoneListV3().then(function(t){return x["default"].map(t,function(t,a){return t.defaultZone&&e.set("zoneIndex",a),{value:t.zone,name:t.zone.replace(/zone/g,"可用区"),cdsTypes:t.cdsTypes,ephemeralDiskTypes:t.ephemeralDiskTypes||[],bccInstanceTypes:t.bccInstanceTypes||[],bccInstanceTypesForShow:t.bccInstanceTypesForShow||[]}})})},bccWhite:function(e){return JSON.parse(C["default"].get("whiteTags"))},isSysCdsRequiredRegion:function(e){return P["default"].isSysCdsRequiredRegion()},tagList:function(e){return m.api.getSearchTagList({serviceType:[],region:["global"]}).then(function(t){var a=x["default"].uniq(x["default"].pluck(t,"tagKey")),i=x["default"].uniq(x["default"].pluck(t,"tagValue"));e.set("tagKeys",x["default"].map(a,function(e){return{name:e,value:e}})),e.set("tagValues",x["default"].map(i,function(e){return{name:e,value:e}}));var n=x["default"].groupBy(t,"tagKey");return x["default"].each(n,function(e,t){n[t]=x["default"].map(e,function(e){return{name:e.tagValue,value:e.tagValue}})}),n})},flavorList:function(e){return m.api.getFlavorList({}).then(function(e){return e})}}}}]),n}(T["default"]);module.exports=$}),define("bcc/instance/create/tpl",[],function(){return'\x3c!-- target: TPL_bcc_instance_create --\x3e\n<div class="bcc-purchase bcc-instance-create bcc-main-wrap main-wrap-new bcc-main-1col">\n    \x3c!-- import: TPL_inf_ria_page_breadcrumb --\x3e\n        \x3c!-- block: back_link --\x3e#/bcc/instance/list\x3c!-- /block --\x3e\n        \x3c!-- block: create_step --\x3e\n            <div data-ui-type="ViewStep"\n                 data-ui-id="buyStep"\n                 data-ui-current-step="1">\n                <ul>\n                    <li bind-for="buyBcc">${i18n.选择云服务器}</li>\n                    <li bind-for="orderConfirm">${i18n.确认订单}</li>\n                    <li>${i18n.在线支付}</li>\n                    <li>${i18n.支付成功}</li>\n                </ul>\n            </div>\n        \x3c!-- /block --\x3e\n    \x3c!-- /import --\x3e\n    <div class="content-wrap">\n        <div class="create-content create-content-wrapper">\n            <div id="buyBcc" class="bcc-instance-buybcc">\n                <div class="ui-tab-content">\n                    <div class="create-main">\n                        <form class="setting-form"\n                            data-ui-type="Form"\n                            data-ui-id="form">\n                            <div data-ui-id="buyBucket" data-ui-type="BuyBucket" data-track-id="ti_bcc_instance_buybucket_clear" data-track-name="清空配置"></div>\n                            <div class="detail-parts-table">\n                                \x3c!-- import: bcc_instance_create_zone--\x3e\n                                \x3c!-- import: bcc_instance_create_configuration --\x3e\n                                \x3c!-- import: bcc_instance_create_storage --\x3e\n                                \x3c!-- import: bcc_instance_create_eip --\x3e\n                                \x3c!-- import: bcc_instance_create_network --\x3e\n                                \x3c!-- import: bcc_instance_create_tag --\x3e\n                                \x3c!-- import: bcc_instance_create_systeminfo --\x3e\n                                \x3c!-- import: bcc_instance_create_buyinfo --\x3e\n                            </div>\n                        </form>\n                    </div>\n                </div>\n            </div>\n            <div id="buyEip">\n                <div data-ui="id:eipAction;type:ActionPanel" class="clearfix ui-tab-content"></div>\n            </div>\n            <div id="orderConfirm" class="order-confirm-panel">\n                <div data-ui="id:orderAction;type:ActionPanel"></div>\n            </div>\n        </div>\n    </div>\n</div>\n\n\x3c!-- target: bcc_instance_create_zone--\x3e\n<dl class="detail-create-settings detail-create detail-part-1-col">\n    <dt><h4>${i18n.付费及地域}</h4></dt>\n    <dd>\n        <label>${i18n.付费方式：}</label>\n        <div>\n            <div data-ui-type="RadioSelect"\n                data-ui-id="productType"\n                data-ui-name="productType"\n                data-track-id="ti_bcc_instance_create_producttype"\n                data-track-name="付费方式"></div>\n        </div>\n    </dd>\n    <dd>\n        <label>当前地域：</label>\n        <div>\n            <span data-ui-type="RadioSelect"\n                data-ui-id="region"\n                data-ui-name="region"></span>\n        </div>\n    </dd>\n    <dd class="zone">\n        <label>可用区：</label>\n        <div>\n            <span data-ui-type="RadioSelect"\n                data-ui-id="logicalZone"\n                data-ui-name="logicalZone"\n                data-track-id="ti_bcc_instance_create_logicalzone"\n                data-track-name="可用区"></span>\n                <span data-ui-type="Tip"\n                    data-ui-content="${i18n.可用区是指在同一区域下，电力和网络互相独立的区域，故障会被隔离在一个可用区内。如果您的应用程序需要更高的高可用性，建议您将云服务创建在不同的可用区内。}<a href=\'https://cloud.baidu.com/doc/Reference/Regions.html#.E5.8F.AF.E7.94.A8.E5.8C.BA\' target=\'_blank\'>${i18n.了解详情。}</a>"\n                    data-ui-skin="warning"\n                    class="doc-link"\n                    data-track-id="ti_bcc_instance_create_zone_tip" data-track-name="可用区提示"></span>\n        </div>\n    </dd>\n</dl>\n\n\x3c!-- target: bcc_instance_create_configuration --\x3e\n<dl class="detail-create-settings detail-create detail-part-1-col">\n    <dt><h4>${i18n.配置}</h4></dt>\n    <dd>\n        <label>${i18n.云服务器类型：}</label>\n        <div>\n            <div data-ui-id="instanceType"\n                data-ui-name="instanceType"\n                data-ui-type="RadioSelect"\n                data-ui-extension-popover-type="PopoverEx"\n                class="ui-radioselect-custom bcc-instance-type"\n                data-track-id="ti_bcc_instance_create_instancetype"\n                data-track-name="云服务器类型"></div>\n        </div>\n    </dd>\n    <dd data-ui-type="Panel" data-ui-id="fpgaPanel" \x3c!-- if: ${instance.instanceType} !== \'8\' --\x3edata-ui-hidden="true" \x3c!-- /if --\x3e>\n        <label>FPGA：</label>\n        <div>\n            <div data-ui-id="fpgaCard"\n                data-ui-name="fpgaCard"\n                data-ui-type="RadioSelect"\n                class="ui-radioselect-custom"\n                data-track-id="ti_bcc_instance_create_fpgacard"\n                data-track-name="FPGA卡"></div>\n        </div>\n    </dd>\n    <dd data-ui-type="Panel" data-ui-id="gpuCardPanel" \x3c!-- if: ${instance.instanceType} !== \'9\' --\x3edata-ui-hidden="true" \x3c!-- /if --\x3e>\n        <label>${i18n.GPU型号：}</label>\n        <div>\n            <div data-ui-id="gpuCard"\n                data-ui-name="gpuCard"\n                data-ui-type="RadioSelect"\n                data-ui-extension-popover-type="PopoverEx"\n                class="ui-radioselect-custom"\n                data-track-id="ti_bcc_instance_create_gpucard"\n                data-track-name="GPU型号"></div>\n            <div data-ui-type="Tip"\n                data-ui-content="${tips.instance.gpuCard}"\n                class="doc-link"></div>\n        </div>\n    </dd>\n    <dd data-ui-type="Panel" data-ui-id="gpuCountPanel" \x3c!-- if: ${instance.instanceType} !== \'9\' --\x3edata-ui-hidden="true" \x3c!-- /if --\x3e>\n        <label>${i18n.GPU数量：}</label>\n        <div>\n            <div data-ui-id="gpuCount"\n                data-ui-name="gpuCount"\n                data-ui-type="RadioSelect"\n                class="ui-radioselect-custom"\n                data-track-id="ti_bcc_instance_create_gpucount"\n                data-track-name="GPU数量"></div>\n        </div>\n    </dd>\n    <dd>\n        <label>CPU：</label>\n        <div>\n            <div data-ui-id="cpu"\n                data-ui-name="cpu"\n                data-ui-type="RadioSelect"\n                class="ui-radioselect-custom cpu-setting"\n                data-track-id="ti_bcc_instance_create_cpu"\n                data-track-name="CPU"></div>\n            <div data-ui-type="Tip"\n                data-ui-content="${tips.instance.cpu}"\n                data-ui-skin="warning"\n                class="doc-link cpu-tip"></div>\n        </div>\n    </dd>\n    <dd>\n        <label>${i18n.内存：}</label>\n        <div>\n            <div data-ui-id="memory"\n                data-ui-name="memory"\n                data-ui-type="RadioSelect"\n                class="ui-radioselect-custom"\n                data-track-id="ti_bcc_instance_create_memory"\n                data-track-name="内存"></div>\n        </div>\n    </dd>\n    \x3c!-- if: ${bccWhite.isCustomVmFlavor} --\x3e\n    <dd>\n        <div class="flavor-custom">\n            <input type="checkbox"\n                data-ui-type="CheckBox"\n                data-ui-name="flavorCustomCheck"\n                data-ui-id="flavorCustomCheck"\n                data-track-id="ti_bcc_instance_create_flavorcustomcheck"\n                data-track-name="自定义配置"/><label>${i18n.自定义配置}</label>\n        </div>\n    </dd>\n    <dd data-ui-type="Panel" data-ui-id="flavorCustomPanel" data-ui-hidden="true">\n        <div class="flavor-custom">\n            <label>CPU</label>\n            <span data-ui-id="cpuCustom"\n                data-ui-name="cpuCustom"\n                data-ui-type="TextBox"\n                data-ui-width="60"\n                class="cpu-custom"></span>\n            <label class="memory-custom-label">${i18n.内存}</label>\n            <span data-ui-id="memoryCustom"\n                data-ui-name="memoryCustom"\n                data-ui-type="TextBox"\n                data-ui-width="60"></span>\n            <span data-ui-type="Validity"\n                data-ui-id="cpuCustomValidity" ></span>\n            <span data-ui-type="Validity"\n                data-ui-id="memoryCustomValidity" ></span>\n        </div>\n    </dd>\n    \x3c!-- /if --\x3e\n    <dd>\n        <label>${i18n.镜像类型：}</label>\n        <div>\n            <div data-ui-id="imageType"\n                 data-ui-name="imageType"\n                 data-ui-type="RadioSelect"\n                 data-ui-extension-popover-type="PopoverEx"\n                 class="ui-radioselect-custom"\n                 data-track-id="ti_bcc_instance_create_imagetype"\n                 data-track-name="镜像类型"></div>\n        </div>\n    </dd>\n    <dd data-ui-id="imagePanel" data-ui-type="Panel" class="bic-os">\n        <label>${i18n.操作系统：}</label>\n        <div>\n            <div class="ui-group ui-select-group">\n                <div data-ui-type="Select" data-ui-name="osType"\n                     data-ui-id="osType"\n                     data-track-id="ti_bcc_instance_create_ostype"\n                     data-track-name="osType"></div>\n                <div data-ui-type="Select" data-ui-name="osVersion"\n                     data-ui-id="osVersion" class="os-version" data-ui-extension-popover-type="PopoverEx"\n                     data-track-id="ti_bcc_instance_create_osversion"\n                     data-track-name="osVersion"></div>\n            </div>\n            <div data-ui-type="Tip"\n                 data-ui-id="osVersionTip"\n                 data-ui-hidden="true"\n                 data-ui-content="${tips.instance.osVersion}"\n                 data-ui-skin="warning"\n                 class="doc-link"></div>\n            <span data-ui-type="Label" data-ui-id="osDisksizeTip" data-ui-hidden="true" class="os-disksize-tip"></span>\n            <div class="behind-os" data-ui-type="Panel" data-ui-id="behindOS" \x3c!-- if: ${instance.instanceType} !== \'8\' --\x3edata-ui-hidden="true" \x3c!-- /if --\x3e>\n            <input type="checkbox"\n                   data-ui-type="CheckBox"\n                   data-ui-name="withoutFPGA"\n                   data-ui-id="withoutFPGA"\n                   data-track-id="ti_bcc_instance_create_withoutfpga"\n                   data-track-name="不带FPGA卡创建"/>${i18n.不带FPGA卡创建}\n            <div data-ui-type="Tip"\n                 data-ui-id="fpgatip"\n                 data-ui-arrow="true"\n                 class="doc-link image-tip"\n                 data-ui-content="${i18n.勾选此项后，可创建出不带FPGA卡的BCC实例。在开发阶段，您在不额外占用FPGA卡的前提下，依然可以使用开发环境的所有软件工具进行开发，待开发完成后，再通过自定义镜像功能新购带有FPGA卡的实例进行烧卡验证即可。}"></div>\n            </div>\n            <a target="_blank"\n               data-ui-id="osHelpLink"\n               data-ui-type="Link"\n               data-ui-hidden="true"\n               class="os_helplink"\n               href="http://bce.baidu.com/doc/BCC/Resources.html#.A8.AF.04.0F.7A.C0.66.72.DF.F3.53.E9.8C.5E.94.D2"\n               data-track-id="ti_bcc_instance_create_oshelplink"\n               data-track-name="镜像环境详情">\n                ${i18n.镜像环境详情}</a>\n            <a target="_blank"\n                data-ui-id="gpuOsHelpLink"\n                data-ui-type="Link"\n                data-ui-hidden="true"\n                class="os_helplink"\n                href="https://cloud.baidu.com/doc/GPU/GettingStarted.html#.E9.95.9C.E5.83.8F.E4.BD.BF.E7.94.A8">\n                 ${i18n.镜像环境详情}</a>\n            <a target="_blank"\n               data-ui-id="osProtocolLink"\n               data-ui-type="Link"\n               data-ui-hidden="true"\n               class="os_helplink"\n               href="http://bce.baidu.com/doc/BCC/Resources.html#.FB.81.0D.6E.08.3E.F1.B0.D7.0B.3A.8A.56.EA.42.84">\n                <input type="checkbox" disabled="disabled" checked="checked">&nbsp; ${i18n.确认《百度云镜像服务协议》}</a>\n            <div data-ui="type:Panel;id:osTip;hidden:true;" class="bcc-error">\n                ${i18n.镜像和系统信息加载失败，请}<span data-ui="type:Button;id:osReload;skin:stringfy;" class="bcc-error-reload">${i18n.刷新}</span>${i18n.重试。}\n            </div>\n            <div data-ui-type="Panel" data-ui-id="internalImageTip" data-ui-hidden="true" class="row-tip-grey">百度内部业务上云请选择 CentOS ： 6.3X86_64(64.bit)镜像，如有安装其他OS镜像的需求，请到<a href="http://security.baidu.com/myflaw/web/#/home" target="_blank">安全运维管理平台</a>进行备案</div>\n        </div>\n    </dd>\n    \x3c!-- if: ${bccWhite.isScriptFlavor} --\x3e\n    <dd>\n        <label>${i18n.脚本地址：}</label>\n        <div>\n            <input data-ui-type="TextBox"\n                data-ui-id="bccCreateWithScript"\n                data-ui-name="bccCreateWithScript"\n                data-ui-placeholder="${i18n.请输入脚本地址}"\n                data-ui-width="340" />\n            <div data-ui-type="Label" class="row-tip-grey">${i18n.支持输入一个脚本地址,以http://或https://开头}</div>\n        </div>\n    </dd>\n    \x3c!-- /if --\x3e\n    <dd data-ui-type="Panel"\n        data-ui-id="mktImagePanel"\n        class="mkt-image-container"></dd>\n</dl>\n\n\x3c!-- target: bcc_instance_create_storage --\x3e\n<dl class="detail-create-settings detail-create detail-part-1-col">\n    <dt><h4>${i18n.存储}</h4></dt>\n    <dd>\n        <label>${i18n.系统盘：}</label>\n        \x3c!--if: ${isSysCdsRequiredRegion} --\x3e\n        <div>\n            <div class="ui-group" style="margin-bottom:-6px;">\n                <div data-ui-id="rootDiskStorageType" data-ui-type="Select"\n                     class="ui-radioselect-custom"></div>\n                <div data-ui-type="Dragger" data-ui-id="rootDiskSizeInGb" data-ui-name="rootDiskSizeInGb" class="sys-disk-size"></div>\n            </div>\n            <div data-ui-type="Tip"\n                 data-ui-id="FPGARootDiskTip"\n                 data-ui-skin="warning"\n                 class="fpga-root-disk-tip"\n                 data-ui-hidden="true"\n                 data-ui-content="${i18n.FPGA云服务器系统盘大小默认100G。}"></div>\n        </div>\n        <div class="root-disk-tip row-tip-grey" data-ui-type="Label" data-ui-id="rootDiskStorageTip"></div>\n        \x3c!--else--\x3e\n        <div>\n            <div class="ui-group" style="margin-bottom:-6px;">\n            <span>\n                ${i18n.免费赠送 - Linux送20GB，Windows送40GB}\n            </span>\n            </div>\n        </div>\n        \x3c!--/if--\x3e\n    </dd>\n    <dd data-ui-type="Panel" data-ui-id="tempDiskPanel">\n        <label>${i18n.本地磁盘：}</label>\n        <div class="relative-field disk-size-field">\n            <div data-ui-type="Panel" data-ui-id="tempDiskPanelOn" class="temp-disk-on">\n                <button data-ui-type="Button"\n                    data-ui-id="tempDiskOn"\n                    type="button"\n                    data-track-id="ti_bcc_instance_create_tempdiskon"\n                    data-track-name="创建本地磁盘">${i18n.创建本地磁盘}</button>\n                <button data-ui-type="Button"\n                    data-ui-id="highTempDiskOn"\n                    type="button"\n                    data-track-id="ti_bcc_instance_create_hightempdiskon"\n                    data-track-name="创建高性能本地磁盘">${i18n.创建高性能本地磁盘}</button>\n                <span data-ui-type="Tip" data-ui-arrow="true" data-ui-id="tempDiskTypeTip"\n                     data-ui-content="${tips.instance.tempDiskTip}">\n                </span>\n            </div>\n            <div data-ui-type="Panel" data-ui-id="tempDiskPanelSet" data-ui-hidden="true" class="disk-size-set">\n                <div data-ui-id="diskSize" data-ui-name="diskSize"\n                    data-ui-type="Dragger" data-disk-type="ssd" class="temp-disk"></div>\n                <a href="javascript:void(0)" class="doc-link temp-disk-doc-link">\n                    <div data-ui-type="Tip" data-ui-arrow="true" data-ui-id="diskSizeTip"\n                         data-ui-content="${tips.instance.tempDiskSize.ssd}"></div>\n                </a>\n                <span class="form-field-tip">${i18n.请选择磁盘容量0}-${maxDiskSize}GB，${i18n.数值为5的倍数}</span>\n            </div>\n        </div>\n        <p class="bcc-color-red warn-text">${i18n.温馨提示：本地盘有丢失数据的风险，如果您的应用不能做到数据可靠性的架构，建议您使用云磁盘}</p>\n    </dd>\n    <dd data-ui-type="Panel" data-ui-id="fixedTempDiskPanel" data-ui-hidden="true">\n        <label>${i18n.本地磁盘：}</label>\n        <div class="disk-size-show">\n            <span data-ui-type="Label" data-ui-id="fixedTempDisk">450</span>GB\n            <span class="row-tip-grey">${i18n.（暂不支持自主选择）}</span>\n        </div>\n        <p class="bcc-color-red warn-text">${i18n.温馨提示：本地盘有丢失数据的风险，如果您的应用不能做到数据可靠性的架构，建议您使用云磁盘}</p>\n    </dd>\n    <dd data-ui-id="ebsSelloutPanel" data-ui-type="Panel" data-ui-hidden="true">\n        <label>${i18n.CDS云磁盘：}</label>\n        <div><span>${i18n.已售罄}</span> <span data-ui-type="Tip" data-ui-arrow="true" data-ui-id="cdsSellOutTip"\n            data-ui-content="${tips.cds.sellOutTip}"></span></div>\n    </dd>\n    <dd data-ui-id="ebsSetPanel" data-ui-type="Panel" id="ebsSizeWrapper" data-index="0" class="ebsSize">\n        <label>${i18n.CDS云磁盘：}</label>\n        <div>\n            <div data-ui="id:ebsSize;name:ebsSize;type:BccCreateMethod;" class="ebs-main"></div>\n                <div data-ui-type="Tip" data-ui-arrow="true"\n                    data-ui-content="${tips.instance.cds}"  class="ebs-doc-link">\n                </div>\n            <p class="row-tip-grey">${i18n.一个实例最多只能挂载}${quota.cdsRatio}${i18n.块磁盘}</p>\n            <p class="row-tip-grey">${tips.cds.howToSelectTip | raw}</p>\n            <p id="ebsSizeError" data-for="form-error" class="bcc-error"></p>\n        </div>\n    </dd>\n    <dd>\n        <label>${i18n.绑定快照策略：}</label>\n        <div>\n            <div data-ui-type="ToggleButton"\n              data-ui-id="autoSnaphot"\n              data-ui-name="autoSnaphot"\n              data-ui-checked="true"></div>\n        </div>\n    </dd>\n    <dd data-ui-id="aspPanel" data-ui-type="Panel">\n        <label>${i18n.选择快照策略：}</label>\n        <div>\n            <div data-ui-id="asp"\n                 data-ui-name="aspId"\n                 data-ui-type="Select"\n                 data-ui-width="200"></div>\n            <span data-ui="type:Button;id:createAsp;skin:stringfy;" class="create-asp">+ ${i18n.创建快照策略}</span>\n            <span data-ui="type:Panel;id:aspTip;hidden:true;" class="bcc-error">\n                ${i18n.加载失败，请}<span data-ui="type:Button;id:aspReload;skin:stringfy;" class="bcc-error-reload">${i18n.刷新}</span>${i18n.重试。}\n            </span>\n            <label data-ui-type="Validity"\n                   data-ui-id="aspValidity"></label>\n        </div>\n    </dd>\n</dl>\n\n\x3c!-- target: bcc_instance_create_eip --\x3e\n<dl class="detail-create-settings detail-create detail-part-1-col">\n    <dt><h4>${i18n.弹性资源}</h4></dt>\n    <dd>\n        <label class="required-label">${i18n.公网IP：}</label>\n        <div>\n            <div data-ui-type="BoxGroup"\n                data-ui-id="ifBuyEip"\n                data-ui-name="ifBuyEip"\n                data-ui-box-type="radio" class="buy-eip" data-ui-extension-autovalidate-type="AutoValidate"\n                data-ui-extension-autovalidate-events="input,change"\n                data-track-id="ti_bcc_instance_create_ifbuyeip"\n                data-track-name="公网IP"></div>\n        </div>\n        <div data-ui-type="Label" class="row-tip-grey">${tips.instance.buyEipTip}</div>\n    </dd>\n    <dd class="eip-relative">\n        <label>${i18n.名称：}</label>\n        <div>\n            <input data-ui-type="TextBox"\n                data-ui-id="eipName"\n                data-ui-name="eipName"\n                data-ui-placeholder="${i18n.请输入公网IP名称}"\n                data-ui-width="240" />\n            <div data-ui-type="Label" data-ui-id="eipNameTip" class="row-tip-grey"></div>\n        </div>\n    </dd>\n    <dd data-ui-type="Panel" data-ui-id="networkTypePanel" class="eip-network-type eip-relative">\n        <label class="required-label">${i18n.公网带宽：}</label>\n        <div>\n            <div data-ui-id="networkType"\n                data-ui-name="subProductType"\n                data-ui-type="RadioSelect"\n                data-track-id="ti_bcc_instance_create_networktype"\n                data-track-name="公网带宽"></div>\n            <label data-ui-type="Label" data-ui-id="subProductTypeTip" class="row-tip-grey"></label>\n        </div>\n    </dd>\n    <dd data-ui-type="Panel" data-ui-id="networkPanel" class="eip-bandwidth eip-relative">\n        <label class="required-label"><span class="eip-bandwidth-title">${i18n.带宽峰值}</span></label>\n        <div>\n            <div data-ui-id="network"\n                data-ui-name="bandwidthInMbps"\n                data-ui-type="Dragger"></div>\n        </div>\n    </dd>\n</dl>\n\n\x3c!-- target: bcc_instance_create_network --\x3e\n<dl class="detail-create-settings detail-create detail-part-1-col">\n    <dt><h4>${i18n.网络}</h4></dt>\n    <dd>\n        <label class="required-label">${i18n.网络类型：}</label>\n        <div>\n            <div class="ui-group ui-select-group">\n                <div data-ui-type="Select" data-ui-id="vpc" class="vpc-select"></div>\n                <div data-ui-type="Select" data-ui-id="subnet" data-ui-name="subnetUuid"></div>\n            </div>\n            <div data-ui-type="Tip"\n                 data-ui-id="subnetTip"\n                 data-ui-hidden="true"\n                 data-ui-content="注：该子网为NAT专属子网，子网中的BCC不允许绑定EIP"\n                 data-ui-skin="warning"\n                 class="doc-link">\n            </div>\n            <div data-ui="type:Panel;id:vpcTip;hidden:true;" class="bcc-error bcc-vpc-error">\n                ${i18n.加载失败，请}<span data-ui="type:Button;id:vpcReload;skin:stringfy;" class="bcc-error-reload">${i18n.刷新}</span>${i18n.重试。}\n            </div>\n            <div data-ui="type:Panel;id:subnetEmptyTip;hidden:true;" class="bcc-error bcc-vpc-error">\n                ${i18n.该自定义私有网络中没有子网，请先}<span data-ui-type="Label" data-ui-id="createSubnet" class="create-subnet-label">${i18n.创建子网}</span>${i18n.或者选择其他私有网络}\n            </div>\n        </div>\n    </dd>\n    <dd>\n        <label>${i18n.安全组：}</label>\n        <div>\n            <div data-ui-id="securityGroups"\n                 data-ui-name="securityGroupId"\n                 data-ui-type="Select"\n                 data-ui-width="200"\n                 data-ui-selected-index="@securityGroupsSelectedIndex"\n                 data-ui-datasource="@securityGroups"\n                 data-track-id="ti_bcc_instance_create_securitygroup"\n                 data-track-name="安全组"></div>\n            <div data-ui="type:Panel;id:securityTip;hidden:true;" class="bcc-error bcc-security-error">\n                ${i18n.加载失败，请}<span data-ui="type:Button;id:securityReload;skin:stringfy;" class="bcc-error-reload">${i18n.刷新}</span>${i18n.重试。}\n            </div>\n            <div data-ui-type="Label"\n                 data-ui-id="securityGroupTips"\n                 class="security-group-tip row-tip-grey">${tips.instance.secureTip | raw}</div>\n        </div>\n    </dd>\n</dl>\n\n\x3c!-- target: bcc_instance_create_tag --\x3e\n<dl class="detail-create-settings detail-create detail-part-1-col create-tag">\n    <dt><h4>${i18n.标签}</h4></dt>\n    <dd>\n        <label>${i18n.绑定标签：}</label>\n        <div id="tagEditContainer">\n            \x3c!-- import: TPL_bcc_instance_tag_edit_item --\x3e\n        </div>\n        <div class="tag-tip">\n            <div data-ui="type:Label;id:tagKeyTip;"></div>\n            <div data-ui="type:Label;id:tagValueTip;"></div>\n        </div>\n    </dd>\n    <dd>\n        <div>\n            <button data-ui-type="Button" data-ui-id="addTag"\n                type="button" data-ui-skin="create">${i18n.添加标签}</button>\n            <a href="https://cloud.baidu.com/doc/BCC/GettingStarted.html#.E6.A0.87.E7.AD.BE.E7.AE.A1.E7.90.86" \n                target="_blank" class="help-doc"><i class="iconfont icon-warning-new"></i>${i18n.帮助文档}</a>\n            <span data-ui="type:Label;id:tagTip;" class="tag-tip-red"></span>\n        </div>\n        <div data-ui-type="Label" class="security-group-tip row-tip-grey">${i18n.温馨提示：标签支持您按各种标准（如用途、所有者或项目）对资源进行分类；每个标签包含键和值两部分}</div>\n    </dd>\n    <dd>\n        <div>\n            <label>${i18n.其关联资源CDS、EIP统一加标签：}</label>\n            <div data-ui-type="ToggleButton" data-ui-id="relationTag" \n                data-ui-name="relationTag" data-ui-checked="true"></div>\n        </div>\n    </dd>\n</dl>\n\n\x3c!-- target: bcc_instance_create_systeminfo --\x3e\n<dl class="detail-create-systeminfo detail-create detail-part-1-col">\n    <dt><h4>${i18n.系统信息}</h4></dt>\n    <dd>\n        <label>${i18n.实例名称：}</label>\n        <div>\n            <div data-ui="type:RadioSelect;id:nameType;name:nameType;" class="ui-radioselect-custom"\n            data-track-id="ti_bcc_instance_create_nametype"\n            data-track-name="实例名称"></div>\n            <div data-ui="type:Panel;id:namePanel;hidden:true;" class="cb">\n                <input data-ui-type="TextBox"\n                       data-ui-id="name"\n                       data-ui-name="name"\n                       data-ui-validity-label="nameValidity"\n                       data-ui-placeholder="${i18n.请输入名称}"\n                       data-ui-width="240" />\n                <label data-ui-type="Validity"\n                       data-ui-id="nameValidity"></label>\n                <div data-ui-type="Label" data-ui-id="nameTip" class="row-tip-grey"></div>\n            </div>\n        </div>\n    </dd>\n    <dd data-ui="type:Panel;id:adminNamePanel;">\n        <label>${i18n.管理用户名：}</label>\n        <div>\n            <span data-ui="type:Label;id:adminName;" class="bcc-admin-name"></span>\n        </div>\n    </dd>\n    <dd>\n        <label class="required-label">${i18n.管理员密码：}</label>\n        <div>\n            <div data-ui="type:RadioSelect;id:adminPassType;name:adminPassType;" class="ui-radioselect-custom"\n            data-track-id="ti_bcc_instance_create_adminpasstype"\n            data-track-name="管理员密码"></div>\n            <div data-ui-type="Tip"\n                 data-ui-id="adminPassTypeTip"\n                 data-ui-content="${tips.instance.ssh}"\n                 data-ui-skin="warning"\n                 class="doc-link"></div>\n            <div data-ui="type:Panel;id:adminPassPanel;" class="cb">\n                <div>\n                    <input type="password"\n                           data-ui-type="TextBox"\n                           data-ui-id="adminPass"\n                           data-ui-name="adminPass"\n                           data-ui-placeholder="${i18n.请输入密码}"\n                           data-ui-custom-error-message="${i18n.密码不符合规则}"\n                           data-ui-validity-label="passValidity"\n                           data-ui-width="240"\n                           autocomplete="off" />\n                    <label data-ui-type="Validity"\n                           data-ui-id="passValidity"></label>\n                    <div data-ui-type="Label" data-ui-id="adminPassTip" class="row-tip-grey"></div>\n                </div>\n                <div>\n                    <input type="password"\n                           data-ui-type="TextBox"\n                           data-ui-id="adminPassConfirm"\n                           data-ui-name="adminPassConfirm"\n                           data-ui-placeholder="${i18n.请再次输入密码}"\n                           data-ui-validity-label="confirmValidity"\n                           data-ui-width="240"\n                           autocomplete="off" />\n                    <label data-ui-type="Validity"\n                           data-ui-id="confirmValidity"></label>\n                </div>\n            </div>\n            <div data-ui="type:Label;id:adminPassNote;" class="admin-pass-note row-tip-grey">${tips.instance.adminPassCustomTip}</div>\n        </div>\n    </dd>\n    <dd data-ui="type:Panel;id:keypairPanel;hidden:true;">\n        <label class="required-label">${i18n.密钥对：}</label>\n        <div>\n            <div data-ui-id="keypair"\n                 data-ui-name="keypair"\n                 data-ui-type="Select"\n                 data-ui-value="选择密钥对"\n                 data-ui-width="200"></div>\n            <span data-ui="type:Button;id:createKeypair;skin:stringfy;" data-ui-extension-popover-type="PopoverEx">+ ${i18n.创建密钥对}</span>\n            <div data-ui="type:Panel;id:keypairTip;hidden:true;" class="bcc-error">\n                ${i18n.加载失败，请}<span data-ui="type:Button;id:keypairReload;skin:stringfy;" class="bcc-error-reload">${i18n.刷新}</span>${i18n.重试。}\n            </div>\n            <label data-ui-type="Validity"\n                   data-ui-id="keypairValidity"></label>\n        </div>\n    </dd>\n</dl>\n\n\x3c!-- target: bcc_instance_create_buyinfo --\x3e\n<dl class="detail-create-buyinfo detail-create detail-part-1-col">\n    <dt><h4>${i18n.购买信息}</h4></dt>\n    <dd data-ui-type="Panel" data-ui-id="purchaseTypePanel">\n        <label class="required-label">${i18n.购买时长：}</label>\n        <div>\n            <div data-ui-id="purchaseLength" data-ui-name="purchaseLength"\n                 data-ui-type="RadioSelect" class="ui-radioselect-pl bcc-purchase-length"\n                 data-track-id="ti_bcc_instance_create_purchaselength"\n                 data-track-name="购买时长"></div>\n            <div data-ui-id="purchaseLengthTip"\n                 data-ui-type="Label"\n                 data-ui-hidden="true" class="row-tip-grey">当前购买的时长为弹性资源包年包月按带宽计费的时长</div>\n        </div>\n    </dd>\n    <dd>\n        <label class="required-label">${i18n.购买个数：}</label>\n        <div>\n            <div data-ui-type="NumberTextline" data-ui-id="purchaseNum"\n                 data-ui-name="purchaseNum" class="ui-radioselect-unit purchase-num"\n                 data-track-id="ti_bcc_instance_create_purchasenum"\n                 data-track-name="购买个数"></div>\n            <label class="purchase-num-tip"></label>\n            <span id="instance-create-limit-warning" class="yellow"></span>\n        </div>\n    </dd>\n    <dd data-ui-id="renewPanel" data-ui-type="Panel">\n        <label>${i18n.自动续费：}</label>\n        <div>\n            <div data-ui-type="ToggleButton"\n                  data-ui-id="autoRenew"\n                  data-ui-name="autoRenew"\n                  data-track-id="ti_bcc_instance_create_autorenew"\n                  data-track-name="自动续费"></div>\n            <a href="https://cloud.baidu.com/doc/Finance/Renew/24.5C.E8.87.AA.E5.8A.A8.E7.BB.AD.E8.B4.B9.html" target="_blank">${i18n.什么是自动续费？}</a>\n            <div data-ui-id="autoRenewPanel" data-ui-type="Panel" data-ui-hidden="true">\n                <div class="auto-renew-item">\n                    <label>${i18n.选择续费周期：}</label>\n                    <div class="ui-group ui-select-group">\n                        <div data-ui-type="Select" data-ui-id="autoRenewTimeUnit" data-ui-name="autoRenewTimeUnit"\n                        data-track-id="ti_bcc_instance_create_autorenewtimeunit"\n                        data-track-name="续费周期单元"></div>\n                        <div data-ui-type="Select" data-ui-id="autoRenewTime" data-ui-name="autoRenewTime"\n                        data-track-id="ti_bcc_instance_create_autorenewtime"\n                        data-track-name="续费周期"></div>\n                    </div>\n                    <span data-ui="type:Label;id:expireTimeLabel;" class="renew-expire-time"></span>\n                </div>\n                <div class="auto-renew-item auto-renew-relation">\n                    <label>${i18n.合并开通自动续费：}</label>\n                    <span class="auto-renew-relation auto-renew-eip"><input type="checkbox" checked="checked"\n                    data-track-id="ti_bcc_instance_create_autoreneweip"\n                    data-track-name="合并开通EIP">&nbsp; EIP&nbsp;&nbsp;&nbsp;</span>\n                    <span class="auto-renew-relation auto-renew-cds"><input type="checkbox" checked="checked"\n                    data-track-id="ti_bcc_instance_create_autorenewcds"\n                    data-track-name="合并开通CDS">&nbsp; CDS</span>\n                </div>\n            </div>\n        </div>\n    </dd>\n    <dd data-ui-id="releasePanel" data-ui-type="Panel" data-ui-hidden="true">\n        <label>${i18n.自动释放：}</label>\n        <div>\n            <div data-ui-type="ToggleButton"\n                  data-ui-id="autoRelease"\n                  data-ui-name="autoRelease"\n                  data-track-id="ti_bcc_instance_create_autorelease"\n                  data-track-name="自动释放"></div>\n            <a href="https://cloud.baidu.com/doc/BCC/GettingStarted.html#.E5.AE.9A.E6.97.B6.E9.87.8A.E6.94.BE" target="_blank">${i18n.什么是自动释放？}</a>\n            <div data-ui-id="autoReleasePanel" data-ui-type="Panel" data-ui-hidden="true">\n                <div class="auto-release-item">\n                    <label>${i18n.选择释放时间：}</label>\n                    <input data-ui-type="Calendar" name="releaseTime"\n                        data-ui-id="releaseTime" class="start-calendar"\n                        data-ui-width="204" data-ui-time="true"\n                        data-track-id="ti_bcc_instance_create_releasetime"\n                        data-track-name="自动释放时间"/>\n                </div>\n                <div class="auto-release-tip">\n                    <p>${i18n.1.设定释放时间为北京时间；2.本实例系统盘快照都会被释放}</p>\n                    <p>${i18n.3.本实例已挂载CDS云磁盘都会被自动卸载，不会被释放；4. 实例释放后不可恢复}</p>\n                </div>\n            </div>\n        </div>\n    </dd>\n    <dd>\n        <span class="eip-purchase-tip">\n            ${i18n.温馨提示：}<br/>\n            <span data-ui="type:Panel;id:beianNote;">\n            \x3c!-- if: ${isRegionHK} --\x3e\n                ${tips.instance.beianHKTip}\n            \x3c!-- else: --\x3e\n                ${tips.instance.beianPrepay | raw}\n            \x3c!-- /if --\x3e\n            </span>\n        </span>\n    </dd>\n</dl>\n\n\x3c!-- target: bcc_intsnace_create_image_type_tip --\x3e\n<div class="\x3c!-- if: ${imageType} === \'common\' || ${imageType} === \'fpgaImage\' || ${imageType} === \'gpuBccImage\' --\x3ebcc-image-type-active\x3c!-- /if --\x3e">\n${i18n.公共镜像：由百度云官方提供，仅包含基础操作系统环境。}\n</div>\n<div class="\x3c!-- if: ${imageType} === \'custom\' || ${imageType} === \'fpgaCustom\' || ${imageType} === \'gpuBccCustom\'--\x3ebcc-image-type-active\x3c!-- /if --\x3e">\n${i18n.自定义镜像：用户通过“创建自定义镜像”功能生成的镜像，包含用户针对系统盘基础操作系统、应用及软件环境的个性化配置。自定义镜像可以帮助您快速创建包含个性化配置的云服务器。}\n</div>\n<div class="\x3c!-- if: ${imageType} === \'integration\' --\x3ebcc-image-type-active\x3c!-- /if --\x3e">\n${i18n.服务集成镜像：基于基础操作系统并集成有通用服务和应用软件环境的镜像。由百度或第三方服务商提供，经由百度云审核后发布。服务集成镜像可帮助您快速创建包含控制面板、PHP等常用运行环境的云服务器。}\n</div>\n<div class="\x3c!-- if: ${imageType} === \'sharing\' --\x3ebcc-image-type-active\x3c!-- /if --\x3e">\n${i18n.共享镜像：支持用户将自定义镜像共享给其他用户，被共享用户可以通过管理控制台或API查询到其他用户共享的镜像。被共享用户可以使用其他用户共享的镜像创建实例和重装操作系统。}\n</div>\n<div class="\x3c!-- if: ${imageType} === \'mkt\' --\x3ebcc-image-type-active\x3c!-- /if --\x3e">\n${i18n.云市场镜像：由第三方服务商提供的，经百度云审核后发布在云市场的镜像环境。包含丰富的服务运行环境和应用软件，可帮助您快速应对各类解决方案场景（目前暂不支持后付费镜像）。}\n</div>\n\n\x3c!-- target: TPL_bcc_instance_create_mkt_image_info --\x3e\n<label>${i18n.镜像选择：}</label>\n<div>\n    <span>${mktImage.productName}（${mktImage.packageName}）</span>\n    <a target="_blank"\n        class="os_helplink"\n        href="${mktImage.productUrl}">\n        ${i18n.镜像环境详情}</a>\n    <a target="_blank"\n        class="os_helplink"\n        href="${mktImage.agreementUrl}">\n        <input type="checkbox" disabled="disabled" checked="checked">&nbsp; ${i18n.理解和接受《百度云市场镜像服务协议》}</a>\n    <a href="javascript:;" action-type="repick"><i class="iconfont icon-write"></i>重新选择</a>\n</div>\n\x3c!-- target: TPL_bcc_instance_tag_edit_item --\x3e\n<div \n    \x3c!-- if: !${index} --\x3e\n        id="tagItem0"\n    \x3c!--else--\x3e\n        id="tagItem${index}"\n    \x3c!-- /if --\x3e \n    class="tag-item">\n    <div class="key-item">\n        <label>${i18n.标签键：}</label>\n        <input data-ui-type="TextBox"\n            \x3c!-- if: !${index} --\x3e\n                data-ui-id="tagKey0"\n                data-ui-name="tagKey0"\n                data-ui-value="默认项目"\n            \x3c!--else--\x3e\n                data-ui-id="tagKey${index}"\n                data-ui-name="tagKey${index}"\n                data-ui-value="${tagValue}"\n            \x3c!-- /if --\x3e\n           data-ui-datasource="@tagKeys"\n           data-ui-placeholder="选择已有或手动输入"\n           data-ui-extension-textbox-type="TextBoxSelect"\n           data-ui-width="150">\n    </div>\n    <div class="value-item">\n        <label>${i18n.值：}</label>\n        <input data-ui-type="TextBox"\n            \x3c!-- if: !${index} --\x3e\n                data-ui-id="tagValue0"\n                data-ui-name="tagValue0"\n                data-ui-value=""\n            \x3c!--else--\x3e\n                data-ui-id="tagValue${index}"\n                data-ui-name="tagValue${index}"\n                data-ui-value="${tagValue}"\n            \x3c!-- /if --\x3e\n           data-ui-datasource="@tagValues"\n           data-ui-placeholder="选择已有或手动输入"\n           data-ui-extension-textbox-type="TextBoxSelect"\n           data-ui-width="150">\n        <i class="iconfont icon-close delete-tag"></i>\n    </div>\n</div>\n'}),define("bcc/instance/create/ui",["exports","underscore","babel-runtime/helpers/interop-require-default","moment","esui/lib","common/constants","common/region","../../events","../../config","../../enum","../flavor","./ui/buyBucketFields"],function(exports,e,t,a,i,n,s,r,o,c,l,d){exports.__esModule=!0,exports.getUIProperties=function(){var e=this.model.get("instance"),t=this.model.get("mktImage"),a=this.model.get("bccWhite").bindEip;return{productType:{datasource:c.ProductType.toArray("PREPAY","POSTPAY"),value:e?e.payment:c.ProductType.PREPAY},region:{datasource:u["default"].map(m["default"].SERVICE_TYPE.BCC.region,function(e,t){return{value:t,name:e}}),value:h["default"].getCurrentRegion().id},logicalZone:{datasource:"@zoneDatasource",selectedIndex:"@zoneIndex"},instanceType:{datasource:"@instanceTypeDatasource",value:"@instanceTypeValue",isDisableShow:!1,placement:{center:"top"}},fpgaCard:{datasource:[{name:"Xilinx KU115*1块",value:"Xilinx KU115"}]},gpuCard:{datasource:"@gpuCardDatasource",selectedIndex:"@gpuCardIndex",isDisableShow:!1,placement:{center:"top"}},gpuCount:{datasource:"@gpuCountDatasource",selectedIndex:"@gpuCountIndex"},cpu:{datasource:"@cpuDatasource",unit:"核",selectedIndex:"@cpuIndex"},memory:{datasource:"@memoryDatasource",unit:"GB",selectedIndex:"@memoryIndex"},cpuCustom:{custom:function(e){var t=this.viewContext.controls.flavorCustomCheck,a=this.viewContext.controls.instanceType.getValue(),i=48;return a===c.InstanceType.DEFAULTIII?i=200:a===c.InstanceType.DEFAULTII&&(i=96),!t.isChecked()||/^[1-9][0-9]*$/.test(e)&&e>0&&e<=i},customErrorMessage:"CPU是1到48之间的数字",validityLabel:"cpuCustomValidity"},memoryCustom:{custom:function(e){var t=this.viewContext.controls.flavorCustomCheck,a=this.viewContext.controls.instanceType.getValue(),i=128;return a===c.InstanceType.DEFAULTIII?i=400:a===c.InstanceType.DEFAULTII&&(i=256),!t.isChecked()||/^[1-9][0-9]*$/.test(e)&&e>0&&e<=i},customErrorMessage:"内存是1到128之间的数字",validityLabel:"memoryCustomValidity"},imageType:{datasource:"@imageTypeList",selectedIndex:"@imageTypeIndex",isDisableShow:!1,placement:{center:"top"}},osType:{datasource:[],width:140,selectedIndex:0},osVersion:{datasource:[],width:190,custom:function(e){return this.viewContext.controls.imageType.getValue()===c.ImageType.MKT||!!e},customErrorMessage:"请选择一个自定义镜像",selectedIndex:0},rootDiskStorageType:{datasource:c.DiskType.toArray("SSD","PREMIUM_SSD")},diskSize:{min:"@minDiskSize",max:"@maxDiskSize",length:349,unit:"GB",step:5,opMode:"delete"},ebsSize:{datasource:"@snapshots",maxlength:"@quota.cdsRatio",dragger:{min:5,max:32765,step:1,length:320},snapshot:{stateDisabled:!0,content:'从快照创建CDS磁盘 <span class="loading"></span>'},initDraggerCount:0,diskType:"@diskType"},ifBuyEip:{value:a?"0":"1",datasource:[{name:"购买弹性公网IP",value:1},{name:"暂不需要",value:0}],custom:function(e){return"1"!==this.viewContext.controls.ifBuyEip.getValue()||!a},customErrorMessage:"需安全部审核通过后才可进行此操作"},eipName:{custom:function(e){return"0"===this.viewContext.controls.ifBuyEip.getValue()||!e||/^[a-zA-Z][\w\-\/\.]{0,64}$/.test(e)},customErrorMessage:"名称不符合规则：支持大小写字母、数字以及-_ /.特殊字符，必须以字母开头，长度1-65"},eipNameTip:{text:o.RULE.NAME.placeholder},networkType:{datasource:c.ProductType.toArray("PREPAYEIP","NETRAFFIC","BANDWIDTH")},network:{max:200,min:1,length:349,unit:"Mbps"},vpc:{width:200,datasource:"@vpcDatasource"},subnet:{width:200,datasource:"@subnetDatasource"},nameType:{datasource:[{name:"随机生成",value:o.PASSWORD_TYPE.RANDOM},{name:"用户自定义",value:o.PASSWORD_TYPE.CUSTOM}]},adminPassType:{datasource:[{name:"随机生成",value:o.PASSWORD_TYPE.RANDOM},{name:"用户自定义",value:o.PASSWORD_TYPE.CUSTOM},{name:"密钥对",value:o.PASSWORD_TYPE.SSH}]},name:{custom:function(e){return this.viewContext.controls.nameType.getValue()===o.PASSWORD_TYPE.RANDOM||o.RULE.NAME.pattern.test(e)},customErrorMessage:o.RULE.NAME.patternErrorMessage},bccCreateWithScript:{custom:function(e){return!e||o.RULE.SCRIPTADDRESS.pattern.test(e)},customErrorMessage:o.RULE.SCRIPTADDRESS.patternErrorMessage},adminPass:{custom:function(e){return this.viewContext.controls.adminPassType.getValue()!==o.PASSWORD_TYPE.CUSTOM||o.RULE.PASSWORD.custom(e)}},adminPassConfirm:{custom:function(e){var t=this.viewContext.controls.adminPassType,a=this.viewContext.controls.adminPass;return t.getValue()===o.PASSWORD_TYPE.RANDOM||a.getValue()===this.getValue()},customErrorMessage:"密码不一致"},nameTip:{text:o.RULE.NAME.placeholder},adminPassTip:{text:o.RULE.PASSWORD.customErrorMessage},keypair:{custom:function(e){return this.viewContext.controls.adminPassType.getValue()!==o.PASSWORD_TYPE.SSH||!!e},customErrorMessage:"请选择密钥对",validityLabel:"keypairValidity"},asp:{custom:function(e){return!this.viewContext.controls.autoSnaphot.isChecked()||!!e},customErrorMessage:"请选择自动快照策略",validityLabel:"aspValidity"},purchaseLength:{datasource:"@purchaseLenDatasource",value:t&&t.months?t.months:1},purchaseNum:{currentValue:1,max:o.LIMIT.INSTANCE.MAX_AT_ONE_TIME},autoRenewTimeUnit:{datasource:c.TimeType.toArray()},autoRenewTime:{datasource:c.Month.toArray()},buyBucket:{fields:b["default"],confirmBtn:{text:"下一步",skin:"skin-primary-button"}},rootDiskSizeInGb:{min:40,max:100,step:1,length:349,unit:"GB"},releaseTime:{range:{begin:p["default"]().subtract(1,"days").toDate(),end:new Date(2046,10,4)},rawValue:p["default"]().add(6,"m").toDate(),required:"required",requiredErrorMessage:"释放时间必填",custom:function(e){return p["default"](e).isAfter(p["default"]().add(5,"m"))},autoHideLayer:"true",customErrorMessage:"释放时间必须晚于当前时间5分钟"}}},exports.getUIEvents=function(){return{"productType:change":function(e){var t=e.target.getValue(),a=this.model.get("tips").instance,i=this.model.get("isRegionHK");t===c.ProductType.PREPAY?(this.get("releasePanel").hide(),this.get("autoRelease").setValue(!1),this.get("releaseTime").disable(),!i&&this.get("beianNote").setContent(a.beianPrepay),this.get("networkType").setValue(c.ProductType.PREPAYEIP)):(this.get("releasePanel").show(),!i&&this.get("beianNote").setContent(a.beianPostpay),this.get("networkType").setValue(c.ProductType.NETRAFFIC)),this.updateImage(),this.updateFlavor(),this.updatePurchaseInfo(),this.fire(g["default"].CHANGE_PRODUCT_TYPE,{productType:t})},"region:change":function(e){this.fire(g["default"].REGION_CHANGE,{regionId:e.target.getValue()})},"logicalZone:change":function(e){var t=this.get("ebsSize"),a=this.model.get("diskType"),i=e.target.getItem().cdsTypes;i&&u["default"].intersection(i,[c.DiskType.SATA,c.DiskType.SSD,c.DiskType.PREMIUM_SSD]).length>0?(u["default"].each(a,function(e){e.disabled=u["default"].indexOf(i,e.value)<0,e.text=e.disabled?c.DiskType.getTextFromValue(e.value)+"(已售罄)":c.DiskType.getTextFromValue(e.value)}),t.updateDiskType(a),this.get("ebsSetPanel").show(),t.show(),this.get("ebsSelloutPanel").hide()):(t.hide(),this.get("ebsSetPanel").hide(),this.get("ebsSelloutPanel").show()),this.updateInstanceTypeDatasource(),this.fire("reloadData",{key:"subnet"})},"instanceType:change":function(e){if(this.updateFlavor(),this.updateCustomFlavor(),this.updateImage(),this.tempDiskHandler(),this.model.get("bccWhite").isCustomVmFlavor&&this.get("flavorCustomCheck").isChecked()){var t=this.get("cpuCustom"),a=this.get("memoryCustom");this.get("flavorCustomCheck").setProperties({checked:!1}),this.get("cpu").setProperties({disabled:!1}),this.get("memory").setProperties({disabled:!1}),t.setProperties({value:""}),a.setProperties({value:""}),t.validate(),a.validate(),this.get("flavorCustomPanel").hide()}if(this.model.get("isSysCdsRequiredRegion")){var i=e.target.getValue(),n=this.get("rootDiskSizeInGb"),s=this.get("FPGARootDiskTip");if(i===c.InstanceType.FPGA)this.model.set("previousRootDiskSize",n.getValue()),n.setValue(100),n.disable(),s.show();else{var r=this.model.get("previousRootDiskSize");r&&n.setValue(r),n.enable(),s.hide()}}e.target.getValue()===c.InstanceType.GPU?this.get("gpuOsHelpLink").show():this.get("gpuOsHelpLink").hide(),this.fire(g["default"].GET_PRICE)},"gpuCard:change":function(e){var t=this.get("gpuCount").getValue(),a=v["default"].getGpuCount(e.item.value),i=u["default"].map(a,function(e){return{name:e,value:e}});this.get("gpuCount").setProperties({datasource:i,showNum:i.length,selectedIndex:Math.max(u["default"].indexOf(a,t),0)}),this.updateFlavor(),this.tempDiskHandler(),this.fire(g["default"].UPDATE_OS_TYPE,{imageType:this.get("imageType").getValue()}),this.fire(g["default"].GET_PRICE)},"gpuCount:change":function(e){this.updateFlavor(),this.tempDiskHandler(),this.fire(g["default"].GET_PRICE)},"cpu:change":function(e){!e.item&&(e.item=this.model.get("cpuDatasource")[e.index]);var t=e.item,a=this.get("productType").getValue(),i=this.get("instanceType").getValue(),n=v["default"].getMemory(t,a,i);this.get("memory").setProperties({datasource:n,showNum:n.length,selectedIndex:0}),this.fire(g["default"].GET_PRICE);var s=this.get("osVersion").selectedIndex;this.get("osType").fire("change",{osVersionIndex:s})},"memory:change":function(e){this.fire(g["default"].GET_PRICE);var t=this.get("osVersion").selectedIndex;this.get("osType").fire("change",{osVersionIndex:t})},"flavorCustomCheck:click":function(e){var t=this.get("cpuCustom"),a=this.get("memoryCustom");e.target.isChecked()?(this.get("cpu").setProperties({disabled:!0}),this.get("memory").setProperties({disabled:!0}),this.get("flavorCustomPanel").show()):(this.get("cpu").setProperties({disabled:!1}),this.get("memory").setProperties({disabled:!1}),t.setProperties({value:""}),a.setProperties({value:""}),this.get("flavorCustomPanel").hide(),t.validate(),a.validate(),this.fire(g["default"].GET_PRICE)),this.updateCustomFlavor()},"withoutFPGA:click":function(e){var t=this.get("fpgaCard");e.target.isChecked()?t.setProperties({disabled:!0}):t.setProperties({disabled:!1}),this.fire(g["default"].GET_PRICE)},"cpuCustom:change":function(e){var t=this.get("memoryCustom");if(e.target.validate()&&t.checkValidity()){+e.target.getValue()<=+t.getValue()?(this.fire(g["default"].GET_PRICE),e.target.hideValidity()):(this.notifyErrors({cpuCustom:"内存不小于CPU"}),this.enableSubmitBtn(!0)),t.hideValidity();var a=this.get("osVersion").selectedIndex;this.get("osType").fire("change",{osVersionIndex:a})}},"memoryCustom:change":function(e){var t=this.get("cpuCustom");if(e.target.validate()&&t.checkValidity()){+t.getValue()<=+e.target.getValue()?(this.fire(g["default"].GET_PRICE),e.target.hideValidity()):(this.notifyErrors({memoryCustom:"内存不小于CPU"}),this.enableSubmitBtn(!0)),t.hideValidity();var a=this.get("osVersion").selectedIndex;this.get("osType").fire("change",{osVersionIndex:a})}},"imageType:change":function(e){var t=e.target.getRawValue(),a=this.get("mktImagePanel");this.model.set("imageType",t),t===c.ImageType.MKT?e.initial||e.mktSilent||this.model.get("productId")?this.model.get("mktImage")&&(this.fire(g["default"].GET_PRICE,e),this.get("imagePanel").hide(),a&&a.show(),this.get("adminName").setText(o.OS_ADMIN_NAME[this.model.get("mktImage").osType.toLowerCase()])):this.fire(g["default"].CHOOSE_MKT_PRODUCT,e):t===c.ImageType.INTEGRATION?(this.get("imagePanel").show(),a&&a.hide(),this.get("osHelpLink").show(),this.get("osProtocolLink").show()):(this.get("imagePanel").show(),a&&a.hide(),this.get("osHelpLink").hide(),this.get("osProtocolLink").hide()),t!==c.ImageType.MKT&&(this.fire(g["default"].UPDATE_OS_TYPE,{imageType:t}),this.fire(g["default"].GET_PRICE,e)),this.updateSaleTip()},"osType:change":function(e){var t=e.target.getSelectedItem();if(t&&t.value){"linux"===t.value?this.get("adminPassType").updateDatasource([{name:"随机生成",value:o.PASSWORD_TYPE.RANDOM},{name:"用户自定义",value:o.PASSWORD_TYPE.CUSTOM},{name:"密钥对",value:o.PASSWORD_TYPE.SSH}]):"windows"===t.value&&this.get("adminPassType").updateDatasource([{name:"随机生成",value:o.PASSWORD_TYPE.RANDOM},{name:"用户自定义",value:o.PASSWORD_TYPE.CUSTOM}]),this.get("adminNamePanel").show(),this.get("adminName").setText(o.OS_ADMIN_NAME[t.value]);var a=t.name;this.model.set("osName",a);var i=!1;this.model.get("bccWhite").isCustomVmFlavor&&(i=this.get("flavorCustomCheck").isChecked()),this.updateAdminPassType(),this.updateImageTip(),this.fire(g["default"].UPDATE_OS_VERSION,{imageType:this.model.get("imageType"),osType:a,osVersionIndex:e.osVersionIndex,memory:i?this.get("memoryCustom").getValue():this.get("memory").getValue(),cpu:i?this.get("cpuCustom").getValue():this.get("cpu").getValue()})}},"osVersion:change":function(e){var t=this.get("osVersion").getSelectedItem();if(t&&t.value){var a=this.get("diskSize"),i=a.getValue(),n=t.minDiskSize;f["default"].getAttribute(a.main,"data-disk-type")===c.TempDiskType.NVME&&+n<5&&(n=5),n?(i<t.minDiskSize&&a.setValue(n),a.setProperties({min:n})):(a.setProperties({min:0}),a.setValue(i||0)),this.get("behindOS").setProperties({hidden:"DEV"!==t.fpgaType}),this.updateOsDisksizeTip()}},"autoSnaphot:change":function(e){e.target.isChecked()?this.get("aspPanel").show():this.get("aspPanel").hide()},"aspReload:click":function(e){this.fire("reloadData",{key:"asp"})},"createAsp:click":function(){this.fire("createAsp")},"ifBuyEip:change":function(e){this.buyEipHandler(),this.updatePurchaseInfo(),this.warningPanelShow(),this.enableSubmitBtn(!0),this.get("autoRenew").isChecked()&&this.updateRelationProduct(),this.fire(g["default"].GET_PRICE)},"networkType:change":function(e){this.networkTypeChangeHandler(),this.updateRelationProduct(),this.updatePurchaseInfo(),this.fire(g["default"].GET_PRICE)},"network:change":function(e){this.fire(g["default"].GET_PRICE)},"securityGroups:change":function(e){var t=e.target.getSelectedItem();t&&t.value&&this.model.set("securityGroupName",t.name)},"ebsSize:change":function(e){this.get("autoRenew").isChecked()&&this.updateRelationProduct(),this.fire(g["default"].CHANGE_CDS_SIZE,{newValue:e.target.getValue()})},"tempDiskOn:click":function(e){this.setTempDisksize({tempDiskType:c.TempDiskType.SSD})},"highTempDiskOn:click":function(e){this.setTempDisksize({tempDiskType:c.TempDiskType.NVME})},"diskSize:change":function(e){this.fire(g["default"].GET_PRICE)},"diskSize:delete":function(e){if(f["default"].getAttribute(e.target.main,"data-disk-type")===c.TempDiskType.NVME)return this.showToast("高性能本地磁盘为存储优化型BCC的必选项，不可删除。");this.deleteTempDisksize()},"nameType:change":function(e){e.item.value===o.PASSWORD_TYPE.RANDOM?this.get("namePanel").hide():this.get("namePanel").show()},"adminPassType:change":function(e){var t=e.item.value,a=this.model.get("tips").instance,i=this.get("adminPassNote");t===o.PASSWORD_TYPE.RANDOM?(this.get("adminPassPanel").hide(),this.get("keypairPanel").hide(),i.show(),i.setText(a.adminPassRandomTip)):t===o.PASSWORD_TYPE.SSH?(this.get("adminPassPanel").hide(),this.get("adminPassNote").hide(),this.get("keypairPanel").show()):(this.get("keypairPanel").hide(),this.get("adminPassPanel").show(),i.show(),i.setText(a.adminPassCustomTip))},"purchaseLength:change":function(e){this.fire(g["default"].GET_PRICE)},"purchaseNum:change":function(e){e.now===o.LIMIT.INSTANCE.MAX_AT_ONE_TIME?this.showLimitWarn():this.hideLimitWarn(),this.fire(g["default"].CHANGE_PURCHASE_NUM)},buyBucket:{reset:function(e){e.preventDefault(),this.fire(g["default"].RELOAD)},confirm:function(e){e.preventDefault(),this.fire(g["default"].PICK,{ifBuyEip:"1"===this.get("ifBuyEip").getValue()})}},"osReload:click":function(e){this.fire("reloadData",{key:"image"})},"securityReload:click":function(e){this.fire("reloadData",{key:"security"})},"name:keypress":"stopSubmit","adminPass:keypress":"stopSubmit","adminPassConfirm:keypress":"stopSubmit","vpcReload:click":function(e){this.fire("reloadData",{key:"vpc"})},"vpc:change":function(e){this.fire("reloadData",{key:"subnet"}),this.fire("reloadData",{key:"security"})},"subnet:change":function(e){var t=e.target.getSelectedItem(),a=this.get("ifBuyEip");t&&t.hasOwnProperty("subnetType")&&3===t.subnetType?(this.get("subnetTip").show(),a.set("rawValue",["0"]),a.disable()):(this.get("subnetTip").hide(),a.enable()),this.enableSubmitBtn(!0)},"keypairReload:click":function(e){this.fire("reloadData",{key:"keypair"})},"autoRenew:change":function(e){e.target.isChecked()?(this.get("autoRenewPanel").show(),this.updateExpireTime(),this.updateRelationProduct()):this.get("autoRenewPanel").hide(),this.fire(g["default"].GET_PRICE)},"autoRenewTimeUnit:change":function(e){var t=e.target.getValue(),a=this.get("autoRenewTime");t===c.TimeType.MONTH?a.updateDatasource(c.Month.toArray()):a.updateDatasource(c.Year.toArray()),this.updateExpireTime(),this.fire(g["default"].GET_PRICE)},"autoRenewTime:change":function(e){this.updateExpireTime(),this.fire(g["default"].GET_PRICE)},"rootDiskSizeInGb:change":function(e){this.fire(g["default"].GET_PRICE),this.updateRootDiskStorageTip(e)},"rootDiskStorageType:change":function(e){this.fire(g["default"].GET_PRICE),this.updateRootDiskStorageTip(e)},"createSubnet:click":function(){this.fire("createSubnet")},"createKeypair:click":function(){this.fire("createKeypair")},"autoRelease:change":function(e){var t=this.get("releaseTime");e.target.isChecked()?(t.enable(),!t.validate()&&this.model.set("releaseTimeValid",!1),this.get("autoReleasePanel").show()):(this.model.set("releaseTimeValid",!0),t.disable(),this.get("autoReleasePanel").hide()),this.enableSubmitBtn(!0)},"releaseTime:change":function(e){e.target.validate()?this.model.set("releaseTimeValid",!0):this.model.set("releaseTimeValid",!1),this.enableSubmitBtn(!0)},"addTag:click":function(e){this.fire(g["default"].ADD_TAG)}}};var u=t["default"](e),p=t["default"](a),f=t["default"](i),m=t["default"](n),h=t["default"](s),g=t["default"](r),v=t["default"](l),b=t["default"](d)}),define("bcc/instance/create/ui/buyBucketFields",["exports","module","underscore","babel-runtime/helpers/interop-require-default","common/region","common/zone","common/util/moneyUtil","../../../enum","../../../_public/ebsUtil","../../../common","../../../util"],function(exports,module,e,t,a,i,n,s,r,o,c){var l=t["default"](e),d=t["default"](a),u=t["default"](i),p=t["default"](n),f=t["default"](r),m=t["default"](o);module.exports=[{title:"地域：",content:function(e){return d["default"].getCurrentRegion().label}},{title:"可用区：",content:function(e){return u["default"].getLabel(e.logicalZone)}},{title:"购买配置：",content:function(e){var t=["CPU："+e.cpu+"核","内存："+e.memory+"GB"];e.instanceType!==s.InstanceType.DEFAULTIII&&t.push("本地磁盘："+e.diskSize+"GB"),m["default"].isSysCdsRequiredRegion()&&t.push("系统盘："+e.rootDiskSizeInGb+"（内含赠送40）GB"),e.instanceType===s.InstanceType.GPU?t=["GPU型号："+s.GpuCard.getTextFromValue(e.gpuCard),"GPU数量："+e.gpuCount+"块"].concat(t):e.instanceType===s.InstanceType.FPGA&&(t=["FPGA：Xilinx KU115*1块"].concat(t));var a=f["default"].getEbsByType(e.ebsSize,"PREMIUM_SSD"),i=f["default"].getEbsByType(e.ebsSize,"SSD"),n=f["default"].getEbsByType(e.ebsSize,"SATA");return a&&a.length>0&&t.push(s.DiskType.getTextFromAlias("PREMIUM_SSD")+"："+f["default"].getAllEbsSize(a)+f["default"].getEbsSizeDesc(a)+"GB"),i&&i.length>0&&t.push(s.DiskType.getTextFromAlias("SSD")+"："+f["default"].getAllEbsSize(i)+f["default"].getEbsSizeDesc(i)+"GB"),n&&n.length>0&&t.push(s.DiskType.getTextFromAlias("SATA")+"："+f["default"].getAllEbsSize(n)+f["default"].getEbsSizeDesc(n)+"GB"),t.join("、")+""}},{title:"公网带宽：",content:function(e,t){if("1"!==e.ifBuyEip)return t.hidden=!0;t.hidden=!1;var a="包年包月计费";switch(e.subProductType){case"netraffic":a="按使用流量计费";break;case"bandwidth":a="按使用带宽计费"}return a+" "+e.bandwidthInMbps+"Mbps"+(e.productType===s.ProductType.POSTPAY&&e.subProductType===s.ProductType.PREPAYEIP?" * "+e.purchaseLength+"月":"")}},{title:"所选镜像：",content:function(e,t){return e.imageType!==s.ImageType.MKT?t.hidden=!0:(t.hidden=!1,e.mktImage?e.mktImage.productName+"（"+e.mktImage.packageName+"）":"-")}},{title:"购买配额：",content:function(e){var t=e.autoRenewTimeUnit===s.TimeType.MONTH?"个月":"年";return(e.productType===s.ProductType.PREPAY?e.purchaseNum+"台 * "+e.purchaseLength+"月":e.purchaseNum+"台")+(e.autoRenew?"<br>开通自动续费"+e.autoRenewTime+t:"")}},{title:"镜像费用：",content:function(e,t){if(e.imageType!==s.ImageType.MKT)return t.hidden=!0;t.hidden=!1;var a=l["default"].find(e.priceDetail,function(e){return"MKT"===e.servicetype});if(e.loading||!a)return'<span class="loading">努力加载中...请稍候</span>';if(e.error)return'<span class="bcc-error">请求异常，请刷新后重试。 </span><a href="javascript:location.reload();">刷新</a>';var i=p["default"].convertPrice(a.price[0]);return'<span class="price">￥'+(e.productType===s.ProductType.POSTPAY?i.getPriceOfMinute("/分钟"):i.getPriceOfMinute())+"</span>"+(e.mktImage&&"onetime"===e.mktImage.chargeType?"（一次性）":"")}},{title:"配置费用：",content:function(e){if(e.loading)return'<span class="loading">努力加载中...请稍候</span>';if(e.error)return'<span class="bcc-error">请求异常，请刷新后重试。 </span><a href="javascript:location.reload();">刷新</a>';var t=+e.money,a=e.productType===s.ProductType.POSTPAY;if(e.imageType===s.ImageType.MKT){var i=l["default"].find(e.priceDetail,function(e){return"MKT"===e.servicetype});i&&(t-=i.price[0])}if("1"===e.ifBuyEip&&(!a&&!e.subProductType||a&&e.subProductType===s.ProductType.BANDWIDTH)){var n=l["default"].find(e.priceDetail,function(e){return"EIP"===e.servicetype});n&&(t=c.accAdd(t,n.price[0]))}var r=p["default"].convertPrice(t);return'<span class="price">￥'+(a?r.getPriceOfMinute("/分钟"):r.getPriceOfMinute())+"</span>"}},{title:"IP地址租用：",content:function(e,t){if("1"===e.ifBuyEip&&e.subProductType===s.ProductType.NETRAFFIC){if(t.hidden=!1,e.loading||!e.priceDetail)return'<span class="loading">努力加载中...请稍候</span>';if(e.error)return'<span class="bcc-error">请求异常，请刷新后重试。 </span><a href="javascript:location.reload();">刷新</a>';var a=l["default"].find(e.priceDetail,function(e){return"EIP"===e.servicetype});return'<span class="price eip-price">￥'+p["default"].convertPrice(a.price[0]).getPriceOfMinute("/分钟")+"</span>"}t.hidden=!0}},{title:"流量费用：",content:function(e,t){if("1"===e.ifBuyEip&&e.subProductType===s.ProductType.NETRAFFIC){if(t.hidden=!1,e.loading||!e.priceDetail)return'<span class="loading">努力加载中...请稍候</span>';if(e.error)return'<span class="bcc-error">请求异常，请刷新后重试。 </span><a href="javascript:location.reload();">刷新</a>';var a=l["default"].find(e.priceDetail,function(e){return"EIP"===e.servicetype});return'<span class="price">￥'+p["default"].convertPrice(a.networkMoney).getPriceOfMinute("/GB")+"</span>"}t.hidden=!0}},{title:"带宽费用：",content:function(e,t){var a=e.productType===s.ProductType.PREPAY&&e.subProductType===s.ProductType.BANDWIDTH||e.productType===s.ProductType.POSTPAY&&e.subProductType===s.ProductType.PREPAYEIP;if("1"===e.ifBuyEip&&a){if(t.hidden=!1,e.loading||!e.priceDetail)return'<span class="loading">努力加载中...请稍候</span>';if(e.error)return'<span class="bcc-error">请求异常，请刷新后重试。 </span><a href="javascript:location.reload();">刷新</a>';var i=l["default"].find(e.priceDetail,function(e){return"EIP"===e.servicetype}),n=p["default"].convertPrice(i.price[0]);return'<span class="price eip-price">￥'+(e.subProductType===s.ProductType.PREPAYEIP?i.price[0]:n.getPriceOfMinute("/分钟"))+"</span>"}t.hidden=!0}}]}),define("bcc/instance/create/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./tpl","bat-ria/mvc/FormView","babel-runtime/helpers/interop-require-default","inf-ria/decorators","inf-ria/app/brpc","er/Deferred","underscore","lodash","jquery","esui","esui/lib","common/auth","common/constants","common/flags","common/region","../../config","../../enum","../flavor","../../tips","./ui"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p,f,m,h,g,v,b,y,T,x,I){function S(e,t){var a=function(e){return e.replace(/<[^>]+>/g,"").length};if(e){var i=e.split("<br/>");a(e)>70||i.length>0&&a(i[i.length-1])>40?e+="<br/>":e+="； "}return e+t}var E=s["default"](n),w=s["default"](o),k=s["default"](c),C=s["default"](l),D=s["default"](d),_=s["default"](u),A=s["default"](p),P=s["default"](f),R=s["default"](m),N=s["default"](h),L=s["default"](g),$=s["default"](v),O=s["default"](T),M=s["default"](x),B=function(i){function n(){a["default"](this,s),i.apply(this,arguments)}e["default"](n,i),n.prototype.getUIProperties=function(){return I.getUIProperties.apply(this)},n.prototype.getUIEvents=function(){return I.getUIEvents.apply(this)},n.prototype.updateInstanceTypeDatasource=function(){var e=this.get("instanceType"),t=this.get("logicalZone").getItem().bccInstanceTypes,a=this.get("logicalZone").getItem().bccInstanceTypesForShow,i=C["default"].filter(y.InstanceType.toArray("DEFAULTIII","DEFAULTII","DEFAULT","CALCULATION","STORAGE","FPGA","GPU"),function(e){return C["default"].contains(a,e.value)}),n=C["default"].each(i,function(e){e.disable=!C["default"].contains(t,e.value),e.popover=M["default"].instance.instanceType[e.value],e.value===y.InstanceType.DEFAULTIII&&(e.itemClass="new-tip"),e.value!==y.InstanceType.FPGA&&e.disable?e.popover="售罄！请您移步其他可用区购买资源。":e.value===y.InstanceType.FPGA&&e.disable&&(e.popover+='<a href="https://cloud.baidu.com/survey/FPGAnewApply.html" target="_blank">申请公测></a>')}),s=Math.max(C["default"].indexOf(C["default"].pluck(n,"value"),e.getValue()),0);e.setProperties({datasource:n,selectedIndex:n[s].disable?D["default"].findIndex(n,function(e){return!e.disable}):s,showNum:n.length}),e.fire("change")},n.prototype.updateFlavor=function(){var e=this.get("productType").getValue(),t=this.get("instanceType").getValue(),a=this.get("gpuCount").getValue()||1;if(t===y.InstanceType.GPU){var i=this.model.get("flavorList"),n=this.get("logicalZone").getValue(),s=this.get("gpuCard").selectedIndex,r=O["default"].getGpuCardByApi(i,n),o=[];r[s=!r[s]||r[s].disable?D["default"].findIndex(r,function(e){return!e.disable}):s]&&(o=O["default"].getGpuCount(r[s].value));var c=C["default"].map(o,function(e){return{name:e,value:e}});this.get("gpuCard").setProperties({datasource:r,showNum:r.length,selectedIndex:s}),this.get("gpuCount").setProperties({datasource:c,showNum:c.length,selectedIndex:Math.max(C["default"].indexOf(o,a),0)})}this.get("gpuCardPanel").setProperties({hidden:t!==y.InstanceType.GPU}),this.get("gpuCountPanel").setProperties({hidden:t!==y.InstanceType.GPU});var l=this.get("gpuCard").getValue(),d=this.get("cpu").getValue(),u=this.get("memory").getValue(),p=O["default"].getCpu(e,t,l,a),f=O["default"].getMemory(+d,e,t,l,a);this.get("cpu").setProperties({datasource:p,showNum:p.length,selectedIndex:Math.max(C["default"].indexOf(p,+d),0)}),this.get("memory").setProperties({datasource:f,showNum:f.length,selectedIndex:Math.max(C["default"].indexOf(f,+u),0)}),this.get("fpgaPanel").setProperties({hidden:t!==y.InstanceType.FPGA})},n.prototype.updateCustomFlavor=function(){var e=this.get("cpuCustom"),t=this.get("memoryCustom"),a=this.get("instanceType").getValue();if(a===y.InstanceType.FPGA||a===y.InstanceType.GPU)return _["default"](".flavor-custom",".bcc-instance-buybcc").hide();_["default"](".flavor-custom",".bcc-instance-buybcc").show();var i=48,n=128;a===y.InstanceType.DEFAULTIII?(i=200,n=400):a===y.InstanceType.DEFAULTII&&(i=96,n=256),e&&(e.customErrorMessage="CPU是1到"+i+"之间的数字"),t&&(t.customErrorMessage="内存是1到"+n+"之间的数字")},n.prototype.updateImage=function(){var e=this,t=this.get("instanceType").getValue(),a=this.get("imageType"),i=y.ImageType.toArray("COMMON","CUSTOM","INTEGRATION","SHARING");t===y.InstanceType.FPGA?i=y.ImageType.toArray("FPGAIMAGE","FPGACUSTOM"):t===y.InstanceType.GPU?i=y.ImageType.toArray("GPU_BCC_IMAGE","GPU_BCC_CUSTOM","SHARING"):this.get("productType").getValue()===y.ProductType.PREPAY&&(i=C["default"].contains(["fsh","hkg","fwh"],$["default"].getCurrentRegion().id)?y.ImageType.toArray("COMMON","CUSTOM","INTEGRATION","SHARING"):y.ImageType.toArray("COMMON","CUSTOM","INTEGRATION","SHARING","MKT")),C["default"].each(i,function(t){var a=D["default"].capitalize(t.value);t.value!==y.ImageType.MKT&&e.model.get("_osData")&&(t.disable=0===e.model.get("os"+a).length)}),a.setProperties({datasource:i,selectedIndex:Math.max(C["default"].indexOf(C["default"].pluck(i,"value"),a.getValue()),0)}),a.fire("change",{mktSilent:!0})},n.prototype.updateSaleTip=function(){var e="0"!==this.get("ifBuyEip").getValue(),t=this.get("imageType").getValue()===y.ImageType.MKT,a=this.model.get("purchaseLenDatasource"),i=this.model.get("tips").instance.saleTip;C["default"].map(a,function(a){if(a.hoverContent||12===a.value||24===a.value||36===a.value){var n=[i[a.value].bcc];e&&n.push(i[a.value].eip),t&&n.push(i[a.value].mkt),a.hoverContent=n.join("<br>")}}),this.get("purchaseLength").updateDatasource(a)},n.prototype.updateAdminPassType=function(){var e=this.get("osType").getSelectedItem().osType.toLowerCase(),t="linux"===e?2:1;"linux"===e?this.get("adminPassTypeTip").show():this.get("adminPassTypeTip").hide(),this.get("adminPassType").setSelectedIndex(t),this.get("adminPassType").fire("change",{item:{value:2===t?b.PASSWORD_TYPE.SSH:b.PASSWORD_TYPE.CUSTOM}})},n.prototype.tempDiskHandler=function(){var e=this.get("tempDiskOn"),t=this.get("highTempDiskOn"),a=this.get("instanceType").getValue(),i=this.get("tempDiskTypeTip"),n=this.get("productType").getValue();if(a===y.InstanceType.STORAGE)this.get("tempDiskPanel").show(),e.hide(),this.get("fixedTempDiskPanel").hide(),t.fire("click");else if(a===y.InstanceType.FPGA||a===y.InstanceType.GPU){var s=this.get("gpuCard").getValue(),r=this.get("gpuCount").getValue()||1;this.get("fixedTempDisk").setText(O["default"].getDiskSize(n,a,s,r)),this.get("fixedTempDiskPanel").show(),this.get("tempDiskPanel").hide()}else t.hide(),this.get("tempDiskPanel").hide(),this.get("fixedTempDiskPanel").hide(),i.setProperties({content:this.model.get("tips").instance.tempDisk}),this.deleteTempDisksize()},n.prototype.setTempDisksize=function(e){var t=this.get("diskSize");e.tempDiskType===y.TempDiskType.NVME?t.setProperties({min:5}):t.setProperties({min:this.model.get("minDiskSize")}),t.setValue(5),P["default"].setAttribute(t.main,"data-disk-type",e.tempDiskType),this.get("diskSizeTip").setProperties({content:this.model.get("tips").instance.tempDiskSize[e.tempDiskType]}),this.get("tempDiskPanelOn").hide(),this.get("tempDiskPanelSet").show()},n.prototype.deleteTempDisksize=function(e){this.get("tempDiskPanelOn").show(),this.get("tempDiskPanelSet").hide(),this.get("diskSize").changeValue(0)},n.prototype.buyEipHandler=function(e){var t=this.get("ifBuyEip"),a=this.get("networkType").getValue();e=e||this.model.get("productType"),"0"===t.getValue()?_["default"](".eip-relative").hide():(_["default"](".eip-relative").show(),a===y.ProductType.PREPAYEIP?(this.networkTypeChangeHandler(),L["default"].enable_baixin&&(_["default"](".eip-network-type").hide(),_["default"](".eip-bandwidth").hide())):(_["default"](".eip-bandwidth-title").parent().hide(),this.get("network").setProperties({max:200,value:1}))),this.updateSaleTip()},n.prototype.networkTypeChangeHandler=function(){var e=this.get("network"),t=this.get("networkType").getValue(),a=this.get("subProductTypeTip");t===y.ProductType.NETRAFFIC?(e.setProperties({max:1e3,value:1e3}),_["default"](".eip-bandwidth-title").html("带宽峰值：").parent().show(),a.setText("后付费模式，按使用流量（单位为GB）计费，每小时扣费，请保证余额充足。")):(t===y.ProductType.BANDWIDTH?a.setText("后付费模式，按分钟计费，每小时扣费，请保证余额充足。"):a.setText(""),e.setProperties({max:200,value:1}),_["default"](".eip-bandwidth-title").parent().hide())},n.prototype.updatePurchaseInfo=function(){var e=this.get("productType").getValue(),t="0"!==this.get("ifBuyEip").getValue(),a=this.get("networkType").getValue();e===y.ProductType.PREPAY?this.get("renewPanel").show():(this.get("autoRenew").setValue(!1),this.get("renewPanel").hide()),e===y.ProductType.PREPAY||t&&a===y.ProductType.PREPAYEIP?this.get("purchaseTypePanel").show():this.get("purchaseTypePanel").hide(),e===y.ProductType.POSTPAY&&t&&a===y.ProductType.PREPAYEIP?this.get("purchaseLengthTip").show():this.get("purchaseLengthTip").hide()},n.prototype.updateExpireTime=function(){var e=this.get("autoRenewTimeUnit").getValue(),t="系统将于到期前7天进行扣费，扣费时长为"+this.get("autoRenewTime").getValue()+(e===y.TimeType.YEAR?"年":"月");this.get("expireTimeLabel").setText(t)},n.prototype.updateRelationProduct=function(){var e="0"!==this.get("ifBuyEip").getValue(),t=this.get("ebsSize").getValue().length>0,a=this.get("networkType").getValue();e&&a===y.ProductType.PREPAYEIP||t?e&&a===y.ProductType.PREPAYEIP?t?_["default"](".auto-renew-relation").show():(_["default"](".auto-renew-relation").show(),_["default"](".auto-renew-cds").hide()):(_["default"](".auto-renew-relation").show(),_["default"](".auto-renew-eip").hide()):_["default"](".auto-renew-relation").hide()},n.prototype.stopSubmit=function(e){if(13===e.keyCode)return e.stopImmediatePropagation(),e.preventDefault(),!1},n.prototype.getExtraFormData=function(){var e=this,t=this.get("diskSize"),a=this.get("productType").getValue(),i=this.get("instanceType").getValue(),n=this.get("osVersion").getSelectedItem(),s={createEphemeralList:[{storageType:P["default"].getAttribute(t.main,"data-disk-type"),sizeInGB:t.getValue()}],productType:a,autoRenew:this.get("autoRenew").isChecked(),autoRelease:this.get("autoRelease").isChecked(),relationTag:this.get("relationTag").isChecked(),tagIndexList:this.tagIndexList,diskSize:i===y.InstanceType.FPGA||i===y.InstanceType.GPU?this.get("fixedTempDisk").getText():t.getValue(),imageId:n&&n.imageId,imageType:n&&n.imageType};this.model.get("isSysCdsRequiredRegion")&&C["default"].extend(s,{rootDiskSizeInGb:this.get("rootDiskSizeInGb").getValue(),rootDiskStorageType:this.get("rootDiskStorageType").getValue()});var r=C["default"].map(this.tagIndexList,function(t){return{tagKey:e.get("tagKey"+t).getValue(),tagValue:e.get("tagValue"+t).getValue()}});return r&&C["default"].extend(s,{tags:r}),this.get("imageType").getValue()===y.ImageType.MKT?C["default"].extend(s,{imageId:this.model.get("mktImage").imageId,imageType:y.ImageType.MKT,productId:this.model.get("productId")||this.model.get("mktImage").productId,packageId:this.model.get("packageId")||this.model.get("mktImage").packageId}):s},n.prototype.warningPanelShow=function(){var e=this.model.get("productType")===y.ProductType.POSTPAY,t=this.model.get("instanceQuotaCheck"),a=N["default"].verifyUser&&N["default"].verifyUser.verifyStatus,i=this.model.get("prePurchaseValid"),n=this.model.get("posPurchaseValid"),s=this.get("buyBucket"),r="";R["default"].checkForbidden&&!1===R["default"].checkForbidden(this)?r=S(r,this.model.get("tips").forbiddenTip):"NONE"===a||"NONE_UNEXPIRED"===a||"NONE_EXPIRED"===a?e?r=S(r,'温馨提示：您还没有实名认证，请立即去<a href="/qualify/#/qualify/index">认证</a>'):"1"===this.get("ifBuyEip").getValue()&&(r=S(r,'温馨提示：开通有公网IP的实例需首先完成实名认证，您还没有认证，请立即去<a href="/qualify/#/qualify/index">认证</a>，或选择开通无公网IP的实例')):"hk02"===$["default"].getCurrentRegion().id?r=S(r,"温馨提示：售罄！请移步其他地域购买资源。"):t?"1"!==this.get("ifBuyEip").getValue()||this.model.get("eipQuota").eipCreateAble?e||!i||i.status?e&&n&&!n.status?r=S(r,"温馨提示："+n.failReason+' <a href="/billing/#/account/recharge">立即充值</a>'):e&&!this.model.get("quota").postInstanceIsLeft&&(r=S(r,'温馨提示：按需计费类型的云服务器BCC已经售罄，百度云正在积极扩容中，建议您先购买包年包月类型的云服务器BCC，或者提<a href="'+N["default"].domains.ticket+'">工单</a>申请按需资源，谢谢。')):r=S(r,"温馨提示："+i.failReason+' <a href="/billing/#/account/recharge">立即充值</a>'):r=S(r,'温馨提示：您创建的EIP实例已达到限额，如需增加配额请到<a href="'+N["default"].domains.ticket+'">工单</a>申请'):r=S(r,"温馨提示：您创建的"+(e?"后付费":"预付费")+'BCC实例已达到限额，如需增加配额请到<a href="'+N["default"].domains.ticket+'">工单</a>申请');var o='<div class="buy-bucket-tip">'+r+"</div>",c=_["default"](s.main).find(".buy-bucket-tip");r?(c.length>0?c.html(r):_["default"](s.main).append(o),c.show()):c.hide()},n.prototype.vpcEnabled=function(){var e=this.get("vpc").getSelectedItem()&&this.get("subnet").getValue();return this.get("vpc").get("selectedIndex")>-1&&e&&this.get("securityGroups").get("selectedIndex")>-1},n.prototype.enableSubmitBtn=function(e){if(e){var t=N["default"].verifyUser&&N["default"].verifyUser.verifyStatus,a=this.model.get("productType")===y.ProductType.POSTPAY,i=this.model.get("prePurchaseValid"),n=this.model.get("posPurchaseValid"),s=this.model.get("releaseTimeValid"),r=this.model.get("errorInfo"),o=this.model.get("price"),c=this.model.get("bccWhite").bindEip;if(!1===R["default"].checkForbidden(this))return void this.get("buyBucket").disable();if("hk02"===$["default"].getCurrentRegion().id)return void this.get("buyBucket").disable();if(!this.model.get("instanceQuotaCheck"))return void this.get("buyBucket").disable();if("1"===this.get("ifBuyEip").getValue()&&(!this.model.get("eipQuota").eipCreateAble||c))return void this.get("buyBucket").disable();if("NONE"===t||"NONE_UNEXPIRED"===t||"NONE_EXPIRED"===t){if("1"===this.get("ifBuyEip").getValue()||a)return void this.get("buyBucket").disable()}else{if(!a&&i&&!i.status)return void this.get("buyBucket").disable();if(a&&n&&!n.status)return void this.get("buyBucket").disable();if(r||!o)return void this.get("buyBucket").disable();if(a&&!this.model.get("quota").postInstanceIsLeft)return void this.get("buyBucket").disable();if(a&&!D["default"].isUndefined(s)&&!s)return void this.get("buyBucket").disable();if(!this.enableJudege())return void this.get("buyBucket").disable();if(!this.vpcEnabled())return void this.get("buyBucket").disable();if(this.get("osVersion").selectedIndex<0)return void this.get("buyBucket").disable()}}this.get("buyBucket").enable()},n.prototype.enableJudege=function(){if(this.model.get("bccWhite").isCustomVmFlavor){return+this.get("cpuCustom").getValue()<=+this.get("memoryCustom").getValue()}return!0},n.prototype.enterDocument=function(){i.prototype.enterDocument.call(this),this.get("securityGroups").fire("change"),this.get("logicalZone").fire("change"),this.updateRootDiskStorageTip(),this.get("releaseTime").disable();this.model.get("bccWhite").bindEip&&_["default"](".eip-relative").hide()},n.prototype.renderOrderConfirm=function(e,t){var a=this,i=this.get("orderAction"),n=this.get("buyStep"),s={order:e,config:t};w["default"].invokeService("billing://order_confirm",i,s).then(function(){i.on("action@prevPage",a.renderBccConfig,a),n.set("currentStep",2)})},n.prototype.renderBccConfig=function(){var e=this.get("orderAction");this.get("buyStep").set("currentStep",1),e.disposeAction(),e.un("action@prevPage"),e.main.innerHTML=""},n.prototype.showLimitWarn=function(){_["default"]("#instance-create-limit-warning").html("同一订单创建实例数量不能超过"+b.LIMIT.INSTANCE.MAX_AT_ONE_TIME+"个")},n.prototype.hideLimitWarn=function(){_["default"]("#instance-create-limit-warning").html("")},n.prototype.processError=function(){var e=this,t=this.get("ebsSize");_["default"]("[data-for=form-error]").html(""),C["default"].each(t.children,function(t){"addSnapshot"===t.childName?t.stateDisabled=e.model.get("snapshots").length<1:t.enable()}),this.get("buyBucket").disable();var a=this.model.get("errorInfo");C["default"].keys(a).length>0&&(this.get("buyBucket").disable(),C["default"].each(a,function(e,t){_["default"]("#"+t+"Error").html(e)}),a.ebsSize&&C["default"].each(t.children,function(e){e.disable()}));(this.model.get("ebsCountReachMax")||!1)&&C["default"].each(t.children,function(e){e.disable()})},n.prototype.loadMKTImageInfo=function(e){var t=this.get("imagePanel"),a=this.get("mktImagePanel");return this.loadTemplate("TPL_bcc_instance_create_mkt_image_info",a.main,e).done(function(e){t.hide(),a.show()})},n.prototype.loadTemplate=function(e,t,a){var i=new k["default"],n=this.templateRender(e,a||this.getTemplateData());return t.innerHTML=n,i.resolve({container:t,html:n}),i.promise},n.prototype.updateOsDisksizeTip=function(){var e=this.get("osDisksizeTip"),t=this.get("osVersion").getSelectedItem(),a=this.get("osVersion").datasource,i=t?t.minDiskGb:40,n=i||40,s=this.get("instanceType").getValue()===y.InstanceType.FPGA;if(C["default"].every(a,function(e){return!0===e.disabled})?(e.setProperties({text:"当前已选配置无可用镜像",hidden:!1}),e.addState("error")):(e.setProperties({text:"该镜像最低磁盘大小为"+n+"GB",hidden:!1}),e.removeState("error")),this.model.get("isSysCdsRequiredRegion")&&!s){var r=this.get("rootDiskSizeInGb");i=i?Math.max(i,40):40,r.setProperties({min:i}),r.setValue(Math.max(r.getValue(),i))}this.enableSubmitBtn(!0)},n.prototype.updateImageTip=function(){var e=this.get("imageType").getValue(),t=this.get("internalImageTip"),a=this.model.get("_osData"),i=!1;a&&a.osVersionMap.common&&(i=C["default"].find(a.osVersionMap.common.CentOS,function(e){return"6.3 x86_64"===e.name.slice(0,10)})),i&&e===y.ImageType.COMMON?t.show():t.hide()},n.prototype.updateRootDiskStorageTip=function(e){if(this.model.get("isSysCdsRequiredRegion")){var t=this.get("rootDiskStorageType").getSelectedItem().value,a=this.get("rootDiskSizeInGb").getValue(),i=0,n=0;switch(t){case"ssd":i=Math.min(1e3+8*a,5e3),n=Math.min(50+.16*a,130);break;case"premium_ssd":i=Math.min(30*a,24e3),n=Math.min(50+.263*a,260)}this.get("rootDiskStorageTip").setProperties({text:"峰值性能 - 随机IO "+i+" IOPS，吞吐量 "+n.toFixed()+" MB/s；免费赠送40GB，超出部分需要单独付费"})}},n.prototype.initTag=function(){this.bindTagEvent(0),this.updateTagValueDS("默认项目",0)},n.prototype.addTag=function(){if(this.checkAllTag()){var e=this.templateRender("TPL_bcc_instance_tag_edit_item",{index:this.tagIndex});_["default"]("#tagEditContainer").append(e),this.model.get("tagNode")&&_["default"](this.model.get("tagNode")).show();var t=P["default"].g("tagItem"+this.tagIndex);A["default"].init(t,{viewContext:this.viewContext}),this.bindTagEvent(this.tagIndex),this.updateTagKeyDS(this.tagIndex),this.updateTagValueDS("",this.tagIndex),this.tagIndexList.push(this.tagIndex),this.tagIndex++}},n.prototype.checkAllTag=function(){var e=this;return!C["default"].some(this.tagIndexList,function(t){var a=e.get("tagKey"+t).getValue(),i=e.get("tagValue"+t).getValue(),n=e.checkTagKey(t,a),s=e.checkTagValue(t,i);return!n||!s})},n.prototype.findCreatedKeys=function(e){var t=this,a=C["default"].difference(this.tagIndexList,[e]);return C["default"].map(a,function(e){return t.get("tagKey"+e).getValue()})},n.prototype.updateTagKeyDS=function(e,t){var a=this.model.get("tagKeys"),i=this.findCreatedKeys(e),n=C["default"].filter(a,function(e){return!C["default"].contains(i,e.name)});this.get("tagKey"+e).setProperties({datasource:n})},n.prototype.updateTagValueDS=function(e,t){if(e){var a=this.model.get("tagKeys");if(C["default"].find(a,function(t){return t.name===e})){var i=this.model.get("tagList");this.get("tagValue"+t).setProperties({datasource:i[e]})}else{var n=this.model.get("tagValues");this.get("tagValue"+t).setProperties({datasource:n})}}else this.get("tagValue"+t).setProperties({datasource:[]})},n.prototype.checkTagKey=function(e,t){var a=!0,i=!0,n=this.findCreatedKeys(e);return t?/^[\u4e00-\u9fa5\w\-\/\.]{0,65}$/.test(t)?C["default"].contains(n,t)&&(i=!1,this.get("tagTip").setProperties({text:"标签键必须唯一。键为"+t+"的标签发生重复。",hidden:!1})):(a=!1,this.get("tagKeyTip").setProperties({text:"标签键必须是长度1-65大小写字母、数字、中文以及-_ /.特殊字符",hidden:!1})):(a=!1,this.get("tagKeyTip").setProperties({text:"请输入键值",hidden:!1})),i&&this.get("tagTip").hide(),a&&this.get("tagKeyTip").hide(),a&&i},n.prototype.checkTagValue=function(e,t){var a=!0;return/^(?!所有值|空值$)[\u4e00-\u9fa5\w\-\/\.]{0,65}$/.test(t)||(a=!1),a?this.get("tagValueTip").hide():this.get("tagValueTip").setProperties({text:'标签值必须是长度1-65大小写字母、数字、中文以及-_ /.特殊字符，不包含关键字"所有值"、"空值"',hidden:!1}),a},n.prototype.bindTagEvent=function(e){this.bindTagKeyEvent(e),this.bindTagValueInputEvent(e)},n.prototype.bindTagKeyEvent=function(e){var t=this;C["default"].each(["input","select"],function(a){t.get("tagKey"+e).on(a,function(i){t.checkTagKey(e,i.target.getValue()),"input"===a&&t.updateTagKeyDS(e),t.updateTagValueDS(i.target.getValue(),e)})})},n.prototype.bindTagValueInputEvent=function(e){var t=this;this.get("tagValue"+e).on("input",function(a){t.checkTagValue(e,a.target.getValue())})},n.prototype.bindCloseEvent=function(){var e=this;_["default"]("#tagEditContainer").on("click",".delete-tag",function(t){var a=t.target.parentNode.parentNode.id.split("tagItem")[1];e.tagIndexList.splice(e.tagIndexList.indexOf(parseInt(a,0)),1);var i=t.target.parentNode.parentNode;if(0===e.tagIndexList.length){var n=i.parentNode.parentNode;e.model.set("tagNode",n),_["default"](n).hide(),e.get("tagKeyTip").hide(),e.get("tagValueTip").hide(),e.get("tagTip").hide()}else e.checkAllTag();P["default"].removeNode(i)})},n.prototype.bindEvents=function(){i.prototype.bindEvents.call(this),this.initTag(),this.bindCloseEvent()},t["default"](n,[{key:"tagIndex",get:function(){return 1}},{key:"tagIndexList",get:function(){return[0]}}]);var s=n;return n=r.template("TPL_bcc_instance_create")(n)||n}(E["default"]);module.exports=B}),define("bcc/instance/detail/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/BaseAction","babel-runtime/helpers/interop-require-default","inf-ria/helper","inf-ria/app/brpc","er/URL","common/billing/common","common/util/dialog","common/region","../../config","../../events","../../operations","./Model","./View"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p,f,m){function h(){_["default"].confirmHandler({title:"启动",content:"确定启动吗？"},"instance.start",this.view,{instanceId:this.model.get("instanceId")})}function g(){_["default"].confirmHandler({title:"停止",content:"停止实例后相关服务将不可访问，确定停止吗？"},"instance.stop",this.view,{instanceId:this.model.get("instanceId")})}function v(){_["default"].confirmHandler({title:"重启",content:"重启过程中相关服务会中断，确定重启吗？"},"instance.reboot",this.view,{instanceId:this.model.get("instanceId")})}function b(e){var t=this;k["default"].waitActionDialog(this.view,{title:"释放前确认",width:600,needFoot:!0,url:"/bcc/instance/require_auth_code",actionOptions:{extraData:e.extraData,requester:d.api.bccInstanceDelete,tip:this.model.get("tips").instance.bccDeleteTip,serviceType:"BCC",instances:[this.model.get("instance")],parentAction:this}}).then(function(e){var a=e.target;t.dialog=a;a.getFoot().getChild("btnOk").on("click",function(e){a.hide()})})}function y(){_["default"].instanceCreateSnapshot.call(this,{instanceId:this.model.get("instanceId")})}function T(){this.redirect(E["default"].withQuery("/bcc/instance/create",{instanceId:this.model.get("instanceId")}))}var x=i["default"](a),I=i["default"](n),S=i["default"](s),E=i["default"](r),w=i["default"](o),k=i["default"](c),C=i["default"](l),D=i["default"](u),_=i["default"](p),A=i["default"](f),P=i["default"](m),R=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=A["default"],this.viewType=P["default"]}return e["default"](i,a),i.prototype.redirectAfterDelete=function(){this.redirect("/bcc/instance/list")},i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.view.on(D["default"].COMMAND,this.dispatchCommand,this),this.view.on(D["default"].START_INSTANCE,h,this),this.view.on(D["default"].STOP_INSTANCE,g,this),this.view.on(D["default"].REBOOT_INSTANCE,v,this),this.view.on(D["default"].DELETE_INSTANCE,b,this),this.view.on(D["default"].CREATE_SNAPSHOT,y,this),this.view.on(D["default"].BUY_SAME,T,this),this.view.on(D["default"].REFRESH,this.reload),this.view.on(D["default"].UPGRADE_CONFIG,this.upgradeConfig,this)},i.prototype.syncModelToViewIterator=function(e){switch(e.name){case"mktImage":this.view.updateMktImage();break;case"name":case"desc":this.view.updateDetailView({key:e.name})}},i.prototype.dispatchCommand=function(e){var t=e.command,a=e.args;try{a=JSON.parse(a)}catch(e){}this[t]&&this[t].call(this,a)},i.prototype.inlineedit=function(e){this.view.showInlineEdit(e)},i.prototype.editName=function(e){var t=this,a=e.toUpdate,i=e.data,n=e.row,s=this.view.get("inline-edit-for-name-value");if(s.validate())return this.model.updateName(a.name,i.id,n).then(function(){t.view.hideInlineEdit({key:"name"})}).fail(function(e){e.global?t.view.showToast(e.global,{messageType:"error"}):s.showValidationMessage(!1,e.field&&e.field.name)})},i.prototype.editDesc=function(e){var t=this,a=e.toUpdate,i=e.data,n=e.row,s=this.view.get("inline-edit-for-desc-value");if(s.validate())return this.model.updateDesc(a.desc,i.id,n).then(function(){t.view.hideInlineEdit({key:"desc"})}).fail(function(e){e.global?t.view.showToast(e.global,{messageType:"error"}):s.showValidationMessage(!1,e.field&&e.field.desc)})},i.prototype.changePwd=function(){var e=this.model.get("instance"),t=this;_["default"].instanceChangePwd.call(this,{instanceIds:[e.instanceId],instanceUuids:[e.id]}).then(function(e){var a=e.target;t.dialog=a;a.getAction().view.get("form").on("aftervalidate",function(e){e.isValid&&a.hide()})})},i.prototype.vncAccess=function(){var e=require.toUrl("bcc/vnc/relay.html"),t=this.model.get("instance"),a=E["default"].serialize({instanceId:t.id,type:"novnc",instanceName:t.name,region:C["default"].getCurrentRegion().id});-1!==e.indexOf("?")?e+="&"+a:e+="?"+a,location.search&&(e+="&"+location.search.substr(1)),window.open(e)},i.prototype.bindEip=function(){var e=this,t={instanceType:"BCC",instanceId:this.model.get("instance").id,listRequester:d.api.bccEipInstanceList,submitRequester:d.api.bccEipBind};S["default"].invokeService("eip://bind",t).then(function(){return e.reload()})},i.prototype.unbindEip=function(){var e=this.model.get("instance");_["default"].confirmHandler({title:"提示",content:"您确定解绑"+e.publicIp+"吗？",width:320},"instance.unbindEip",this.view,{eip:e.publicIp})},i.prototype.redirectToVpc=function(){I["default"].redirectToModule("network","/vpc/instance/list")},i.prototype.redirectToSubnet=function(){var e=this.model.get("vpcInfo")||{vpc:{},subnet:{}};I["default"].redirectToModule("network","/vpc/subnet/list",{vpcId:e.vpc.vpcId,cidr:e.vpc.cidr,vpc:e.vpc.name})},i.prototype.changeIp=function(){var e=this.model.get("instance"),t=this.model.get("vpcInfo");k["default"].waitActionDialog(this.view,{title:"内网IP地址变更",width:500,needFoot:!0,url:"/bcc/instance/change_ip",actionOptions:{parentAction:this,instance:e,vpc:t.vpc,serviceType:"BCC",requester:d.api.bccUpdatePrivateIP,subnet:t.subnet}})},i.prototype.changeSubnet=function(){var e=this.model.get("instance"),t=this.model.get("vpcInfo");k["default"].waitActionDialog(this.view,{title:"子网变更",width:500,needFoot:!0,url:"/bcc/instance/change_subnet",actionOptions:{parentAction:this,serviceType:"BCC",instance:e,vpc:t.vpc,requester:d.api.bccchangeSubnet,subnet:t.subnet}}).then(function(e){var t=e.target,a=t.getChild("foot").getChild("btnOk");a.disable(),t.getAction().view.on("okBtrigger",function(e){return a.setProperties({disabled:e.disable})})})},i.prototype.rebuildInstance=function(e){var t=this.model.get("instance"),a=this;k["default"].waitActionDialog(this.view,{title:"重装操作系统",width:650,needFoot:!0,url:"/bcc/instance/rebuild",actionOptions:{instanceId:t.id,imageId:t.imageId,osType:t.osType,parentAction:this}}).then(function(e){var t=e.target;a.dialog=t;var i=e.target.getAction();i.view.get("form").on("aftervalidate",function(e){e.isValid&&i.customValiate()&&t.hide()}),i.on("expandDisk",_["default"].expandDisk,a)})},i.prototype.releaseShedule=function(){_["default"].releaseShedule.call(this,{item:this.model.get("instance")})},i.prototype.recharge=function(){w["default"].recharge("BCC",[this.model.get("instanceId")+";"+this.model.get("instance").instanceId])},i.prototype.upgradeNetwork=function(){I["default"].redirectToModule("eip","/eip/instance/upgrade_config",{ip:this.model.get("instance").publicIp})},i.prototype.upgradeConfig=function(){this.redirect("/bcc/instance/upgrade_config~instanceId="+this.model.get("instanceId"))},i}(x["default"]);module.exports=R}),define("bcc/instance/detail/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","bat-ria/mvc/BaseModel","common/region","common/zone","common/util","common/storage","../../config","../../enum","../../tips","common/util/PermissionChecker","../rules"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p,f,m){var h=n["default"](i),g=n["default"](s),v=n["default"](r),b=n["default"](o),y=n["default"](c),T=n["default"](l),x=n["default"](p),I=n["default"](f),S=n["default"](m),E={"x-silent":!0},w=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.getInstanceDetail=function(e){return this.set("loading",!0),d.api.bccInstanceDetail({instanceId:e})},n.prototype.prepare=function(){var e=this,t=this.get("instance"),a=t.status;this.set("statusDesc",d.INSTANCE_STATUS.TXT[a]||a),t.instanceTypeDesc=u.InstanceType.getTextFromValue(t.instanceType),t.gpuCardText=u.GpuCard.getTextFromValue(t.gpuCard),this.set("payment",u.ProductType.getTextFromValue(t.payment)),this.set("instanceInfo",t.id+"("+d.INSTANCE_STATUS.TXT[a]+")"),this.set("statusClass",d.INSTANCE_STATUS.CLASS[a]);h["default"].each(["START","STOP","REBOOT","CREATE_SNAPSHOT","RESET_PASSWORD","REBUILD_INSTANCE","DELETE","UPGRADE_CONFIG","buySame","recharge","RELEASE_SHEDULE","changeSubnet","changeIp","RENAME","updateDesc","bindEip","unbindEip"],function(a){e.set(a.toLowerCase()+"Disable",I["default"].check(S["default"],t,a)[a].disable)}),t.imageType===u.ImageType.MKT&&this.getMktImage()},n.prototype.getMktImage=function(){var e=this,t=this.get("instance");return d.api.mktImageDetail({instanceUuid:t.id},E).then(function(t){return e.set("mktImage",t)})},n.prototype.updateName=function(e,t){var a=this;return d.api.bccInstanceRename({name:e,instanceIds:t},E).then(function(){a.get("instance").name=e,a.set("name",e)})},n.prototype.updateDesc=function(e,t){var a=this;return d.api.bccInstanceUpdateDesc({desc:e,instanceId:t},E).then(function(){a.get("instance").desc=e,a.set("desc",e)})},t["default"](n,[{key:"datasource",get:function(){return{loading:h["default"].constant(!0),menu:function(e){return"instance"},tips:function(){return x["default"]},instance:function(e){var t=e.get("instanceId");return e.getInstanceDetail(t).then(function(t){return e.set("loading",!1,{silent:!0}),e.set("isPrepay",t.payment===u.ProductType.PREPAY),e.set("isPostpay",t.payment===u.ProductType.POSTPAY),t.instanceId=t.instanceId||t.id,e.set("regionLabel",[v["default"].getCurrentRegion().label,b["default"].getLabel(t.logicalZone)].join("，")),h["default"].contains([u.EipStatus.EXPIRED,u.EipStatus.STOPED,u.EipStatus.PAUSED],t.eipStatus)&&(t.eipStatusText=u.EipStatus.getTextFromValue(t.eipStatus)),t})},tab:function(){return{detail:"ui-tab-item-active"}},vpcInfo:function(e){e.set("loading",!0);var t=e.get("instanceId");return d.api.getVpcDetail({bccIds:[t]}).then(function(a){e.set("loading",!1,{silent:!0});var i=a[t]||{vpc:{},subnet:{}};return i.vpc.name=y["default"].getVpcName(i.vpc.name),i.subnet.name=y["default"].getSubnetName(i.subnet.name),i})},bccWhite:function(e){return JSON.parse(T["default"].get("whiteTags"))}}}}]),n}(g["default"]);module.exports=w}),define("bcc/instance/detail/tpl",[],function(){return'\x3c!-- target: TPL_bcc_instance_detail --\x3e\n\n\x3c!-- if: ${loading} --\x3e\n\x3c!-- import: TPL_bcc_instance_detail_loading --\x3e\n\x3c!-- else: --\x3e\n\x3c!-- import: TPL_bcc_instance_detail_main --\x3e\n\x3c!-- /if --\x3e\n\n\x3c!-- target: TPL_bcc_instance_detail_main(master = TPL_bcc_instance_detail_structure) --\x3e\n\n\x3c!-- block: abstrct-info --\x3e\n<h1 title="${instance.name}">${instance.name}</h1>\n<span class="${statusClass}">\n    ${statusDesc}\n</span>\n\x3c!-- /block --\x3e\n\n\x3c!-- block: operation-info   --\x3e\n<span class="ui-group ui-button-group">\n    <button data-ui-type="Button"\n            data-ui-id="startInstance"\n            \x3c!-- if: ${startDisable} --\x3e\n            data-ui-disabled="true"\n            \x3c!-- /if --\x3e\n            title="开启服务器BCC"\n            data-track-id="ti_bcc_instance_detail_start" data-track-name="开启">${i18n.开启}</button>\n    <button data-ui-type="Button"\n            data-ui-id="stopInstance"\n            \x3c!-- if: ${stopDisable} --\x3e\n            data-ui-disabled="true"\n            \x3c!-- /if --\x3e\n            title="停止服务器BCC"\n            data-track-id="ti_bcc_instance_detail_stop" data-track-name="停止">${i18n.停止}</button>\n    <button data-ui-type="Button"\n            data-ui-id="rebootInstance"\n            \x3c!-- if: ${rebootDisable} --\x3e\n            data-ui-disabled="true"\n            \x3c!-- /if --\x3e\n            title="重启服务器BCC"\n            data-track-id="ti_bcc_instance_detail_reboot" data-track-name="重启">${i18n.重启}</button>\n    <button data-ui-type="Button"\n            data-ui-id="deleteInstance"\n            title="释放资源，删除服务器BCC"\n            data-track-id="ti_bcc_instance_detail_delete"\n            data-track-name="释放">释放</button>\n    <button data-ui-type="Button"\n            data-ui-id="createSnapshot" data-ui-skin="create"\n            title="创建快照"\n            data-track-id="ti_bcc_instance_detail_create_snapshot"\n            data-track-name="创建快照">创建快照</button>\n    <button data-ui-type="Button" data-ui-id="refreshList"\n        data-ui-skin="refresh"\n        data-track-id="ti_bcc_instance_detail_refresh"\n        data-track-name="刷新详情"></button>\n</span>\n\x3c!-- /block --\x3e\n\n\x3c!-- block: detail-info --\x3e\n<div class="instance-info-section">\n    <h2 class="instance-info-title"><em>${i18n.基本信息}</em></h2>\n    <div class="instance-info-content">\n        <ul>\n            <li>\n                ${i18n.区域：}${regionLabel}\n            </li>\n            <li>\n                ID：\n                <span class="truncated" title="${instance.instanceId}">${instance.instanceId}</span>\n                <span data-ui-clipboard-text="@instance.instanceId"\n                    data-ui-type="Clipboard"\n                    data-ui-id="copyId"\n                    data-track-id="ti_bcc_instance_detail_copy_id"\n                    data-track-name="复制ID">\n                    <i class="iconfont icon-copy"></i>\n                </span>\n            </li>\n            <li>${i18n.状态：}\n                <span class="${statusClass}">\n                    ${statusDesc}\n                </span>\n            </li>\n            <li>\n                <div class="inline-edit-container">\n                    <div class="inline-edit-label">\n                        ${i18n.名称：}\n                        <span class="truncated update-value" title="${instance.name}">\n                            \x3c!-- if: ${instance.name} --\x3e\n                            ${instance.name}\n                            \x3c!-- else: --\x3e\n                            ${i18n.无}\n                            \x3c!-- /if --\x3e\n                        </span>\n                        \x3c!-- if: ${renameDisable} --\x3e\n                        <span class="link-like state-disabled">${i18n.变更}</span>\n                        \x3c!-- else: --\x3e\n                        <span data-ui="id:editName;type:Button" class="link-like cmd-button" data-command="inlineedit" data-command-args=\'{"key": "name"}\'\n                        data-track-id="ti_bcc_instance_detail_edit_name_show"\n                        data-track-name="点开修改名称"\n                        >${i18n.变更}</span>\n                        \x3c!-- /if --\x3e\n                    </div>\n                    <div class="inline-edit-main name" for="name">\n                        <input data-ui="id:inline-edit-for-name-value;type:TextBox;value:${instance.name};width:350;" />\n                        <button data-ui="id:inline-edit-for-name-submit;type:Button;skin:ok;"\n                        data-track-id="ti_bcc_instance_detail_edit_name"\n                        data-track-name="修改名称">${i18n.保存}</button>\n                        <button data-ui="id:inline-edit-for-name-cancel;type:Button;skin:cancel;">${i18n.取消}</button>\n                        <label data-ui="id:inline-edit-for-name-value-validity;type:Validity"></label>\n                    </div>\n                </div>\n            </li>\n            <li>\n                <div class="inline-edit-container">\n                    <div class="inline-edit-label">\n                        ${i18n.描述：}\n                        <span class="truncated update-value" title="${instance.desc}">\n                            \x3c!-- if: ${instance.desc} --\x3e\n                            ${instance.desc}\n                            \x3c!-- else: --\x3e\n                            ${i18n.无}\n                            \x3c!-- /if --\x3e\n                        </span>\n                        \x3c!-- if: ${updateDescDisable} --\x3e\n                        <span class="link-like state-disabled">${i18n.变更}</span>\n                        \x3c!-- else: --\x3e\n                        <span data-ui="id:editDesc;type:Button" class="link-like cmd-button" data-command="inlineedit" data-command-args=\'{"key": "desc"}\'\n                        data-track-id="ti_bcc_instance_detail_edit_desc_show"\n                        data-track-name="点开修改描述">${i18n.变更}</span>\n                        \x3c!-- /if --\x3e\n                    </div>\n                    <div class="inline-edit-main desc" for="desc">\n                        <input data-ui="id:inline-edit-for-desc-value;type:TextBox;value:${instance.desc};width:350;" />\n                        <button data-ui="id:inline-edit-for-desc-submit;type:Button;skin:ok;"\n                        data-track-id="ti_bcc_instance_detail_edit_desc"\n                        data-track-name="修改描述">${i18n.保存}</button>\n                        <button data-ui="id:inline-edit-for-desc-cancel;type:Button;skin:cancel;">${i18n.取消}</button>\n                        <label data-ui="id:inline-edit-for-desc-value-validity;type:Validity"></label>\n                    </div>\n                </div>\n            </li>\n            <li>\n                ${i18n.类型：}${instance.instanceTypeDesc}\n            </li>\n            <li>${i18n.操作：}\n                \x3c!-- if: ${reset_passwordDisable} --\x3e\n                <span class="link-like state-disabled">${i18n.重置密码}</span>\n                \x3c!-- else: --\x3e\n                <span data-ui="id:changePwd;type:Button" data-command="changePwd"\n                    class="link-like cmd-button"\n                    data-track-id="ti_bcc_instance_detail_change_pwd"\n                    data-track-name="重置密码">${i18n.重置密码}</span>\n                \x3c!-- /if --\x3e\n                \x3c!-- if: ${instance.status} === "ACTIVE" --\x3e\n                    <span data-ui="id:vncAccess;type:Button" data-command="vncAccess"\n                        class="link-like cmd-button"\n                        data-track-id="ti_bcc_instance_detail_vnc"\n                        data-track-name="VNC远程">\n                        ${i18n.VNC远程}</span>\n                \x3c!-- /if --\x3e\n            </li>\n            \x3c!-- if: ${instance.specificType} === true--\x3e\n            <li>${i18n.属性：}\n                <span>\n                    ${i18n.专属}\n                    <span data-ui-type="Tip">\n                        ${i18n.运行在您专属硬件上的实例，此类实例与其他客户的实例已实现物理隔离。}\n                    </span>\n                </span>\n            </li>\n            \x3c!-- /if --\x3e\n        </ul>\n    </div>\n</div>\n<div class="separator"></div>\n<div class="instance-info-section">\n    <h2 class="instance-info-title"><em>${i18n.支付信息}</em></h2>\n    <div class="instance-info-content">\n        <ul>\n            <li>${i18n.支付方式：}\n                <span>${payment}</span>\n                \x3c!-- if: ${rechargeDisable} --\x3e\n                <span class="link-like state-disabled">${i18n.续费}</span>\n                \x3c!-- else: --\x3e\n                <span data-ui="id:recharge;type:Button" data-command="recharge"\n                    class="link-like cmd-button"\n                    data-track-id="ti_bcc_instance_detail_recharge"\n                    data-track-name="续费">${i18n.续费}</span>\n                \x3c!-- /if --\x3e\n            </li>\n            <li>\n                ${i18n.创建时间：}${instance.createTime|formatTime}\n            </li>\n            <li>${i18n.到期时间：}\n                <span>\n                    \x3c!-- if: ${isPostpay} --\x3e\n                        \x3c!-- if: ${instance.releaseTime} --\x3e\n                        ${i18n.预计于}${instance.releaseTime|formatTime}${i18n.释放}\n                        \x3c!-- else --\x3e\n                        ${i18n.未设置释放时间}\n                        \x3c!-- /if --\x3e\n                        \x3c!-- if: ${release_sheduleDisable} --\x3e\n                        <span class="link-like state-disabled">${i18n.设置定时释放}</span>\n                        \x3c!-- else: --\x3e\n                        <span data-ui="id:releaseShedule;type:Button" data-command="releaseShedule"\n                            class="link-like cmd-button"\n                            data-track-id="ti_bcc_instance_detail_release_shedule"\n                            data-track-name="设置定时释放">${i18n.设置定时释放}</span>\n                        \x3c!-- /if --\x3e\n                    \x3c!-- else --\x3e\n                        ${instance.expireTime|formatTime}\n                    \x3c!-- /if --\x3e\n                </span>\n            </li>\n        </ul>\n    </div>\n</div>\n<div class="separator"></div>\n<div class="instance-info-section">\n    <h2 class="instance-info-title"><em>${i18n.配置信息}</em></h2>\n    <div class="instance-info-content">\n        <ul>\n            <li>\n                CPU：${instance.cpu}${i18n.核}\n            </li>\n            <li>\n                ${i18n.内存：}${instance.memory}GB\n                <span data-ui-type="Button"\n                    data-ui-id="buySame"\n                    class="bysame_button"\n                    data-track-id="ti_bcc_instance_detail_buy_same"\n                    data-track-name="购买相同配置">${i18n.购买相同配置}</span>\n                <span data-ui-type="Button"\n                    data-ui-id="upgradeButton"\n                    class="upgrade_button"\n                    data-track-id="ti_bcc_instance_detail_upgrade"\n                    data-track-name="配置升级">${i18n.配置升级}</span>\n            </li>\n            <li>\n                ${i18n.本地磁盘：}${instance.diskSize}GB\n            </li>\n            \x3c!-- if: ${instance.instanceType} === \'8\' && ${instance.fpgaCard}  --\x3e\n            <li>\n                ${i18n.FPGA：}${instance.fpgaCard}\n            </li>\n            \x3c!-- /if --\x3e\n            \x3c!-- if: ${instance.instanceType} === \'9\' --\x3e\n            <li>\n                ${i18n.GPU型号：}${instance.gpuCardText}\n            </li>\n            <li>\n                ${i18n.GPU数量：}${instance.gpuCount}${i18n.块}\n            </li>\n            \x3c!-- /if --\x3e\n            <li>${i18n.公网IP：}\n                <span>\n                    \x3c!-- if: ${instance.publicIp} --\x3e\n                    ${instance.publicIp}（${i18n.带宽：}${instance.network}Mbps）\n                    <span class="eip-status">${instance.eipStatusText}</span>\n                        \x3c!-- if: ${unbindEipDisable} --\x3e\n                            <span class="link-like state-disabled">${i18n.解绑EIP}</span>\n                        \x3c!-- else: --\x3e\n                            <span data-ui="id:unbindEip;type:Button" data-command="unbindEip"\n                                class="link-like cmd-button"><i class="iconfont icon-unbind" title="${i18n.解绑EIP}"\n                                data-track-id="ti_bcc_instance_detail_unbind_eip"\n                    data-track-name="解绑EIP"></i></span>\n                            \x3c!-- if: !${instance.eipGroupId} --\x3e\n                            <span data-ui="id:upgradeNetwork;type:Button" data-command="upgradeNetwork"\n                                class="link-like cmd-button"\n                                data-track-id="ti_bcc_instance_detail_upgrade_network"\n                    data-track-name="调整带宽">${i18n.调整带宽}</span>\n                            \x3c!-- /if --\x3e\n                        \x3c!-- /if --\x3e\n                    \x3c!-- else --\x3e\n                    ${i18n.未分配}\n                        \x3c!-- if: ${vpcInfo.subnet.subnetType} === 3 --\x3e\n                        <span>${i18n.（NAT专属子网内BCC无法绑定EIP）}</span>\n                        \x3c!-- else: --\x3e\n                            \x3c!-- if: ${bindEipDisable} || ${bccWhite.bindEip} --\x3e\n                            <span class="link-like state-disabled">${i18n.绑定EIP}</span>\n                            \x3c!-- else: --\x3e\n                            <span data-ui="id:bindEip;type:Button" data-command="bindEip"\n                                class="link-like cmd-button"\n                                data-track-id="ti_bcc_instance_detail_bind_eip"\n                    data-track-name="绑定EIP">${i18n.绑定EIP}</span>\n                            \x3c!-- /if --\x3e\n                        \x3c!-- /if --\x3e\n                    \x3c!-- /if --\x3e\n                </span>\n            </li>\n            \x3c!-- if: ${vpcInfo.vpc} --\x3e\n            <li>${i18n.所在网络：}\n                <span>\n                    <span data-ui="id:redirectToVpc;type:Button" data-command="redirectToVpc"\n                        class="link-like cmd-button vpc-button"\n                        data-track-id="ti_bcc_instance_detail_redirect_to_vpc"\n                    data-track-name="跳转到VPC">${vpcInfo.vpc.name}\x3c!-- if:${vpcInfo.vpc.cidr} --\x3e（${vpcInfo.vpc.cidr}）\x3c!-- /if --\x3e</span>\n                </span>\n            </li>\n            \x3c!-- /if --\x3e\n            \x3c!-- if: ${vpcInfo.subnet} --\x3e\n            <li>${i18n.所在子网：}\n                <span>\n                    <span data-ui="id:redirectToSubnet;type:Button" data-command="redirectToSubnet"\n                        class="link-like cmd-button vpc-button"\n                        data-track-id="ti_bcc_instance_detail_redirect_to_subnet"\n                    data-track-name="跳转到子网">${vpcInfo.subnet.name}\x3c!-- if:${vpcInfo.subnet.cidr} --\x3e（${vpcInfo.subnet.cidr}）\x3c!-- /if --\x3e</span>\n                </span>\n                \x3c!-- if: ${changesubnetDisable} --\x3e\n                <span class="link-like state-disabled">${i18n.变更子网}</span>\n                \x3c!-- else: --\x3e\n                <span data-ui="id:changeSubnet;type:Button" data-command="changeSubnet"\n                    class="link-like cmd-button"\n                    data-track-id="ti_bcc_instance_detail_change_subnet"\n                    data-track-name="变更子网">${i18n.变更子网}</span>\n                \x3c!-- /if --\x3e\n            </li>\n            \x3c!-- /if --\x3e\n            <li>${i18n.内网IP：}\n                <span class="span-text">${instance.internalIp}</span>\n                \x3c!-- if: ${changeipDisable} --\x3e\n                <span class="link-like state-disabled">${i18n.变更内网IP}</span>\n                \x3c!-- else: --\x3e\n                <span data-ui="id:changeIp;type:Button" data-command="changeIp"\n                    class="link-like cmd-button"\n                    data-track-id="ti_bcc_instance_detail_change_ip"\n                    data-track-name="变更内网IP">${i18n.变更内网IP}</span>\n                \x3c!-- /if --\x3e\n            </li>\n            <li>${i18n.操作系统：}\n                <span title="${instance.osType} / ${instance.osVersion}" class="span-text">\n                    \x3c!-- if: ${instance.osName}--\x3e\n                    ${instance.osName} / ${instance.osVersion}\n                    \x3c!-- else --\x3e\n                    ${instance.osType} / ${instance.osVersion}\n                    \x3c!-- /if --\x3e\n                </span>\n                \x3c!-- if: ${rebuild_instanceDisable} --\x3e\n                <span class="link-like state-disabled">${i18n.重装操作系统}</span>\n                \x3c!-- else: --\x3e\n                <span data-ui="id:rebuildInstance;type:Button" data-command="rebuildInstance"\n                    class="link-like cmd-button"\n                    data-track-id="ti_bcc_instance_detail_rebuild"\n                    data-track-name="重装操作系统">${i18n.重装操作系统}</span>\n                \x3c!-- /if --\x3e\n            </li>\n            \x3c!-- if: ${instance.imageType} === \'mkt\' --\x3e\n            <li>${i18n.镜像信息：}\n                <span data-ui-type="Panel" data-ui-id="mktImageLoading" class="loading">\n                    ${i18n.加载中。。。}\n                </span>\n                <span data-ui-type="Panel" data-ui-id="mktImagePanel">\n                </span>\n            </li>\n            \x3c!-- /if --\x3e\n        </ul>\n    </div>\n</div>\n\x3c!-- /block --\x3e'}),define("bcc/instance/detail/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./tpl","jquery","babel-runtime/helpers/interop-require-default","underscore","bat-ria/mvc/BaseView","../../events","../../config","../../util"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d){var u=s["default"](n),p=s["default"](r),f=s["default"](o),m=s["default"](c),h=s["default"](l),g=s["default"](d),v=function(i){function n(){a["default"](this,n),i.call(this),this.template="TPL_bcc_instance_detail"}return e["default"](n,i),n.prototype.getUIEvents=function(){return{"instanceInfoDetailPanel:command":function(e){var t=p["default"].extend(e.args||{},{data:this.model.get("instance")});g["default"].triggerCommand.call(this,e.name,t),e.stopPropagation(),e.preventDefault()},"inline-edit-for-name-submit:click":function(e){g["default"].triggerCommand.call(this,"editName",{data:this.model.get("instance"),toUpdate:{name:this.get("inline-edit-for-name-value").getValue()}})},"inline-edit-for-desc-submit:click":function(e){g["default"].triggerCommand.call(this,"editDesc",{data:this.model.get("instance"),toUpdate:{desc:this.get("inline-edit-for-desc-value").getValue()}})},"inline-edit-for-name-cancel:click":function(e){this.get("inline-edit-for-name-value").setValue(this.model.get("instance").name),this.hideInlineEdit({key:"name"})},"inline-edit-for-desc-cancel:click":function(e){this.get("inline-edit-for-desc-value").setValue(this.model.get("instance").desc),this.hideInlineEdit({key:"desc"})},"startInstance:click":function(e){this.fire(m["default"].START_INSTANCE)},"stopInstance:click":function(e){this.fire(m["default"].STOP_INSTANCE)},"rebootInstance:click":function(e){this.fire(m["default"].REBOOT_INSTANCE)},"createSnapshot:click":function(e){this.fire(m["default"].CREATE_SNAPSHOT)},"upgradeButton:click":function(e){this.fire(m["default"].UPGRADE_CONFIG)},"buySame:click":function(e){this.fire(m["default"].BUY_SAME)},"refreshList:click":function(e){this.fire(m["default"].REFRESH)},"deleteInstance:click":function(e){this.fire(m["default"].DELETE_INSTANCE,{extraData:{instanceId:this.model.get("instanceId")}})},"copyId:aftercopy":function(){this.showToast("已复制到剪贴板")}}},n.prototype.updateMktImage=function(){var e=this.model.get("mktImage"),t=this.get("mktImagePanel"),a='<a target="_blank" href="'+e.productUrl+'">'+e.productName+"（"+e.packageName+"）</a>";this.get("mktImageLoading").hide(),t.setContent(a)},n.prototype.updateDetailView=function(e){var t=e.key,a=p["default"].escape(this.model.get("instance")[t]);u["default"](".inline-edit-main[for="+t+"]").parent(".inline-edit-container").find(".update-value").html(a)},n.prototype.showInlineEdit=function(e){var t=e.key;u["default"](".inline-edit-main[for="+t+"]").show()},n.prototype.hideInlineEdit=function(e){var t=e.key;u["default"](".inline-edit-main[for="+t+"]").hide()},t["default"](n,[{key:"uiProperties",get:function(){return{"inline-edit-for-name-value":p["default"].defaults({validityLabel:"inline-edit-for-name-value-validity"},h["default"].RULE.NAME),"inline-edit-for-desc-value":p["default"].defaults({validityLabel:"inline-edit-for-desc-value-validity"},h["default"].RULE.DESCRIPTION),startInstance:{disabled:"@startDisable"},stopInstance:{disabled:"@stopDisable"},rebootInstance:{disabled:"@rebootDisable"},createSnapshot:{disabled:"@create_snapshotDisable"},deleteInstance:{disabled:"@deleteDisable"},upgradeButton:{disabled:"@upgrade_configDisable"},buySame:{disabled:"@buysameDisable"}}}}]),n}(f["default"]);module.exports=v}),define("bcc/instance/flavor",["exports","module","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","lodash","babel-runtime/helpers/interop-require-default","common/region","common/storage","common/constants","../enum"],function(exports,module,e,t,a,i,n,s,r,o){var c=i["default"](a),l=i["default"](n),d=i["default"](s),u=i["default"](r),p=c["default"].keys(u["default"].SERVICE_TYPE.BCC.region),f=[{region:["hk"],productType:["prepay","postpay"],instanceType:["0","5","7"],flavor:{cpu:[1,2,4,8],memory:{1:[1,2,4,8],2:[2,4,8,12],4:[4,8,12,16],8:[8,12,16,24,32]}}},{region:["default","bj","gz","hk02","su"],productType:["prepay","postpay"],instanceType:["0","5"],flavor:{cpu:[1,2,4,8,12,16],memory:{1:[1,2,4,8],2:[2,4,8,12,16],4:[4,8,12,16,32],8:[8,12,16,24,32,64],12:[12,16,24,32,48,64],16:[16,24,32,48,64]}}},{region:["default","bj","gz","hk02","su"],productType:["prepay","postpay"],instanceType:["4"],flavor:{cpu:[4,8,16,24],memory:{4:[8,16,32],8:[16,32],16:[32,64],24:[96]}}},{region:["default","bj","gz","hk02","su"],productType:["prepay"],instanceType:["7"],flavor:{cpu:[1,2,4,8,12,16,32,48],memory:{1:[1,2,4,8],2:[2,4,8,12,16],4:[4,8,12,16,32],8:[8,12,16,24,32,64],12:[12,16,24,32,48,64],16:[16,24,32,48,64,128],32:[64,128],48:[96,128,192]}}},{region:["default","bj","gz","hk02","su","hkg"],productType:["postpay"],instanceType:["7"],flavor:{cpu:[1,2,4,8,12,16],memory:{1:[1,2,4,8],2:[2,4,8,12,16],4:[4,8,12,16,32],8:[8,12,16,24,32,64],12:[12,16,24,32,48,64],16:[16,24,32,48,64,128]}}},{region:["default","bj","gz","hk","hk02","su"],productType:["prepay","postpay"],instanceType:["8"],flavor:{cpu:[16],memory:{16:[64]},diskSize:450}},{region:["default","bj"],productType:["prepay","postpay"],instanceType:["9"],gpuCards:["nTeslaP40","nTeslaP4","nTeslaK40","nTitanX","nQuadroK1200"],flavor:[{gpuCard:["nTeslaK40","nTitanX"],gpuCount:[1],cpu:[6],memory:{6:[40]},diskSize:200},{gpuCard:["nTeslaK40","nTitanX"],gpuCount:[2],cpu:[12],memory:{12:[80]},diskSize:400},{gpuCard:["nTeslaK40","nTitanX"],gpuCount:[4],cpu:[24],memory:{24:[160]},diskSize:800},{gpuCard:["nTeslaP40","nTeslaP4"],gpuCount:[1],cpu:[12],memory:{12:[40]},diskSize:450},{gpuCard:["nTeslaP40","nTeslaP4"],gpuCount:[2],cpu:[24],memory:{24:[80]},diskSize:900},{gpuCard:["nTeslaP4","nTeslaP40"],gpuCount:[4],cpu:[48],memory:{48:[160]},diskSize:1800},{gpuCard:["nQuadroK1200"],gpuCount:[1],cpu:[12],memory:{12:[60]},diskSize:100},{gpuCard:["nQuadroK1200"],gpuCount:[2],cpu:[24],memory:{24:[120]},diskSize:200}]},{region:["default","hk","hk02"],productType:["prepay","postpay"],instanceType:["9"],gpuCards:["nTeslaP40","nTeslaP4","nTeslaK40","nTitanX"],flavor:[{gpuCard:["nTeslaK40","nTitanX"],gpuCount:[1],cpu:[6],memory:{6:[40]},diskSize:200},{gpuCard:["nTeslaK40","nTitanX"],gpuCount:[2],cpu:[12],memory:{12:[80]},diskSize:400},{gpuCard:["nTeslaK40","nTitanX"],gpuCount:[4],cpu:[24],memory:{24:[160]},diskSize:800},{gpuCard:["nTeslaP40","nTeslaP4"],gpuCount:[1],cpu:[12],memory:{12:[40]},diskSize:450},{gpuCard:["nTeslaP40","nTeslaP4"],gpuCount:[2],cpu:[24],memory:{24:[80]},diskSize:900},{gpuCard:["nTeslaP4","nTeslaP40"],gpuCount:[4],cpu:[48],memory:{48:[160]},diskSize:1800}]},{region:["gz"],productType:["prepay","postpay"],instanceType:["9"],gpuCards:["nTeslaP40","nTeslaP4"],flavor:[{gpuCard:["nTeslaP40","nTeslaP4"],gpuCount:[1],cpu:[12],memory:{12:[40]},diskSize:450},{gpuCard:["nTeslaP40","nTeslaP4"],gpuCount:[2],cpu:[24],memory:{24:[80]},diskSize:900},{gpuCard:["nTeslaP40","nTeslaP4"],gpuCount:[4],cpu:[48],memory:{48:[160]},diskSize:1800}]},{region:["su"],productType:["prepay","postpay"],instanceType:["9"],gpuCards:["nTeslaP40","nTeslaP4","nTitanX"],flavor:[{gpuCard:["nTeslaP40","nTeslaP4"],gpuCount:[1],cpu:[12],memory:{12:[40]},diskSize:450},{gpuCard:["nTeslaP40","nTeslaP4"],gpuCount:[2],cpu:[24],memory:{24:[80]},diskSize:900},{gpuCard:["nTeslaP40","nTeslaP4"],gpuCount:[4],cpu:[48],memory:{48:[160]},diskSize:1800},{gpuCard:["nTitanX"],gpuCount:[1],cpu:[6],memory:{6:[40]},diskSize:200},{gpuCard:["nTitanX"],gpuCount:[2],cpu:[12],memory:{12:[80]},diskSize:400},{gpuCard:["nTitanX"],gpuCount:[4],cpu:[24],memory:{24:[160]},diskSize:800}]},{region:["bd"],productType:["prepay","postpay"],instanceType:["9"],gpuCards:["nTeslaV100","nTeslaP40"],flavor:[{gpuCard:["nTeslaP40"],gpuCount:[1],cpu:[12],memory:{12:[40]},diskSize:450},{gpuCard:["nTeslaP40"],gpuCount:[2],cpu:[24],memory:{24:[80]},diskSize:900},{gpuCard:["nTeslaP40"],gpuCount:[4],cpu:[48],memory:{48:[160]},diskSize:1800},{gpuCard:["nTeslaV100"],gpuCount:[1],cpu:[12],memory:{12:[60]},diskSize:400},{gpuCard:["nTeslaV100"],gpuCount:[2],cpu:[24],memory:{24:[120]},diskSize:800},{gpuCard:["nTeslaV100"],gpuCount:[4],cpu:[48],memory:{48:[240]},diskSize:1600},{gpuCard:["nTeslaV100"],gpuCount:[8],cpu:[96],memory:{96:[480]},diskSize:3200}]},{region:["fsh"],productType:["prepay","postpay"],instanceType:["7"],flavor:{cpu:[2,4,8,12,16,32,48],memory:{2:[2,4,8,12,16],4:[4,8,12,16,32],8:[8,12,16,24,32,64],12:[12,16,24,32,48,64],16:[16,24,32,48,64,128],32:[64,128],48:[96,128,192]}}},{region:["default","bj","gz","su","fwh","hkg","bd"],productType:["prepay","postpay"],instanceType:["10"],flavor:{cpu:[1,2,4,8,12,16,24,32,48,64,96],memory:{1:[1,2,4,8],2:[2,4,8,12,16],4:[4,8,12,16,32],8:[8,12,16,24,32,64],12:[12,16,24,32,48,64],16:[16,24,32,48,64,128],24:[48,96,128],32:[64,128,256],48:[96,128,192,256],64:[128,256],96:[256]}}},{region:["hkg"],productType:["prepay"],instanceType:["7"],flavor:{cpu:[1,2,4,8,12,16,32,48],memory:{1:[1,2,4,8],2:[2,4,8,12,16],4:[4,8,12,16,32],8:[8,12,16,24,32,64],12:[12,16,24,32,48,64],16:[16,24,32,48,64,128],32:[64,128],48:[96,128,192]}}}],m=function(){function a(){t["default"](this,a)}return a.prototype.getFlavor=function(e,t,a){e===undefined&&(e="prepay"),t===undefined&&(t="0");var i=arguments.length<=3||arguments[3]===undefined?1:arguments[3],n=l["default"].getCurrentRegion().id;c["default"].contains(p,n)||(n="default");var s=c["default"].chain(f).find(function(a){return c["default"].contains(a.region,n)&&c["default"].contains(a.productType,e)&&c["default"].contains(a.instanceType,t)}).value();return s?t===o.InstanceType.GPU?(a=a||this.getGpuCard(e)[0],c["default"].find(s.flavor,function(e){return c["default"].contains(e.gpuCard,a)&&c["default"].contains(e.gpuCount,i)})):s.flavor:c["default"].chain(f).find(function(e){return c["default"].contains(e.region,"default")&&c["default"].contains(e.productType,"prepay")&&c["default"].contains(e.instanceType,"0")}).value().flavor},a.prototype.getMinCpu=function(e,t,a,i,n){var s=this.getFlavor(e,t,a,i),r=c["default"].findKey(s.memory,function(e){return e[0]>n});return parseInt(r,10)},a.prototype.getCpu=function(e,t,a,i){var n=this.getFlavor(e,t,a,i);return c["default"].clone(n.cpu)||[]},a.prototype.getMemory=function(e,t,a,i,n){var s=this.getFlavor(t,a,i,n);return c["default"].clone(s.memory[e]||s.memory[s.cpu[0]])},a.prototype.getDiskSize=function(e,t,a,i){return this.getFlavor(e,t,a,i).diskSize},a.prototype.getGpuCard=function(){var e=arguments.length<=0||arguments[0]===undefined?"prepay":arguments[0],t=JSON.parse(d["default"].get("whiteTags")),a=l["default"].getCurrentRegion().id,i=c["default"].chain(f).find(function(t){return c["default"].contains(t.region,a)&&c["default"].contains(t.productType,e)&&c["default"].contains(t.instanceType,o.InstanceType.GPU)}).value();return i?t.isGpuK1200?i.gpuCards:c["default"].contains(i.gpuCards,"nQuadroK1200")?c["default"].without(i.gpuCards,"nQuadroK1200"):i.gpuCards:["nTeslaP40","nTeslaP4","nTeslaK40","nTitanX"]},a.prototype.getGpuCount=function(e){return"bd"===l["default"].getCurrentRegion().id&&e===o.GpuCard.NTESLAV100?[1,2,4,8]:e===o.GpuCard.NQUADROK1200?[1,2]:[1,2,4]},a.prototype.getGpuCardByApi=function(e,t){var a={},i=c["default"].find(e,function(e){return e.logicalZone===t}),n=i&&c["default"].find(i.bccResources,function(e){return 9===e.indexValue&&"available"===e.status});return n&&c["default"].each(n.flavors,function(e){var t=e.gpuCardType;if(!a[t]){var i="soldout"===e.status;a[e.gpuCardType]={name:o.GpuCard.getTextFromValue(t),value:t,disable:i,popover:i?"售罄！请您移步其他可用区购买资源。":""}}}),c["default"].values(a)},e["default"](a,[{key:"Flavors",get:function(){return f}}]),a}();module.exports=new m}),define("bcc/instance/ip/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","inf-ria/mvc/FormAction","babel-runtime/helpers/interop-require-default","inf-ria/decorators","./Model","./View"],function(exports,module,e,t,a,i,n,s,r){var o=i["default"](a),c=i["default"](s),l=i["default"](r),d=function(a){function i(){t["default"](this,s),a.apply(this,arguments)}e["default"](i,a),i.prototype.redirectAfterSubmit=function(){this.model.get("parentAction")?this.model.get("parentAction").reload():this.reload()};var s=i;return i=n.action(c["default"],l["default"])(i)||i}(o["default"]);module.exports=d}),define("bcc/instance/ip/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","inf-ria/mvc/FormModel","babel-runtime/helpers/interop-require-default","underscore","../../config"],function(exports,module,e,t,a,i,n,s){var r=i["default"](a),o=i["default"](n),c=function(a){function i(){t["default"](this,i),a.apply(this,arguments)}return e["default"](i,a),i.prototype.submitRequester=function(e){var t=this.get("requester");if(t)return t(e)},i.prototype.filterData=function(e){var t=this.get("instance"),a=this.get("subnet"),i=this.get("vpc");return{instanceId:t.id,vpcId:i.vpcId,boot:!(!e.boot||"on"!==e.boot),oldIpList:[{privateIp:this.get("internalIp"),subnetId:a.subnetId}],newIpList:[{privateIp:e.privateIp,subnetId:a.subnetId}]}},i.prototype.prepare=function(){var e=this.get("instance");this.set("internalIp",e.internalIp?o["default"].trim(e.internalIp.split("[")[0]):"")},i}(r["default"]);module.exports=c}),define("bcc/instance/ip/tpl",[],function(){return'\x3c!-- target: TPL_bcc_instance_ip --\x3e\n<div class="bcc-instance-detail-ip">\n    <form data-ui-type="Form" data-ui-id="form" data-ui-auto-validate="true">\n        <div class="form-data-body">\n            <div class="form-row">\n                <label>${serviceType}${i18n.名称：}</label>\n                <div class="form-value form-line">\n                    ${instance.name}\n                </div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.所在VPC：}</label>\n                <div class="form-value form-line">\n                    ${vpc.cidr}\n                </div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.所在子网：}</label>\n                <div class="form-value form-line">\n                    <label data-ui-type="Label" data-ui-id="subnetCidr">${subnet.cidr}</label>\n                </div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.当前内网IP：}</label>\n                <div class="form-value form-line">\n                    ${instance.internalIp}\n                    <label data-ui-type="Label"\n                        data-ui-hidden="true"\n                        data-ui-id="internalIp">${internalIp}</label>\n                </div>\n            </div>\n            <div class="form-row">\n                <label class="required-label">${i18n.更改后内网IP：}</label>\n                <div class="form-value">\n                    <input data-ui-type="TextBox"\n                        data-ui-id="privateIp" data-ui-name="privateIp" />\n                    <div class="validity-wrapper">\n                        <label data-ui-type="Validity" data-ui-id="privateIpValidity"></label>\n                    </div>\n                </div>\n            </div>\n            <div class="form-row">\n                <label>&nbsp;</label>\n                <div class="form-value">\n                    <input data-ui-type="CheckBox" data-ui-id="boot" data-ui-name="boot"\n                        \x3c!-- if: ${serviceType} === \'BBC\' --\x3e\n                        data-ui-disabled="true"\n                        \x3c!-- /if --\x3e\n                        title="${i18n.自动重启该服务器}" />\n                    \x3c!-- if: ${serviceType} === \'BCC\' --\x3e\n                    <span data-ui-type="Tip">${i18n.自动重启该服务器令IP更改生效。若选择不重启，用户需手动重启服务器或进入服务器操作系统重启网卡，IP更改方可生效。}</span>\n                    \x3c!-- else: --\x3e\n                    <span data-ui-type="Tip">${i18n.自动重启服务器可自动令IP更改生效，重启预计需要几分钟。当前不支持客户自行修改IP。}</span>\n                    \x3c!-- /if --\x3e\n                </div>\n            </div>\n        </div>\n    </form>\n</div>\n\n\x3c!-- target: TPL_bcc_instance_ip_child --\x3e\n\x3c!-- import: TPL_bcc_instance_ip --\x3e\n'}),define("bcc/instance/ip/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-decorated-class","babel-runtime/helpers/class-call-check","babel-runtime/core-js/symbol","bat-ria/tpl!./tpl","inf-ria/mvc/FormView","babel-runtime/helpers/interop-require-default","inf-ria/decorators"],function(exports,module,e,t,a,i,n,s,r,o){var c=function(e){for(var t=(e=+e).toString(2),a="",i=0;i<8-t.length;i++)a+="0";return a+t},l=function(n){function s(){a["default"](this,r),n.apply(this,arguments)}e["default"](s,n),s.prototype.getExtraFormData=function(){return{boot:this.get("boot").isChecked()?"on":"off"}},t["default"](s,[{key:i["default"](),decorators:[o.uiProp("privateIp")],value:function(){return{required:!0,pattern:/^(([01]?\d?\d|2[0-4]\d|25[0-5])\.){3}([01]?\d?\d|2[0-4]\d|25[0-5])$/,patternErrorMessage:"IP地址格式错误",validityLabel:"privateIpValidity",custom:function(e){if(e===this.viewContext.controls.internalIp.getText())return!1;for(var t=this.viewContext.controls.subnetCidr.getText().split("/"),a=+t[1],i=[],n=[],s=t[0].split("."),r=e.split("."),o=0,l=s.length;o<l;o+=1)i.push(c(s[o])),n.push(c(r[o]));return i=i.join(""),n=n.join(""),i.substring(0,a)===n.substring(0,a)&&n.substring(a,n.length).indexOf("0")>-1},customErrorMessage:"请确保填写的IP地址属于所在子网的IP段地址范围内且不能和当前内网IP重复"}}},{key:i["default"](),decorators:[o.uiProp("boot")],value:function(){return{checked:!0}}}]);var r=s;return s=o.template("TPL_bcc_instance_ip")(s)||s}(r["default"](s)["default"]);module.exports=l}),define("bcc/instance/join_security_groups.tpl",[],function(){return'\x3c!-- target: TPL_bcc_instance_join_security_groups --\x3e\n<div class="main-wrap-new bcc-instance-join-security-groups">\n<form data-ui-type="Form"\n      data-ui-id="form"\n      data-ui-auto-validate="true">\n    \x3c!-- if: ${instances.length} --\x3e\n    <p>\n        ${i18n.您选择的需要关联的云服务器实例为}\n        \x3c!-- for: ${instances} as ${item} --\x3e\n        “${item.name}”、\n        \x3c!-- /for --\x3e\n        ${i18n.请在下方选择需要关联的安全组}\n    </p>\n    \x3c!-- /if --\x3e\n\n    <div data-ui-type="Table"\n         data-ui-id="securityGroups"></div>\n</form>\n</div>\n\n\x3c!-- target: TPL_bcc_instance_join_security_groups_child --\x3e\n\x3c!-- import: TPL_bcc_instance_join_security_groups --\x3e\n'}),define("bcc/instance/JoinSecurityGroups",["require","bat-ria/mvc/FormAction","underscore","./JoinSecurityGroupsModel","./JoinSecurityGroupsView","er/util"],function(require){function e(){a.apply(this,arguments)}function t(){var e=this.view,t=this.model,a=i.pluck(t.get("instances"),"id"),n=e.get("securityGroups"),s=n.datasource,r=[];i.each(s,function(e,t,n){i.intersection(a,i.pluck(e.instances,"id")).length===a.length?r[t]=+t:r[t]=!1}),n.setRowSelected(r,!0)}var a=require("bat-ria/mvc/FormAction"),i=require("underscore");return e.prototype.modelType=require("./JoinSecurityGroupsModel"),e.prototype.viewType=require("./JoinSecurityGroupsView"),e.prototype.redirectAfterSubmit=function(){if(this.context.isChildAction){var e=this.model.get("parentAction");e&&e.reload()}else a.prototype.redirectAfterSubmit.apply(this,arguments)},e.prototype.initBehavior=function(){a.prototype.initBehavior.apply(this,arguments),this.on("entercomplete",t,this)},require("er/util").inherits(e,a),e}),define("bcc/instance/JoinSecurityGroupsModel",["require","bat-ria/mvc/FormModel","underscore","common/util","../config","er/util"],function(require){function e(){t.apply(this,arguments),this.submitRequester=n.bccInstanceJoinSecurityGroups}var t=require("bat-ria/mvc/FormModel"),a=require("underscore"),i=require("common/util"),n=require("../config").api;return e.prototype.datasource=[{vpcInfo:function(e){var t={vpc:{},subnet:{}};if(e.get("instances")&&!e.get("instances")[0].vpcId){var a=e.get("instances")[0].id;return n.getVpcDetail({bccIds:[a]}).then(function(e){var n=e[a]||t;return n.vpc.name=i.getVpcName(n.vpc.name),n.subnet.name=i.getSubnetName(n.subnet.name),n})}return t}},{securityGroups:function(e){return e.getAllSecurityGroups()}}],e.prototype.getAllSecurityGroups=function(){var e=a.pluck(this.get("instances"),"vpcId"),t={};return e&&e.length>0&&(t.vpcId=e[0]||this.get("vpcInfo").vpc.vpcId),n.bccSecurityList(t).then(function(e){return a.isArray(e.result)&&a.each(e.result,function(e){e.name=a.escape(e.name),e.desc=a.escape(e.desc)}),e.result})},e.prototype.getExtraData=function(){return{instanceIds:a.map(this.get("instances"),function(e){return e.id}),securityGroupIds:this.get("securityGroupIds")||[]}},require("er/util").inherits(e,t),e}),define("bcc/instance/JoinSecurityGroupsView",["require","bat-ria/tpl!./join_security_groups.tpl","bat-ria/mvc/FormView","underscore","inf-i18n","common/util","er/util"],function(require){function e(){t.apply(this,arguments)}require("bat-ria/tpl!./join_security_groups.tpl");var t=require("bat-ria/mvc/FormView"),a=require("underscore"),i=require("inf-i18n"),n=require("common/util");e.prototype.template="TPL_bcc_instance_join_security_groups";var s=[{title:i("安全组名称"),content:"name"},{title:i("所在网络"),content:function(e){return n.getVpcName(e.vpcName)}},{title:i("安全组描述"),content:"desc"}];return e.prototype.uiProperties={securityGroups:{fields:s,select:"multi",selectMode:"line",datasource:"@securityGroups"}},e.prototype.uiEvents={"securityGroups:select":function(e){var t=a.map(e.target.getSelectedItems(),function(e){return e.id});this.model.set("securityGroupIds",t)}},require("er/util").inherits(e,t),e}),define("bcc/instance/List",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","inf-i18n","intro.js","er/URL","inf-ria/app/brpc","../mvc/ListAction","common/region","common/util/dialog","common/billing/common","common/storage","./ListModel","./ListView","../events","../config","../operations","../enum","./bcmDetail","../ssh/bindSsh"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p,f,m,h,g,v,b,y,T){function x(){this.redirect("/bcc/instance/create")}function I(e){this.redirect(V["default"].withQuery("/bcc/instance/detail",{instanceId:e.instanceId}))}function S(e){var t=e.item;this.redirect(V["default"].withQuery("/bcc/instance/upgrade_config",{instanceId:t.id}))}function E(e){z["default"].recharge("BCC",e.instanceIds)}function w(e){var t=this,a=this.model.get("tableData")[parseInt(e.rowIndex,10)];Q["default"].handler("instance.rename",this.view,{name:e.value,instanceIds:a.id},null,function(e){t.view.get("table").showEditError(e.field.name)})}function k(e){Q["default"].instanceCreateSnapshot.call(this,{instanceId:e.instanceId||e.item.id})}function C(e){Q["default"].instanceCreateImage.call(this,{instanceUuid:e.item.id,instanceId:e.item.instanceId||e.item.id})}function D(e){Q["default"].instanceChangeName.call(this,{instanceIds:e.instanceIds,instanceNames:e.instanceNames})}function _(e){var t=this,a=e.instanceIds||[e.instanceId],i=e.instanceUuids||[e.instanceUuid];Q["default"].instanceChangePwd.call(this,{instanceIds:a,instanceUuids:i}).then(function(e){var a=e.target;t.dialog=a;a.getAction().view.get("form").on("aftervalidate",function(e){e.isValid&&a.hide()})})}function A(e){var t=this;q["default"].waitActionDialog(this.view,{title:"释放前确认",width:600,needFoot:!0,url:"/bcc/instance/require_auth_code",actionOptions:{extraData:e.extraData,requester:g.api.bccInstanceDelete,tip:this.model.get("tips").instance.bccDeleteTip,serviceType:"BCC",instances:e.instances,parentAction:this}}).then(function(e){var a=e.target;t.dialog=a;a.getFoot().getChild("btnOk").on("click",function(e){return a.hide()}),a.on("cancel",function(){return t.view.resetMoreOperation()}),a.on("close",function(){return t.view.resetMoreOperation()})})}function P(e){var t=this;Q["default"].instanceRebuild.call(this,{instanceId:e.instanceId||e.item.id,imageId:e.imageId||e.item.imageId,osType:e.osType||e.item.osType}).then(function(e){var a=e.target;t.dialog=a;var i=e.target.getAction();i.view.get("form").on("aftervalidate",function(e){e.isValid&&i.customValiate()&&a.hide()}),i.on("expandDisk",Q["default"].expandDisk,t)})}function R(e){Q["default"].releaseShedule.call(this,{item:e.item})}function N(e){var t=require.toUrl("bcc/vnc/relay.html"),a=V["default"].serialize({instanceId:e.instanceId||e.item.id,type:"novnc",instanceName:e.instanceName||e.item.name,region:H["default"].getCurrentRegion().id});-1!==t.indexOf("?")?t+="&"+a:t+="?"+a,location.search&&(t+="&"+location.search.substr(1)),window.open(t)}function L(e){var t=this,a=e.item,i={instanceType:"BCC",instanceId:a.id,instancePayment:a.payment,listRequester:g.api.bccEipInstanceList,submitRequester:g.api.bccEipBind};G["default"].invokeService("eip://bind",i).then(function(){return t.reload()})}function $(e){var t=e.item;Q["default"].confirmHandler({title:B["default"]("提示"),content:M["default"].sprintf(B["default"]("您确定解绑%s吗？"),t.publicIp),width:320},"instance.unbindEip",this.view,{eip:t.publicIp})}function O(e){this.view.showToast(B["default"]("已复制到剪贴板"))}var M=i["default"](a),B=i["default"](n),U=i["default"](s),V=i["default"](r),G=i["default"](o),F=i["default"](c),H=i["default"](l),q=i["default"](d),z=i["default"](u),Y=i["default"](p),K=i["default"](f),W=i["default"](m),j=i["default"](h),Q=i["default"](v),X=i["default"](y),Z=i["default"](T),J=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=K["default"],this.viewType=W["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.view.on(j["default"].FILTER,this.filterList,this),this.view.on(j["default"].REFRESH,this.refresh,this),this.view.on(j["default"].CREATE_INSTANCE,x,this),this.view.on(j["default"].TO_DETAIL,I,this),this.view.on(j["default"].REBUILD_INSTANCE,P,this),this.view.on(j["default"].SAVE_EDIT,w,this),this.view.on(j["default"].CREATE_SNAPSHOT,k,this),this.view.on(j["default"].CREATE_IMAGE,C,this),this.view.on(j["default"].CHANGE_NAME,D,this),this.view.on(j["default"].CHANGE_PWD,_,this),this.view.on(j["default"].GET_VNC_URL,N,this),this.view.on(j["default"].UPGRADE_CONFIG,S,this),this.view.on(j["default"].RELEASE_SHEDULE,R,this),this.view.on(j["default"].BIND2EIP,L,this),this.view.on(j["default"].UNBINDEIP,$,this),this.view.on(j["default"].COPYID,O,this),this.view.on("bcmDetail",this.bcmDetail,this),this.view.on(j["default"].RECHARGE_BATCH,E,this),this.view.on("JOIN_SECURITY_GROUPS",this.joinSecurityGroups,this),this.view.on(j["default"].DELETE_INSTANCE,A,this),this.view.on(j["default"].ALTER_PRODUCTTYPE,this.alterProductType,this),this.view.on(j["default"].CANCEL_ALTER_PRODUCTTYPE,this.cancelAlterProductType,this),this.view.on(j["default"].EDIT_TAG,this.editTag,this),this.view.initTableSelectItem("id",this.model.get("id")),this.view.on("closeQrCode",function(){return Y["default"].set("close-qr-ad-promotions",!0)}),this.view.on("BIND_SSH",this.bindSsh,this),this.view.on("UNBIND_SSH",this.unbindSsh,this),this.setIntervalRefreshTable(),this.on("beforeleave",function(){clearInterval(this.timer)}),this.on("listDataFailed",this.listDataFailedHandler,this),this.on("listDataLoaded",this.showListTip,this),this.on("listDataLoaded",this.showIntro,this),this.on("listDataLoaded",this.displayQrCode,this)},i.prototype.bcmDetail=function(e){X["default"].from(e.item).show()},i.prototype.bindSsh=function(e){var t=this;this._SSHComponent&&this._SSHComponent.dispose(),this._SSHComponent=new Z["default"]({data:{type:"BIND",payload:e.selectedItems}}),this._SSHComponent.attach(document.body),this._SSHComponent.on("ok",function(e){return t.refresh()}),this._SSHComponent.on("cancel",function(e){return t.view.resetMoreOperation()}),this._SSHComponent.on("close",function(e){return t.view.resetMoreOperation()})},i.prototype.unbindSsh=function(e){var t=this;this._SSHComponent&&this._SSHComponent.dispose(),this._SSHComponent=new Z["default"]({data:{type:"UNBIND",payload:e.selectedItems}}),this._SSHComponent.attach(document.body),this._SSHComponent.on("ok",function(e){return t.refresh()}),this._SSHComponent.on("cancel",function(e){return t.view.resetMoreOperation()}),this._SSHComponent.on("close",function(e){return t.view.resetMoreOperation()})},i.prototype.displayQrCode=function(){this.qrCodeDisplayed||Y["default"].get("close-qr-ad-promotions")||(this.view.displayQrCode(),this.qrCodeDisplayed=!0)},i.prototype.showListTip=function(){this.view.showListTip()},i.prototype.showIntro=function(){var e=this;Y["default"].get("bcc-intro-20170407")||function(){e.view.setTableHeadIntro();var t=U["default"]();t.setOptions({tooltipClass:"bcc-instance-list-intro"}),t.start(),Y["default"].set("bcc-intro-20170407",!0),e.on("beforeleave",function(e){return t.exit()})}()},i.prototype.refresh=function(){var e=this.view.getSearchArgs();if(e.filters||e.keyword)return delete e.filters,delete e.keyword,delete e.keywordType,this.redirect(V["default"].withQuery("/bcc/instance/list",e));this.asyncListPage()},i.prototype.listDataFailedHandler=function(){this.view.updatePageData({tableData:[]},"<div><p>列表数据加载异常，请刷新页面！</p></div>")},i.prototype.syncModelToViewIterator=function(e){switch(e.name){case"tableData":this.model&&this.model.checkForRealName();break;case"realname":this.view&&this.view.setRealnameTip();break;case"quota":this.view&&this.view.setQuotaTip();break;case"hasHost":this.view.handleDccInstanceTitle();break;case"bccTags":this.view.updateKeywordType()}},i.prototype.editTag=function(e){var t=this;M["default"].each(e.data,function(e){return e.resoureId=e.instanceId});var a={serviceType:"BCC",instances:e.data,submitRequester:g.api.bccTagAssign};G["default"].invokeService("tag://edit",a).then(function(){return t.reload()})},i.prototype.joinSecurityGroups=function(e){Q["default"].joinSecurityGroups.call(this,{instances:e.instances})},i.prototype.alterProductType=function(e){if(M["default"].chain(e.productTypes).uniq().value().length>1)return this.view.waitAlert({title:"温馨提示",content:"计费变更已经支持预付费转后付费和后付费转预付费两种模式。<br>请您将预付费资源和后付费资源分开操作，谢谢！",encode:!1});var t=e.productTypes[0]===b.ProductType.PREPAY?"TO_POSTPAY":"TO_PREPAY";z["default"].alterProductType("BCC",e.instanceIds,t)},i.prototype.cancelAlterProductType=function(e){Q["default"].confirmHandler({title:"取消计费变更",content:"确认取消计费变更？<br/>您已开通计费变更-预付费转后付费功能。<br/>实例将会在到期后自动转换为后付费的计费方式。",width:420,encode:!1},"instance.cancelAlterProductType",this.view,{serviceType:"BCC",instanceIds:e.instanceIds})},i.prototype.setIntervalRefreshTable=function(){var e=this;this.timer=setInterval(function(){return e.intervalRefreshListPage()},g.BCC_LISTEN_INTERVAL)},i.prototype.intervalRefreshListPage=function(){var e=this;this.view.shouldKeepSelectedIndex=!0,this.retrieveListPage().then(function(){return e.view.shouldKeepSelectedIndex=!1})},i.prototype.redirectAfterDelete=function(){this.redirect(this.getURLForPage(this.model.get("pageNo")||1))},i.prototype.filterList=function(e){this.model.setFilters(e.condition),this.view.submitSearch(e)},i}(F["default"]);module.exports=J}),define("bcc/instance/list.tpl",[],function(){return'\x3c!-- target: TPL_bcc_instance --\x3e\n<div class="bcc-instance bcc-main-wrap main-wrap-new">\n    <div class="content-wrap">\n        <p class="breadcrumb">\n            <span>${i18n.产品服务}</span>\n            <span class="divider">/</span>\n            <span class="active">${i18n.云服务器BCC}-${i18n.实例列表}</span>\n        </p>\n        <div class="list-content">\n            \x3c!-- import: TPL_bcc_instance_notice --\x3e\n            \x3c!-- import: TPL_bcc_instance_list_navigator --\x3e\n            <h2 class="h2-text">${i18n.实例}</h2>\n            <div class="table-full-wrap">\n                <p data-ui-id="realnameTip"\n                    data-ui-type="ToastLabel"\n                    data-ui-message-type="alert"\n                    data-ui-hidden="true"\n                    class="realname-tip"></p>\n                <div class="link-wrap">\n                \x3c!-- import: TPL_bcc_common_quick_search --\x3e\n                <a href="/billing/#/renew/list~serviceType=BCC"><i class="iconfont icon-renewmanage"\n                data-track-id="ti_bcc_instance_autorecharge" data-track-name="自动续费"></i>${i18n.自动续费}</a>\n                </div>\n                <div class="operation-wrap" data-follow-thead="table">\n                    <div class="buttons-wrap">\n                        <div data-ui-id="createInstance"\n                            data-ui-type="Button"\n                            data-ui-skin="create"\n                            data-auth="forbidden"\n                            data-authtype="READONLY"\n                            data-ui-extension-popover-type="PopoverEx" data-ui-placement={"center":"top"}>${i18n.创建实例}</div>\n                        <div data-ui-type="Button"\n                                data-ui-id="recharge"\n                                title="${i18n.批量续费}"\n                                data-ui-extension-popover-type="PopoverEx" data-ui-placement={"center":"top"}\n                                data-track-id="ti_bcc_instance_recharge" data-track-name="续费">${i18n.续费}</div>\n                        <div data-ui-type="Button"\n                                data-ui-id="editTag"\n                                title="${i18n.标签}"\n                                data-intro="${i18n.资源可以打标签啦}"\n                                data-ui-extension-popover-type="PopoverEx" data-ui-placement={"center":"top"}\n                                data-track-id="ti_bcc_instance_edit_tag" data-track-name="编辑标签">${i18n.编辑标签}</div>\n                        <span data-ui-type="Select" data-ui-id="moreOpt" data-ui-skin="light" data-ui-extension-popover-type="PopoverEx" data-track-id="ti_bcc_instance_more_opt" data-track-name="更多操作"></span>\n                    </div>\n                    <div class="buttons-quick-wrap">\n                        <span class="ui-group ui-search-group" data-intro="${i18n.可以按标签来搜索资源}">\n                            <span data-ui-type="SelectEx" data-ui-id="keywordType"\n                                  data-ui-value="@keywordType"\n                                  data-ui-has-child-list="true"\n                                  data-track-id="ti_bcc_instance_search_select"\n                                  data-track-name="搜索下拉选择"></span>\n                            <input class="search-box" data-ui-type="TextBox"\n                                   data-ui-id="keyword" data-ui-value="@keyword"\n                                   data-ui-extension-textbox-type="TextBoxSelect"/>\n                            <button data-ui-type="Button" data-ui-id="searchBtn" data-track-id="ti_bcc_instance_search" data-track-name="搜索"></button>\n                        </span>\n                        <button type="button"\n                            data-ui-type="Button" data-ui-id="refreshList" title="${i18n.刷新表格数据，取消筛选条件}"\n                            data-track-id="ti_bcc_instance_refresh" data-track-name="刷新">\n                            <i class="iconfont icon-cdnrefresh"></i>\n                        </button>\n                        <button data-ui="type:Button;id:downloadList;" title="${i18n.下载当前列表展现的实例信息，编码格式为utf-8}"\n                        data-track-id="ti_bcc_instance_download" data-track-name="下载">\n                            <i class="iconfont icon-download"></i>\n                        </button>\n                        <div id="table-custom-fields-container"\n                        data-track-id="ti_bcc_instance_custom_fields" data-track-name="自定义列"></div>\n                    </div>\n                </div>\n                <div data-ui-type="Table" data-ui-id="table"\n                     data-ui-datasource="@tableData"\n                     data-ui-order-by="@orderBy" data-ui-order="@order"\n                     data-ui-select="@selectMode" data-ui-extension-tip-type="TableTip"\n                     data-ui-extension-command-type="Command"\n                     data-ui-extension-tableedit-type="TableEdit"\n                     data-ui-extension-tableex-type="TableEx"\n                     data-ui-extension-customfields-type="TableCustomFields"\n                     data-ui-extension-tablefilter-type="TableFilter"\n                     data-track-id="ti_bcc_instance_table" data-track-name="列表操作">\n                </div>\n                <div class="ui-row clearfix">\n                    <span class="selected-tip"></span>\n                    <div class="listpager-container">\n                        \x3c!-- import: TPL_bcc_list_pager --\x3e\n                    </div>\n                    <span class="total-tip"></span>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("bcc/instance/ListModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","../mvc/ListModel","babel-runtime/helpers/interop-require-default","er/URL","underscore","inf-i18n","common/constants","common/region","../config","../tips","../flags","../common"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p,f){var m=n["default"](i),h=n["default"](s),g=n["default"](r),v=n["default"](o),b=n["default"](c),y=n["default"](l),T=n["default"](u),x=n["default"](p),I={"X-silence":!0},S=function(i){function n(e){a["default"](this,n),i.call(this,e)}return e["default"](n,i),n.prototype.listRequester=function(e){return d.api.bccInstanceList(e,{"x-silent":!0})},n.prototype.getVNCUrl=function(e,t,a){return d.api.bccVNCUrl({instanceId:e,type:t,instanceName:a})},n.prototype.getDownloadUrl=function(){var e=this.getQuery();return e.filters&&(e.filters=JSON.stringify(e.filters)),delete e.pageNo,delete e.pageSize,delete e.instanceType,"/api/bcc/instance/download?"+h["default"].serialize(e)},n.prototype.prepare=function(){var e=this;this.getBccQuota(),this.getHost(),this.getBccTags();var t=this.get("filters");"string"==typeof t&&function(){try{t=JSON.parse(t)}catch(i){}e.set("filters",t,{silent:!0});var a={};g["default"].each(t,function(e){a[e.join("")]=!0}),e.set("filterMapper",a,{silent:!0})}();var a=[d.FILTER.INSTANCE.NAME,d.FILTER.INSTANCE.ID,d.FILTER.INSTANCE.INTERNALIP,d.FILTER.INSTANCE.PUBLICIP,d.FILTER.INSTANCE.VPC,d.FILTER.INSTANCE.SUBNET,d.FILTER.INSTANCE.SSHNAME,d.FILTER.INSTANCE.SSHID,d.FILTER.INSTANCE.SUBNETID];this.set("keywordTypeDatasource",a),this.set("notice",{text:v["default"]("百度云推出安全入侵检测系统——流量审计IDS，全面监控资产安全，开启获得500G免费分析流量!"),url:"/bss/#/bss/ids/statistics"})},n.prototype.getBccQuota=function(){var e=this;return d.api.bccQuota({objType:"bcc"},I).then(function(t){e.set("quota",t)})},n.prototype.getBccTags=function(){var e=this;return d.api.getSearchTagList({serviceType:["BCC"],region:[y["default"].getCurrentRegion().id]},I).then(function(t){var a=g["default"].groupBy(t,"tagKey");g["default"].each(a,function(e,t){a[t]=g["default"].map(e,function(e){return{name:e.tagValue||"空值",value:e.tagValue}}),a[t]=[{name:"所有值",value:"@@@"}].concat(a[t])});var i=g["default"].extend({"(全部)":[{name:"所有值",value:"@@@"}],"(无标签)":[{name:"空值",value:""}]},a);e.set("bccTags",i)})},n.prototype.getHost=function(){var e=this;return d.api.getDccHostList({pageSize:1,pageNo:1},I).then(function(e){return e.result.length>0}).then(function(t){return t?e.set("hasHost",!0):d.api.getDccInstanceList({pageSize:1,pageNo:1},I).then(function(t){return e.set("hasHost",t.result.length>0)})})},n.prototype.filterQuery=function(e){var t=[],a=e.keyword,i=e.keywordType;if(e.filters){var n=e.filters;delete e.filters;try{n=JSON.parse(n)}catch(s){}g["default"].each(n,function(a){"expiredDate<7"===a.join("")?e.showMode="WILLEXPIRED":"configuration"===a[0]?a[1]&&(e.instanceType=[a[1]]):t.push({keywordType:a[0],keyword:a[1]})})}return i.match(/^tag\/([\u4e00-\u9fa5\w\-\/\.@]{0,64})$/)&&(i="tag","空值"===a&&(a=""),"所有值"===a&&(a="@@@")),(e.keyword||"tag"===i)&&t.push({keywordType:i,subKeywordType:e.subKeywordType||"",keyword:a||""}),e.filters=t,e.pageNo&&(e.pageNo=+e.pageNo),"id"===e.orderBy&&(e.orderBy="name"),e},n.prototype.setFilters=function(e){this.set("filters",e)},n.prototype.checkForRealName=function(){var e=this,t=this.get("realname"),a=this.get("tableData");!t&&g["default"].some(a,function(e){if(e.payment===d.PAYMENT.POSTPAY||e.publicIp)return!0})&&d.api.bccRealname({},I).then(function(t){e.set("realname",t)})},t["default"](n,[{key:"datasource",get:function(){return{menu:function(){return"instance"},enableDcc:function(){var e=b["default"].availableService?b["default"].availableService.split(","):[];return x["default"].enable_dcc&&g["default"].contains(e,"DCC")},tips:function(){return T["default"]},beian:function(){return!f.isRegionHK()&&b["default"].domains.beian},hasHost:function(e){return"dccInstanceList"===e.get("from")},activedTab:g["default"].constant("instance")}}},{key:"defaultArgs",get:function(){return{keywordType:d.FILTER.INSTANCE.NAME.value,order:"desc",orderBy:"createTime",pageSize:d.pageSize,serverType:"BCC"}}}]),n}(m["default"]);module.exports=S}),define("bcc/instance/listPageRouter",["exports","module","lodash","babel-runtime/helpers/interop-require-default","er/locator","common/storage","common/constants","common/region","../landing/Action","./List"],function(exports,module,e,t,a,i,n,s,r,o){var c=t["default"](e),l=t["default"](a),d=t["default"](i),u=t["default"](n),p=t["default"](s),f=t["default"](r),m=t["default"](o);module.exports={createRuntimeAction:function(){var e=c["default"].keys(u["default"].SERVICE_TYPE.BCC.region),t=c["default"].keys(u["default"].SERVICE_TYPE.DCC.region),a=p["default"].getCurrentRegion().id;return d["default"].set("bcc-only-dcc",!1),!c["default"].contains(e,a)&&c["default"].contains(t,a)?(d["default"].set("bcc-only-dcc",!0),l["default"].redirect("/dcc/instance/list")):c["default"].contains(e,a)||c["default"].contains(t,a)?d["default"].get("bcc-landing-20170103")?new m["default"]:(d["default"].set("bcc-landing-20170103",!0),new f["default"]):l["default"].redirect("/region/404")}}}),define("bcc/instance/ListView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./list.tpl","inf-ria/ui/Clipboard","../mvc/ListView","babel-runtime/helpers/interop-require-default","etpl","underscore","jquery","esui/lib","inf-i18n","common/util/timeUtil","common/auth","common/util/tableUtil","common/zone","common/util","common/region","common/util/PermissionChecker","../config","../enum","../events","../operations","common/flags","common/storage","./rules"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p,f,m,h,g,v,b,y,T,x,I,S,E,w){var k=r["default"](s),C=r["default"](o),D=r["default"](c),_=r["default"](l),A=r["default"](d),P=r["default"](u),R=r["default"](p),N=r["default"](f),L=r["default"](m),$=r["default"](h),O=r["default"](v),M=r["default"](b),B=r["default"](x),U=r["default"](I),V=r["default"](S),G=r["default"](E),F=r["default"](w),H=[{field:"id",title:P["default"]("实例名称/ID"),width:"15%",minWidth:140,sortable:!0,content:function(e,t,a){if(!e.name)return'<div>\n                    <span class="instance-id" title="'+(e.instanceId||e.id)+'">'+(e.instanceId||e.id)+'</span>\n                    <button data-ui-type="Clipboard"\n                       class="link-like link-copy"\n                       data-ui-clipboard-text="'+(e.instanceId||e.id)+'"\n                       data-ui-x-event-name="clipboard"\n                       data-ui-x-event-type="aftercopy,error"\n                       data-ui-x-event-bubble="true"\n                       data-ui-id="copyId'+t+'">\n                       <i class="iconfont icon-copy" title='+P["default"]("复制到剪贴板")+"></i>\n                   </button>\n                   </div>";var i='<span class="instance-name">'+D["default"].escape(e.name)+"</span>";e.id&&(i='<a href="#/bcc/instance/detail~instanceId='+e.id+'"\n                            title="'+D["default"].escape(e.name)+'" class="instance-name"\n                            data-track-id="ti_bcc_instance_name_link"\n                            data-track-name="实例名称-详情页">\n                        '+D["default"].escape(e.name)+"\n                    </a>");var n=D["default"].contains(y.INSTANCE_STATUS.CAN_EDITNAME,e.status)?'<span class="ui-table-cell-editentry"data-row="'+t+'" data-col="'+a+'"><i class="iconfont icon-edit"></i></span>':"",s=e.autoRenew?'<i class="iconfont icon-auto-renew" title='+P["default"]("已开通自动续费")+"></i>":"",r="cce"===e.application?'<i class="iconfont icon-cce-node" title='+P["default"]("容器节点")+"></i>":"",o="as"===e.application?'<i class="iconfont icon-auto-scaling" title='+P["default"]("弹性伸缩节点")+"></i>":"";return i+(e.specificType?'<i class="specific-type"></i>':"")+n+'<br />\n                <span class="instance-id" title="'+(e.instanceId||e.id)+'">'+(e.instanceId||e.id)+"</span>"+(e.scheduledSnapshot?'<i title="'+P["default"]("定时自动快照任务已启动")+'" class="iconfont icon-alarm-clock"></i>':"")+s+r+o+'<button data-ui-type="Clipboard"\n                       class="link-like link-copy"\n                       data-ui-clipboard-text="'+(e.instanceId||e.id)+'"\n                       data-ui-x-event-name="clipboard"\n                       data-ui-x-event-type="aftercopy,error"\n                       data-ui-x-event-bubble="true"\n                       data-ui-id="copyId'+t+'"\n                       data-track-id="ti_bcc_instance_copy_id"\n                       data-track-name="复制ID">\n                       <i class="iconfont icon-copy" title='+P["default"]("复制到剪贴板")+"></i>\n                   </button>"},editContent:function(e){return D["default"].escape(e.name)},editWidth:250,editRules:D["default"].omit(y.RULE.NAME,"placeholder"),editNote:y.RULE.NAME.placeholder},{field:"status",title:P["default"]("状态"),width:"9%",minWidth:75,filter:{datasource:T.InstanceStatus.getFilterStatus()},content:function(e,t){var a=e.status;"to_prepay"===e.orderStatus&&(a=T.InstanceStatus.BILLING_CHANGING);var i='<span data-command="bcmDetail" data-command-args="\n            '+t+'" data-track-id="ti_bcc_instance_drawer_monitor"\n            data-track-name="监控浮层"><i class="iconfont icon-bcm" title='+P["default"]("查看监控")+"></i></span/>",n='<a href="/bss/#/bss/bcc/list" target="_blank" title="查看主机安全"\n            class="host-eye host-eye-'+("dead"===e.hostEyeStatus?"inactive":"active")+'">\n                <i class="iconfont icon-host-eye"></i>\n            </a><br>';return'<span class="status-icon">\n                    '+("BUILD"===e.status||V["default"].enable_baixin?n:i+n)+'\n                </span>\n                <span class="status '+(T.InstanceStatus.fromValue(a).klass||"status error")+'">\n                    '+(T.InstanceStatus.getTextFromValue(a)||"-")+"\n                </span>"}},{field:"payment",title:P["default"]("支付方式"),width:"9%",minWidth:97,filter:{datasource:[{name:P["default"]("全部"),value:""},{name:P["default"]("预付费"),value:"prepay"},{name:P["default"]("后付费"),value:"postpay"}]},content:function(e,t){var a=P["default"]("该实例已开通计费变更-预付费转后付费，将会在到期后转为后付费资源，请关注！<br>如需进行续费、升配等操作，请先取消计费变更，谢谢！");return e.payment!==T.ProductType.PREPAY||"to_postpay"!==e.orderStatus||e.specificType||g.isSubUser()?y.PAYMENT_DESC[e.payment]:y.PAYMENT_DESC[e.payment]+'&nbsp;<span data-ui-type="Tip"data-ui-id="alterProductTip${row}"data-ui-skin="warning"data-ui-arrow="true"data-ui-content="'+a+'"></span>'}},{field:"createTime",title:P["default"]("创建时间"),width:"11%",minWidth:96,sortable:!0,content:function(e){return R["default"].toDate(e.createTime)}},{title:P["default"]("到期时间"),field:"expireTime",width:"11%",minWidth:96,sortable:!0,content:function(e,t,a){var i="",n="",s=O["default"].getCurrentRegion().id,r='<a href="/billing/#/billing/recharge/list~serviceType=BCC&instanceIds='+(e.id+";"+e.instanceId)+"&region="+s+'&rechargeType=ASSOCIATED">\n                '+P["default"]("续费入口")+">>\n            </a>";if(e.status===T.InstanceStatus.EXPIRED)n=""+P["default"]("您的实例已经过期，请您尽快续费。")+r;else{var o=P["default"]("您的实例还有%s天到期，请您尽快续费。");n="\n                    "+D["default"].sprintf(o,e.expireDate)+"\n                    "+r+"\n                "}return e.expireDate<7&&!e.orderStatus&&(i=' <span data-ui-type="Tip"\n                    data-ui-id="expireTimeTip'+t+'"\n                    data-ui-skin="warning"\n                    data-ui-arrow="true"\n                    data-ui-content=\''+n+"'></span>"),e.payment===y.PAYMENT.PREPAY?R["default"].toDate(e.expireTime)+i:"-"}},{field:"publicIp",title:P["default"]("公网IP/带宽"),minWidth:100,width:"12%",content:function(e,t){var a="",i="",n=O["default"].getCurrentRegion().id,s='\n            <a href="/billing/#/billing/recharge/list~serviceType=EIP&instanceIds='+(e.eipId+";"+e.eipAllocationId)+"&region="+n+'">\n                '+P["default"]("立即续费")+"\n            </a>";switch(e.eipStatus){case T.EipStatus.EXPIRED:i=P["default"]("当前公网IP已到期，")+s;break;case T.EipStatus.STOPED:i=P["default"]("当前公网IP")+T.EipStatus.getTextFromValue(e.eipStatus);break;case T.EipStatus.PAUSED:i=P["default"]("当前公网IP已")+T.EipStatus.getTextFromValue(e.eipStatus)}a+=D["default"].escape(e.publicIp||"-"),a+="/",a+=e.network?e.network+"Mbps":"-";var r=!g.isSubUser();return e.publicIp?a+=(r=r&&D["default"].contains(y.INSTANCE_STATUS.CAN_UNBINDEIP,e.status)&&"BCC_NAT"!==e.subnetType)?function(e,t){var a=e.status!==y.INSTANCE_STATUS.BUILD;return C["default"].compile(z)({label:'<i class="iconfont icon-unbind" title="'+P["default"]("解绑")+'EIP"></i>',command:B["default"].UNBINDEIP,args:t,className:a?"":"state-disabled",disabled:a?"":"disabled"})}(e,t):"":(a+=(r=r&&D["default"].contains(y.INSTANCE_STATUS.CAN_BINDEIP,e.status)&&"BCC_NAT"!==e.subnetType)?function(e,t){var a=G["default"].get("whiteTags")&&JSON.parse(G["default"].get("whiteTags")).bindEip,i=e.status!==y.INSTANCE_STATUS.BUILD&&!a,n=a?"需安全部审核通过后才可进行此操作":"绑定";return C["default"].compile(z)({label:'<i class="iconfont icon-bind" title="'+P["default"](n)+'EIP"></i>',command:B["default"].BIND2EIP,args:t,className:i?"":"state-disabled",disabled:i?"":"disabled"})}(e,t):"","BCC_NAT"===e.subnetType&&(a+=' <span data-ui-type="Tip"\n                    data-ui-id="eipTip'+t+'"\n                    data-ui-skin="warning"\n                    data-ui-arrow="true"\n                    data-ui-content=\'NAT专属子网无法绑定EIP\'></span>')),D["default"].contains([T.EipStatus.EXPIRED,T.EipStatus.STOPED,T.EipStatus.PAUSED],e.eipStatus)&&(a+=' <span data-ui-type="Tip"\n                    data-ui-id="eipTip'+t+'"\n                    data-ui-skin="warning"\n                    data-ui-arrow="true"\n                    data-ui-content=\''+i+"'></span>"),a}},{field:"internalIp",sortable:!0,title:P["default"]("内网IP"),minWidth:100,width:"12%",content:function(e,t){return e.internalIp}},{field:"configuration",title:P["default"]("配置/类型"),filter:{datasource:T.InstanceType.getFilterStatus()},width:"13%",minWidth:110,content:function(e){var t="${cpu}"+P["default"]("核")+"/${memory}GB/"+e.sysDisk+"GB",a=T.InstanceType.getTextFromValue(e.instanceType)||P["default"]("普通型");return C["default"].compile(t)(e)+"/"+a}},{field:"osType",title:"OS",width:"6%",stable:!0,minWidth:35,content:function(e){var t=D["default"].escape(e.osName||e.osType),a=t+D["default"].escape(e.osVersion),i=t.toLowerCase().replace(/\s/g,"-");return D["default"].contains(y.OS_IMAGE_NAME,i)?'<div class="sys-icon '+i+'" title="'+a+'"></div>':"-"}},{field:"vpc",title:P["default"]("所在网络"),minWidth:80,width:"9%",content:function(e){return P["default"](g.getVpcName(e.vpcName))}},{field:"subnet",title:P["default"]("所在子网"),minWidth:80,width:"9%",content:function(e){return P["default"](g.getSubnetName(e.subnetName))}},{field:"logicalZone",title:P["default"]("所在可用区"),minWidth:80,width:"9%",content:function(e){return P["default"]($["default"].getLabel(e.logicalZone))}},{field:"tag",title:P["default"]("标签"),sortable:!0,width:"9%",content:function(e,t,a){if(!e.tags||e.tags.length<1)return"-";var i="",n="";return D["default"].each(e.tags,function(e,t){n+="{"+e.tagKey+" : "+e.tagValue+"} ",t<2&&(i+=e.tagKey+" : "+e.tagValue+"<br/>")}),e.tags.length>2&&(i+="..."),'\n                <div title="'+n+'">\n                    '+i+"\n                </div>\n            "}},{field:"keypair",title:P["default"]("密钥对名称／ID"),minWidth:80,width:"9%",content:function(e){return e.keypairName?"\n                    <span>"+e.keypairName+"</span><br/>\n                    <span>"+e.keypairId+"</span>\n                ":"-\\-"}},{field:"operation",title:P["default"]("操作"),width:"8%",minWidth:60,content:function(e,t){var a="";return a+=function(e){return e.permission.disable?'\n            <span class="opration">\n                <span data-ui-type="Button"\n                    data-ui-id="'+(e.command+e.args)+'"\n                    data-ui-disabled="true"\n                    data-ui-extension-popover-type="PopoverEx"\n                    data-ui-popover="'+e.permission.message+'"\n                    class="cmd-button state-disabled"\n                    data-track-id="ti_bcc_instance_'+e.command+'"\n                    data-track-name="'+e.label+'">\n                    '+e.label+"\n                </span>\n            </span>\n        ":'\n        <span class="opration">\n            <button\n                title="'+e.label+'"\n                data-command="'+e.command+"\"\n                data-command-args='"+e.args+'\'\n                class="cmd-button">\n                '+e.label+"\n            </button>\n        </span>\n    "}({label:P["default"]("VNC远程"),command:B["default"].GET_VNC_URL,args:t,permission:M["default"].check(F["default"],e,"vnc").vnc})}}],q=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.getSearchArgs=function(){var e=i.prototype.getSearchArgs.call(this),t=this.get("keywordType"),a=this.model.get("pageNo");if(+a>0&&(e.pageNo=a),t){var n=t.getSelectedItem();e.keywordType=t.getValue(),e.subKeywordType=n[1]&&n[1].value}var s=this.model.get("filters");return s&&s.length>0&&(e.filters=JSON.stringify(s)),e},n.prototype.enterDocument=function(){this.setTableFilterValue(),i.prototype.enterDocument.call(this);var e=!1,t="",a=this.get("realnameTip");N["default"].checkForbidden&&!1===N["default"].checkForbidden(this)&&(e=!0,t+=y.FORBIDDENTIP),e&&(a.setContent(t),a.show()),this.model.get("keywordType")&&this.get("keywordType").fire("change"),this.handleDccInstanceTitle()},n.prototype.displayQrCode=function(){var e=this,t=_["default"]("<div/>").addClass("console-app-qr").html('\n            <div class="console-app-qr-text"><strong>扫一扫</strong>下载App</div>\n            <img src="https://bce.bdstatic.com/console/app-qr.png" width="100" height="100" />\n            <div class="console-app-qr-text">随时查看产品信息</div>\n            <div class="console-app-qr-close tip-left" tip="关闭"><i class="iconfont icon-close"></i></div>\n        ');_["default"]("#new-sidebar").append(t),_["default"](".console-app-qr-close").click(function(){_["default"](".console-app-qr").remove(),e.fire("closeQrCode")})},n.prototype.setTableFilterValue=function(){var e=this.model.get("filters");e&&e.length>0?D["default"].each(H,function(t){t.filter&&D["default"].each(e,function(e){e[0]===t.field&&(t.filter.value=e[1])})}):D["default"].each(H,function(e){e.filter&&(e.filter.value=null)})},n.prototype.setTableHeadIntro=function(){var e=this.get("table").fields,t=this.get("table").get("headPanel").main.getElementsByClassName("ui-table-hcell-text");D["default"].each(e,function(e,a){"tag"===e.field&&(A["default"].setAttribute(t[a+1],"data-intro",P["default"]("也可以按标签来排序资源")),A["default"].setAttribute(t[a+1],"data-position","bottom-middle-aligned"))})},n.prototype.setRealnameTip=function(){var e=this.model.get("realname"),t=this.get("realnameTip"),a=[];t.getContent()&&a.push(t.getContent()),e&&"PASS"!==e.status&&(e.ban?a.push("因未在"+R["default"].toDate(e.deadLine)+'前完成实名认证，您已购买的后付费BCC实例、开通公网访问预付费BCC实例的公网访问端口已被封禁，实名认证完成后可重新自动开通，请立即去<a href="/qualify/#/qualify/index">认证</a>。'):a.push('购买云服务器BCC需要实名认证，您还没有认证。点此立即去<a href="/qualify/#/qualify/index">认证</a>。')),a.length>0&&!g.isSubUser()&&(t.setContent(a.join("<br>")),t.show())},n.prototype.showListTip=function(){var e=this.get("table").getSelectedItems().length,t=this.get("pager").count,a=D["default"].sprintf(P["default"]("已选中%s条"),e),i=D["default"].sprintf(P["default"]("共%s条"),t);_["default"](".selected-tip").html(a),_["default"](".total-tip").html(i)},n.prototype.setQuotaTip=function(){var e=this.model.get("quota"),t=C["default"].compile(["预付费实例可创建总数：${preInstanceTotal}个 / 已创建数量：${preInstanceCreated}个","后付费实例可创建总数：${postInstanceTotal}个 / 已创建数量：${postInstanceCreated}个"].join("\n"));this.get("createInstance").main.setAttribute("title",t(e||{}))},n.prototype.bindEvents=function(){i.prototype.bindEvents.call(this);var e=this;_["default"](".quick-search-filters").on("click","a",function(t){_["default"](this).toggleClass("actived");var a=e.model.get("filters")||[],i=D["default"].reject(a,function(e){return"expiredDate<7"===e.join("")});_["default"](".quick-search-filters a").each(function(e,t){var a=_["default"](t);if(a.hasClass("actived")){var n=a.data();i.push([n.key,n.op,n.value])}}),e.fire(B["default"].FILTER,{condition:i})})},n.prototype.resetMoreOperation=function(){var e=this.get("moreOpt");e.get("selectedIndex")>-1&&e.setProperties({selectedIndex:-1})},n.prototype.updatePageData=function(e,t){this.shouldKeepSelectedIndex||this.get("table").setProperties({selectedIndex:[]}),i.prototype.updatePageData.call(this,e,t)},n.prototype.updateKeywordType=function(){var e=this.model.get("keywordTypeDatasource"),t=this.model.get("bccTags"),a=this.model.get("keywordType"),i=D["default"].map(D["default"].keys(t),function(e){var t=e;return"(全部)"===e?t="@@@":"(无标签)"===e&&(t=""),{name:e,value:t}});e.push({name:P["default"]("标签"),value:"tag",children:i}),this.get("keywordType").setProperties({datasource:e,hasChildList:!0,joinStr:"/",value:a})},n.prototype.handleDccInstanceTitle=function(){this.model.get("hasHost")?(_["default"](".ui-tab-navigator",".bcc-instance").show(),_["default"](".h2-text",".bcc-instance").hide()):(_["default"](".ui-tab-navigator",".bcc-instance").hide(),_["default"](".h2-text",".bcc-instance").show())},t["default"](n,[{key:"template",get:function(){return"TPL_bcc_instance"}},{key:"uiProperties",get:function(){return{keywordType:{datasource:"@keywordTypeDatasource"},keyword:{placeholder:P["default"]("请输入实例名称进行搜索")},table:L["default"].tableProperty(H,{followHead:!0,followHeadOffsetH:50,noFollowHeadCache:!0,followDoms:[_["default"](".operation-wrap")[0]],editable:1,columnRenderIndexes:[1,7],noDataHtml:"<div><p>"+P["default"]("没有相关数据！")+"</p></div>",extTableEx:["id","expireTime","payment","publicIp","operation"],extTableCustomFields:{container:"#table-custom-fields-container",defaults:["id","status","payment","expireTime","publicIp","internalIp","configuration","tag","operation"],locked:{head:["id"],tail:["operation"]},maxFields:9}}),pager:{pageSizes:[10,20,50,100]},moreOpt:{width:130,datasource:T.MoreOperation.getOperation("BCC"),emptyText:P["default"]("更多操作"),selectedIndex:-1}}}},{key:"uiEvents",get:function(){return D["default"].extend({},L["default"].getListEvents({"keyword:enter":function(e){this.submitSearch(e)},"createInstance:click":function(e){this.fire(B["default"].CREATE_INSTANCE)},"downloadList:click":function(e){window.open(this.model.getDownloadUrl())},"editTag:click":function(e){var t=this.get("table").getSelectedItems();this.fire(B["default"].EDIT_TAG,t)},"table:select":function(e){var t=this.get("table").getSelectedItems(),a=M["default"].check(F["default"],t);this.showListTip(),L["default"].setButtonStatusAndTip(this,a,t),L["default"].setSelectStatusAndTip(this,"moreOpt",a,t)},"table:command":function(e){"string"==typeof e.args&&(e.args=+e.args);var t=e.target.get("datasource")[e.args];this.fire(e.name,{item:t})},"table:clipboard@aftercopy":function(e){this.fire(B["default"].COPYID)},"table:clipboard@error":function(e){e.originalTarget.hide()},"recharge:click":function(e){var t=this.get("table").getSelectedItems(),a=D["default"].map(t,function(e){return e.id+";"+e.instanceId});this.fire(B["default"].RECHARGE_BATCH,{instanceIds:a})},"table:filter":function(e){var t=this.get("table").fields[e.fieldIndex],a=this.model.get("filters")||[],i=D["default"].reject(a,function(e){return e[0]===t.field});i.push([t.field,e.value]),this.fire(B["default"].FILTER,{condition:i})},"moreOpt:change":function(e){var t=this,a=this.get("table"),i=e.target.getValue(),n=a.getSelectedItems();n.length>0&&i&&function(){var e=[];switch(i){case T.MoreOperation.START:U["default"].confirmHandler({title:"启动",content:"确定启动吗？",width:280},"instance.start",t,{},{instanceId:"id"});break;case T.MoreOperation.REBOOT:U["default"].confirmHandler({title:"重启",content:"重启过程中相关服务会中断，确定重启吗？",width:400},"instance.reboot",t,{type:"soft"},{instanceId:"id"});break;case T.MoreOperation.DELETE:e=D["default"].map(n,function(e){return e.id}),t.fire(B["default"].DELETE_INSTANCE,{extraData:{instanceId:e.join(",")},instances:n});break;case T.MoreOperation.STOP:U["default"].confirmHandler({title:"停止",content:"停止实例后相关服务将不可访问，确定停止吗？",width:420},"instance.stop",t,{},{instanceId:"id"});break;case T.MoreOperation.RENAME:var a=[];D["default"].each(n,function(t){e.push(t.id),a.push(t.name)}),t.fire(B["default"].CHANGE_NAME,{instanceIds:e,instanceNames:a});break;case T.MoreOperation.RESET_PASSWORD:e=D["default"].map(n,function(e){return e.instanceId});var s=D["default"].map(n,function(e){return e.id});t.fire(B["default"].CHANGE_PWD,{instanceIds:e,instanceUuids:s});break;case T.MoreOperation.JOIN_SECURITY:t.fire("JOIN_SECURITY_GROUPS",{instances:n});break;case T.MoreOperation.ALTER_PRODUCTTYPE:var r=[];D["default"].each(n,function(t){e.push(t.id+";"+t.instanceId),r.push(t.payment)}),t.fire(B["default"].ALTER_PRODUCTTYPE,{instanceIds:e,productTypes:r});break;case T.MoreOperation.CANCEL_ALTER_PRODUCTTYPE:e=D["default"].pluck(n,"id"),t.fire(B["default"].CANCEL_ALTER_PRODUCTTYPE,{instanceIds:e});break;case T.MoreOperation.BIND_SSH:t.fire("BIND_SSH",{selectedItems:n});break;case T.MoreOperation.UNBIND_SSH:t.fire("UNBIND_SSH",{selectedItems:n});break;default:var o=n[0]||{};t.fire(B["default"][i],{item:o})}}()},"instanceNoticeClose:click":function(e){this.get("instanceNotice").hide()}}),{"keywordType:change":function(e){var t=this.model.get("bccTags"),a=this.get("keyword"),i=[];if(t){var n=e.target.getSelectedItem(),s=n[0].name||n[0].text;if(n.length>1){var r=n[1].name;s="",r&&(s="标签值",i=t[r])}a.setProperties({placeholder:s?D["default"].sprintf(P["default"]("请输入%s进行搜索"),s):P["default"]("搜索无标签实例")})}a.setProperties({datasource:i})}})}},{key:"initTableSelectItem",get:function(){return L["default"].initTableSelectItem}}]),n}(k["default"]);module.exports=q;var z='<span class="oprations"><button data-command="${command}" data-command-args="${args}" class="cmd-button ${className}" ${disabled}>${label|raw}</button></span>'}),define("bcc/instance/Monitor",["require","bat-ria/mvc/BaseAction","../events","common/constants","inf-ria/helper","./MonitorModel","./MonitorView","er/util"],function(require){function e(){n.apply(this,arguments)}function t(e){this.reload()}function a(){var e=this.model.get("instance");require("inf-ria/helper").redirectToModule("bcm","/bcm/alarm/rule",{scope:r,dimensions:this.model.get("dimensions"),instanceType:e.instanceType})}function i(e){var t=this;this.model.getAlarmState({scope:r,dimensions:this.model.get("dimensions")}).then(function(e){t.view.refreshAlarmState(e)})}var n=require("bat-ria/mvc/BaseAction"),s=require("../events"),r=require("common/constants").MONITOR_SCOPE.BCC;return e.prototype.initBehavior=function(){n.prototype.initBehavior.apply(this,arguments);var e=this;e.view.on(s.TO_ALARM_DETAIL,a,this),e.view.on(s.GET_ALARM_STATE,i,this),e.view.on("refresh",t,this),e.view.initMonitor.call(this.view),e.on("beforeleave",function(){clearInterval(e.view.timer)},this)},e.prototype.modelType=require("./MonitorModel"),e.prototype.viewType=require("./MonitorView"),e.prototype.filterRedirect=function(e){if(this.context.isChildAction&&e.getPath()!==this.context.url.getPath())return location.href="/bcc/"+location.search+"#"+e.toString(),!1},require("er/util").inherits(e,n),e}),define("bcc/instance/monitor.tpl",[],function(){return'\x3c!-- target: TPL_bcc_monitor --\x3e\n<div class="bcc-instance-monitor bcc-main-wrap main-wrap-new monitor">\n    <div class="content-wrap">\n        <p class="breadcrumb">\n            <span>产品服务</span>\n            <span class="divider">/</span>\n            <a href="#/bcc/instance/list">云服务器BCC-实例列表</a>\n            <span class="divider">/</span>\n            <span class="active">监控</span>\n        </p>\n\n        <div class="instance-info">\n            <h1 title="${instance.name}">${instance.name}</h1>\n            <span class="instance-status ${statusClass}">${statusDesc}</span>\n            </div>\n            \x3c!-- if: ${instance} === ""--\x3e\n            <div class="tips-error">没有收到该机器的数据，请<a href="javascript:void(0)" data-ui="type:Label;id:refresh;">刷新</a>重试。</div>\n            \x3c!-- else --\x3e\n            <div class="detail-content">\n                \x3c!-- import: TPL_bcc_monitor_child --\x3e\n            </div>\n            \x3c!-- /if --\x3e\n        </div>\n    </div>\n</div>\n\n\n\x3c!-- target: TPL_bcc_monitor_child --\x3e\n<div class="ui-tab-content">\n    <h2 class="detail-parts-title"><em>监控信息</em>\n    <div data-ui-type="Tip"\n        data-ui-content="如需查看内存和磁盘空间的监控信息，请安装<a href=\'http://bce.baidu.com/doc/BCM/BCM-Agent.html\' target=\'_blank\'>BCM-Agent</a>"\n        data-ui-skin="warning"></div>\n </h2>\n    \x3c!-- import: TPL_alarm_state_summary --\x3e\n    \x3c!-- use: monitor_trend_search(type="monitor") --\x3e\n    <div class="monitor-trends">\n        \x3c!-- for: ${monitorMetric} as ${chartMetric}, ${chart} --\x3e\n        <div class="monitor-trend-box">\n            <div class="monitor-trend-wrap" >\n                <div data-ui-type="BcmChart"\n                     data-ui-extension-showbig-type="BcmChartShowBigView"\n                     data-ui-group="chart"\n                     data-ui-title="${chartMetric.name}"\n                     data-ui-showbigable="show"\n                     data-ui-big-view-location="/common/bcm/monitorChart"\n                     data-ui-height="200"\n                     data-ui-api-type="metricName"\n                     data-ui-scope="BCE_BCC"\n                     data-ui-dimensions="${dimensions}"\n                     data-ui-metrics="${chartMetric.metricString}"\n                     data-ui-statistics="${chartMetric.statistics}"\n                     data-ui-period="60"\n                     data-ui-time="1h"\n                     data-ui-requester="@api.bcmMetricDataMetricName"\n                     data-ui-no-data="暂无数据<p style=\'font-size:12px;color:#aaa;\'>请检查是否安装了BCM客户端</p>"\n                     data-ui-unit="${chartMetric.unit}"\n                        ></div>\n            </div>\n        </div>\n        \x3c!-- /for --\x3e\n    </div>\n\n    <h2 class="detail-parts-title"><em>扩展监控项</em>\n        <div data-ui-type="Tip"\n            data-ui-content="查看扩展监控项需要安装<a href=\'http://bce.baidu.com/doc/BCM/BCM-Agent.html\' target=\'_blank\'>BCM-Agent</a>"\n            data-ui-skin="warning"></div>\n    </h2>\n    <esui-tab data-ui-id="tab" class="ui-smart-tab extra-tab">\n        <ul data-role="navigator">\n            \x3c!-- for: ${extraMetric} as ${category}, ${index} --\x3e\n            <li data-for="tab${index}"\n                data-track-id="ti_bcc_instance_monitor"\n                data-track-name="${category.title}">${category.title}</li>\n            \x3c!-- /for --\x3e\n        </ul>\n        \x3c!-- for: ${extraMetric} as ${category}, ${index} --\x3e\n        <div id="tab${index}" class="ui-tab-content">\n            \x3c!-- for: ${category.items} as ${item} --\x3e\n            <input data-ui-type="CheckBox"\n                   data-ui-group="extraMetricCheckbox"\n                   name="${category.title}"\n                   value="${item.value}"\n                   title="${item.name}"\n                   data-track-id="ti_bcc_instance_monitor_${item.value}"\n                   data-track-name="${item.name}"/>\n            \x3c!-- /for --\x3e\n        </div>\n        \x3c!-- /for --\x3e\n    </esui-tab>\n    \x3c!-- use: monitor_trend_search(type="extraMonitor") --\x3e\n    <div data-ui-type="Panel" data-ui-id="extraChartList" class="monitor-trends"></div>\n</div>\n\n\x3c!-- target: TPL_bcc_monitor_chart_item --\x3e\n<div class="monitor-trend-box" data-ui-type="Panel" data-ui-id="${id}">\n    <div class="monitor-trend-wrap" >\n        <div data-ui-type="BcmChart"\n             data-ui-extension-showbig-type="BcmChartShowBigView"\n             data-ui-showbigable="show"\n             data-ui-big-view-location="/common/bcm/monitorChart"\n             data-ui-group="extraChart"\n             data-ui-title="${title}"\n             data-ui-height="200"\n             data-ui-api-type="metricName"\n             data-ui-scope="BCE_BCC"\n             data-ui-dimensions="${dimensions}"\n             data-ui-metrics="${metrics}"\n             data-ui-statistics="${statistics}"\n             data-ui-period="${period}"\n             data-ui-time="${time}"\n             data-ui-unit="${unit}"\n             data-ui-requester="@api.bcmMetricDataMetricName"\n             data-ui-no-data="暂无数据<p style=\'font-size:12px;color:#aaa;\'>请检查是否安装了BCM客户端</p>"\n                ></div>\n    </div>\n</div>\n'}),define("bcc/instance/MonitorModel",["require","bat-ria/mvc/BaseModel","inf-ria/utils/mtools","underscore","inf-i18n","common/constants","../config","./config","../enum","jquery","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("bat-ria/mvc/BaseModel"),a=require("inf-ria/utils/mtools"),i=require("underscore"),n=require("inf-i18n"),s=require("common/constants"),r=require("../config"),o=require("./config"),c=require("../enum").InstanceType,l=r.api,d=r.INSTANCE_STATUS,u=[{title:"CPU",items:[{name:"CPU空闲率",value:"CpuIdlePercent",unit:"百分比",statistics:"minimum"},{name:"每秒上下文切换次数",value:"CpuContextSwitchSecond",unit:"次/秒",statistics:"average"},{name:"每秒CPU的中断次数",value:"CpuInterruptSecond",unit:"次",statistics:"average"},{name:"系统CPU时间比率",value:"CpuSystemPercent",unit:"百分比",statistics:"average"},{name:"用户CPU时间比率",value:"CpuUserPercent",unit:"百分比",statistics:"average"}]},{title:"内存",items:[{name:"文件系统内存cache值",value:"MemCacheBytes",unit:"字节",statistics:"average"},{name:"内存空闲量",value:"MemFreeBytes",unit:"字节",statistics:"minimum"},{name:"内存总量",value:"MemTotalBytes",unit:"字节",statistics:"average"},{name:"内存可用量",value:"MemAvailableBytes",unit:"字节",statistics:"average"}]},{title:"磁盘",items:[{name:"整台服务器的磁盘空间总量",value:"DiskTotalBytes",unit:"字节",statistics:"average"},{name:"整台服务器的磁盘空闲总量",value:"DiskFreeBytes",unit:"字节",statistics:"minimum"},{name:"整台服务器的磁盘使用总量",value:"DiskUsedBytes",unit:"字节",statistics:"maximum"},{name:"整台服务器的磁盘使用率",value:"DiskUsedPercent",unit:"百分比",statistics:"maximum"}]},{title:"网络",items:[{name:"已建立的TCP连接数",value:"TcpCurrentEstab",unit:"个",statistics:"average"},{name:"TCP接收包数",value:"TcpInSegs",unit:"个",statistics:"average"},{name:"TCP发送包数",value:"TcpOutSegs",unit:"个",statistics:"average"},{name:"TCP重传数",value:"TcpRetranSegs",unit:"个",statistics:"average"}]}];return e.prototype.datasource={menu:function(e){return"instance"},api:function(e){return l},tab:function(){return{monitor:"ui-tab-item-active"}},monitorMetricOrigin:function(e){return o.monitorMetric},extraMetric:function(){return o.extraMetric},instance:[{instance:function(e){return e.getInstanceById(e.get("instanceId"))}},{windows:function(e){var t=e;if(""===t.get("instance")||"windows"!==t.get("instance").osType)return!1;var a=JSON.parse(JSON.stringify(u)),n=[],s=[],r=t.get("monitorMetricOrigin"),o=JSON.parse(JSON.stringify(r));return l.bcmMetricList({dimensions:"InstanceId:"+t.get("instance").id,scope:"BCE_BCC"}).then(function(t){return i.each(t,function(e){/Disk[a-z]+UsedBytes/i.test(e)?n.push({name:e.replace(/Disk([a-z]+)UsedBytes/i,"$1")+"盘空间使用量",value:e}):/Disk[a-z]+UsedPercent/i.test(e)?s.push({name:e.replace(/Disk([a-z]+)UsedPercent/i,"$1")+"盘空间使用率",value:e}):/Cpu[0-9]+ProcessorPercent/i.test(e)?a[0].items.push({name:e.replace(/(Cpu[0-9]+)(ProcessorPercent)/i,"$1使用率"),value:e,unit:"百分比",statistics:"minimum"}):/Cpu[0-9]+IdlePercent/i.test(e)&&a[0].items.push({name:e.replace(/(Cpu[0-9]+)(IdlePercent)/i,"$1空闲率"),value:e,unit:"百分比",statistics:"minimum"})}),o.diskUsed.metrics=n,o.diskUsedPercent.metrics=s,e.set("monitorMetricOrigin",o),e.set("extraMetric",a),o})}}]},e.prototype.prepare=function(){var e=this.get("instance"),t=e.status;e.instanceType===c.GPU&&this.addGpuMonitorMetric(),this.set("statusClass",d.CLASS[t]),this.set("statusDesc",d.TXT[t]||t);var n=e.publicIp,r=require("jquery").extend(!0,{},this.get("monitorMetricOrigin"));this.set("monitorMetric",r),i.each(r,function(e){var t=[];i.each(e.metrics,function(e){t.push(e.value+"("+e.name+")")}),e.metricString=t.join(",")}),n||a.filterMetrics(r,"eip",!1),this.set("monitorScope",s.MONITOR_SCOPE.BCC),this.set("dimensions","InstanceId:"+this.get("instanceId"))},e.prototype.addGpuMonitorMetric=function(){var e=this.get("instance"),t=i.clone(this.get("extraMetric")),a=o.gpuMonitorMetric,s=[];i.find(t,function(e){return"GPU"===e.title})||(i.each(a.items,function(t){var a=[];if(i.contains(["UtilizationGpu","UtilizationMemory","MemoryTotal","MemoryUsed","MemoryFree","Temperature","EccErrors","Status","Error"],t.value)){for(var r=0;r<e.gpuCount;r++)a.push({name:i.sprintf(n("gpu卡%s的"),r+1)+t.name,value:"Gpu"+r+t.value});s.push({name:t.name,unit:t.unit,value:t.value,metrics:a})}else s.push(t)}),t.push({title:"GPU",items:s})),this.set("extraMetric",t)},e.prototype.getInstanceById=function(e){return l.bccInstanceDetail({instanceId:e})},e.prototype.getAlarmState=function(e){return l.bcmAlarmStateSummary(e)},require("er/util").inherits(e,t),e}),define("bcc/instance/MonitorView",["require","bat-ria/tpl!./monitor.tpl","bat-ria/mvc/BaseView","jquery","underscore","common/constants","common/util","../events","../config","er/util"],function(require){function e(){t.apply(this,arguments)}require("bat-ria/tpl!./monitor.tpl");var t=require("bat-ria/mvc/BaseView"),a=require("jquery"),i=require("underscore"),n=require("common/constants"),s=require("common/util").isSubUser(),r=require("../events"),o=require("../config");return e.prototype.template="TPL_bcc_monitor",e.prototype.uiProperties={toAlarm:{hidden:s}},e.prototype.uiEvents={"monitorTimeRange:change":function(e){this.changeMonitorTrendsTimeRange("chart",e.target)},"monitorRefresh:click":function(){this.refreshMonitorTrends("chart")},"extraMonitorTimeRange:change":function(e){this.changeMonitorTrendsTimeRange("extraChart",e.target)},"extraMonitorRefresh:click":function(){this.refreshMonitorTrends("extraChart")},"toAlarm:click":function(){this.fire(r.TO_ALARM_DETAIL)},"refresh:click":function(){this.fire("refresh")}},e.prototype.initMonitor=function(){var e=this;e.monitorCharts={},e.fire(r.GET_ALARM_STATE),e.timer=setInterval(function(){e.fire(r.GET_ALARM_STATE)},n.ALARM_STATE_QUERY_PERIOD),e.getGroup("extraMetricCheckbox").each(function(t){t.on("click",function(){this.isChecked()?e.appendExtraMetricChart(this):e.removeExtraMetricChart(this)})})},e.prototype.appendExtraMetricChart=function(e){var t=e.getValue(),a=this.model.get("extraMetric"),n=i.findWhere(a,{title:e.name}),s=i.findWhere(n.items,{value:t}),r=this.get("extraChartList"),c=this.get("extraMonitorTimeRange").getValue(),l=o.monitorDefaultPeriod[c]||60,d=s.value+"("+s.name+")";if(s.metrics&&s.metrics.length>0){var u=[];i.each(s.metrics,function(e){u.push(e.value+"("+e.name+")")}),d=u.join(",")}var p=this.templateRender("TPL_bcc_monitor_chart_item",{id:"panel_"+t,title:n.title+" - "+s.name,dimensions:this.model.get("dimensions"),metrics:d,statistics:s.statistics,unit:s.unit,period:l,time:c});r.prependContent(p)},e.prototype.removeExtraMetricChart=function(e){var t=e.getValue(),a=this.get("panel_"+t);a&&a.destroy()},e.prototype.refreshMonitorTrends=function(e){this.getGroup(e).each(function(e){e.refresh()})},e.prototype.changeMonitorTrendsTimeRange=function(e,t){var a=t.getValue(),i=o.monitorDefaultPeriod[a]||60;this.getGroup(e).each(function(e){e.setProperties({period:i,time:a})})},e.prototype.refreshAlarmState=function(e){a("#js-alarm-state-ok").text(e.okStateCount),a("#js-alarm-state-alarm").text(e.alarmStateCount),a("#js-alarm-state-insufficient").text(e.insufficientStateCount)},require("er/util").inherits(e,t),e}),define("bcc/instance/Rebuild",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","inf-ria/mvc/FormAction","babel-runtime/helpers/interop-require-default","lodash","./RebuildModel","./RebuildView","../enum","../_public/selectUtil","../ssh/create"],function(exports,module,e,t,a,i,n,s,r,o,c,l){var d=i["default"](a),u=i["default"](n),p=i["default"](s),f=i["default"](r),m=i["default"](c),h=i["default"](l),g=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=p["default"],this.viewType=f["default"]}return e["default"](i,a),i.prototype.osTypeChange=function(e){var t=this.model.get("instance"),a=this.model.get("osVersionMap")[e.imageType][e.osType],i=0;a=u["default"].filter(a,function(e){var a=!!e.minMem&&e.minMem>t.memory,i=!!e.minCpu&&e.minCpu>t.cpu;return!a&&!i}),a=u["default"].each(a,function(e){return e.maxRamGbInvalid=!!e.maxRamGb&&t.memory>e.maxRamGb,e.disabled=e.maxRamGbInvalid,e.popover=e.maxRamGbInvalid?"您选择的内存已大于当前镜像支持的最大内存":"",e}),u["default"].every(a,function(e){return!0===e.disabled})&&(i=-1),m["default"].selectHandler(this.view,"osVersion",a,i)},i.prototype.imageTypeChange=function(e){var t=e.imageType,a=this.model.getOSTypeList(t);m["default"].selectHandler(this.view,"osType",a),t===o.ImageType.INTEGRATION?this.view.get("osHelpLinkPanel").show():this.view.get("osHelpLinkPanel").hide()},i.prototype.setImageId=function(e){this.model.set("imageId",e.imageId)},i.prototype.initBehavior=function(){var e=this;a.prototype.initBehavior.call(this),this.view.on("IMAGE_TYPE_CHANGE",this.imageTypeChange,this),this.view.on("OS_TYPE_CHANGE",this.osTypeChange,this),this.view.on("SET_IMAGE_ID",this.setImageId,this),this.view.on("expandDisk",function(t){return e.fire("expandDisk",t)},this),this.view.on("createKeypair",this.createKeypair,this),this.quotaCheck()},i.prototype.quotaCheck=function(){var e=this.model.get("quota");e.keypairCreated>=e.keypairTotal?this.view.get("createKeypair").setProperties({disabled:!0,popover:"一个地域下最多只能创建500个密钥"}):this.view.get("createKeypair").setProperties({disabled:!1,popover:""})},i.prototype.createKeypair=function(){var e=this;this._KeyPairCreateComponent&&this._KeyPairCreateComponent.dispose(),this._KeyPairCreateComponent=new h["default"]({data:{keypairCreate:!0}}),this._KeyPairCreateComponent.attach(document.body),this._KeyPairCreateComponent.on("ok",function(t){e.loadKeypairData(),e.quotaCheck()})},i.prototype.loadKeypairData=function(){return this.model.getKeypairList()},i.prototype.syncModelToViewIterator=function(e){switch(e.name){case"mktImage":this.view.updateMktImage();break;case"osData":this.view.updateOs();break;case"keypair":this.view.updateKeypair()}},i.prototype.submit=function(e){if(this.customValiate()){var t=a.prototype.submit.call(this,e);return t.fail(function(){var e=this.view.get("form");e&&e.fire("aftermanualvalidate",{isValid:!1})}),t}},i.prototype.customValiate=function(){var e=this.model.getSubmitData(this.view.getFormData());return this.view.get("form").validate()&&e.imageId&&this.view.validateKeypair()},i.prototype.redirectAfterSubmit=function(){this.model.get("parentAction").reload()},i.prototype.handleSubmitError=function(e){var t=this.model.get("parentAction");t&&t.dialog&&t.dialog.show(),e.field&&e.field.mfa||this.view.showToast(e&&e.global?e.global:"操作失败",{messageType:"error"})},i}(d["default"]);module.exports=g}),define("bcc/instance/rebuild.tpl",[],function(){return'\x3c!-- target: TPL_bcc_instance_rebuild --\x3e\n<div class="bcc-main-wrap bcc-dialog-form bcc-rebuild-dialog">\n    <form data-ui="type:Form;id:form;autoValidate:true;">\n        <div class="form-data-body">\n            <div class="form-row">\n                <div class="operation-tip">\n                    ${i18n.重装系统会清除系统盘内数据且不可恢复（云磁盘数据不受影响），}\n                    \x3c!-- if: ${snapshoted} --\x3e${i18n.同时系统盘快照会被删除，如需备份系统盘数据请制作自定义镜像。}\x3c!-- /if --\x3e\n                    \x3c!-- if: ${isActive} --\x3e${i18n.重装系统后云服务器服务会中断几分钟，}\x3c!-- /if --\x3e ${i18n.确定重装吗？}\n                </div>\n            </div>\n            <div class="form-row">\n                <div class="form-key">${i18n.镜像类型：}</div>\n                <div class="form-value">\n                    <div data-ui-id="imageType"\n                         data-ui-type="RadioSelect"\n                         class="ui-radioselect-custom"></div>\n                    <div data-ui-type="Tip"\n                         data-ui-id="imageTip"\n                         data-ui-arrow="true"\n                         class="image-tip"></div>\n                </div>\n            </div>\n            <div class="form-row bcc-os-row">\n                <div class="form-key">${i18n.操作系统：}</div>\n                \x3c!-- if: ${instance.imageType} === \'mkt\' --\x3e\n                <div data-ui-id="mktImagePanel" data-ui-type="Panel" class="form-value">\n                    <span class="loading">${i18n.加载中。。。}</span>\n                </div>\n                \x3c!-- else: --\x3e\n                <div class="form-value">\n                    <div data-ui-type="Select"\n                         data-ui-width="120"\n                         data-ui-id="osType"></div>\n                    <div data-ui-type="Select"\n                         data-ui-width="260"\n                         data-ui-required="required"\n                         data-ui-required-error-message="${i18n.请选择一个镜像}"\n                         data-ui-extension-popover-type="PopoverEx"\n                         data-ui-id="osVersion"></div>\n                    <div data-ui="type:Panel;id:osHelpLinkPanel;hidden:true;">\n                        <a target="_blank" class="os_helplink"\n                            href="http://bce.baidu.com/doc/BCC/Resources.html#.A8.AF.04.0F.7A.C0.66.72.DF.F3.53.E9.8C.5E.94.D2">\n                            ${i18n.镜像环境详情}\n                        </a>&nbsp;\n                        <a target="_blank" class="os_helplink"\n                            href="http://bce.baidu.com/doc/BCC/Resources.html#.FB.81.0D.6E.08.3E.F1.B0.D7.0B.3A.8A.56.EA.42.84">\n                            <input type="checkbox" disabled="disabled" checked="checked">&nbsp; ${i18n.确认《百度云镜像服务协议》}\n                        </a>\n                    </div>\n                    <div data-ui-type="Validity"\n                       data-ui-id="osVersionValidity"></div>\n                    <div data-ui-type="Panel" data-ui-id="osOversizedTipV2" data-ui-hidden="true" class="os-oversized-tip">\n                        该镜像大小为<span data-ui-type="Label" data-ui-id="minDiskGb"></span>GB，系统盘容量不足，请先\n                        <div data-ui-type="Button" data-ui-id="expandDisk" class="expand-disk skin-stringfy-button">扩容系统盘</div>\n                    </div>\n                    <div data-ui-type="Panel" data-ui-id="osOversizedTip" data-ui-hidden="true" class="os-oversized-tip">\n                        您当前系统盘容量小于重装该镜像所需系统盘容量，无法重装操作系统。\n                    </div>\n                </div>\n                \x3c!-- /if --\x3e\n            </div>\n            <div class="form-row bcc-admin-name-row">\n                <div class="form-key">${i18n.管理员用户名：}</div>\n                <div class="form-value">\n                    <div data-ui="type:Label;id:adminName;" class="bcc-admin-name">root</div>\n                </div>\n            </div>\n            <div class="form-row">\n                <div class="form-key">${i18n.登录方式：}</div>\n                <div class="form-value">\n                    <div data-ui="type:RadioSelect;id:adminPassType;name:adminPassType;" class="ui-radioselect-custom"></div>\n                    <div data-ui-type="Tip"\n                         data-ui-id="adminPassTypeTip"\n                         data-ui-content="${tips.instance.ssh}"\n                         data-ui-skin="warning"\n                         class="doc-link"></div>\n                </div>\n            </div>\n            <div data-ui="type: Panel; id:passwordPanel">\n                <div class="form-row">\n                    <div class="form-key">${i18n.管理员新密码：}</div>\n                    <div class="form-value">\n                        <input type="password"\n                            data-ui-custom-error-message="${i18n.密码不符合规则}"\n                            data-ui-type="TextBox"\n                            data-ui-id="adminPass"\n                            data-ui-name="adminPass"\n                            data-ui-width="320" />\n                        <br />\n                        <label data-ui="type:Label;id:passwordTip;" class="bcc-note password-tip"></label>\n                    </div>\n                </div>\n                <div class="form-row">\n                    <div class="form-key">${i18n.确认密码：}</div>\n                    <div class="form-value">\n                        <input type="password"\n                            data-ui-type="TextBox"\n                            data-ui-id="confirm"\n                            data-ui-name="confirm"\n                            data-ui-width="320" />\n                        <div class="bcc-note">${tips.instance.adminPassCustomTip}</div>\n                    </div>\n                </div>\n            </div>\n            <div data-ui="type: Panel; id:keypairPanel">\n                <div class="form-row">\n                    <div class="form-key">${i18n.密钥对：}</div>\n                    <div class="form-value">\n                        <div data-ui-id="keypair"\n                             data-ui-name="keypair"\n                             data-ui-type="Select"\n                             data-ui-extension-autovalidate-type=\'AutoValidate\'\n                             data-ui-extension-autovalidate-prevent=\'true\'\n                             data-ui-width="200"></div>\n                        <span data-ui="type:Button;id:createKeypair;skin:stringfy;" data-ui-extension-popover-type="PopoverEx">+ ${i18n.创建密钥对}</span>\n                        <span data-ui="type:Label;id:keypairTip;hidden:true;" class="bcc-error">\n                            ${i18n.加载失败，请重试。}\n                        </span>\n                        <br>\n                        <label data-ui-type="Validity"\n                               data-ui-id="keypairValidity"></label>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </form>\n</div>\n\n\x3c!-- target: TPL_bcc_instance_rebuild_os --\x3e\n<div>\n    <span>${mktImage.productName}（${mktImage.packageName}）</span>\n    <a target="_blank"\n        class="os_helplink"\n        href="${mktImage.productUrl}">\n        ${i18n.镜像环境详情}</a>\n    <a target="_blank"\n        class="os_helplink"\n        href="${mktImage.agreementUrl}">\n        <input type="checkbox" disabled="disabled" checked="checked">&nbsp; ${i18n.理解和接受《百度云镜像服务协议》}</a>\n</div>\n\n\x3c!-- target: TPL_bcc_instance_rebuild_child --\x3e\n\x3c!-- import: TPL_bcc_instance_rebuild --\x3e\n'}),define("bcc/instance/RebuildModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","inf-ria/mvc/FormModel","babel-runtime/helpers/interop-require-default","lodash","promise","../flags","../helper","../util","../tips","../config","../enum"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p){var f=n["default"](i),m=n["default"](s),h=n["default"](r),g=n["default"](o),v=n["default"](c),b=n["default"](l),y=n["default"](d),T={"x-silent":!0},x=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.submitRequester=function(e){return u.api.bccInstanceRebuild(e,T)},n.prototype.prepare=function(){var e=this.get("instance");this.set("isActive",e.status===p.InstanceStatus.ACTIVE),this.prepareImageTypeData(),this.getImageData(),this.getKeypairList(),e.imageType===p.ImageType.MKT&&this.getMktImage()},n.prototype.getImageList=function(e){var t=this,a=this.get("instance"),i="os"+m["default"].capitalize(e[0]),n={imageTypes:e,keyword:"active",keywordType:"status"};return m["default"].contains([p.ImageType.FPGAIMAGE,p.ImageType.FPGACUSTOM],a.imageType)&&m["default"].extend(n,{fpgaImageId:a.imageId}),u.api.bccImageList(n,T).then(function(n){var s=n.result;return a.instanceType===p.InstanceType.GPU&&e[0]===p.ImageType.GPU_BCC_IMAGE&&(s=m["default"].filter(s,function(e){return"windows"!==e.osType})),t.set(i,s),s})},n.prototype.getImageData=function(){var e=this,t=this.get("imageTypeData"),a=[];m["default"].each(t,function(t){t.value===p.ImageType.GPU_BCC_IMAGE?a.push(e.getImageList([p.ImageType.GPU_BCC_IMAGE,p.ImageType.COMMON])):t.value===p.ImageType.GPU_BCC_CUSTOM?a.push(e.getImageList([p.ImageType.GPU_BCC_CUSTOM,p.ImageType.CUSTOM])):t.value!==p.ImageType.MKT&&a.push(e.getImageList([t.value]))}),h["default"].all(a).then(function(){var t=e.getOsData();e.set("osTypeMap",t.osTypeMap),e.set("osVersionMap",t.osVersionMap),e.set("osData",t)})},n.prototype.getMktImage=function(){var e=this,t=this.get("instance");return u.api.mktImageDetail({instanceUuid:t.id},T).then(function(t){return e.set("mktImage",t)})},n.prototype.prepareImageTypeData=function(){var e=this.get("instance"),t=p.ImageType.toArray("COMMON","CUSTOM","INTEGRATION","SHARING");e.instanceType===p.InstanceType.FPGA?t=p.ImageType.toArray("FPGAIMAGE","FPGACUSTOM"):e.instanceType===p.InstanceType.GPU?t=p.ImageType.toArray("GPU_BCC_IMAGE","GPU_BCC_CUSTOM","SHARING"):e.imageType===p.ImageType.MKT&&(t=p.ImageType.toArray("COMMON","CUSTOM","INTEGRATION","SHARING","MKT"));var a=Math.max(m["default"].indexOf(m["default"].pluck(t,"value"),e.imageType),0);return e.imageType===p.ImageType.COMMON&&(a=0),e.imageType===p.ImageType.CUSTOM&&(a=1),this.set("imageTypeData",t),this.set("imageTypeIndex",a),t},n.prototype.getKeypairList=function(){var e=this;return u.api.sshList({pageNo:1,pageSize:500},T).then(function(t){var a=[{text:"选择密钥对",value:""}];return m["default"].each(t.result,function(e){a.push({text:e.name,value:e.keypairId})}),e.set("keypair",{list:a}),a}).fail(function(t){return e.set("keypair",{error:!0})})},n.prototype.getOsData=function(){var e=this,t={common:[],custom:[],integration:[],sharing:[],fpgaImage:[],fpgaCustom:[],gpuBccImage:[],gpuBccCustom:[]},a={common:{},custom:{},integration:{},sharing:[],fpgaImage:{},fpgaCustom:{},gpuBccImage:{},gpuBccCustom:{}},i=this.get("imageTypeData"),n=this.get("instance");if(m["default"].each(i,function(i){var s=m["default"].capitalize(i.value);n.imageType===p.ImageType.MKT&&i.value!==p.ImageType.MKT?i.disable=!0:i.value!==p.ImageType.MKT&&e.get("os"+s)&&(i.disable=0===e.get("os"+s).length,b["default"].formatOsData(i.value,e.get("os"+s),t,a))}),t.gpuBccImage.length){var s=m["default"].remove(t.gpuBccImage,function(e){return"ubuntu"===e.name.toLowerCase()});if(t.gpuBccImage=[].concat(s,t.gpuBccImage),a.gpuBccImage.Ubuntu){var r=m["default"].remove(a.gpuBccImage.Ubuntu,function(e){return/^.*集成GPU驱动版$/.test(e.name)});a.gpuBccImage.Ubuntu=[].concat(r,a.gpuBccImage.Ubuntu)}}return{osTypeMap:t,osVersionMap:a}},n.prototype.getOSTypeList=function(e){return this.get("osTypeMap")[e]},n.prototype.getExtraData=function(){return g["default"].enable_baixin?{authCode:"123456",instanceId:this.get("instanceId"),imageId:this.get("imageId")}:{instanceId:this.get("instanceId"),imageId:this.get("imageId")}},n.prototype.filterData=function(e){return g["default"].enable_rsa_encrypt&&e.adminPass&&e.confirm&&(e.adminPass=v["default"].rsaEncrypt(e.adminPass),e.confirm=e.adminPass),e.adminPassType===u.PASSWORD_TYPE.SSH&&(e.keypairId=e.keypair,delete e.keyPair),e},t["default"](n,[{key:"datasource",get:function(){return[{tips:function(){return y["default"]},quota:function(e){return u.api.bccQuota({objType:"bcc",needGlobalQuota:!0})},instance:function(e){return u.api.bccInstanceDetail({instanceId:e.get("instanceId")})},snapshoted:function(e){return u.api.bccSnapshotList({instanceId:e.get("instanceId")}).then(function(e){return e.result&&e.result.length})}},{sysDisk:function(e){return u.api.bccDiskDetail({instanceId:e.get("instance").id})}}]}}]),n}(f["default"]);module.exports=x}),define("bcc/instance/RebuildView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/tpl!./rebuild.tpl","inf-ria/mvc/FormView","babel-runtime/helpers/interop-require-default","../config","../enum","common/util"],function(exports,module,e,t,a,i,n,s,r,o){var c=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_bcc_instance_rebuild"}return e["default"](i,a),i.prototype.getUIEvents=function(){return{"imageType:change":function(e){var t=e.item.value,a=this.model.get("tips").imageTips;this.fire("IMAGE_TYPE_CHANGE",{imageType:t}),this.get("imageTip").setProperties({content:a[t]})},"osType:change":function(e){var t=e.target.getSelectedItem();t&&("linux"===t.value?(this.get("adminPassType").updateDatasource([{name:"设置密码",value:s.PASSWORD_TYPE.CUSTOM},{name:"密钥对",value:s.PASSWORD_TYPE.SSH}]),this.get("adminPassType").setSelectedIndex(1),this.get("adminPassTypeTip").show()):"windows"===t.value&&(this.get("adminPassType").updateDatasource([{name:"设置密码",value:s.PASSWORD_TYPE.CUSTOM}]),this.get("adminPassType").setSelectedIndex(0),this.get("adminPassTypeTip").hide()),this.get("adminName").setText(s.OS_ADMIN_NAME[t.value]),this.fire("OS_TYPE_CHANGE",{imageType:this.get("imageType").getValue(),osType:t.name,memory:this.model.get("instance").memory}))},"osVersion:change":function(){var e=this.get("osVersion").getSelectedItem();this.fire("SET_IMAGE_ID",{imageId:e&&e.imageId||""});var t=this.model.get("instance"),a=t.sysDisk,i=this.model.get("parentAction").view.get("btnFootOk");if(t.rocV2&&e){var n=this.get("osOversizedTipV2"),s=this.get("minDiskGb");e.minDiskGb>a?(this.checkExpandCdsPermission()&&(s.setProperties({text:e.minDiskGb}),n.show()),i.disable()):(n.hide(),i.enable())}else if(e){n=this.get("osOversizedTip");/linux/.test(e.osType)&&(e.minDiskGb>20?(n.show(),i.disable()):(n.hide(),i.enable())),/windows/.test(e.osType)&&(e.minDiskGb>40?(n.show(),i.disable()):(n.hide(),i.enable()))}},"adminPassType:change":function(e){var t=this.get("passwordPanel"),a=this.get("keypairPanel");e.target.getValue()===s.PASSWORD_TYPE.SSH?(t.hide(),a.show()):(t.show(),a.hide())},"adminPass:input":function(e){e.target.validate()},"confirm:input":function(e){this.viewContext.controls.adminPass.getValue()!==e.target.getValue()?this.notifyErrors({confirm:"密码不一致"}):e.target.hideValidity()},"createKeypair:click":function(){this.fire("createKeypair")},"expandDisk:click":function(){this.fire("expandDisk",{item:this.model.get("sysDisk")})}}},i.prototype.getUIProperties=function(){var e=this.model.get("instance");return{imageType:{datasource:"@imageTypeData",selectedIndex:"@imageTypeIndex"},imageTip:{content:this.model.get("tips").imageTips[e.imageType]},osType:{datasource:[{name:"加载中...",value:""}]},osVersion:{datasource:[{name:"加载中...",value:""}],validityLabel:"osVersionValidity"},adminPassType:{datasource:[{name:"设置密码",value:s.PASSWORD_TYPE.CUSTOM},{name:"密钥对",value:s.PASSWORD_TYPE.SSH}],selectedIndex:"linux"===e.osType.toLowerCase()?1:0},adminPass:{custom:function(e){return this.viewContext.controls.adminPassType.getValue()===s.PASSWORD_TYPE.SSH||s.RULE.PASSWORD.custom(e)}},keypair:{datasource:[{name:"加载中...",value:""}],custom:function(e){return this.viewContext.controls.adminPassType.getValue()!==s.PASSWORD_TYPE.SSH||!!e},customErrorMessage:"请选择密钥对",validityLabel:"keypairValidity"},passwordTip:{text:s.RULE.PASSWORD.customErrorMessage},confirm:{custom:function(e){var t=this.viewContext.controls.adminPass;return this.viewContext.controls.adminPassType.getValue()===s.PASSWORD_TYPE.SSH||t.getValue()===this.getValue()},customErrorMessage:"确认密码和新密码不一致"}}},i.prototype.enterDocument=function(){a.prototype.enterDocument.call(this),this.get("adminPassType").fire("change")},i.prototype.updateOs=function(){this.get("imageType").updateDatasource(this.model.get("imageTypeData")),this.model.get("instance").imageType!==r.ImageType.MKT&&this.fire("IMAGE_TYPE_CHANGE",{imageType:this.get("imageType").getValue()})},i.prototype.updateMktImage=function(){var e=this.model.get("mktImage"),t=this.templateRender("TPL_bcc_instance_rebuild_os",{mktImage:e});this.get("mktImagePanel").setContent(t)},i.prototype.updateKeypair=function(){var e=this.model.get("keypair");e.error?(this.get("keypairTip").show(),this.get("keypair").updateDatasource([{name:"加载失败",value:""}])):(this.get("keypair").updateDatasource(e.list),this.get("keypairTip").hide())},i.prototype.validateKeypair=function(){return this.get("keypair").validate()},i.prototype.checkExpandCdsPermission=function(){var e=this.model.get("sysDisk");return!(e.storageType!==r.StorageType.SSD&&e.storageType!==r.StorageType.PREMIUM_SSD||e.status!==s.DISK_STATUS.IN_USE||e.orderStatus||o.isSubUser())},i}(n["default"](i)["default"]);module.exports=c}),define("bcc/instance/Release",["require","bat-ria/mvc/BaseAction","./ReleaseModel","./ReleaseView","er/util"],function(require){function e(){a.apply(this,arguments)}function t(){var e=this.view.get("releaseOnOff"),t=this.view.get("releaseTime"),a=this.model.get("releaseTime");a?e.set("checked",!0):(e.set("checked",!1),t.disable()),this.model.set("releaseTimeInitValue",a)}var a=require("bat-ria/mvc/BaseAction");return e.prototype.initBehavior=function(){a.prototype.initBehavior.apply(this,arguments),this.on("entercomplete",t,this)},e.prototype.modelType=require("./ReleaseModel"),e.prototype.viewType=require("./ReleaseView"),require("er/util").inherits(e,a),e}),define("bcc/instance/release.tpl",[],function(){return'\x3c!-- target: TPL_bcc_instance_releaseshedule --\x3e\n<div class="bcc-releaseshedule-dialog skin-confirm-dialog bcc-dialog-form">\n    <div class="form-data-body">\n        <div class="form-row">\n            <div class="form-key">${i18n.自动释放设置：}</div>\n            <div class="form-value form-release-on-off">\n                <div data-ui-type="ToggleButton"\n                    data-ui-id="releaseOnOff"></div>\n            </div>\n        </div>\n        <div class="form-row" id="releaseTimeRow">\n            <div class="form-key">${i18n.自动释放时间：}</div>\n            <div class="form-value">\n                <input data-ui-type="Calendar" name="releaseTime"\n                    data-ui-id="releaseTime" class="start-calendar"\n                    data-ui-value="${releaseTime}"\n                    data-ui-width="204"\n                    data-ui-time="true" />\n            </div>\n        </div>\n    </div>\n</div>\n\n\x3c!-- target: TPL_bcc_instance_releaseshedule_child --\x3e\n\x3c!-- import: TPL_bcc_instance_releaseshedule --\x3e\n'}),define("bcc/instance/ReleaseModel",["require","bat-ria/mvc/BaseModel","common/constants","inf-ria/utils/mtools","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("bat-ria/mvc/BaseModel"),a=require("common/constants"),i=require("inf-ria/utils/mtools");return e.prototype.datasource={releaseTime:function(e){var t=e.get("releaseTime");return t&&i.utc2local(t,a.TIME_FORMAT)}},require("er/util").inherits(e,t),e}),define("bcc/instance/ReleaseView",["require","bat-ria/tpl!./release.tpl","bat-ria/mvc/BaseView","moment","er/util"],function(require){function e(){t.apply(this,arguments)}require("bat-ria/tpl!./release.tpl");var t=require("bat-ria/mvc/BaseView"),a=require("moment");return e.prototype.template="TPL_bcc_instance_releaseshedule",e.prototype.uiEvents={"releaseTime:change":function(e){e.target.validate()?this.setBtnOkAble("enable"):this.setBtnOkAble("disable")},"releaseOnOff:change":function(e){var t=this.get("releaseTime");e.target.isChecked()?t.enable():(t.disable(),t.removeState("validity-invalid"),t.getValidityLabel().hide()),this.setBtnOkAble("enable")}},e.prototype.uiProperties={releaseTime:{range:{begin:a().subtract(1,"days").toDate(),end:new Date(2046,10,4)},required:"required",requiredErrorMessage:"释放时间必填",custom:function(e){return a(e).isAfter(a().add(5,"m"))},autoHideLayer:"false",customErrorMessage:"释放时间必须晚于当前时间5分钟"}},e.prototype.setBtnOkAble=function(e){var t=this.model.get("parentAction").view.get("btnFootOk");if("enable"===e||"disable"===e){var a=this.model.get("releaseTimeInitValue");!a&&!this.get("releaseOnOff").isChecked()||a&&this.get("releaseOnOff").isChecked()&&this.get("releaseTime").getValue()===a?t.disable():t[e]()}},require("er/util").inherits(e,t),e}),define("bcc/instance/require_auth_code.tpl",[],function(){return'\x3c!-- target: TPL_bcc_instance_requireauth_code --\x3e\n<div class="bcc-dialog-form bcc-instance-requireauth-code">\n    \x3c!-- if: ${tip} --\x3e\n    <div class="tip">${tip|raw}</div>\n    \x3c!-- /if --\x3e\n    \x3c!-- if: ${serviceType} && ${serviceType}  === \'BCC\' --\x3e\n    <div class="instance-info-container">\n        <div class="info-head"><span>实例名称 / 实例ID / 内网IP</span></div>\n        <label>待删除实例：</label>\n        <div class="info-body">\n\n            \x3c!-- for: ${instances} as ${instance}--\x3e\n            <div>\n                ${instance.name | formatName(20)} / ${instance.instanceId} / ${instance.internalIp}\n            </div>\n            \x3c!-- /for --\x3e\n        </div>\n    </div>\n    <div class="related-release">\n        <input type="checkbox"\n               data-ui-type="CheckBox"\n               data-ui-name="relatedReleaseFlag"\n               data-ui-id="relatedReleaseFlag">\n        ${i18n.关联释放绑定的后付费公网IP和云磁盘}\n    </div>\n    <div data-ui-type="Panel" data-ui-id="deleteCdsSnapshotPanel" class="related-release" data-ui-hidden="true">\n        <input type="checkbox"\n               data-ui-type="CheckBox"\n               data-ui-name="deleteCdsSnapshotFlag"\n               data-ui-id="deleteCdsSnapshotFlag">\n        ${i18n.同时释放云磁盘快照}\n    </div>\n    \x3c!-- /if --\x3e\n    <form data-ui-type="Form"\n          data-ui-id="form"\n          data-ui-auto-validate="true">\n        <table>\n            \x3c!-- if: ${isCds} --\x3e\n            \x3c!-- <tr>\n                <td colspan="2">\n                    <input type="checkbox"\n                        data-ui-type="CheckBox"\n                        data-ui-name="autoSnapshot"\n                        data-ui-id="autoSnapshot"\n                        data-ui-title="同步释放云磁盘的自动和手动快照？"/>\n                </td>\n            </tr> --\x3e\n            <tr>\n                <td colspan="2">\n                    <input type="checkbox"\n                        data-ui-type="CheckBox"\n                        data-ui-name="manualSnapshot"\n                        data-ui-id="manualSnapshot"\n                        data-ui-title="同步释放云磁盘的自动和手动快照？" />\n                </td>\n            </tr>\n            \x3c!-- /if --\x3e\n        </table>\n    </form>\n\n</div>\n\n\x3c!-- target: TPL_bcc_instance_requireauth_code_child --\x3e\n\x3c!-- import: TPL_bcc_instance_requireauth_code --\x3e\n'}),define("bcc/instance/RequireAuthCode",["require","bat-ria/mvc/FormAction","er/Deferred","./RequireAuthCodeModel","./RequireAuthCodeView","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("bat-ria/mvc/FormAction");require("er/Deferred");return e.prototype.modelType=require("./RequireAuthCodeModel"),e.prototype.viewType=require("./RequireAuthCodeView"),e.prototype.redirectAfterSubmit=function(){var e=this.model.get("parentAction");e&&(e.redirectAfterDelete&&e.redirectAfterDelete()||e.reload())},e.prototype.initBehavior=function(){t.prototype.initBehavior.apply(this,arguments)},e.prototype.handleSubmitError=function(e){var t=this.model.get("parentAction");t&&t.dialog&&t.dialog.show(),e.field&&e.field.mfa||this.view.showToast(e&&e.global?e.global:"操作失败",{messageType:"error"})},require("er/util").inherits(e,t),e}),define("bcc/instance/RequireAuthCodeModel",["require","bat-ria/mvc/FormModel","../config","../flags","underscore","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("bat-ria/mvc/FormModel"),a=(require("../config").api,require("../flags")),i=require("underscore"),n={"x-silent":!0};return e.prototype.submitRequester=function(e){var t=this.get("requester");if(t)return t(e,n)},e.prototype.datasource=null,e.prototype.getExtraData=function(){return a.enable_baixin?i.extend({authCode:"123456"},this.get("extraData")):this.get("extraData")||{}},require("er/util").inherits(e,t),e}),define("bcc/instance/RequireAuthCodeView",["require","bat-ria/tpl!./require_auth_code.tpl","bat-ria/mvc/FormView","underscore","er/util"],function(require){function e(){t.apply(this,arguments)}require("bat-ria/tpl!./require_auth_code.tpl");var t=require("bat-ria/mvc/FormView"),a=require("underscore");return e.prototype.template="TPL_bcc_instance_requireauth_code",e.prototype.uiProperties={},e.prototype.uiEvents={"relatedReleaseFlag:click":function(){this.get("relatedReleaseFlag").isChecked()?this.get("deleteCdsSnapshotPanel").show():this.get("deleteCdsSnapshotPanel").hide()}},e.prototype.getExtraFormData=function(){var e={};return this.get("relatedReleaseFlag")&&a.extend(e,{relatedReleaseFlag:this.get("relatedReleaseFlag").isChecked()?1:0}),this.get("deleteCdsSnapshotFlag")&&a.extend(e,{deleteCdsSnapshotFlag:this.get("deleteCdsSnapshotFlag").isChecked()?1:0}),this.model.get("isCds")&&(e=a.extend(e,{manualSnapshot:this.get("manualSnapshot").isChecked()?"on":"off",autoSnapshot:this.get("manualSnapshot").isChecked()?"on":"off"})),e},require("er/util").inherits(e,t),e}),define("bcc/instance/rules",["exports","module","../enum","common/region","babel-runtime/helpers/interop-require-default","lodash"],function(exports,module,e,t,a,i){var n=a["default"](t),s=a["default"](i);module.exports={createInstance:[{required:!1},{subUserAble:!1,message:"子帐号没有权限创建实例"},{custom:function(e){if("hk02"===n["default"].getCurrentRegion().id)return{disable:!0,message:"售罄！请移步其他地域购买资源。"}}}],recharge:[{status:[e.InstanceStatus.ACTIVE,e.InstanceStatus.SHUTOFF,e.InstanceStatus.EXPIRED],message:function(e){return e.length>1?"部分实例当前状态无法续费":"该实例当前状态无法续费"}},{productType:["prepay"],message:"后付费的实例不能续费"},{orderAble:!1,message:"实例存在其他订单，请处理后重试"},{subUserAble:!1,message:"子帐号没有权限对实例续费"}],editTag:[{status:s["default"].map(e.InstanceStatus.toArray(),function(t){if(t.value!==e.InstanceStatus.BUILD)return t.value}),message:function(e){return e.length>1?"部分实例当前状态无法编辑标签":"该实例当前状态无法编辑标签"}}],RELEASE_SHEDULE:[{isSingle:!0,message:"无法批量设置定时释放"},{status:[e.InstanceStatus.ACTIVE,e.InstanceStatus.SHUTOFF,e.InstanceStatus.PAUSED,e.InstanceStatus.SUSPENDED,e.InstanceStatus.RESCUE,e.InstanceStatus.ERROR,e.InstanceStatus.SOFT_DELETED,e.InstanceStatus.EXPIRED,e.InstanceStatus.SHELVED,e.InstanceStatus.SHELVED_OFFLOADED,e.InstanceStatus.MIGRATING],message:"该实例当前状态无法设置定时释放"},{subUserAble:!1,message:"子帐号没有权限设置定时释放"},{custom:function(t){return"cce"===t[0].application?{disable:!0,message:"禁止对CCE节点进行该操作"}:"as"===t[0].application?{disable:!0,message:"禁止对伸缩组节点进行该操作"}:t[0].payment===e.ProductType.PREPAY&&t[0].status!==e.InstanceStatus.EXPIRED?{disable:!0,message:"预付费的实例只能已过期设置定时释放"}:void 0}}],DELETE:[{status:[e.InstanceStatus.ACTIVE,e.InstanceStatus.SHUTOFF,e.InstanceStatus.PAUSED,e.InstanceStatus.SUSPENDED,e.InstanceStatus.RESCUE,e.InstanceStatus.ERROR,e.InstanceStatus.SOFT_DELETED,e.InstanceStatus.EXPIRED,e.InstanceStatus.SHELVED,e.InstanceStatus.SHELVED_OFFLOADED,e.InstanceStatus.MIGRATING],message:function(e){return e.length>1?"部分实例当前状态无法释放":"该实例当前状态无法释放"}},{subUserAble:!1,message:"子帐号没有权限释放实例"},{custom:function(t){var a={};return s["default"].find(t,function(e){return"cce"===e.application})?{disable:!0,message:"禁止对CCE节点进行该操作"}:s["default"].find(t,function(e){return"as"===e.application})?{disable:!0,message:"禁止对伸缩组节点进行该操作"}:(s["default"].each(t,function(t){t.payment===e.ProductType.PREPAY&&t.status!==e.InstanceStatus.EXPIRED&&(a={disable:!0,message:"预付费的实例只能已过期释放"})}),a)}}],START:[{status:[e.InstanceStatus.SHUTOFF],message:function(e){return e.length>1?"部分实例当前状态无法开启":"该实例当前状态无法开启"}},{custom:function(e){if(s["default"].find(e,function(e){return"as"===e.application}))return{disable:!0,message:"禁止对伸缩组节点进行该操作"}}}],REBOOT:[{status:[e.InstanceStatus.ACTIVE],message:function(e){return e.length>1?"部分实例当前状态无法重启":"该实例当前状态无法重启"}},{custom:function(e){if(s["default"].find(e,function(e){return"as"===e.application}))return{disable:!0,message:"禁止对伸缩组节点进行该操作"}}}],STOP:[{status:[e.InstanceStatus.ACTIVE,e.InstanceStatus.ERROR],message:function(e){return e.length>1?"部分实例当前状态无法停止":"该实例当前状态无法停止"}},{custom:function(e){if(s["default"].find(e,function(e){return"as"===e.application}))return{disable:!0,message:"禁止对伸缩组节点进行该操作"}}}],RESET_PASSWORD:[{isSingle:!0,message:"无法批量重置实例密码"},{status:[e.InstanceStatus.ACTIVE,e.InstanceStatus.SHUTOFF],message:"该实例当前状态无法重置密码"},{custom:function(e){if(s["default"].find(e,function(e){return"as"===e.application}))return{disable:!0,message:"禁止对伸缩组节点进行该操作"}}}],JOIN_SECURITY:[{status:s["default"].map(e.InstanceStatus.toArray(),function(t){if(!s["default"].contains([e.InstanceStatus.BUILD,e.InstanceStatus.EXPIRED],t.value))return t.value}),message:function(e){return e.length>1?"部分实例当前状态无法关联安全组":"该实例当前状态无法关联安全组"}},{custom:function(e){if(1!==s["default"].uniq(s["default"].pluck(e,"vpcId")).length)return{disable:!0,message:"关联安全组的实例必须在同一个VPC内"}}}],CREATE_SNAPSHOT:[{isSingle:!0,message:"无法批量创建快照"},{status:[e.InstanceStatus.ACTIVE,e.InstanceStatus.SHUTOFF],message:"该实例当前状态无法创建快照"},{custom:function(t){if(t[0].imageType===e.ImageType.MKT)return{disable:!0,message:"由云市场镜像创建的实例无法创建快照"}}}],CREATE_IMAGE:[{isSingle:!0,message:"无法批量创建自定义镜像"},{status:[e.InstanceStatus.ACTIVE,e.InstanceStatus.SHUTOFF],message:"该实例当前状态无法创建自定义镜像"},{custom:function(t){if(t[0].imageType===e.ImageType.MKT)return{disable:!0,message:"由云市场镜像创建的实例无法创建自定义镜像"}}}],REBUILD_INSTANCE:[{isSingle:!0,message:"无法批量重装操作系统"},{status:[e.InstanceStatus.ACTIVE,e.InstanceStatus.SHUTOFF],message:"该实例当前状态无法重装操作系统"},{custom:function(e){return"cce"===e[0].application?{disable:!0,message:"禁止对CCE节点进行该操作"}:"as"===e[0].application?{disable:!0,message:"禁止对伸缩组节点进行该操作"}:void 0}}],ALTER_PRODUCTTYPE:[{status:[e.InstanceStatus.ACTIVE,e.InstanceStatus.SHUTOFF],message:function(e){return e.length>1?"部分实例当前状态无法计费变更":"该实例当前状态无法计费变更"}},{subUserAble:!1,message:"子帐号没有权限做计费变更"},{orderAble:!1,message:"实例存在其他订单，请处理后重试"},{custom:function(t){return s["default"].find(t,function(e){return"as"===e.application})?{disable:!0,message:"禁止对伸缩组节点进行该操作"}:s["default"].find(t,function(e){return e.autoRenew})?{disable:!0,message:t.length>1?"部分实例开通了自动续费，无法变更计费方式":"该实例开通了自动续费，无法变更计费方式"}:s["default"].filter(t,function(t){return t.payment===e.ProductType.PREPAY}).length>1?{disable:!0,message:"不支持批量预付费转后付费"}:void 0}}],CANCEL_ALTER_PRODUCTTYPE:[{status:[e.InstanceStatus.ACTIVE,e.InstanceStatus.SHUTOFF],message:function(e){return e.length>1?"部分实例当前状态无法取消计费变更":"该实例当前状态无法取消计费变更"}},{subUserAble:!1,message:"子帐号没有权限取消计费变更"},{custom:function(e){return s["default"].find(e,function(e){return"as"===e.application})?{disable:!0,message:"禁止对伸缩组节点进行该操作"}:1!==s["default"].uniq(s["default"].pluck(e,"orderStatus")).length||"to_postpay"!==e[0].orderStatus?{disable:!0,message:"正在进行计费变更的实例才能取消计费变更"}:void 0}}],UPGRADE_CONFIG:[{isSingle:!0,message:"无法批量升级实例规格"},{status:[e.InstanceStatus.ACTIVE,e.InstanceStatus.SHUTOFF],message:"该实例当前状态无法升级"},{subUserAble:!1,message:"子帐号没有权限升级实例规格"},{orderAble:!1,message:"实例存在其他订单，请处理后重试"},{custom:function(t){return"cce"===t[0].application?{disable:!0,message:"禁止对CCE节点进行该操作"}:"as"===t[0].application?{disable:!0,message:"禁止对伸缩组节点进行该操作"}:t[0].instanceType===e.InstanceType.FPGA||t[0].instanceType===e.InstanceType.GPU&&t[0].payment===e.ProductType.POSTPAY?{disable:!0,message:"FPGA/GPU云服务器无法升级实例规格"}:void 0}}],RENAME:[{status:[e.InstanceStatus.ACTIVE,e.InstanceStatus.SHUTOFF],message:function(e){return e.length>1?"部分实例当前状态无法修改名称":"该实例当前状态无法修改名称"}},{custom:function(e){if(s["default"].find(e,function(e){return"as"===e.application}))return{disable:!0,message:"禁止对伸缩组节点进行该操作"}}}],updateDesc:[{isSingle:!0,message:"无法批量修改描述"},{status:[e.InstanceStatus.ACTIVE,e.InstanceStatus.SHUTOFF],message:"该实例当前状态无法修改描述"}],vnc:[{isSingle:!0,message:"无法批量vnc远程连接"},{status:[e.InstanceStatus.ACTIVE],message:"该实例当前状态无法vnc远程连接"}],bindEip:[{isSingle:!0,message:"无法批量绑定EIP"},{subUserAble:!1,message:"子帐号没有权限绑定EIP"},{status:[e.InstanceStatus.ACTIVE,e.InstanceStatus.SHUTOFF,e.InstanceStatus.PAUSED,e.InstanceStatus.SUSPENDED,e.InstanceStatus.RESCUE],message:"该实例当前状态无法绑定EIP"},{custom:function(e){return"BCC_NAT"===e[0].subnetType?{disable:!0,message:"NAT专属子网的实例无法绑定EIP"}:e[0].publicIp?{disable:!0,message:"该实例已绑定EIP"}:void 0}}],unbindEip:[{isSingle:!0,message:"无法批量解绑EIP"},{subUserAble:!1,message:"子帐号没有权限解绑EIP"},{status:[e.InstanceStatus.ACTIVE,e.InstanceStatus.SHUTOFF,e.InstanceStatus.PAUSED,e.InstanceStatus.SUSPENDED,e.InstanceStatus.RESCUE,e.InstanceStatus.EXPIRED],message:"该实例当前状态无法解绑EIP"},{custom:function(e){return"BCC_NAT"===e[0].subnetType?{disable:!0,message:"NAT专属子网的实例无法解绑EIP"}:e[0].publicIp?void 0:{disable:!0,message:"该实例没有绑定EIP"}}}],changeIp:[{status:[e.InstanceStatus.ACTIVE,e.InstanceStatus.SHUTOFF],message:"该实例当前状态无法变更子网"},{custom:function(e){return"cce"===e[0].application?{disable:!0,message:"禁止对CCE节点进行该操作"}:"as"===e[0].application?{disable:!0,message:"禁止对伸缩组节点进行该操作"}:void 0}}],changeSubnet:[{custom:function(e){return"cce"===e[0].application?{disable:!0,message:"禁止对CCE节点进行该操作"}:"as"===e[0].application?{disable:!0,message:"禁止对伸缩组节点进行该操作"}:void 0}}],buySame:[{subUserAble:!1,message:"子帐号没有权限购买相同配置"}],BIND_SSH:[{status:[e.InstanceStatus.ACTIVE,e.InstanceStatus.SHUTOFF],message:"该实例当前状态无法绑定密钥对"},{custom:function(e){if(s["default"].find(e,function(e){return"windows"===e.osType}))return{disable:!0,message:"密钥对只支持Linux系统的虚机"}}}],UNBIND_SSH:[{isSingle:!0,message:"无法批量解绑密钥对"},{status:[e.InstanceStatus.ACTIVE,e.InstanceStatus.SHUTOFF],message:"该实例当前状态无法解绑密钥对"},{custom:function(e){if(""===e[0].keypairId)return{disable:!0,message:"该虚机尚未绑定任何密钥对"}}}]}}),define("bcc/instance/security_groups.tpl",[],function(){return'\x3c!-- target: TPL_bcc_instance_securitygroups --\x3e\n<div class="bcc-instance-securitygroups bcc-main-wrap main-wrap-new">\n    <div class="content-wrap">\n        <p class="breadcrumb">\n            <span>${i18n.产品服务}</span>\n            <span class="divider">/</span>\n            <a href="#/bcc/instance/list">${i18n.云服务器BCC} - ${i18n.实例列表}</a>\n            <span class="divider">/</span>\n            <span class="active">${i18n.安全组}</span>\n        </p>\n\n        <div class="instance-info">\n            <h1 title="${instance.name}">${instance.name}</h1>\n            <span class="${statusClass}">${statusDesc}</span>\n        </div>\n\n        <div class="detail-content">\n            \x3c!-- import: TPL_bcc_instance_securitygroups_child --\x3e\n        </div>\n    </div>\n</div>\n\x3c!-- target: TPL_bcc_instance_securitygroups_child --\x3e\n<section class="ui-tab-content">\n    <article>\n        <header><h2>${i18n.当前应用的安全组规则}</h2></header>\n        <esui-tab data-ui-id="ruleTab" class="ui-smart-tab">\n            <ul data-role="navigator" class="ui-tab-navigator">\n                <li data-for="rule-in-list">${i18n.入站}</li>\n                <li data-for="rule-out-list">${i18n.出站}</li>\n            </ul>\n            <div id="rule-in-list" class="ui-tab-content">\n                <div data-ui-type="Table"\n                    data-ui-id="ingressRules"\n                    data-ui-datasource="@ingressRules">\n                </div>\n            </div>\n            <div id="rule-out-list" class="ui-tab-content">\n                <div data-ui-type="Table"\n                    data-ui-id="egressRules"\n                    data-ui-datasource="@egressRules">\n                </div>\n            </div>\n        </esui-tab>\n    </article>\n\n    <article>\n        <header><h2>${i18n.关联的安全组列表}</h2></header>\n        <div class="button-wrap">\n            <div data-ui-type="Button"\n                data-ui-id="joinSecurityGroups">${i18n.关联安全组}</div\n        ></div>\n        <div data-ui-type="Table"\n                data-ui-id="securityGroups"\n                data-ui-datasource="@securityGroups"\n                data-ui-extension-tableedit-type="TableEdit"\n                data-ui-extension-command-type="Command"\n                data-ui-extension-tablesubrow-type="TableSubrow">\n        </div>\n    </article>\n</section>\n\n\x3c!-- target: TPL_bcc_instance_securitygroups_subrow --\x3e\n<table class="ingress">\n    <caption>${i18n.入站规则}</caption>\n    <tr><th>${i18n.协议}</th><th>${i18n.端口}</th><th>Source</th><th>${i18n.备注}</th></tr>\n    \x3c!-- if: ${ingressRows.length} > 0 --\x3e\n    \x3c!-- for: ${ingressRows} as ${row} --\x3e\n    <tr>\n        <td>${row.protocol}</td>\n        <td>${row.portRange}</td>\n        \x3c!-- if: ${row.remoteGroupId} --\x3e\n        <td>${i18n.安全组：}${row.remoteGroupId}</td>\n        \x3c!-- else --\x3e\n        <td>${i18n.源IP：}${row.remoteIP}</td>\n        \x3c!-- /if --\x3e\n        <td>${row.name}</td>\n    </tr>\n    \x3c!-- /for --\x3e\n    \x3c!-- else --\x3e\n    <tr><td colspan="4">${i18n.暂无}</td></tr>\n    \x3c!-- /if --\x3e\n</table>\n\n<table class="egress">\n    <caption>${i18n.出站规则}</caption>\n    <tr><th>${i18n.协议}</th><th>${i18n.端口}</th><th>Target</th><th>${i18n.备注}</th></tr>\n    \x3c!-- if: ${egressRows.length} > 0 --\x3e\n    \x3c!-- for: ${egressRows} as ${row} --\x3e\n    <tr>\n        <td>${row.protocol}</td>\n        <td>${row.portRange}</td>\n        \x3c!-- if: ${row.remoteGroupId} --\x3e\n        <td>${i18n.安全组：}${row.remoteGroupId}</td>\n        \x3c!-- else --\x3e\n        <td>${i18n.目的IP：}${row.remoteIP}</td>\n        \x3c!-- /if --\x3e\n        <td>${row.name}</td>\n    </tr>\n    \x3c!-- /for --\x3e\n    \x3c!-- else --\x3e\n    <tr><td colspan="4">${i18n.暂无}</td></tr>\n    \x3c!-- /if --\x3e\n</table>\n'}),define("bcc/instance/SecurityGroups",["require","bat-ria/mvc/BaseAction","underscore","inf-i18n","../../common/util/dialog","./SecurityGroupsModel","./SecurityGroupsView","er/util"],function(require){function e(){n.apply(this,arguments)}function t(e){o.waitActionDialog(this.view,{title:r("关联安全组"),width:600,needFoot:!0,url:"/bcc/instance/join_security_groups",actionOptions:{instances:e.instances,parentAction:this}})}function a(e){this.model.quitSecurityGroup(e.data).then(s.bind(this.reload,this))}function i(e){var t=this.view.get("securityGroups").datasource[+e.rowIndex],a=t.id,i=e.value;i!==t.desc&&this.model.updateSecurityGroupField(a,"desc",i).then(s.bind(this.reload,this))}var n=require("bat-ria/mvc/BaseAction"),s=require("underscore"),r=require("inf-i18n"),o=require("../../common/util/dialog");return e.prototype.modelType=require("./SecurityGroupsModel"),e.prototype.viewType=require("./SecurityGroupsView"),e.prototype.initBehavior=function(){n.prototype.initBehavior.apply(this,arguments),this.view.on("SAVE_EDIT",i,this),this.view.on("JOIN_SECURITY_GROUPS",t,this),this.view.on("QUIT_SECURITY_GROUPS",a,this)},e.prototype.filterRedirect=function(e){if(this.context.isChildAction&&e.getPath()!==this.context.url.getPath())return location.href="/bcc/"+location.search+"#"+e.toString(),!1},require("er/util").inherits(e,n),e}),define("bcc/instance/SecurityGroupsModel",["require","bat-ria/mvc/BaseModel","underscore","../security/rule","../config","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("bat-ria/mvc/BaseModel"),a=require("underscore"),i=require("../security/rule"),n=require("../config"),s=n.api,r=n.INSTANCE_STATUS;return e.prototype.datasource={menu:function(e){return"instance"},instance:function(e){return e.getInstanceById(e.get("instanceId"))},securityGroups:function(e){return e.getSecurityGroups(e.get("instanceId"))},tab:function(){return{security:"ui-tab-item-active"}}},e.prototype.getInstanceById=function(e){return s.bccInstanceDetail({instanceId:e})},e.prototype.getSecurityGroups=function(e){return s.bccInstanceSecurityGroups({instanceId:e})},e.prototype.quitSecurityGroup=function(e){return s.bccInstanceQuitSecurityGroup({instanceId:this.get("instance").id,securityGroupId:e})},e.prototype.updateSecurityGroupField=function(e,t,a){var i={id:e};return i[t]=a,s.bccSecurityUpdateField(i)},e.prototype.prepare=function(){function e(e,t){for(var a=0;a<e.length;a++)if(t.equal(e[a],!0))return;e.push(t)}var t=this.get("securityGroups"),n=[],s=[];a.each(t.activeRules,function(t){var a=i.fromJSON(t);"egress"===t.direction?e(s,a):"ingress"===t.direction&&e(n,a)}),this.set("ingressRules",n),this.set("egressRules",s),this.set("securityGroups",t.securityGroups);var o=this.get("instance").status;this.set("statusDesc",r.TXT[o]||o),this.set("statusClass",r.CLASS[o])},require("er/util").inherits(e,t),e}),define("bcc/instance/SecurityGroupsView",["require","bat-ria/tpl!./security_groups.tpl","bat-ria/mvc/BaseView","underscore","bat-ria/etpl","inf-i18n","common/util","../security/rule","../config","er/util"],function(require){function e(){a.apply(this,arguments)}function t(e){var t=this.get("securityGroups"),a=parseInt(e.data,10),s=t.getSubrow(a);if(""===s.style.display)s.style.display="none";else{var r=function(e){var t=i.filter(e,function(e){return"ingress"===e.direction}).map(o.fromJSON),a=i.filter(e,function(e){return"egress"===e.direction}).map(o.fromJSON);return n.render("TPL_bcc_instance_securitygroups_subrow",{ingressRows:t,egressRows:a})}(t.datasource[a].rules);t.setSubrowContent(r,a),s.style.display=""}}require("bat-ria/tpl!./security_groups.tpl");var a=require("bat-ria/mvc/BaseView"),i=require("underscore"),n=require("bat-ria/etpl"),s=require("inf-i18n"),r=require("common/util"),o=require("../security/rule"),c=require("../config").INSTANCE_STATUS;e.prototype.template="TPL_bcc_instance_securitygroups";var l=[{title:s("协议"),content:"protocol"},{title:s("端口范围"),content:"portRange"},{title:"Source",content:function(e){return"system"===e.source?s("安全组：")+e.remoteGroupId:"ingressRules"===this.id?s("源IP：")+e.remoteIP:s("目的IP：")+e.remoteIP}},{title:s("备注"),width:80,content:function(e){return e.edit?e.name:i.escape(e.name)}}],d=[{title:s("安全组名称"),content:function(e){return'<a href="/network/#/vpc/security/detail~id='+e.id+(e.vpcId?"&vpcId="+e.vpcId:"")+'">'+i.escape(e.name)+"</a>"}},{title:s("所在网络"),content:function(e){return r.getVpcName(e.vpcName)}},{title:s("描述"),content:function(e,t,a){return i.escape(e.desc)+(r.isSubUser()?"":'<span class="ui-table-cell-editentry"data-row="'+t+'" data-col="'+a+'"><i class="iconfont icon-edit"></i></span>')},field:"desc",editRules:{maxLength:255}},{title:s("操作"),content:function(e,t){var a=(this.get("datasource")||[]).length,i='<a href="javascript:void(0)" data-command="TOGGLE_SECURITY_GROUPS"data-command-args="'+t+'">'+s("查看规则")+"</a>&nbsp;";return a>1&&(i+='<a href="javascript:void(0)" data-command="QUIT_SECURITY_GROUPS" data-command-args="'+e.id+'">'+s("取消关联")+"</a>"),i}}];return e.prototype.getUIProperties=function(){var e=this.model.get("instance");return{ingressRules:{fields:l},egressRules:{fields:i.map(l,function(e){return"Source"===e.title?i.chain(e).clone().extend({title:"Target"}).value():e})},securityGroups:{fields:d,subrow:!0,editable:!0,columnResizable:!0},joinSecurityGroups:{disabled:e.status===c.BUILD||e.status===c.EXPIRED}}},e.prototype.uiEvents={"ruleTab:activate":function(e){this.get("ingressRules").adjustWidth(),this.get("egressRules").adjustWidth()},"joinSecurityGroups:click":function(e){this.fire("JOIN_SECURITY_GROUPS",{instances:[this.model.get("instance")]})},"securityGroups:saveedit":function(e){this.fire("SAVE_EDIT",e)},"securityGroups:command":function(e){this.fire(e.name,{data:e.args})}},e.prototype.bindEvents=function(){a.prototype.bindEvents.apply(this,arguments),this.on("TOGGLE_SECURITY_GROUPS",t,this)},require("er/util").inherits(e,a),e}),define("bcc/instance/subnet/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","inf-ria/mvc/FormAction","babel-runtime/helpers/interop-require-default","inf-ria/decorators","./Model","./View"],function(exports,module,e,t,a,i,n,s,r){var o=i["default"](a),c=i["default"](s),l=i["default"](r),d=function(a){function i(){t["default"](this,s),a.apply(this,arguments)}e["default"](i,a),i.prototype.redirectAfterSubmit=function(){this.model.get("parentAction")?this.model.get("parentAction").reload():this.reload()};var s=i;return i=n.action(c["default"],l["default"])(i)||i}(o["default"]);module.exports=d}),define("bcc/instance/subnet/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","inf-ria/mvc/FormModel","babel-runtime/helpers/interop-require-default","underscore","inf-i18n","../../config"],function(exports,module,e,t,a,i,n,s,r,o){var c=n["default"](i),l=n["default"](s),d=n["default"](r),u=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.submitRequester=function(e){var t=this.get("requester");if(t)return t(e)},n.prototype.getSubnetList=function(){return o.api.vpcSubnetList()},n.prototype.filterData=function(e){var t=this.get("instance");this.get("subnet");return{instanceId:t.id,subnetId:e.subnetId,reboot:!(!e.boot||"on"!==e.boot)}},n.prototype.prepare=function(){var e=this.get("instance");this.set("internalIp",e.internalIp?l["default"].trim(e.internalIp.split("[")[0]):"")},t["default"](n,[{key:"datasource",get:function(){return{subnetList:function(e){var t=e.get("serviceType"),a=e.get("instance"),i=t&&"BBC"===t?[2,4]:[1,3];return o.api.subnetList({vpcId:e.get("vpc").vpcId,zone:a.logicalZone,subnetTypes:i}).then(function(e){var i=[{name:d["default"]("请选择子网"),value:""}];return t&&"BBC"===t&&a.publicIp?l["default"].each(e,function(e,t){4===e.subnetType?i.push({name:e.name,value:e.subnetId,disabled:!0,popover:"NAT专属子网中的BBC无法绑定EIP,请先手动将EIP解绑"}):i.push({name:e.name,value:e.subnetId})}):l["default"].each(e,function(e,t){i.push({name:e.name,value:e.subnetId})}),i})}}}}]),n}(c["default"]);module.exports=u}),define("bcc/instance/subnet/tpl",[],function(){return'\x3c!-- target: TPL_bcc_instance_subnet --\x3e\n<div class="bcc-instance-subnet">\n    <form data-ui-type="Form" data-ui-id="form" data-ui-auto-validate="true">\n        <div class="form-data-body">\n            <div class="bcc-subnet-note">\n                    ${i18n.温馨提示：目前仅支持在同AZ下变更子网，不支持跨AZ或跨VPC变更子网，如果从普通子网变更至NAT专属子网请先手动解绑EIP。}\n            </div>\n            <div class="form-row">\n                <label>${serviceType}${i18n.名称：}</label>\n                <div class="form-value form-line">\n                    ${instance.name}\n                </div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.所在VPC：}</label>\n                <div class="form-value form-line">\n                    ${vpc.cidr}\n                </div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.所在子网：}</label>\n                <div class="form-value form-line">\n                    <label data-ui-type="Label" data-ui-id="subnetCidr">${subnet.cidr}</label>\n                </div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.当前内网IP：}</label>\n                <div class="form-value form-line">\n                    ${instance.internalIp}\n                    <label data-ui-type="Label"\n                        data-ui-hidden="true"\n                        data-ui-id="internalIp">${internalIp}</label>\n                </div>\n            </div>\n            <div class="form-row">\n                <label class="required-label">${i18n.选择变更子网：}</label>\n                <div class="form-value">\n                    <div data-ui-type="Select"\n                        data-ui-extension-popover-type="PopoverEx"\n                        data-ui-id="subnetId" data-ui-name="subnetId">\n                    </div>\n                </div>\n            </div>\n            <div class="form-row">\n                <label>&nbsp;</label>\n                <div class="form-value">\n                    <input data-ui-type="CheckBox" data-ui-id="boot" data-ui-name="boot"\n                        title="${i18n.自动重启该服务器}"\n                        \x3c!-- if: ${serviceType} === \'BBC\' --\x3e\n                        data-ui-disabled="true"\n                        \x3c!-- /if --\x3e\n                        />\n                    \x3c!-- if: ${serviceType} === \'BCC\' --\x3e\n                    <span data-ui-type="Tip">${i18n.自动重启该服务器令IP更改生效。若选择不重启，用户需手动重启服务器或进入服务器操作系统重启网卡，IP更改方可生效。}</span>\n                    \x3c!-- else: --\x3e\n                    <span data-ui-type="Tip">${i18n.自动重启服务器可自动令IP更改生效，重启预计需要几分钟。当前不支持客户自行修改IP。}</span>\n                    \x3c!-- /if --\x3e\n                </div>\n            </div>\n        </div>\n    </form>\n</div>\n\n\x3c!-- target: TPL_bcc_instance_subnet_child --\x3e\n\x3c!-- import: TPL_bcc_instance_subnet --\x3e\n'}),define("bcc/instance/subnet/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-decorated-class","babel-runtime/helpers/class-call-check","babel-runtime/core-js/symbol","bat-ria/tpl!./tpl","inf-ria/mvc/FormView","babel-runtime/helpers/interop-require-default","inf-ria/decorators"],function(exports,module,e,t,a,i,n,s,r,o){var c=function(n){function s(){a["default"](this,r),n.apply(this,arguments)}e["default"](s,n),s.prototype.getUIEvents=function(){return{"subnetId:change":function(e){this.fire("okBtrigger",{disable:0===e.target.selectedIndex})}}},s.prototype.getExtraFormData=function(){return{boot:this.get("boot").isChecked()?"on":"off"}},t["default"](s,[{key:i["default"](),decorators:[o.uiProp("subnetId")],value:function(){return{datasource:"@subnetList"}}},{key:i["default"](),decorators:[o.uiProp("boot")],value:function(){return{checked:!0}}}]);var r=s;return s=o.template("TPL_bcc_instance_subnet")(s)||s}(r["default"](s)["default"]);module.exports=c}),define("bcc/instance/upgrade_config.tpl",[],function(){return'\x3c!-- target: TPL_bcc_instance_upgradeconfig --\x3e\n<div class="bcc-instance-upgradeconfig bcc-main-1col bcc-main-wrap main-wrap-new">\n    <div class="content-wrap">\n        <p class="breadcrumb">\n            <span>产品服务</span>\n            <span class="divider">/</span>\n            <a href="#/bcc/instance/list">云服务器BCC-实例列表</a>\n            <span class="divider">/</span>\n            <span class="active">配置升级</span>\n        </p>\n        <div class="create-content">\n            <div \x3c!-- if: ${instance.instanceType} !== \'9\' || ${bccWhite.isGpuResize} --\x3eclass="content-hidden" \x3c!-- /if --\x3e>\n                <div class="content-error">\n                    ${i18n.GPU实例暂不支持升配操作，如有特殊升配需要，可}\n                    <a href="http://ticket.bce.baidu.com/#/ticket/create">${i18n.提交工单}></a>\n                    ${i18n.反馈}\n                </div>\n                <div class="content-back">\n                    <button type="button" data-ui="id:cancel;type:Button;skin:cancel;">${i18n.回退}</button>\n                </div>\n            </div>\n            <div \x3c!-- if: ${instance.instanceType} === \'9\' && !${bccWhite.isGpuResize} --\x3eclass="content-hidden" \x3c!-- /if --\x3e>\n                <div data-ui-type="ViewStep"\n                     data-ui-id="buyStep"\n                     data-ui-current-step="1">\n                    <ul>\n                        <li bind-for="resizeBcc">升级云服务器配置</li>\n                        <li bind-for="orderConfrim">确认订单</li>\n                        <li>支付成功</li>\n                    </ul>\n                </div>\n                <div data-ui-type="Tab" data-ui-id="productType"\n                     data-ui-active-index="0" class="bec-tab">\n                    <ul data-role="navigator" class="ui-tab-navigator"></ul>\n                </div>\n                <div id="resizeBcc" class="create-main ui-tab-content">\n                    <form class="setting-form"\n                        data-ui-type="Form"\n                        data-ui-id="form"\n                        data-ui-submit-button="toBuy"\n                        data-ui-auto-validate="true">\n                        <div data-ui-id="buyBucket"\n                            data-ui-type="BuyBucket"\n                            data-ui-disabled="true"></div>\n                        <div class="detail-parts-table">\n                            <dl class="detail-part-1-col">\n                                <dt><h4>当前配置</h4></dt>\n                                <dd>\n                                    <div class="detail-cell">\n                                        <label>实例名称：</label>\n                                        <span class="nowrap-text" title="${instance.name}">${instance.name}</span>\n                                    </div>\n                                    <div class="detail-cell">\n                                        <label>公网IP：</label>\n                                        <span>${instance.publicIp|defaultValue}</span>\n                                    </div>\n                                </dd>\n                                \x3c!-- if: ${instance.instanceType} === \'9\' --\x3e\n                                <dd>\n                                    <div class="detail-cell">\n                                        <label>GPU型号：</label>\n                                        <span>${instance.gpuCardName}</span>\n                                    </div>\n                                    <div class="detail-cell">\n                                        <label>GPU卡数量：</label>\n                                        <span>${instance.gpuCount}块</span>\n                                    </div>\n                                </dd>\n                                \x3c!-- /if --\x3e\n                                <dd>\n                                    <div class="detail-cell">\n                                        <label>CPU：</label>\n                                        <span>${instance.cpu}核</span>\n                                    </div>\n                                    <div class="detail-cell">\n                                        <label>内网IP：</label>\n                                        <span>${instance.internalIp}</span>\n                                    </div>\n                                </dd>\n                                <dd>\n                                    <div class="detail-cell">\n                                        <label>内存：</label>\n                                        <span>${instance.memory}GB</span>\n                                    </div>\n                                    <div class="detail-cell">\n                                        <label>支付方式：</label>\n                                        <span>${instance.paymentDesc}</span>\n                                    </div>\n                                </dd>\n                                <dd>\n                                    <div class="detail-cell">\n                                        <label>数据盘：</label>\n                                        <span>${instance.diskSize}GB</span>\n                                    </div>\n                                    <div class="detail-cell">\n                                        <label>操作系统：</label>\n                                        <span>\n                                            \x3c!-- if: ${instance.osName}--\x3e\n                                            ${instance.osName} / ${instance.osVersion}\n                                            \x3c!-- else --\x3e\n                                            ${instance.osType} / ${instance.osVersion}\n                                            \x3c!-- /if --\x3e\n                                        </span>\n                                    </div>\n                                </dd>\n                                <dd>\n                                    <div class="detail-cell">\n                                        <label>实例ID：</label>\n                                        <span class="nowrap-text" title="${intance.instanceId}">${instance.instanceId}</span>\n                                    </div>\n                                    <div class="detail-cell">\n                                        <label>到期时间：</label>\n                                        <span>${instance.expireTimeDesc}</span>\n                                    </div>\n                                </dd>\n                            </dl>\n                            <dl class="detail-create detail-part-1-col">\n                                <dt><h4>变更配置</h4></dt>\n                                \x3c!-- if: ${instance.instanceType} === \'9\' --\x3e\n                                <dd>\n                                    <label>GPU型号：</label>\n                                    <div>\n                                        <div data-ui-id="gpuCard"\n                                            data-ui-name="gpuCard"\n                                            data-ui-type="RadioSelect"\n                                            class="ui-radioselect-custom"></div>\n                                    </div>\n                                </dd>\n                                <dd>\n                                    <label>GPU数量：</label>\n                                    <div>\n                                        <div data-ui-id="gpuCount"\n                                            data-ui-name="gpuCount"\n                                            data-ui-type="RadioSelect"\n                                            class="ui-radioselect-custom"></div>\n                                    </div>\n                                </dd>\n                                \x3c!-- /if --\x3e\n                                <dd>\n                                    <label>CPU：</label>\n                                    <div>\n                                        <div data-ui-id="cpu"\n                                            data-ui-name="cpu"\n                                            data-ui-type="RadioSelect"\n                                            data-ui-extension-popover-type="PopoverEx"\n                                            class="ui-radioselect-custom"></div>\n                                    </div>\n                                </dd>\n                                <dd>\n                                    <label>内存：</label>\n                                    <div>\n                                        <div data-ui-id="memory"\n                                            data-ui-name="memory"\n                                            data-ui-type="RadioSelect"\n                                            data-ui-extension-popover-type="PopoverEx"\n                                            class="ui-radioselect-custom"></div>\n                                    </div>\n                                </dd>\n                                \x3c!-- if: ${bccWhite.isCustomVmFlavor} && ${instance.instanceType} !== \'9\' --\x3e\n                                <dd>\n                                    <div class="flavor-custom">\n                                        <input type="checkbox"\n                                            data-ui-type="CheckBox"\n                                            data-ui-name="flavorCustomCheck"\n                                            data-ui-id="flavorCustomCheck" /><label>${i18n.自定义配置}</label>\n                                    </div>\n                                </dd>\n                                <dd data-ui-type="Panel" data-ui-id="flavorCustomPanel" data-ui-hidden="true">\n                                    <div class="flavor-custom">\n                                        <label>CPU：</label>\n                                        <span data-ui-id="cpuCustom"\n                                            data-ui-name="cpuCustom"\n                                            data-ui-type="TextBox"\n                                            data-ui-width="60"\n                                            class="cpu-custom"></span> 核\n                                        <label class="memory-custom-label">${i18n.内存}：</label>\n                                        <span data-ui-id="memoryCustom"\n                                            data-ui-name="memoryCustom"\n                                            data-ui-type="TextBox"\n                                            data-ui-width="60"></span> GB\n                                        <span data-ui-type="Validity"\n                                            data-ui-id="cpuCustomValidity" ></span>\n                                        <span data-ui-type="Validity"\n                                            data-ui-id="memoryCustomValidity" ></span>\n                                    </div>\n                                </dd>\n                                \x3c!-- /if --\x3e\n                                \x3c!-- if: ${instance.instanceType} === \'9\' --\x3e\n                                <dd>\n                                    <label>${i18n.本地磁盘：}</label>\n                                    <div class="disk-size-show">\n                                        <span data-ui-type="Label" data-ui-id="fixedTempDisk">${instance.diskSize}</span>GB\n                                        <span class="row-tip-grey">${i18n.（暂不支持自主选择）}</span>\n                                    </div>\n                                </dd>\n                                \x3c!-- /if --\x3e\n                            </dl>\n                        </div>\n                    </form>\n                </div>\n                <div id="orderConfrim">\n                    <div data-ui="id:orderAction;type:ActionPanel" class="clearfix ui-tab-content"></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("bcc/instance/upgrade_network.tpl",[],function(){return'\x3c!-- target: TPL_bcc_instance_UpgradeNetwork --\x3e\n<div class="bcc-instance-upgradenetwork bcc-main-1col bcc-main-wrap main-wrap-new">\n    <div class="content-wrap">\n        <p class="breadcrumb">\n            <span>${i18n.产品服务}</span>\n            <span class="divider">/</span>\n            <a href="#/bcc/instance/list">${i18n.云服务器BCC} - ${i18n.实例列表}</a>\n            <span class="divider">/</span>\n            <span class="active">${i18n.变更配置}</span>\n        </p>\n        <div class="create-content">\n            <div data-ui-type="ViewStep"\n                 data-ui-id="buyStep"\n                 data-ui-current-step="1">\n                <ul>\n                    <li bind-for="resizeEip">${i18n.升级云服务器配置}</li>\n                    <li bind-for="orederConfirm">${i18n.确认订单}</li>\n                    <li>${i18n.支付成功}</li>\n                </ul>\n            </div>\n            <div data-ui-type="Tab" data-ui-id="productType"\n                 data-ui-active-index="0" class="bec-tab">\n                <ul data-role="navigator" class="ui-tab-navigator">\n                </ul>\n            </div>\n            <div id="resizeEip" class="create-main">\n                <form class="setting-form"\n                    data-ui-type="Form"\n                    data-ui-id="form"\n                    data-ui-submit-button="toBuy"\n                    data-ui-auto-validate="true">\n                    <div data-ui-id="buyBucket"\n                        data-ui-type="BuyBucket"\n                        data-ui-disabled="true"></div>\n                    <div class="detail-parts-table">\n                        <dl class="detail-part-1-col">\n                            <dt><h4>${i18n.当前配置}</h4></dt>\n                            <dd>\n                                <div class="detail-cell">\n                                    <label>${i18n.云服务器名称：}</label>\n                                    <span class="nowrap-text" title="${instance.name}">${instance.name}</span>\n                                </div>\n                                <div class="detail-cell">\n                                    <label>CPU：</label>\n                                    <span>${instance.cpu}${i18n.核}</span>\n                                </div>\n                                <div class="detail-cell">\n                                    <label>${i18n.内存：}</label>\n                                    <span>${instance.memory}GB</span>\n                                </div>\n                            </dd>\n                            <dd>\n                                <div class="detail-cell">\n                                    <label>${i18n.云服务器实例ID：}</label>\n                                    <span class="nowrap-text" title="${instance.id}">${instance.id}</span>\n                                </div>\n                                <div class="detail-cell">\n                                    <label>${i18n.数据盘：}</label>\n                                    <span>${instance.diskSize}GB</span>\n                                </div>\n                                <div class="detail-cell">\n                                    <label>${i18n.带宽：}</label>\n                                    <span>${instance.network}Mbps</span>\n                                </div>\n                            </dd>\n                            <dd>\n                                <div class="detail-cell">\n                                    <label>${i18n.公网IP：}</label>\n                                    <span>${instance.publicIp|defaultValue}</span>\n                                </div>\n                                <div class="detail-cell">\n                                    <label>${i18n.内网IP：}</label>\n                                    <span>${instance.internalIp}</span>\n                                </div>\n                                <div class="detail-cell">\n                                    <label>${i18n.操作系统：}</label>\n                                    <span>\n                                        \x3c!-- if: ${instance.osName}--\x3e\n                                        ${instance.osName} / ${instance.osVersion}\n                                        \x3c!-- else --\x3e\n                                        ${instance.osType} / ${instance.osVersion}\n                                        \x3c!-- /if --\x3e\n                                    </span>\n                                </div>\n                            </dd>\n                            <dd>\n                                <div class="detail-cell">\n                                    <label>${i18n.支付方式：}</label>\n                                    <span>${instance.paymentText}</span>\n                                </div>\n                                <div class="detail-cell">\n                                    <label>${i18n.到期时间：}</label>\n                                    <span>${instance.expireTime|formatTime}</span>\n                                </div>\n                                <div class="detail-cell"></div>\n                            </dd>\n                        </dl>\n                        <dl class="detail-create detail-part-1-col">\n                            <dt><h4>${i18n.变更配置}</h4></dt>\n                            <dd>\n                                <label>${i18n.公网带宽：}</label>\n                                <div>\n                                    <div data-ui-id="network"\n                                        data-ui-name="bandWidth"\n                                        data-ui-value="@instance.network"\n                                        data-ui-type="Dragger"></div>\n                                    <label data-ui-type="Label"\n                                        data-ui-id="networkTip"\n                                        data-ui-hidden="true"\n                                        class="network-tip">${i18n.公网带宽为0时，将不分配公网IP。如需公网访问，请设置带宽值。}</label>\n                                    \x3c!-- if: ${instance.payment} === \'prepay\' --\x3e\n                                    <p class="prepay-tip">\n                                        ${i18n.提醒：云服务到期时间为}<strong>${instance.expireTime|formatTime}</strong>${i18n.，升级天数为}<strong>${daysLeftToUpgrade}</strong>${i18n.天。}\n                                    </p>\n                                    \x3c!-- /if --\x3e\n                                </div>\n                            </dd>\n                        </dl>\n                    </div>\n                </form>\n            </div>\n            <div id="orderConfirm">\n                <div data-ui="id:orderAction;type:ActionPanel" class="clearfix ui-tab-content"></div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("bcc/instance/UpgradeConfig",["require","bat-ria/mvc/FormAction","underscore","common/constants","common/region","common/util/orderUtil","../enum","../events","../config","./UpgradeConfigModel","./UpgradeConfigView","er/util"],function(require){function e(){a.apply(this,arguments)}function t(){var e=this.model.getSubmitData(this.view.getFormData()),t=function(e,t,a){var i={serviceType:"BCC",productType:a,type:"RESIZE",instanceId:e.instanceId,price:t.money,items:[{serviceType:"BCC",productType:a,time:t.dayCount,timeUnit:"DAY",price:t.money,unitPrice:t.money,unitPriceShow:"￥"+t.money+"/分钟",chargeType:n.SERVICE_TYPE.BCC.chargeType[a],configuration:["地域："+s.getCurrentRegion().label,"CPU："+e.upgradedConfig.cpu+"核","内存："+e.upgradedConfig.memory+"GB"]}]};return r.make(i)}(e,this.model.get("priceAggregate"),this.model.get("instance").payment);this.view.renderOrderConfirm(t,e)}var a=require("bat-ria/mvc/FormAction"),i=require("underscore"),n=require("common/constants"),s=require("common/region"),r=require("common/util/orderUtil"),o=require("../enum").InstanceType,c=require("../events"),l=require("../config").PAYMENT,d=!1;return e.prototype.modelType=require("./UpgradeConfigModel"),e.prototype.viewType=require("./UpgradeConfigView"),e.prototype.initBehavior=function(){a.prototype.initBehavior.apply(this,arguments),this.view.on("REFRESH_CONFIG_INFO",this.refreshConfigInfo,this),this.view.on(c.RELOAD,this.reload,this),this.view.on("confirm",this.confirm,this),this.view.on(c.PICK,t,this),this.view.on("BACK_FORWARD",this.backForward,this),this.refreshConfigInfo("init")},e.prototype.confirm=function(e){var t;t=this.model.get("instance").instanceType===o.GPU?"亲爱的用户，购买扣款成功后，为生效您升级的GPU实例相关配置，您的云服务器实例将会重启，请确认继续购买。":"亲爱的用户，购买扣款成功后，为生效您升级的CPU及内存配置，您的云服务器实例将会重启，请确认继续购买。",d?this.view.fire(c.PICK):this.view.waitConfirm({title:"配置升级温馨提醒",content:t,width:540,needFoot:!0}).then(i.bind(function(){d=!0,this.view.fire(c.PICK)},this)),e.preventDefault()},e.prototype.refreshConfigInfo=function(e){var t=this,a=this.model.get("instance"),n=t.model.getSubmitData(t.view.getFormData()),s=a.payment===l.POSTPAY,r=t.view.get("buyBucket");"init"===e&&(a.instanceType===o.GPU?t.model.set("oldConfig",{cpu:a.cpu,memory:a.memory,disk:a.diskSize,gpuCardCount:a.gpuCount}):t.model.set("oldConfig",{cpu:a.cpu,memory:a.memory})),r.setValue(i.extend({},n,{loading:!0})),r.disable(),t.model.calculateTheBudget(n).then(function(e){r.setValue(i.extend(n,e,{isPostpay:s})),t.model.set("priceAggregate",e),i.isEqual(t.model.get("oldConfig"),n.upgradedConfig)||parseFloat(e.money)<=0?r.disable():r.enable()}).fail(function(e){r.setValue(i.extend({},n,{error:!0})),r.disable()})},e.prototype.backForward=function(e){this.back()},require("er/util").inherits(e,a),e}),define("bcc/instance/UpgradeConfigModel",["require","bat-ria/mvc/FormModel","moment","underscore","common/constants","common/storage","../config","./flavor","../enum","er/util"],function(require){function e(){t.apply(this,arguments),this.submitRequester=o.bccInstanceUpdateConfigCreate}var t=require("bat-ria/mvc/FormModel"),a=require("moment"),i=require("underscore"),n=require("common/constants"),s=require("common/storage"),r=require("../config"),o=r.api,c=r.PAYMENT,l=r.PAYMENT_DESC,d=require("./flavor"),u=require("../enum"),p=u.GpuCard,f=u.InstanceType,m={"x-silent":!0};return e.prototype.datasource={instance:function(e){return e.getInstanceById(e.get("instanceId")).then(function(e){return e.instanceId=e.instanceId||e.id,e.gpuCardName=p.getTextFromValue(e.gpuCard),e})},bccWhite:function(e){return JSON.parse(s.get("whiteTags"))}},e.prototype.getInstanceById=function(e){return o.bccInstanceDetail({instanceId:e}).then(function(e){return e.expireTimeDesc=e.expireTime?a(e.expireTime).format(n.TIME_FORMAT):"-",e.paymentDesc=l[e.payment],e})},e.prototype.calculateTheBudget=function(e){return o.bccInstanceUpdateConfigBudget(e,m)},e.prototype.prepare=function(){var e,t,a,n,s,r,o,l=this.get("instance");if("9"===l.instanceType){var u=d.getGpuCount(l.gpuCard);r=[{name:l.gpuCardName,value:l.gpuCard}],o=i.map(u,function(e){return{name:e,value:e}})}e=d.getCpu(l.payment,l.instanceType,l.gpuCard,l.gpuCount),a=i.indexOf(e,+l.cpu);var p=d.getMinCpu(l.payment,l.instanceType,l.gpuCard,l.gpuCount,l.maxRamGb);i.each(e,function(e,t,i){i[t]={name:e+"核",value:e},l.payment===c.PREPAY&&e<l.cpu&&(i[t].disable=!0),l.maxRamGb&&e>=p&&(i[t].disable=!0,i[t].popover="无对应的内存配置可选"),a<0&&!i[t].disable&&(a=t)}),s=e[a]?e[a].value:i.last(e).value,t=d.getMemory(s,l.payment,l.instanceType,l.gpuCard,l.gpuCount),n=i.indexOf(t,+l.memory),i.each(t,function(e,t,a){a[t]={name:e+"GB",value:e},l.payment===c.PREPAY&&e<l.memory&&(a[t].disable=!0),l.maxRamGb&&e>l.maxRamGb&&(a[t].disable=!0,a[t].popover="当前操作系统不支持大于"+l.maxRamGb+"的内存"),n<0&&!a[t].disable&&(n=t)}),i.each(o,function(e,t,a){l.gpuCount>e.value&&(a[t].disable=!0)});var m=1,h=1,g=48,v=128;l.payment===c.PREPAY&&(m=l.cpu)&&(h=l.memory),l.instanceType===f.DEFAULTIII?(g=200,v=400):l.instanceType===f.DEFAULTII&&(g=96,v=256),l.maxRamGb&&l.maxRamGb<v&&(v=l.maxRamGb),this.set("cpuIndex",a),this.set("memoryIndex",n),this.set("cpuDatasource",e),this.set("memoryDatasource",t),this.set("gpuCardDatasource",r),this.set("gpuCountDatasource",o),this.set("minCustomCpu",m),this.set("minCustomMemory",h),this.set("maxCustomCpu",g),this.set("maxCustomMemory",v)},e.prototype.filterData=function(e){var t=this.get("instance");return t.instanceType===f.GPU?{instanceId:this.get("instanceId"),gpuCard:e.gpuCard,upgradedConfig:{disk:e.disk,cpu:e.cpu,memory:e.memory,gpuCardCount:e.gpuCount}}:("on"===e.flavorCustomCheck&&(e.cpu=+e.cpuCustom,e.memory=+e.memoryCustom),delete e.cpuCustom,delete e.memoryCustom,delete e.flavorCustomCheck,!e.memory&&(e.memory=t.memory),!e.cpu&&(e.cpu=t.cpu),{instanceId:this.get("instanceId"),upgradedConfig:e})},require("er/util").inherits(e,t),e}),define("bcc/instance/UpgradeConfigView",["require","bat-ria/tpl!./upgrade_config.tpl","underscore","bat-ria/mvc/FormView","inf-ria/app/brpc","common/region","common/util/moneyUtil","../config","../enum","../events","./flavor","er/util"],function(require){function e(){a.apply(this,arguments)}require("bat-ria/tpl!./upgrade_config.tpl");var t=require("underscore"),a=require("bat-ria/mvc/FormView"),i=require("inf-ria/app/brpc"),n=require("common/region"),s=require("common/util/moneyUtil"),r=require("../config").PAYMENT,o=require("../enum"),c=o.InstanceType,l=o.GpuCard,d=require("../events"),u=require("./flavor"),p=[{title:"地域：",content:function(e){return n.getCurrentRegion().label}},{title:"配置：",content:function(e){if(e&&e.upgradedConfig)return e.upgradedConfig.gpuCardCount?"GPU型号:"+l.getTextFromValue(e.gpuCard)+"、GPU数量:"+e.upgradedConfig.gpuCardCount+"块、CPU:"+e.upgradedConfig.cpu+"核、内存:"+e.upgradedConfig.memory+"GB、本地磁盘:"+e.upgradedConfig.disk+"GB":"CPU"+e.upgradedConfig.cpu+"核、内存"+e.upgradedConfig.memory+"GB"}},{title:"配置费用：",content:function(e){if(e.loading)return'<span class="loading">努力加载中...请稍候</span>';if(e.error)return'<span class="bcc-error">请求异常，请刷新后重试。 </span><a href="javascript:location.reload();">刷新</a>';if(typeof e.money!==undefined){var t=s.convertPrice(e.money);return'<span class="price">￥'+(e.isPostpay?t.getPriceOfMinute("/分钟"):t.getPriceOfMinute())+"</span>"}}}];return e.prototype.template="TPL_bcc_instance_upgradeconfig",e.prototype.getUIProperties=function(){var e=this.model.get("instance"),t=this.model.get("minCustomCpu"),a=this.model.get("maxCustomCpu"),i=this.model.get("minCustomMemory"),n=this.model.get("maxCustomMemory");return{cpu:{datasource:"@cpuDatasource",selectedIndex:"@cpuIndex"},gpuCard:{datasource:"@gpuCardDatasource",value:e&&e.instanceType===c.GPU?e.gpuCard:l.NTESLAP40},gpuCount:{datasource:"@gpuCountDatasource",value:e&&e.instanceType===c.GPU?e.gpuCount:1},memory:{datasource:"@memoryDatasource",selectedIndex:"@memoryIndex"},cpuCustom:{custom:function(e){return!this.viewContext.controls.flavorCustomCheck.isChecked()||/^[1-9][0-9]*$/.test(e)&&e>=t&&e<=a},customErrorMessage:"CPU是"+t+"到"+a+"之间的数字",validityLabel:"cpuCustomValidity"},memoryCustom:{custom:function(e){return!this.viewContext.controls.flavorCustomCheck.isChecked()||/^[1-9][0-9]*$/.test(e)&&e>=i&&e<=n},customErrorMessage:"内存是"+i+"到"+n+"之间的数字",validityLabel:"memoryCustomValidity"},buyBucket:{fields:p,offsetTop:20,confirmBtn:{text:"下一步",skin:"skin-primary-button"}}}},e.prototype.uiEvents={"gpuCount:change":function(e){var a=this.model.get("instance"),i=this.get("gpuCard").getValue(),n=this.get("gpuCount").getValue(),s=u.getCpu(a.payment,a.instanceType,i,n),o=u.getMemory(+a.cpu,a.payment,a.instanceType,i,n);t.each(s,function(e,t,i){i[t]={name:e+"核",value:e},a.payment===r.PREPAY&&e<a.cpu&&(i[t].disable=!0)}),t.each(o,function(e,t,i){i[t]={name:e+"GB",value:e},a.payment===r.PREPAY&&e<a.memory&&(i[t].disable=!0)}),this.get("cpu").setProperties({datasource:s,showNum:s.length,selectedIndex:0}),this.get("memory").setProperties({datasource:o,showNum:o.length,selectedIndex:0}),this.get("fixedTempDisk").setText(u.getDiskSize(a.payment,a.instanceType,i,n)),this.fire("REFRESH_CONFIG_INFO",{gpuCount:e.item.value})},"cpu:change":function(e){!e.item&&(e.item=this.model.get("cpuDatasource")[e.index]);var a=this.model.get("instance"),i=e.item.value,n=u.getMemory(i,a.payment,a.instanceType),s=t.indexOf(n,+a.memory);t.each(n,function(e,t,i){i[t]={name:e+"GB",value:e},a.payment===r.PREPAY&&e<a.memory&&(i[t].disable=!0),a.maxRamGb&&e>a.maxRamGb&&(i[t].disable=!0,i[t].popover="当前操作系统不支持大于"+a.maxRamGb+"的内存"),s<0&&!i[t].disable&&(s=t)}),this.get("memory").setProperties({datasource:n,showNum:n.length,selectedIndex:s}),this.fire("REFRESH_CONFIG_INFO",{cpu:i})},"memory:change":function(e){var a=e.item;t.isObject(a)&&this.fire("REFRESH_CONFIG_INFO",{memory:a.value})},"flavorCustomCheck:click":function(e){var t=this.get("cpuCustom"),a=this.get("memoryCustom");e.target.isChecked()?(this.get("cpu").setProperties({disabled:!0}),this.get("memory").setProperties({disabled:!0}),this.get("flavorCustomPanel").show()):(this.get("cpu").setProperties({disabled:!1}),this.get("memory").setProperties({disabled:!1}),t.setProperties({value:""}),a.setProperties({value:""}),this.get("flavorCustomPanel").hide(),t.validate(),a.validate(),this.fire("REFRESH_CONFIG_INFO",{cpu:this.get("cpu").getValue(),memory:this.get("memory").getValue()}))},"cpuCustom:change":function(e){var t=this.get("memoryCustom"),a=+e.target.getValue(),i=this.model.get("instance");e.target.validate()&&t.checkValidity()&&(a<=+t.getValue()?(this.fire("REFRESH_CONFIG_INFO",{cpu:a,memory:+t.getValue()}),i.cpu===a&&i.memory===+t.getValue()?this.notifyErrors({cpuCustom:"配置未改变"}):e.target.hideValidity()):(this.notifyErrors({cpuCustom:"内存不能小于CPU"}),this.get("buyBucket").disable()),t.hideValidity())},"memoryCustom:change":function(e){var t=this.get("cpuCustom"),a=+e.target.getValue(),i=this.model.get("instance");e.target.validate()&&t.checkValidity()&&(+t.getValue()<=a?(this.fire("REFRESH_CONFIG_INFO",{cpu:+t.getValue(),memory:a}),i.cpu===+t.getValue()&&i.memory===a?this.notifyErrors({memoryCustom:"配置未改变"}):e.target.hideValidity()):(this.notifyErrors({memoryCustom:"内存不能小于CPU"}),this.get("buyBucket").disable()),t.hideValidity())},"cancel:click":function(e){this.fire("BACK_FORWARD")},buyBucket:{reset:function(e){e.preventDefault(),this.fire(d.RELOAD)},confirm:function(e){e.preventDefault(),this.get("form").validate()&&this.fire("confirm")}}},e.prototype.renderOrderConfirm=function(e,a){var n=this.get("orderAction"),s=this.get("buyStep"),r={order:e,config:a},o=t.bind(this.renderBccConfig,this);i.invokeService("billing://order_confirm",n,r).then(function(){n.on("action@prevPage",o),s.set("currentStep",2)})},e.prototype.getExtraFormData=function(){if(this.model.get("instance").instanceType===c.GPU)return{disk:this.get("fixedTempDisk").getText()}},e.prototype.renderBccConfig=function(){var e=this.get("orderAction");this.get("buyStep").set("currentStep",1),e.disposeAction(),e.main.innerHTML=""},require("er/util").inherits(e,a),e}),define("bcc/instance/UpgradeNetwork",["require","bat-ria/mvc/FormAction","underscore","common/constants","common/util/dialog","common/auth","common/region","common/util/orderUtil","../events","../config","./UpgradeNetworkModel","./UpgradeNetworkView","er/util"],function(require){function e(){a.apply(this,arguments)}function t(){var e=this.model.getSubmitData(this.view.getFormData()),t=function(e,t,a){var i={serviceType:"BCC",productType:a,type:"EIP_RESIZE",price:t.money,items:[{serviceType:"BCC",productType:a,time:t.dayCount,timeUnit:"DAY",price:t.money,unitPrice:t.money,unitPriceShow:"￥"+t.money+"/分钟",chargeType:n.SERVICE_TYPE.BCC.chargeType[a],configuration:["地域："+o.getCurrentRegion().label,"公网带宽："+e.upgradedConfig.bandWidth+"Mbps"]}]};return c.make(i)}(e,this.model.get("priceAggregate"),this.model.get("instance").payment);this.view.renderOrderConfirm(t,e)}var a=require("bat-ria/mvc/FormAction"),i=require("underscore"),n=require("common/constants"),s=require("common/util/dialog"),r=require("common/auth"),o=require("common/region"),c=require("common/util/orderUtil"),l=require("../events"),d=require("../config"),u=d.PAYMENT;return e.prototype.modelType=require("./UpgradeNetworkModel"),e.prototype.viewType=require("./UpgradeNetworkView"),e.prototype.initBehavior=function(){a.prototype.initBehavior.apply(this,arguments),this.view.on("NETWORK_CHANGE",this.onNetworkChange,this),this.view.on(l.RELOAD,this.reload,this),this.view.on(l.PICK,t,this),this.refreshConfigInfo("init")},e.prototype.onNetworkChange=function(e){var t=this.model.get("instance"),a=this.view.get("network"),i=e.bandWidth,o=n.verifyUser&&"PASS"===n.verifyUser.verifyStatus,c=r.checkForbidden&&r.checkForbidden(this.view),l="";i>0&&!1===c?(l=d.FORBIDDENTIP,s.waitAlert(this.view,{title:"带宽升级",content:l}).then(function(){a.setValue(t.network)})):i>0&&!o?(l="尊敬的用户，不支持未实名用户调整公网带宽，请完成实名认证后升级带宽",this.view.waitAlert(l,"带宽升级").then(function(){a.setValue(t.network)})):0===i&&t.network>0?(l="暂不支持从有公网带宽到无公网带宽（去掉公网IP）的调整",this.view.waitAlert(l,"带宽升级").then(function(){a.setValue(t.network)})):"prepay"===t.payment&&t.network>i?(l="您当前的带宽为"+t.network+"Mbps，预付费暂不支持调整到"+i+"Mbps，请重新选择！",this.view.waitAlert(l,"带宽升级").then(function(){a.setValue(t.network)})):this.refreshConfigInfo({bandWidth:i})},e.prototype.refreshConfigInfo=function(e){var t=this,a=t.model.getSubmitData(t.view.getFormData()),n=this.model.get("instance").payment===u.POSTPAY,s=t.view.get("buyBucket");"init"===e&&t.model.set("oldConfig",a.upgradedConfig),t.model.calculateTheBudget(a).then(function(e){s.setValue(i.extend(a,e,{isPostpay:n})),t.model.set("priceAggregate",e),i.isEqual(t.model.get("oldConfig"),a.upgradedConfig)||parseFloat(e.money)<=0?s.disable():s.enable()})},require("er/util").inherits(e,a),e}),define("bcc/instance/UpgradeNetworkModel",["require","bat-ria/mvc/FormModel","moment","../config","er/util"],function(require){function e(){t.apply(this,arguments),this.submitRequester=n.bccInstanceUpgradeConfigCreate}var t=require("bat-ria/mvc/FormModel"),a=require("moment"),i=require("../config"),n=i.api;return e.prototype.datasource={instance:function(e){return e.getInstanceById(e.get("instanceId"))}},e.prototype.getInstanceById=function(e){return n.bccInstanceDetail({instanceId:e})},e.prototype.calculateTheBudget=function(e){return n.bccInstanceUpgradeConfigBudget(e)},e.prototype.prepare=function(){var e=this.get("instance");if(e.paymentText=i.PAYMENT_DESC[e.payment],"prepay"===e.payment){var t=a(),n=a(e.expireTime);this.set("daysLeftToUpgrade",n.diff(t,"days"))}},e.prototype.filterData=function(e){return{instanceId:this.get("instanceId"),upgradedConfig:e}},require("er/util").inherits(e,t),e}),define("bcc/instance/UpgradeNetworkView",["require","bat-ria/tpl!./upgrade_network.tpl","underscore","bat-ria/mvc/FormView","inf-ria/app/brpc","common/region","common/util/moneyUtil","../events","er/util"],function(require){function e(){a.apply(this,arguments)}require("bat-ria/tpl!./upgrade_network.tpl");var t=require("underscore"),a=require("bat-ria/mvc/FormView"),i=require("inf-ria/app/brpc"),n=require("common/region"),s=require("common/util/moneyUtil"),r=require("../events"),o=[{title:"配置：",content:function(e){if(e&&e.upgradedConfig)return"带宽"+e.upgradedConfig.bandWidth+"Mbps"}},{title:"地域：",content:function(){return n.getCurrentRegion().label}},{title:"配置费用：",content:function(e){if(typeof e.money!==undefined){var t=s.convertPrice(e.money);return'<span class="price">￥'+(e.isPostpay?t.getPriceOfMinute("/分钟"):t.getPriceOfMinute())+"</span>"}}}];return e.prototype.template="TPL_bcc_instance_UpgradeNetwork",e.prototype.uiProperties={network:{min:0,max:200,length:349,unit:"Mbps"},buyBucket:{fields:o,offsetTop:20,confirmBtn:{text:"下一步",skin:"skin-primary-button"}}},e.prototype.uiEvents={"network:change":function(e){var t=e.now||e.target.getValue();this.get("networkTip")[t<=0?"show":"hide"](),this.fire("NETWORK_CHANGE",{bandWidth:t})},buyBucket:{reset:function(e){e.preventDefault(),this.fire(r.RELOAD)},confirm:function(e){e.preventDefault(),this.get("form").validate()&&this.fire(r.PICK)}}},e.prototype.enterDocument=function(){a.prototype.enterDocument.apply(this,arguments),this.get("network").fire("change")},e.prototype.renderOrderConfirm=function(e,a){var n=this.get("orderAction"),s=this.get("buyStep"),r={order:e,config:a},o=t.bind(this.renderBccConfig,this);i.invokeService("billing://order_confirm",n,r).then(function(){n.on("action@prevPage",o),s.set("currentStep",2)})},e.prototype.renderBccConfig=function(){var e=this.get("orderAction");this.get("buyStep").set("currentStep",1),e.disposeAction(),e.main.innerHTML=""},require("er/util").inherits(e,a),e}),define("bcc/landing/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/BaseAction","babel-runtime/helpers/interop-require-default","./Model","./View","../events"],function(exports,module,e,t,a,i,n,s,r){var o=i["default"](a),c=i["default"](n),l=i["default"](s),d=i["default"](r),u=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=c["default"],this.viewType=l["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.view.on(d["default"].CREATE_INSTANCE,this.createInstance,this),this.view.on(d["default"].ENTER_BCC_LIST,this.enterBccList,this)},i.prototype.createInstance=function(){this.redirect("/bcc/instance/create~from=landing")},i.prototype.enterBccList=function(){this.redirect("/bcc/instance/list~from=landing")},i}(o["default"]);module.exports=u}),define("bcc/landing/config",["exports","er/controller","babel-runtime/helpers/interop-require-default"],function(exports,e,t){t["default"](e)["default"].registerAction([{type:"bcc/landing/Action",path:"/bcc/landing"}])}),define("bcc/landing/data",["exports","module","inf-i18n","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t){var a=t["default"](e);module.exports={title:a["default"]("云服务器BCC简介"),desc:a["default"]("云服务器BCC（Baidu Cloud Compute）是基于百度多年积累的虚拟化、分布式集群等技术构建的云端计算服务。")+a["default"]("BCC支持弹性伸缩，分钟级丰富灵活的计费模式，搭配镜像、快照、云安全等增值服务，为您提供业界最佳效费比的高性能云服务器。"),modulars:[{name:a["default"]("云服务器BCC使用流程"),id:"introduction",content:[{title:a["default"]("注册及实名认证"),id:"realname",desc:a["default"]("注册百度云账号，并完成实名认证，操作细节请参考实名认证。"),linkText:a["default"]("查看详情")+"&gt;&gt;",link:"/qualify/#/qualify/index"},{title:a["default"]("创建实例"),id:"create",desc:a["default"]("包年包月和按需付费两种购买方式，填写配置信息。"),linkText:a["default"]("查看详情")+"&gt;&gt;",link:"#/bcc/instance/create"},{title:a["default"]("搭配创建相关产品"),id:"relation",desc:a["default"]("（可选）购买弹性公网IP，购买云磁盘CDS。"),linkText:a["default"]("查看详情")+"&gt;&gt;",link:"#/bcc/instance/create"},{title:a["default"]("连接实例"),id:"vnc",desc:a["default"]("支持VNC远程连接和客户端远程登录。"),linkText:a["default"]("查看详情")+"&gt;&gt;",link:"#/bcc/instance/list"}]},{name:a["default"]("相关产品"),id:"relation",content:[{title:a["default"]("弹性公网IP EIP"),id:"eip",desc:a["default"]("提供灵活、弹性的公网接入服务"),link:"//cloud.baidu.com/doc/EIP/index.html"},{title:a["default"]("云磁盘CDS"),id:"cds",desc:a["default"]("灵活稳定、方便扩展的万量级IOPS块存储服务"),link:"//cloud.baidu.com/product/cds.html"},{title:a["default"]("负载均衡BLB"),id:"blb",desc:a["default"]("均衡应用流量，消除故障节点，提高可用性"),link:"//cloud.baidu.com/product/blb.html"},{title:a["default"]("私有网络VPC"),id:"vpc",desc:a["default"]("灵活自定义地址空间、提供安全隔离网络环境"),link:"//cloud.baidu.com/product/vpc.html"},{title:a["default"]("域名服务"),id:"bcd",desc:a["default"]("提供百余种后缀域名注册及免费智能解析服务"),link:"//cloud.baidu.com/product/bcd.html"}]},{name:a["default"]("用户指南"),linkText:a["default"]("帮助文档")+"&gt;&gt;",link:"https://cloud.baidu.com/doc/BCC/index.html"}]}}),define("bcc/landing/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/BaseModel","babel-runtime/helpers/interop-require-default","./data"],function(exports,module,e,t,a,i,n,s){var r=n["default"](i),o=n["default"](s),c=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),t["default"](n,[{key:"datasource",get:function(){return{__hideSidebar:function(){return!0},data:function(){return o["default"]}}}}]),n}(r["default"]);module.exports=c}),define("bcc/landing/tpl",[],function(){return'\x3c!-- target: TPL_bcc_common_landing --\x3e\n<div class="bcc bcc-common-landing main-wrap-new">\n    <div class="content-wrap">\n        <p class="breadcrumb">\n            <span>${i18n.产品服务}</span>\n            <span class="divider">/</span>\n            <span class="active">${i18n.云服务器BCC}</span>\n        </p>\n        <div class="create-content left">\n            <div class="create-main">\n                <div class="detail-parts-table">\n                    <dl class="detail-create detail-part-1-col">\n                        <dt>\n                            <h4>${data.title}</h4>\n                        </dt>\n                        <dd class="sub-title">\n                            ${data.desc}\n                        </dd>\n                        <dd>\n                            <button data-ui-id="create" data-ui-type="Button" data-ui-skin="create">${i18n.创建实例}</button>\n                            <button data-ui-id="enterBccList" data-ui-type="Button"  \n                             class="enter-bcc-btn">${i18n.进入BCC}</button>\n                        </dd>\n                    </dl>\n                    <dl class="detail-create detail-part-1-col">\n                        <dt>\n                            <h4>${data.modulars[0].name}</h4>\n                        </dt>\n                        <dd>\n                            \x3c!-- for: ${data.modulars[0].content} as ${intro},${index} --\x3e\n                            \x3c!-- if: ${index} !== 0 --\x3e\n                            <div class="arrow"></div>\n                            \x3c!-- /if --\x3e\n                            <div class="jumbotron">\n                                <div class="img-${intro.id}"></div>\n                                <h1>${intro.title}</h1>\n                                <p>${intro.desc}</p>\n                                \x3c!-- if: ${intro.linkText} --\x3e\n                                <a href="${intro.link}" target="_blank">\n                                    ${intro.linkText | raw}\n                                </a>\n                                \x3c!-- /if --\x3e\n                            </div>\n                            \x3c!-- /for --\x3e\n                        </dd>\n                    </dl>\n                </div>\n            </div>\n        </div>\n        <div class="create-content right">\n            <h2>${data.modulars[1].name}</h2>\n            \x3c!-- for: ${data.modulars[1].content} as ${relation} --\x3e\n            <div class="recommend recommend-${relation.id}">\n                <span class="iconfont icon-${relation.id}"></span>\n                <a href="${relation.link}" target="_blank"\n                    class="recommend-title">${relation.title}</a>\n                <p class="recommend-description">\n                    ${relation.desc}\n                </p>\n            </div>\n            \x3c!-- /for --\x3e\n            <div class="separation"></div>\n            <h2>${data.modulars[2].name}</h2>\n            <a target="_blank" class="help-link" href="${data.modulars[2].link}">\n                ${data.modulars[2].linkText | raw}\n            </a>\n        </div>\n    </div>\n</div>\n'}),define("bcc/landing/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./tpl","bat-ria/mvc/BaseView","babel-runtime/helpers/interop-require-default","../events"],function(exports,module,e,t,a,i,n,s,r){var o=s["default"](n),c=s["default"](r),l=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.getUIEvents=function(){return{"create:click":function(){this.fire(c["default"].CREATE_INSTANCE)},"enterBccList:click":function(){this.fire(c["default"].ENTER_BCC_LIST)}}},t["default"](n,[{key:"template",get:function(){return"TPL_bcc_common_landing"}},{key:"uiProperties",get:function(){return{}}}]),n}(o["default"]);module.exports=l}),define("bcc/mvc/ListAction",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","inf-ria/mvc/ListAction","babel-runtime/helpers/interop-require-default","inf-ria/decorators","./ListModel","./ListView"],function(exports,module,e,t,a,i,n,s,r){var o=i["default"](a),c=i["default"](s),l=i["default"](r),d=function(a){function i(){t["default"](this,s),a.apply(this,arguments)}e["default"](i,a);var s=i;return i=n.action(c["default"],l["default"])(i)||i}(o["default"]);module.exports=d}),define("bcc/mvc/ListModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","lodash","babel-runtime/helpers/interop-require-default","inf-ria/mvc/ListModel","common/storage"],function(exports,module,e,t,a,i,n,s){var r=i["default"](a),o=i["default"](n),c=i["default"](s),l=function(a){function i(){t["default"](this,i),a.apply(this,arguments)}return e["default"](i,a),i.prototype.getQuery=function(){var e=a.prototype.getQuery.call(this),t="bcc-"+(location.hash||"").split("~")[0]+"-pagesize";return c["default"].get(t)&&r["default"].extend(e,{pageSize:c["default"].get(t)}),e},i}(o["default"]);module.exports=l}),define("bcc/mvc/ListView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","inf-ria/mvc/ListView","babel-runtime/helpers/interop-require-default","common/storage"],function(exports,module,e,t,a,i,n){var s=i["default"](a),r=i["default"](n),o=function(a){function i(){t["default"](this,i),a.apply(this,arguments)}return e["default"](i,a),i.prototype.submitSearch=function(e){if("pagesizechange"===e.type){var t="bcc-"+(location.hash||"").split("~")[0]+"-pagesize";r["default"].set(t,e.target.pageSize)}a.prototype.submitSearch.call(this,e)},i.prototype.enterDocument=function(){a.prototype.enterDocument.call(this);var e="bcc-"+(location.hash||"").split("~")[0]+"-pagesize";r["default"].get(e)&&this.get("pager").setProperties({pageSize:r["default"].get(e)})},i}(s["default"]);module.exports=o}),define("bcc/operationlist/config",["require","er/controller"],function(require){return require("er/controller").registerAction([{type:"bcc/operationlist/Operationlist",path:"/bcc/operationlist",skipRegionCheck:!0}]),{}}),define("bcc/operationlist/Operationlist",["require","er/events","../mvc/ListAction","./OperationlistModel","./OperationlistView","er/util"],function(require){function e(){a.apply(this,arguments)}var t=require("er/events"),a=require("../mvc/ListAction");return e.prototype.modelType=require("./OperationlistModel"),e.prototype.viewType=require("./OperationlistView"),e.prototype.initBehavior=function(){a.prototype.initBehavior.apply(this,arguments),this.view.on("refresh",this.reload,this),t.fire("region_changed",{id:"global",globalOnly:!0}),this.on("beforeleave",function(){t.fire("region_changed")})},require("er/util").inherits(e,a),e}),define("bcc/operationlist/operationlist.tpl",[],function(){return'\x3c!-- target: TPL_bcc_operationlist --\x3e\n<div class="bcc-operationlist bcc-main-wrap main-wrap-new">\n    <div class="content-wrap">\n        <p class="breadcrumb">\n            <span>${i18n.产品服务}</span>\n            <span class="divider">/</span>\n            <span class="active">${i18n.云服务器BCC} - ${i18n.操作日志}</span>\n        </p>\n        <div class="list-content">\n            <h2>${i18n.操作日志}</h2>\n            <div class="table-full-wrap">\n                <div class="ui-row clearfix">\n                    <label>${i18n.操作时间：}</label>\n                    <div data-ui="id:prevDate;type:Button;">&lt</div>\n                    <input data-ui-type="Calendar"\n                       data-ui-id="calendar"\n                       data-ui-range="${startRangeTime},${endRangeTime}"/>\n                    <div data-ui="id:nextDate;type:Button;">&gt</div>\n                    <button data-ui-type="Button" data-ui-id="refresh" data-ui-skin="refresh"></button>\n                </div>\n\n                <div data-ui-type="Table" data-ui-id="table" data-ui-datasource="@tableData"\n                    data-ui-order-by="@orderBy" data-ui-order="@order" data-ui-select="@selectMode"\n                    data-ui-extension-tip-type="TableTip"\n                    data-ui-extension-command-type="Command"\n                    data-ui-extension-tablefilter-type="TableFilter">\n                </div>\n\n                <div class="ui-row clearfix">\n                    \x3c!-- import: listPager --\x3e\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n'}),define("bcc/operationlist/OperationlistModel",["require","../mvc/ListModel","moment","common/util/timeUtil","../config","er/util"],function(require){function e(){t.apply(this,arguments),this.listRequester=n.getTraceLogList}var t=require("../mvc/ListModel"),a=require("moment"),i=require("common/util/timeUtil"),n=require("../config").api;return e.prototype.datasource=[{menu:function(e){return"operationlist"}},{startRangeTime:function(){return"2014-05-01 00:00:00"},endRangeTime:function(){return i.toTime(new Date)}},{disablePrevDateBtn:function(e){var t=e.get("startTime")||e.defaultArgs.startTime,i=e.get("startRangeTime");return a(i).unix()>=a(t).add(-1,"day").unix()},disableNextDateBtn:function(e){var t=e.get("startTime")||e.defaultArgs.startTime,i=e.get("endRangeTime");return a(i).unix()<=a(t).add(1,"day").unix()},calendarValue:function(e){var t=e.get("startTime")||e.defaultArgs.startTime;return i.toDate(t)}}],e.prototype.defaultArgs={startTime:i.timeToUtc(i.getStartTime(new Date)),endTime:i.timeToUtc(i.getEndTime(new Date)),pageSize:10,filter:"BCC"},require("er/util").inherits(e,t),e}),define("bcc/operationlist/OperationlistView",["require","bat-ria/tpl!./operationlist.tpl","../mvc/ListView","underscore","moment","inf-i18n","common/util/timeUtil","common/util/tableUtil","../flags","er/util"],function(require){function e(){a.apply(this,arguments)}function t(){return c.enable_baixin?i.filter(l,function(e){return!i.contains(["status","ip"],e.field)}):l}require("bat-ria/tpl!./operationlist.tpl");var a=require("../mvc/ListView"),i=require("underscore"),n=require("moment"),s=require("inf-i18n"),r=require("common/util/timeUtil"),o=require("common/util/tableUtil"),c=require("../flags");e.prototype.template="TPL_bcc_operationlist";var l=[{field:"operateContent",title:s("操作内容"),width:"45%",content:function(e){return i.escape(e.operDesc)}},{field:"productService",title:s("产品服务"),width:"12%",filter:{datasource:function(){var e=[{name:"BCC",value:"BCC"},{name:"CDS",value:"CDS"}];return c.enable_baixin?i.union(e,[{name:"DCC",value:"DCC"},{name:"BLB",value:"BLB"},{name:"EIP",value:"EIP"},{name:"VPC",value:"VPC"}]):e}()},content:function(e){return e.serviceType}},{field:"operateTime",title:s("操作时间"),width:"18%",content:function(e){return r.toTime(e.operTime)}},{field:"status",title:s("状态"),width:"10%",content:function(e){return e.operStatus?'<span class="status normal">成功</span>':'<span class="status error" >失败</span>'}},{field:"ip",title:s("操作者IP"),width:"15%",content:function(e){return i.escape(e.operIp)}}];return e.prototype.uiProperties={table:{fields:t(),sortable:!0,columnResizable:!0,noDataHtml:s("没有相关数据！"),select:"",selectedIndex:[]},pager:{pageSizes:[10,20,50,100]},calendar:{value:"@calendarValue"},prevDate:{disabled:"@disablePrevDateBtn"},nextDate:{disabled:"@disableNextDateBtn"}},e.prototype.uiEvents={"calendar:change":function(e){this.submitSearch(e)},"table:filter":function(e){this.submitSearch(e)},"refresh:click":function(){this.fire("refresh")},"prevDate:click":function(){this.asyncDate(-1)},"nextDate:click":function(){this.asyncDate(1)}},e.prototype.enterDocument=function(){var e=this.model.get("filter")||this.model.defaultArgs.filter;i.map(t(),function(t){t.filter&&(t.filter.value=e)}),a.prototype.enterDocument.apply(this,arguments)},e.prototype.getSearchArgs=function(){var e=o.getSearchArgs.call(this),t=this.get("calendar").getValue();return e.startTime=r.timeToUtc(r.getStartTime(t)),e.endTime=r.timeToUtc(r.getEndTime(t)),e.filter=this.get("table").getFilterValue(1),e},e.prototype.asyncDate=function(e){var t=this.get("calendar"),a=t.getValue(),i=n(a).add(e,"day").format("YYYY-MM-DD");t.setValue(i),t.fire("change")},require("er/util").inherits(e,a),e}),define("bcc/operations",["require","er/util","./config","./events","./enum","inf-i18n","inf-ui/x/biz/helper","common/util/dialog","inf-ria/utils/mtools"],function(require){function e(e){var a=e.target,i=a.getAction(),n=a.getChild("foot").getChild("btnOk"),s=a.getChild("foot").getChild("btnCancel"),r=i.view.get("form");r.on("aftervalidate",function(e){!e.isValid&&n.enable()}),r.on("aftermanualvalidate",function(e){!e.isValid&&n.enable()}),a.on("close",t.bind(function(){this.resetMoreOperation&&this.resetMoreOperation()},this.view)),n.on("click",function(){r.validateAndSubmit()}),s.on("click",t.bind(function(){a.fire("cancel"),a.dispose(),this.resetMoreOperation&&this.resetMoreOperation()},this.view)),a.resize()}var t=require("er/util"),a=require("./config").api,i=require("./events"),n=require("./enum"),s=require("inf-i18n"),r=require("inf-ui/x/biz/helper"),o={"instance.rebuild":{msg:s("重装操作系统"),api:a.bccInstanceRebuild},"instance.reboot":{msg:s("重启虚拟机"),api:a.bccInstanceReboot},"instance.start":{msg:s("开启虚拟机"),api:a.bccInstanceStart,xhrOptions:{"x-silent":!0}},"instance.stop":{msg:s("停止虚拟机"),api:a.bccInstanceStop},"instance.delete":{msg:s("删除虚拟机"),api:a.bccInstanceDelete},"instance.createImage":{msg:s("创建自定义镜像"),api:a.bccInstanceCreateImage},"instance.rename":{msg:s("重命名虚拟机"),api:a.bccInstanceRename},"instance.unbindEip":{msg:s("解绑弹性公网IP"),api:a.bccEipUnbind},"instance.cancelAlterProductType":{msg:s("取消预付费转后付费"),api:a.bccCancelAlterProductType},"snapshot.create":{msg:s("创建虚拟机快照"),api:a.bccSnapshotCreate},"snapshot.delete":{msg:s("删除虚拟机快照"),api:a.bccSnapshotDelete},"snapshot.rollback":{msg:s("回滚虚拟机快照"),api:a.bccSnapshotRollback},"snapshot.createImage":{msg:s("创建自定义镜像"),api:a.bccSnapshotCreateImage},"snapshot.rename":{msg:s("重命名虚拟机快照"),api:a.bccSnapshotRename},"image.delete":{msg:s("删除镜像"),api:a.bccImageDelete},"image.rename":{msg:s("重命名镜像"),api:a.bccImageRename},"cds.detach":{msg:s("卸载CDS磁盘"),api:a.bccCdsDetach},"cds.delete":{msg:s("删除CDS磁盘"),api:a.bccCdsDelete},"cds.rename":{msg:s("重命名CDS磁盘"),api:a.bccCdsRename},"cds.cancelAlterProductType":{msg:s("取消预付费转后付费"),api:a.bccCdsCancelAlterProductType},"cds.snapshot.rollback":{msg:s("回滚CDS磁盘快照"),api:a.bccCdsSnapshotRollback},"cds.snapshot.rename":{msg:s("重命名CDS磁盘快照"),api:a.bccCdsSnapshotRename},"security.delete":{msg:s("删除安全组"),api:a.bccSecurityDelete}};return{handler:function(e,t,a,n,s){var r=o[e];if(r&&t){a=a||{};var c=null;if(n){c=t.get("table").getSelectedItems();for(var l in n)if(n.hasOwnProperty(l)){for(var d=[],u=0;u<c.length;++u)d.push(c[u][n[l]]);a[l]=d.join()}}r.api(a,r.xhrOptions).then(function(){t.showToast(r.msg+"成功"),t.fire(i.REFRESH)},function(e){var a=c&&c.length>1?"部分":"",i=r.xhrOptions&&e.global?"失败原因："+e.global:"";t.showToast(r.msg+a+"失败。"+i,{messageType:"error"}),s&&s.call(null,e)})}},confirmHandler:function(e,t,a,i,n,s){var r=this;a.waitConfirm({title:e.title,content:e.content,width:e.width||540,needFoot:!0,encode:e.encode}).then(function(e){r.handler(t,a,i,n,s)}).ensure(function(){a.resetMoreOperation&&a.resetMoreOperation()})},attachCds:function(a){this.view.waitActionDialog({title:s("挂载实例"),width:800,needFoot:!0,url:"/bcc/cds/attach",actionOptions:{diskId:a.diskId,logicalZone:a.logicalZone,parentAction:this}}).then(t.bind(e,this))},cdsCreateSnapshot:function(a){this.view.waitActionDialog({title:s("创建快照"),width:600,needFoot:!0,url:"/bcc/cds/create_snapshot",actionOptions:{diskId:a.diskId,volumeId:a.volumeId||a.diskId,diskType:a.diskType,attachment:a.attachment,instanceId:a.instanceId||a.instanceUuid,parentAction:this}}).then(t.bind(e,this))},instanceChangeName:function(a){this.view.waitActionDialog({title:s("批量修改实例名称"),width:600,needFoot:!0,url:"/bcc/instance/change_name",actionOptions:{instanceIds:a.instanceIds,instanceNames:a.instanceNames,parentAction:this}}).then(t.bind(e,this))},instanceChangePwd:function(a){var i=this.view.waitActionDialog({title:s("重置密码"),width:600,needFoot:!0,url:"/bcc/instance/change_pwd",actionOptions:{instanceIds:a.instanceIds,instanceUuids:a.instanceUuids,parentAction:this}});return i.then(t.bind(e,this)),i},instanceRebuild:function(a){var i=this.view.waitActionDialog({title:s("重装操作系统"),width:610,needFoot:!0,url:"/bcc/instance/rebuild",actionOptions:{instanceId:a.instanceId,imageId:a.imageId,osType:a.osType,parentAction:this}});return i.then(t.bind(e,this)),i},instanceCreateSnapshot:function(a){this.view.waitActionDialog({title:s("创建快照"),width:620,needFoot:!0,url:"/bcc/snapshot/create",actionOptions:{instanceId:a.instanceId,parentAction:this}}).then(t.bind(e,this))},instanceCreateAutoSnapshot:function(a){this.view.waitActionDialog({title:s("设置本实例磁盘自动快照策略"),width:540,needFoot:!0,url:"/bcc/instance/auto_snapshot",actionOptions:{instanceId:a.instanceId,imageType:a.imageType||"common",parentAction:this}}).then(t.bind(e,this))},instanceCreateImage:function(a){this.view.waitActionDialog({title:s("创建自定义镜像"),width:620,needFoot:!0,url:"/bcc/image/create",actionOptions:{instanceId:a.instanceId||a.instanceUuid,instanceUuid:a.instanceUuid,parentAction:this}}).then(t.bind(e,this))},snapshotCreateImage:function(a){this.view.waitActionDialog({title:s("创建自定义镜像"),width:620,needFoot:!0,url:"/bcc/snapshot/create_image",actionOptions:{instanceId:a.instanceId||a.instanceUuid,instanceUuid:a.instanceUuid,snapshotId:a.snapshotId||a.snapshotUuid,snapshotUuid:a.snapshotUuid,parentAction:this}}).then(t.bind(e,this))},joinSecurityGroups:function(a){var i=s("关联安全组");a.instances&&a.instances.length>1&&(i=s("批量")+i),this.view.waitActionDialog({title:i,width:600,needFoot:!0,url:"/bcc/instance/join_security_groups",actionOptions:{instances:a.instances,parentAction:this}}).then(t.bind(e,this))},releaseShedule:function(e){var i=this,n=i.view,r=require("common/util/dialog"),o=require("inf-ria/utils/mtools");n.waitActionDialog({title:s("创建定时释放计划"),width:600,needFoot:!0,url:"/bcc/instance/release",actionOptions:{instanceId:e.item.id,releaseTime:e.item.releaseTime,parentAction:i}}).then(function(e){var c=e.target;i.dialog=c;var l=c.getFoot().getChild("btnOk"),d=c.getFoot().getChild("btnCancel");l.setContent(s("下一步")),l.disable();var u=c.getAction();l.on("click",function(){(function(e,t){var c=e.view.get("releaseOnOff").isChecked()?e.view.get("releaseTime").getValue():"",l=e.model.get("releaseTimeInitValue");if(!c||e.view.get("releaseTime").validate()){var d={ids:[e.model.get("instanceId")],releaseTime:c&&o.local2utc(c)};i.view.resetMoreOperation&&i.view.resetMoreOperation(),t.hide(),r.waitActionDialog(n,{title:s("变更前确认"),width:600,needFoot:!0,url:"/bcc/instance/require_auth_code",actionOptions:{extraData:d,requester:a.bccInstanceExpiredRelease,tip:c&&!l?'<div class="releaseSheduleTip"><span>温馨提示：</span><p>1. '+s("设定释放时间为北京时间")+"</p><p>2. "+s("本实例系统盘快照都会被释放")+"</p><p>3. "+s("本实例已挂载CDS云磁盘都会被自动卸载，不会被释放")+"</p><p>4. "+s("实例释放后不可恢复")+"</p></div>":"变更释放时间需要确认",parentAction:this,needRedirectAfterSubmit:!0,reloadParentAfterSubmit:!0}}).then(function(e){var t=e.target;t.getFoot().getChild("btnOk").on("click",function(){t.hide()})})}else e.view.setBtnOkAble("disable")}).call(i,u,c)}),c.on("close",t.bind(function(){this.resetMoreOperation&&this.resetMoreOperation()},i.view)),d.on("click",t.bind(function(){c.fire("cancel"),c.dispose(),this.resetMoreOperation&&this.resetMoreOperation()},i.view)),c.resize()})},chooseMKTProduct:function(e){var t=this;this.view.waitActionDialog({title:s("云市场 - 镜像服务"),width:850,needFoot:!1,url:"/bcc/instance/create/mktlist",actionOptions:e}).then(function(e){var a=e.target,i=a.getAction();i.on("dialog.resize",function(e){a.resize()}),i.on("dialog.dispose",function(e){a.dispose()}),a.on("close",function(e){t.fire("dialog.close",e)})})},expandDisk:function(e){var t=this;if(e.item.volumeType===n.VolumeType.SYSTEM){var a='1、扩容操作目前仅支持单分区系统盘，多分区系统盘请点击"取消";</br>'+(e.item.resizeNeedScript?"2、系统盘"+e.item.name+'扩容完成后，您需要按照文档执行相关操作，并重启云服务器才会最终生效； <a href="https://cloud.baidu.com/doc/BCC/GettingStarted.html#.E6.89.A7.E8.A1.8C.E8.84.9A.E6.9C.AC" target="_blank">查看文档></a>':"2、系统盘"+e.item.name+"扩容完成后，您需要手动重启云服务器才能最终生效；");this.view.waitConfirm({title:"温馨提示",content:a,needFoot:!0,okText:"下一步",encode:!1}).then(function(){t.redirect("/bcc/cds/upgrade_config~diskId="+e.item.id)},function(){t.view.resetMoreOperation()})}else t.redirect("/bcc/cds/upgrade_config~diskId="+e.item.id)},snapshotTransfinite:function(e){var t=this;this.view.waitConfirm({title:s("创建快照提示"),content:s("该磁盘快照数已达上限，无法进行创建操作，如您仍希望创建，请尽快对磁盘快照进行手动删除清理"),needFoot:!0,okText:s("前往清理"),encode:!1}).then(function(){t.redirect("/bcc/snapshot/disk~diskType="+e.type+"&"+e.idName+"="+e.id)},function(){t.view.resetMoreOperation()})},relateASP:function(e){var t={title:s("自动快照策略关联"+e.title),width:700,needFoot:!0,url:"/bcc/snapshot/relatePolicy"},a={parentAction:this,aspId:e.aspId,volumeId:e.volumeId};r.waitActionDialog(t,a)}}}),define("bcc/rpc/brpc",["exports","module","lodash","babel-runtime/helpers/interop-require-default","inf-ria/app/brpc","./factory"],function(exports,module,e,t,a,i){var n=t["default"](e),s=t["default"](a);module.exports={activate:n["default"].once(function(){s["default"].registerService("bcc://instanceNameEdit",i.instanceNameEdit()),s["default"].registerService("bcc://instancePwdReset",i.instancePwdReset()),s["default"].registerService("bcc://instancerRebuild",i.instancerRebuild()),s["default"].registerService("bcc://instancerJoinSecurity",i.instancerJoinSecurity()),s["default"].registerService("bcc://createImage",i.createImage()),s["default"].registerService("bcc://createSnapshot",i.createSnapshot()),s["default"].registerService("bcc://changeSubnet",i.changeSubnet()),s["default"].registerService("bcc://changeIp",i.changeIp())})}}),define("bcc/rpc/factory",["exports","lodash","babel-runtime/helpers/interop-require-default","er/controller","inf-ria/app/helper"],function(exports,e,t,a,i){exports.__esModule=!0,exports.instanceNameEdit=function(){return function(e){var t=s["default"].currentAction,a={title:"批量修改名称",width:600,needFoot:!0,url:"/bcc/instance/change_name",actionOptions:n["default"].assign({parentAction:t},e)};return i.waitActionDialog(a)}},exports.instancePwdReset=function(){return function(e){var t=s["default"].currentAction,a={title:"重置密码",width:600,needFoot:!0,url:"/bcc/instance/change_pwd",actionOptions:n["default"].assign({parentAction:t},e)};return i.waitActionDialog(a)}},exports.instancerRebuild=function(){return function(e){var t=s["default"].currentAction,a={title:"重装操作系统",width:610,needFoot:!0,url:"/bcc/instance/rebuild",actionOptions:n["default"].assign({parentAction:t},e)};return i.waitActionDialog(a)}},exports.instancerJoinSecurity=function(){return function(e){var t=s["default"].currentAction,a={title:"关联安全组",width:600,needFoot:!0,url:"/bcc/instance/join_security_groups",actionOptions:n["default"].assign({parentAction:t},e)};return i.waitActionDialog(a)}},exports.createImage=function(){return function(e){var t=s["default"].currentAction,a={title:"创建自定义镜像",width:620,needFoot:!0,url:"/bcc/image/create",actionOptions:n["default"].assign({parentAction:t},e)};return i.waitActionDialog(a)}},exports.createSnapshot=function(){return function(e){var t=s["default"].currentAction,a={title:"创建快照",width:620,needFoot:!0,url:"/bcc/snapshot/create",actionOptions:n["default"].assign({parentAction:t},e)};return i.waitActionDialog(a)}},exports.changeSubnet=function(){return function(e){var t=s["default"].currentAction,a={title:"子网变更",width:500,needFoot:!0,url:"/bcc/instance/change_subnet",actionOptions:n["default"].assign({parentAction:t},e)};return i.waitActionDialog(a)}},exports.changeIp=function(){return function(e){var t=s["default"].currentAction,a={title:"内网IP地址变更",width:500,needFoot:!0,url:"/bcc/instance/change_ip",actionOptions:n["default"].assign({parentAction:t},e)};return i.waitActionDialog(a)}};var n=t["default"](e),s=t["default"](a)}),define("bcc/security/config",["require","underscore","er/controller"],function(require){var e=require("underscore");require("er/controller").registerAction([{type:"bcc/security/List",path:"/bcc/security/list"},{type:"bcc/security/Create",path:"/bcc/security/create"},{type:"bcc/security/Create",path:"/bcc/security/copy"},{type:"bcc/security/Create",path:"/bcc/security/detail"},{type:"bcc/security/EditRule",path:"/bcc/security/edit_rule"}]);return{RULE:{PORTRANGE:{placeholder:"1-65535",required:"required",requiredErrorMessage:"端口范围必填",custom:function(t){if("all"===(t=e.trim(t)).toLowerCase())return!0;var a=function(e){return/[1-9]{1,5}/.test(e)&&e<=65535};if(-1===t.indexOf("-"))return a(t);var i=t.split("-");return a(i[0])&&a(i[1])&&+i[0]<+i[1]},customErrorMessage:"端口范围不符合规则"},REMOTEIP:{placeholder:"all",required:"required",requiredErrorMessage:"IP范围必填",custom:function(t){if("all"===(t=e.trim(t)).toLowerCase())return!0;var a=function(e){return/[0-9]{1,3}/.test(e)&&e<=255},i=function(t){return e.every(t.split("."),a)};if(-1===t.indexOf("/"))return i(t);var n=t.split("/");return i(n[0])&&function(e){return/[1-9]{1,2}/.test(e)&&e<=32&&e>=1}(n[1])},customErrorMessage:"IP范围不符合规则"}}}}),define("bcc/security/Create",["require","bat-ria/mvc/FormAction","underscore","jquery","saber-cookie","../config","../events","../util","./rule","common/util","./CreateModel","./CreateView","er/URL","er/util"],function(require){"use strict";function e(){a.apply(this,arguments),this.on("modelloaded",this.modelLoaded)}function t(e,t){var a=-1;return i.find(t,function(t,i){if(e.equal(t))return a=i,!0}),a}var a=require("bat-ria/mvc/FormAction"),i=require("underscore"),n=require("jquery"),s=require("saber-cookie"),r=require("../config").api,o=require("../events"),c=require("../util"),l=require("./rule"),d=new l("全部协议","all","1-65535"),u="bce-bcc-security-ruleType",p=require("common/util").isSubUser();return e.prototype.modelType=require("./CreateModel"),e.prototype.viewType=require("./CreateView"),e.prototype.modelLoaded=function(){var e=this.context.url.getPath(),t=this.model.get("security");"/bcc/security/detail"===e?(this.model.set("isSecurityDetail",!0),this.model.set("actionTitle","安全组详情"),this.model.submitRequester=r.bccSecurityUpdate):"/bcc/security/copy"===e?(this.model.set("actionTitle","复制安全组"+t.securityGroupId),this.model.set("name",t.name+"-Copy"),this.model.submitRequester=r.bccSecurityCopy):this.model.set("actionTitle","创建安全组")},e.prototype.createRule=function(e){var a=this,i=a.view,n=i.getRulesType(),s=i.getTabItems(n);i.waitActionDialog({title:"添加"+("in"===n?"入站":"出站")+"规则",width:570,needFoot:!0,url:"/bcc/security/edit_rule",actionOptions:{parentAction:a,ruleType:n,securityGroups:a.model.get("securityGroups")}}).then(function(e){var n=e.target,r=n.getFoot().getChild("btnOk"),o=n.getFoot().getChild("btnCancel"),c=n.getAction();r.on("click",function(){(function(e,n){var r=e.view,o="user"===r.get("source").getValue();if(("icmp"===r.get("protocol").getValue()||r.get("portRange").validate())&&(!o||r.get("remoteIP").validate())){var c=i.getRuleData(r.getGroup("rule"),"id");-1===t(c,s.table.datasource)?a.model.get("isSecurityDetail")?(this.addRules(s.table.id,s.modelName,[c],!0),a.view.fire("submit")):(this.addRules(s.table.id,s.modelName,[c]),n.dispose()):i.showRuleDuplicateTip()}}).call(a,c,n)}),o.on("click",function(){n.fire("cancel"),n.dispose()})})},e.prototype.deleteRules=function(e){var t=this.view.getTabItems(),a=t.table.getSelectedItems();this.model.get("isSecurityDetail")?(this.removeRules(t.table.id,t.modelName,a,!0),this.view.fire("submit")):this.removeRules(t.table.id,t.modelName,a)},e.prototype.addRules=function(e,a,n,s){var r,o=this.model.get(a),l=0;if(s&&this.model.updateCache(e,this.model.cloneRuleDatasource(o)),i.each(n,function(e){-1===(r=t(e,o))?o.unshift(e.clone()):(l++,o.unshift(o.splice(r,1)[0]))}),this.model.set(a,o),!s){var d=this.view.get(e);if(d.setDatasource(o),l>0){for(var u=[],p=0;p<l;p++)u.push(d.getRow(p));c.animate("flash",u)}}},e.prototype.removeRules=function(e,t,a,n){var s=this.model.get(t);if(n&&this.model.updateCache(e,this.model.cloneRuleDatasource(s)),i.isArray(a)&&(s=i.reject(s,function(e){return i.find(a,function(t){return t.equal(e)})})),this.model.set(t,s),!n){this.view.get(e).setDatasource(s)}},e.prototype.editRule=function(e){var t=this.view.getRulesType(),a=e.table,s=e.rowIndex,r=a.datasource[s];a.cacheEditRow&&n(a.cacheEditRow.row).find(".edit-rule-cancel").click(),this.model.updateCache(a.id,this.model.cloneRuleDatasource(a.datasource)),a.cacheEditRow={initValue:r};var o=this.view.getEditRow({item:r,rowIndex:s,ruleType:t});a.updateRowAt(s,o);var c=a.getRow(s);a.bodyPanel.initChildren(c),a.cacheEditRow.row=c,i.each(a.bodyPanel.children,function(e){var t=e.get("xFieldName"),i=e.renderOptions.properties.xField[t];i&&e.setProperties(i);var n=e.get("xEventType");n&&e.on(n,function(e){"true"===e.target.get("xEventBubble")&&a.fire(n,{bubble:!0,originalTarget:e.target})})}),this.view.setTabOperationState("editing")},e.prototype.editRuleSubmit=function(e){var a=e.table,i=e.rowIndex,n=function(e){return e+i},s="user"===a.bodyPanel.getChild(n("source")).getValue();if(("icmp"===a.bodyPanel.getChild(n("protocol")).getValue()||a.bodyPanel.getChild(n("portRange")).validate())&&(!s||a.bodyPanel.getChild(n("remoteIP")).validate())){var r=this.view.getRuleData(a.bodyPanel.children,"xFieldName");-1===t(r,a.datasource)?this.model.get("isSecurityDetail")?(a.datasource[i]=r,this.view.fire("submit")):(a.updateRowAt(i,r),a.cacheEditRow=null,a.bodyPanel.disposeChildren(),this.view.updateAllAllowedRule(),this.view.setTabOperationState("normal")):this.view.showRuleDuplicateTip()}},e.prototype.editRuleCancel=function(e){var t=e.table,a=e.rowIndex;t.updateRowAt(a,t.cacheEditRow.initValue),t.cacheEditRow=null,t.bodyPanel.disposeChildren(),this.view.setTabOperationState("normal"),this.model.clearCache(t.id)},e.prototype.toggleAllAllowedRule=function(e){var t=this.view.getTabItems(),a=this.model.hasDefaultAllRule(t.table.datasource),i=this.model.get("isSecurityDetail");t.ruleAllAllowed.submiting||e.data&&a||!e.data&&!a||(e.data?(this.addRules(t.table.id,t.modelName,[d],i),!i&&t.addRule.disable()):(this.removeRules(t.table.id,t.modelName,[d],i),!i&&this.view.addRuleEnable(t)),i&&(t.ruleAllAllowed.submiting=!0,this.view.fire("submit")))},e.prototype.initRuleTab=function(e){var t=this.view.getTabItems();e&&e.main&&(e.main.className=e.main.className.replace(e.oldClassName,e.newClassName)),t.table.adjustWidth()},e.prototype.saveEdit=function(e){var t=e.key,a=e.value,n=this.model.get("id");this.model.updateSecurityGroupField(n,t,a).then(i.bind(this.reload,this))},e.prototype.deleteSecurity=function(e){var t=this.model.get("security");this.view.waitConfirm({title:"删除安全组",content:["您确定删除安全组 “ ",t.name," “ 吗？"].join(""),width:540,needFoot:!0}).then(i.partial(this.model.deleteSecurityGroupById,t.id)).then(i.bind(this.redirect,this,"/bcc/security/list"))},e.prototype.getInstanceContent=function(){var e=this.model.get("security"),t="";if(e&&e.instances&&e.instances.length>0){var a=i.pluck(e.instances,"name"),n=a.length>3;n&&(a.length=3),t="云服务器 "+a.join("、")+(n?"等":"")+"当前已经启用这一安全组规则，您的任何修改将在保存后立即生效。请确认您所设置的安全规则对当前云服务器的正常服务无任何影响！"}return t},e.prototype.resetSecurityHandler=function(){var e=this.model.getSubmitData(this.view.getFormData()),t=[];return t.push(l.toJSON({source:"user",protocol:"all",remoteIP:"all"},"ingress")),t.push(l.toJSON({source:"system",protocol:"all",remoteGroupId:e.id},"ingress")),t.push(l.toJSON({source:"user",protocol:"all",remoteIP:"all"},"egress")),e.desc="",e.rules=t,this.model.submitRequester(e).then(i.bind(this.handleSubmitResult,this),i.bind(this.handleSubmitError,this))},e.prototype.resetSecurity=function(e){var t=this,a=this.getInstanceContent();a?this.view.waitConfirm({title:"提示",content:a}).then(function(){t.resetSecurityHandler()}):this.resetSecurityHandler()},e.prototype.submit=function(e){var t,n=this,s=n.view.getTabItems(),r=i.countBy(e.rules,function(e){return e.direction}).ingress||0;if(n.model.get("isSecurityDetail")){if(t=n.getInstanceContent())return void n.view.waitConfirm(t,"提示").then(function(){a.prototype.submit.call(n,e)},function(){n.rollbackTableData(s)});delete e.name,delete e.desc}if(r<=0)return t="您未添加任何入站开放端口，将使该云服务器无法和外部进行任何通信，您仅能通过VNC功能进行管理。是否确认继续操作？",void n.view.waitConfirm(t,"提示").then(function(){a.prototype.submit.call(n,e)},function(){n.rollbackTableData(s)});a.prototype.submit.call(n,e)},e.prototype.redirectAfterSubmit=function(e){if(this.model.get("isSecurityDetail")){var t=require("er/URL").withQuery(this.context.url.getPath(),{id:this.model.get("id")});s.set(u,this.view.getRulesType()),this.redirect(t,{force:!0})}else this.back("/bcc/security/list")},e.prototype.redirectAfterCancel=function(){this.back(this.backLocation,!0)},e.prototype.handleSubmitError=function(e){var t=this.view.getTabItems();this.rollbackTableData(t),a.prototype.handleSubmitError.call(this,e)},e.prototype.rollbackTableData=function(e){var t=this.model.getCache(e.table.id);if(t&&(t=this.model.cloneRuleDatasource(t),e.table.datasource=t,this.model.set(e.modelName,t)),e.ruleAllAllowed.submiting){var a=this.model.hasDefaultAllRule(e.table.datasource);e.ruleAllAllowed.set("checked",a),e.ruleAllAllowed.submiting=undefined}},e.prototype.init=function(){var e=this.view.getTabItems("in"),t=this.view.getTabItems("out"),a=s.get(u);s.remove(u),this.model.set("tabIn",e),this.model.set("tabOut",t),this.view.get("ruleTab").set("activeIndex","out"===a?1:0),this.view.showRuleQuota(e),this.view.showRuleQuota(t),this.view.updateAllAllowedRule(e),this.view.updateAllAllowedRule(t),p&&(this.view.get("ruleInAllAllowed").setDisabled(!0),this.view.get("ruleOutAllAllowed").setDisabled(!0))},e.prototype.initBehavior=function(){a.prototype.initBehavior.apply(this,arguments);var e=this.view;e.on(o.CREATE_RULE,this.createRule,this),e.on(o.DELETE_RULES,this.deleteRules,this),e.on(o.TOGGLE_ALLALLOWED_RULE,this.toggleAllAllowedRule,this),e.on(o.INIT_RULETAB,this.initRuleTab,this),e.on(o.EDIT_RULE,this.editRule,this),e.on(o.EDIT_RULE_SUBMIT,this.editRuleSubmit,this),e.on(o.EDIT_RULE_CANCEL,this.editRuleCancel,this),this.on("entercomplete",this.init,this),this.model.get("isSecurityDetail")&&(n(".ui-table-cell-editentry").on("click",function(e){var t=n(this.parentNode),a=n("."+t[0].className.replace("info","edit"));t.hide(),a.show()}),e.on(o.SAVE_EDIT,this.saveEdit,this),e.on(o.DELETE_SECURITY,this.deleteSecurity,this),e.on(o.RESET_SECURITY,this.resetSecurity,this));var t=(this.context.args||{}).toPart;if(t){var i=n("[data-part="+t+"]");i.length>0&&n("html,body").animate({scrollTop:i.offset().top},300)}},require("er/util").inherits(e,a),e}),define("bcc/security/create.tpl",[],function(){return'\x3c!-- target: TPL_bcc_security_create --\x3e\n<div class="\x3c!-- if: ${isSecurityDetail} --\x3ebcc-security-detail \x3c!-- /if --\x3ebcc-security-create bcc-main-wrap">\n    <div class="content-wrap">\n        <p class="breadcrumb">\n            <span>${i18n.产品服务}</span>\n            <span class="divider">/</span>\n            <a href="#/bcc/security/list">${i18n.云服务器BCC} - ${i18n.安全组列表}</a>\n            <span class="divider">/</span>\n            <span class="active">${actionTitle}</span>\n        </p>\n\n        \x3c!-- if: ${isSecurityDetail} --\x3e\n        <div class="instance-info">\n            <h1 title="${security.id}">${security.name}</h1>\n            <span class="ui-group ui-button-group">\n                <div data-ui-type="Button"\n                    \x3c!-- if: (${security.instances} && ${security.instances.length} > 0)\n                        || (${security.name} === \'默认安全组\') --\x3e\n                    data-ui-hidden="true"\n                    \x3c!-- /if --\x3e\n                    data-ui-id="deleteGroup">${i18n.删除}</div>\n                <div data-ui-type="Button"\n                    \x3c!-- if: ${security.name} !== \'默认安全组\' --\x3e\n                    data-ui-hidden="true"\n                    \x3c!-- /if --\x3e\n                    data-ui-id="resetGroup">${i18n.恢复默认规则}</div>\n            </span>\n        </div>\n        \x3c!-- /if --\x3e\n\n        <div class="list-content">\n            <h2>${actionTitle}</h2>\n            <form data-ui-type="Form" data-ui-id="form"\n                data-ui-auto-validate="true" data-ui-submit-button="submit"\n                  class="create-main">\n                \x3c!-- import: TPL_bcc_security_group_form --\x3e\n                \x3c!-- import: TPL_bcc_security_group_button --\x3e\n            </form>\n        </div>\n    </div>\n</div>\n\n\x3c!-- target: TPL_bcc_security_group_form --\x3e\n<div class="detail-parts-table">\n    <dl class="detail-create-baseinfo detail-create detail-part-1-col">\n        <dt><h4>${i18n.基本信息}</h4></dt>\n        <dd>\n            <label>${i18n.所在网络：}</label>\n            <div>${vpcName}</div>\n        </dd>\n        \x3c!-- if: ${isSecurityDetail} --\x3e\n        <dd>\n            <label>${i18n.安全组ID：}</label>\n            <div>${security.securityGroupId}</div>\n        </dd>\n        \x3c!-- /if --\x3e\n        <dd>\n            <label>${i18n.安全组名称：}</label>\n            <div>\n                \x3c!-- if: ${isSecurityDetail} --\x3e\n                <div class="bcc-security-name-info">\n                    ${security.name}\n                    \x3c!-- if: ${security.name} !== \'默认安全组\' && !${isSubUser} --\x3e\n                    <span class="ui-table-cell-editentry"></span>\n                    \x3c!-- /if --\x3e\n                </div>\n                <div class="bcc-security-name-edit">\n                    <input\n                        data-ui-type="TextBox"\n                        data-ui-id="name"\n                        data-ui-name="name"\n                        data-ui-value="@name"\n                        data-ui-width="420" />\n                    <button data-ui-type="Button" data-ui-id="editNameSave"\n                            data-ui-key="name" type="Button" class="skin-primary-button">${i18n.确定}</button>\n                    <button data-ui-type="Button" data-ui-id="editNameCancel"\n                            data-ui-key="name" type="button">${i18n.取消}</button>\n                </div>\n                \x3c!-- else: --\x3e\n                    <input\n                            data-ui-type="TextBox"\n                            data-ui-id="name"\n                            data-ui-name="name"\n                            data-ui-value="@name"\n                            data-ui-width="420" />\n                \x3c!-- /if --\x3e\n            </div>\n        </dd>\n        <dd>\n            <label>${i18n.描述：}</label>\n            <div>\n                \x3c!-- if: ${isSecurityDetail} --\x3e\n                <div class="bcc-security-desc-info">\n                    ${security.desc|defaultValue(\'无\')}\n                    \x3c!-- if: !${isSubUser} --\x3e\n                        <span class="ui-table-cell-editentry"></span>\n                    \x3c!-- /if --\x3e\n                </div>\n                <div class="bcc-security-desc-edit">\n                    <textarea\n                        placeholder="最多255个字符"\n                        data-ui-type="TextBox"\n                        data-ui-id="desc"\n                        data-ui-name="desc"\n                        data-ui-value="@desc"\n                        data-ui-width="420"\n                        data-ui-height="60"\n                        data-ui-max-length="255"></textarea><br />\n                    <button data-ui-type="Button" data-ui-id="editDescSave"\n                            data-ui-key="desc" type="Button" class="skin-primary-button">${i18n.确定}</button>\n                    <button data-ui-type="Button" data-ui-id="editDescCancel"\n                            data-ui-key="desc" type="button">${i18n.取消}</button>\n                </div>\n                \x3c!-- else: --\x3e\n                    <textarea\n                        placeholder="${i18n.最多255个字符}"\n                        data-ui-type="TextBox"\n                        data-ui-id="desc"\n                        data-ui-name="desc"\n                        data-ui-value="@desc"\n                        data-ui-width="420"\n                        data-ui-height="60"\n                        data-ui-max-length="255"></textarea>\n                \x3c!-- /if --\x3e\n            </div>\n        </dd>\n    </dl>\n    <dl class="detail-create-settings detail-part-1-col">\n        <dt><h4>${i18n.端口设置}</h4></dt>\n        <dd>\n            <p class="bcc-security-note">* ${i18n.温馨提示：安全组是“允许访问”的规则集合，每添加一个规则，代表允许一个source访问某个或某个范围的端口。若安全组中未添加任何规则，表示所关联BCC实例的所有端口都不能被外界访问。}</p>\n            <esui-tab data-ui-id="ruleTab" class="ui-smart-tab rule-in-list">\n                <ul data-role="navigator" class="ui-tab-navigator">\n                    <li data-for="rule-in-list">${i18n.入站}</li>\n                    <li data-for="rule-out-list">${i18n.出站}</li>\n                </ul>\n                <div class="ui-tab-content">\n                    <div id="rule-in-list" class="rule-list">\n                        <div class="rule-all-toggle">\n                            ${i18n.允许访问所有端口：}\n                            <div\n                                data-ui-type="ToggleButton"\n                                data-ui-id="ruleInAllAllowed"\n                                data-ui-checked="@ingressRulesEnableAll"></div>\n                        </div>\n                        <button data-ui-type="Button"\n                            data-ui-id="addRuleIn"\n                            data-ui-skin="create"\n                            data-ui-disabled="true"\n                            type="Button" class="rule-add-button">${i18n.添加规则}</button>\n                        <span\n                            data-ui="type:Label;id:ingressRulesQuotaTip;"\n                            data-ui-hidden="true"\n                            class="rule-quota-tip">\n                            ${i18n.您已添加}${ruleQuota}${i18n.条入站规则，达到限额！}\n                        </span>\n                        <div data-ui-type="Table" data-ui-id="rulesInTable"\n                            data-ui-datasource="@ingressRules"\n                            data-ui-order-by="@orderBy" data-ui-order="@order"\n                            data-ui-select="@selectMode"\n                            data-ui-extension-command-type="Command">\n                        </div>\n                        <div class="rule-foot">\n                            <input type="checkbox"\n                                data-ui-type="CheckBox"\n                                data-ui-id="selectAllRulesIn"\n                                class="ui-table-select-all-bottom"  />\n                            <button data-ui-type="Button" data-ui-disabled="true"\n                                data-ui-id="deleteRulesIn">${i18n.删除}</button>\n                        </div>\n                    </div>\n                    <div id="rule-out-list" class="rule-list">\n                        <div class="rule-all-toggle">\n                            ${i18n.允许访问所有端口：}\n                            <div\n                                data-ui-type="ToggleButton"\n                                data-ui-id="ruleOutAllAllowed"\n                                data-ui-checked="@egressRulesEnableAll"></div>\n                        </div>\n                        <button data-ui-type="Button"\n                            data-ui-id="addRuleOut"\n                            data-ui-skin="create"\n                            data-ui-disabled="true"\n                            type="Button" class="rule-add-button">${i18n.添加规则}</button>\n                        <span\n                            data-ui="type:Label;id:egressRulesQuotaTip;"\n                            data-ui-hidden="true"\n                            class="rule-quota-tip">\n                            ${i18n.您已添加}${ruleQuota}${i18n.条出站规则，达到限额！}\n                        </span>\n                        <div data-ui-type="Table" data-ui-id="rulesOutTable"\n                            data-ui-datasource="@egressRules"\n                            data-ui-order-by="@orderBy" data-ui-order="@order"\n                            data-ui-select="@selectMode"\n                            data-ui-extension-command-type="Command">\n                        </div>\n                        <div class="rule-foot">\n                            <input type="checkbox"\n                                data-ui-type="CheckBox"\n                                data-ui-id="selectAllRulesOut"\n                                class="ui-table-select-all-bottom"  />\n                            <button data-ui-type="Button" data-ui-disabled="true"\n                                data-ui-id="deleteRulesOut">${i18n.删除}</button>\n                        </div>\n                    </div>\n                </div>\n            </esui-tab>\n\n        </dd>\n    </dl>\n\n    \x3c!-- if: ${isSecurityDetail} && ${bccInstances} --\x3e\n    <dl class="bcc-security-instances detail-part-1-col" data-part="bccInstances">\n        <dt><h4>${i18n.关联云服务器列表}</h4></dt>\n        <dd>\n            <div data-ui-type="Table"\n                 data-ui-id="bccInstances"\n                 data-ui-datasource="@bccInstances">\n            </div>\n        </dd>\n    </dl>\n    \x3c!-- /if --\x3e\n</div>\n\n\x3c!-- target: TPL_bcc_security_group_button --\x3e\n\x3c!-- if: !${isSecurityDetail} --\x3e\n<div class="actionwrap-bottom">\n    <button data-ui-type="Button" data-ui-id="submit"\n            type="Button" class="skin-primary-button"\n            data-ui-group="submit">${i18n.确定}</button>\n    <button data-ui-type="Button" data-ui-id="cancel"\n            type="button">${i18n.取消}</button>\n</div>\n\x3c!-- /if --\x3e\n\n\x3c!-- target: TPL_bcc_security_rule_protocol --\x3e\n<div\n    data-ui="type:Select;width:90;datasource:@protocolList;"\n    data-ui-child-name="protocol${rowIndex}"\n    data-ui-value="${item.protocol}"\n    data-ui-old-raw-value="${item.protocol}"\n    data-ui-x-event-type="change"\n    data-ui-x-event-bubble="true"\n    data-ui-x-row-index="${rowIndex}"\n    data-ui-x-field-name="protocol" >\n</div>\n\n\x3c!-- target: TPL_bcc_security_rule_portrange --\x3e\n<input\n    data-ui="type:TextBox;width:70;required:required;value:${item.portRange}"\n    data-ui-x-event-type="input"\n    data-ui-x-field-name="portRange"\n    data-ui-child-name="portRange${rowIndex}"\n    \x3c!-- if: ${item.protocol} === \'icmp\' || ${item.protocol} === \'all\'  --\x3e\n    data-ui-disabled="true"\n    \x3c!-- /if --\x3e\n    data-ui-placeholder="1-65535" />\n\n\x3c!-- target: TPL_bcc_security_rule_source --\x3e\n<select\n    data-ui="type:Select;value:${item.source}"\n    data-ui-x-event-type="change"\n    data-ui-x-field-name="source"\n    data-ui-x-event-bubble="true"\n    data-ui-x-row-index="${rowIndex}"\n    data-ui-child-name="source${rowIndex}" >\n    <option value="user">\n    \x3c!-- if: ${ruleType} === \'in\' --\x3e${i18n.源IP}\x3c!-- else: --\x3e${i18n.目的IP}\x3c!-- /if --\x3e\n    </option>\n    <option value="system">${i18n.安全组}</option>\n</select>\n<input\n    data-ui-type="TextBox"\n    data-ui-width="100"\n    data-ui-value="${item.remoteIP}"\n    data-ui-child-name="remoteIP${rowIndex}"\n    data-ui-x-event-type="input"\n    data-ui-x-field-name="remoteIP"\n    data-ui-required="required"\n    data-ui-placeholder="${i18n.IP地址}"\n    \x3c!-- if: ${item.source} === \'system\' --\x3edata-ui-hidden="true"\x3c!-- /if --\x3e />\n<div\n    data-ui-type="Select"\n    data-ui-width="180"\n    data-ui-child-name="remoteGroupId${rowIndex}"\n    \x3c!-- if: ${item.remoteGroupId} --\x3e\n    data-ui-value="${item.remoteGroupId}"\n    \x3c!-- else: --\x3e\n    data-ui-selected-index="0"\n    \x3c!-- /if --\x3e\n    data-ui-datasource="@securityGroups"\n    data-ui-x-event-type="change"\n    data-ui-x-field-name="remoteGroupId"\n    data-ui-required="required"\n    \x3c!-- if: ${item.source} === \'user\' --\x3edata-ui-hidden="true"\x3c!-- /if --\x3e >\n</div>\n\n\x3c!-- target: TPL_bcc_security_rule_name --\x3e\n<input\n    data-ui-type="TextBox"\n    data-ui-width="120"\n    data-ui-child-name="name${rowIndex}"\n    data-ui-x-event-bubble="true"\n    data-ui-x-row-index="${rowIndex}"\n    data-ui-x-event-type="change"\n    data-ui-x-field-name="name"\n    data-ui-value="${item.name}"\n    maxLength="255" />\n'}),define("bcc/security/CreateModel",["require","bat-ria/mvc/FormModel","underscore","common/util","../config","../util","./services","./rule","er/util"],function(require){function e(){t.apply(this,arguments),this.submitRequester=n.bccSecurityCreate}var t=require("bat-ria/mvc/FormModel"),a=require("underscore"),i=require("common/util"),n=require("../config").api,s=require("../util"),r=require("./services"),o=require("./rule"),c=new o("全部协议","all","1-65535");return e.prototype.datasource={menu:function(e){return"securityinfo"},security:function(e){if(e.get("id"))return e.getSecurityGroupById(e.get("id"))},securityGroups:function(e){return e.getAllSecurityGroups().then(function(e){var t=[];return a.each(e,function(e){t["默认安全组"===e.name?"unshift":"push"]({name:e.name,value:e.id,title:e.securityGroupId||e.id})}),t})},allServices:function(e){return a.map(r,function(e){return{name:e.name,value:e.name}})},protocolList:function(e){return[{name:"全部协议",value:"all"},{name:"tcp",value:"tcp"},{name:"udp",value:"udp"},{name:"icmp",value:"icmp"}]},ruleQuota:function(){return 50},isSubUser:function(){return i.isSubUser()}},e.prototype.updateSecurityGroupField=function(e,t,a){var i={id:e};return i[t]=a,n.bccSecurityUpdateField(i)},e.prototype.getSecurityGroupById=function(e){return n.bccSecurityDetail({id:e}).then(function(e){return e.securityGroupId=e.securityGroupId||e.id,e})},e.prototype.getAllSecurityGroups=function(){return n.bccSecurityList({}).then(function(e){return e.result})},e.prototype.hasDefaultAllRule=function(e){var t=-1;return a.find(e,function(e,a){return!!c.equal(e)&&(t=a,!0)}),-1!==t},e.prototype.getExtraData=function(){var e=[];a.each(this.get("ingressRules"),function(t){e.push(o.toJSON(t,"ingress"))}),a.each(this.get("egressRules"),function(t){e.push(o.toJSON(t,"egress"))});var t=this.get("security");return{id:t?t.id||"":null,rules:e}},e.prototype.cloneRuleDatasource=function(e){return a.map(e,o.clone)},e.prototype.initCache=function(){this.set("__RULECACHE__",{})},e.prototype.getCache=function(e){return this.get("__RULECACHE__")[e]||null},e.prototype.updateCache=function(e,t){this.get("__RULECACHE__")[e]=t},e.prototype.clearCache=function(e){delete this.get("__RULECACHE__")[e]},e.prototype.ruleQuotaCheck=function(e,t){var a=e+"QuotaCheck";return 2===arguments.length?(t=!!t,this.set(a,t),t):this.get(a)},e.prototype.deleteSecurityGroupById=function(e){return n.bccSecurityDelete({id:e})},e.prototype.prepare=function(){var e=this.get("security"),t=this.get("ruleQuota"),n=[],r=[c],l=a.reduce(this.get("securityGroups"),function(e,t){return e[t.value]=t.name,e},{});if(e){this.set("name",e.name),this.set("desc",e.desc);var d=e.rules||[];a.each(d,function(e){e.remoteGroupName=l[e.remoteGroupId]}),n=a.filter(d,function(e){return"ingress"===e.direction}).map(o.fromJSON).sort(s.sortSecurityRule),r=a.filter(d,function(e){return"egress"===e.direction}).map(o.fromJSON).sort(s.sortSecurityRule),this.set("bccInstances",e.instances||[])}this.set("vpcName",i.getVpcName(e?e.vpcName:"")),this.set("ingressRules",n),this.set("egressRules",r),this.set("ingressRulesEnableAll",this.hasDefaultAllRule(n)),this.set("egressRulesEnableAll",this.hasDefaultAllRule(r)),this.set("ingressRulesQuotaCheck",n.length<t),this.set("egressRulesQuotaCheck",n.length<t),this.set("securityGroupsIdNameMap",l),this.initCache()},require("er/util").inherits(e,t),e}),define("bcc/security/CreateView",["require","bat-ria/tpl!./create.tpl","bat-ria/mvc/FormView","underscore","etpl","jquery","../config","../events","./config","./rule","common/util","common/util/tableUtil","er/util"],function(require){function e(){d.apply(this,arguments)}function t(e){this.getTabItems().table.setAllRowSelected(e.target.isChecked())}function a(e){var t={};t["rulesInTable"===e.target.id?"deleteRulesIn":"deleteRulesOut"]={rule:function(e,t){return!t.editRow&&!y}},function(e,t,a){var i=(t=e.get(t)).getSelectedItems();for(var n in a){var s=a[n],r=s.single&&1!==i.length||!s.canBeNull&&0===i.length||s.multiple&&i.length<2,o=s.rule;if(!r&&o)for(var c=0;c<i.length;c++){var l=!o(i[c],t);if(r=r||l,l)break}e.get(n).setDisabled(r)}var d=e.get("rulesInTable"===t.id?"selectAllRulesIn":"selectAllRulesOut"),u=i.length>0&&i.length===t.datasource.length;d&&d.setChecked(u)}(this,e.target.id,t)}function i(e){var t=this.getTabItems();this.updateAllAllowedRule(t),this.showRuleQuota(t)}function n(e){var t=parseInt(e.args,10);this.fire(e.name,{rowIndex:t,table:e.target}),e.stopPropagation(),e.preventDefault()}function s(e){if(!0===e.bubble){var t=e.originalTarget,a=t.getValue(),i=t.get("xFieldName"),n=t.get("xRowIndex"),s=function(t){return e.target.bodyPanel.getChild(t+n)},r=s("portRange");if("protocol"===i){var o=t.get("oldRawValue");"all"===a?(r.setValue("1-65535"),r.disable()):"icmp"===a?(r.setValue("不涉及"),r.disable()):r.enable(),"icmp"===o&&r.setValue("1-65535"),t.set("oldRawValue",a)}else if("source"===i){var c=s("remoteIP"),l=s("remoteGroupId");"system"===a?(c.hide(),c.hideValidity(),l.show()):(c.show(),c.setValue("all"),l.hide())}}}function r(e){var t=e.target.key,a=this.get(t);a.validate()?this.fire(h.SAVE_EDIT,{key:t,value:a.getValue()}):a.getFocusTarget().focus()}function o(e){var t=e.target.key;f(".bcc-security-"+t+"-info").show(),f(".bcc-security-"+t+"-edit").hide(),this.get(t).setValue(this.model.get("security")[t])}function c(e){this.fire(h.DELETE_SECURITY)}function l(e){this.fire(h.RESET_SECURITY)}require("bat-ria/tpl!./create.tpl");var d=require("bat-ria/mvc/FormView"),u=require("underscore"),p=require("etpl"),f=require("jquery"),m=require("../config"),h=require("../events"),g=require("./config"),v=require("./rule"),b=new v("全部协议","all","1-65535"),y=require("common/util").isSubUser();e.prototype.template="TPL_bcc_security_create";var T=[{title:"实例名称",content:function(e){return u.escape(e.name)}},{title:"实例IP",content:function(e){return(e.publicIp||"未分配")+"(公) / "+e.internalIp+"(内)"}},{title:"描述",content:function(e){return u.escape(e.desc)}}],x=[{title:"协议",content:function(e,t){return e.edit?e.protocol:"all"===e.protocol?"全部协议":u.escape(e.protocol)}},{title:"端口",width:150,content:function(e,t){return e.edit?e.portRange:u.escape(e.portRange)}},{title:"Source",width:150,content:function(e,t){return e.edit?e.source:"user"===e.source?("rulesInTable"===this.id?"源IP：":"目的IP：")+u.escape(e.remoteIP):"安全组："+u.escape(e.remoteGroupName)+"<br>"+(e.remoteGroupShortId||e.remoteGroupId)}},{title:"备注",width:80,content:function(e,t){return e.edit?e.name:u.escape(e.name)}},{title:"操作",content:function(e,t){if(!e.edit){if(e.equal(b))return"";var a="",i=!y;return a+=p.compile(I)({label:"编辑",command:h.EDIT_RULE,args:t,className:i?"":"state-disabled",disabled:i?"":"disabled"})}return e.oprations}}],I='<button data-command="${command}" data-command-args="${args}" class="cmd-button ${className}" ${disabled}>${label}</button>',S=require("common/util/tableUtil");return e.prototype.uiProperties={name:m.RULE.NAME_SUPPORT_CHINESE,ruleTab:{activeIndex:"0"},rulesInTable:S.tableProperty(x,{selectMode:"box"}),rulesOutTable:S.tableProperty(x,{selectMode:"box"}),bccInstances:{fields:T},xField:{portRange:g.RULE.PORTRANGE,remoteIP:g.RULE.REMOTEIP},addRuleIn:{disabled:"@isSubUser"},deleteGroup:{disabled:"@isSubUser"},resetGroup:{disabled:"@isSubUser"},addRuleOut:{disabled:"@isSubUser"}},e.prototype.uiEvents={"ruleTab:activate":function(e){this.fire(h.INIT_RULETAB,{oldClassName:"rule-"+["out","in"][e.activeIndex]+"-list",newClassName:e.tab.panel,main:e.target.main})},"ruleInAllAllowed:change":function(e){this.fire(h.TOGGLE_ALLALLOWED_RULE,e.target.isChecked())},"ruleOutAllAllowed:change":function(e){this.fire(h.TOGGLE_ALLALLOWED_RULE,e.target.isChecked())},"addRuleIn:click":function(e){this.fire(h.CREATE_RULE),e.preventDefault()},"addRuleOut:click":function(e){this.fire(h.CREATE_RULE),e.preventDefault()},"deleteRulesIn:click":function(e){this.fire(h.DELETE_RULES),e.preventDefault()},"deleteRulesOut:click":function(e){this.fire(h.DELETE_RULES),e.preventDefault()},"rulesInTable:select":a,"rulesOutTable:select":a,"selectAllRulesIn:click":t,"selectAllRulesOut:click":t,"rulesInTable:command":n,"rulesOutTable:command":n,"rulesInTable:change":s,"rulesOutTable:change":s,"rulesInTable:bodyChange":i,"rulesOutTable:bodyChange":i},e.prototype.getEditRow=function(e){e=e||{};return{protocol:this.templateRender("TPL_bcc_security_rule_protocol",e),portRange:this.templateRender("TPL_bcc_security_rule_portrange",e),source:this.templateRender("TPL_bcc_security_rule_source",e),name:this.templateRender("TPL_bcc_security_rule_name",e),oprations:p.compile(I)({label:"确定",command:h.EDIT_RULE_SUBMIT,args:e.rowIndex,className:"",disabled:""})+p.compile(I)({label:"取消",command:h.EDIT_RULE_CANCEL,args:e.rowIndex,className:"edit-rule-cancel",disabled:""}),edit:!0}},e.prototype.getRuleData=function(e,t){var a={};return u.each(e,function(e){e[t]&&(a[e[t]]=e.getValue()),"remoteGroupId"===e[t]&&(a.remoteGroupShortId=e.getSelectedItem().title)}),a.remoteGroupName=this.model.get("securityGroupsIdNameMap")[a.remoteGroupId],v.fromJSON(a)},e.prototype.getTabItems=function(e){var t="in"===(e=e||this.getRulesType()),a=t?"rulesInTable":"rulesOutTable",i=t?"addRuleIn":"addRuleOut",n=t?"ruleInAllAllowed":"ruleOutAllAllowed",s=t?"ingressRules":"egressRules";return{table:this.get(a),addRule:this.get(i),ruleAllAllowed:this.get(n),selectAllRules:this.get(t?"selectAllRulesIn":"selectAllRulesOut"),modelName:s,model:this.model.get(s)}},e.prototype.getRulesType=function(){return 0===this.get("ruleTab").get("activeIndex")?"in":"out"},e.prototype.addRuleEnable=function(e){(e=e||this.getTabItems()).ruleAllAllowed.isChecked()||e.table.cacheEditRow||!this.model.ruleQuotaCheck(e.modelName)||y||e.addRule.enable()},e.prototype.ruleAllAllowedEnable=function(e){(e=e||this.getTabItems()).table.cacheEditRow||!this.model.ruleQuotaCheck(e.modelName)&&!e.ruleAllAllowed.isChecked()||e.ruleAllAllowed.enable()},e.prototype.setTableSelectBoxDisabled=function(e){f(".ui-table-multi-select").add(".ui-table-select-all").add(".ui-table-select-all-bottom input").attr("disabled",e)},e.prototype.setTabOperationState=function(e){var t=this.getTabItems(),a=this.get("submit");"editing"===e?(t.ruleAllAllowed.disable(),t.addRule.disable(),t.table.setAllRowSelected(!1),this.setTableSelectBoxDisabled(!0),a&&a.disable()):"normal"===e&&(this.ruleAllAllowedEnable(t),this.addRuleEnable(t),this.setTableSelectBoxDisabled(!1),a&&a.enable(),!this.model.hasDefaultAllRule(t.table.datasource)&&this.model.ruleQuotaCheck(t.modelName)||t.addRule.disable())},e.prototype.showRuleDuplicateTip=function(){this.waitAlert({title:"提示",content:"该条规则您已添加，请勿重复添加！",width:420})},e.prototype.showRuleQuota=function(e){var t=(e=e||this.getTabItems()).table.datasource.length<this.model.get("ruleQuota");if(this.model.ruleQuotaCheck(e.modelName,t),t)return this.get(e.modelName+"QuotaTip").hide(),this.addRuleEnable(e),void this.ruleAllAllowedEnable(e);this.get(e.modelName+"QuotaTip").show(),e.addRule.disable(),e.ruleAllAllowed.isChecked()?this.ruleAllAllowedEnable(e):e.ruleAllAllowed.disable()},e.prototype.updateAllAllowedRule=function(e){var t=(e=e||this.getTabItems()).table,a=this.model.hasDefaultAllRule(t.datasource);a!==e.ruleAllAllowed.isChecked()&&(a?e.addRule.disable():this.addRuleEnable(),e.ruleAllAllowed.set("checked",a));var i="ui-table-row-disabled";if(a===(0===f(i).length)){var n,s=0;u.each(t.datasource,function(e,r,o){e.equal(b)||(n=t.getRow(r),f(n).addClass(i).find("input, button").attr("disabled",a),s++)}),f(t.main).find(".ui-table-select-all").add(".ui-table-select-all-bottom input").attr("disabled",a&&s>0)}},e.prototype.enterDocument=function(){this.model.get("isSecurityDetail")&&(this.uiEvents=u.extend(this.uiEvents,{"editNameSave:click":r,"editNameCancel:click":o,"editDescSave:click":r,"editDescCancel:click":o,"deleteGroup:click":c,"resetGroup:click":l})),this.uiProperties.rulesOutTable.fields=u.map(x,function(e,t){return"Source"===e.title?u.chain(e).clone().extend({title:"Target"}).value():e}),d.prototype.enterDocument.apply(this,arguments)},require("er/util").inherits(e,d),e}),define("bcc/security/edit_rule.tpl",[],function(){return'\x3c!-- target: TPL_bcc_security_edit_rule --\x3e\n<div class="bcc-security-edit-rule">\n    <p class="bcc-security-note">温馨提示：安全组是『允许访问』的规则集合，没有『拒绝访问』的规则。</p>\n    <div class="clearfix">\n        <div class="rule-detail">\n            <div class="rule-detail-item">\n                <label>协议：</label>\n                <div>\n                    <select \n                        data-ui-type="Select"\n                        data-ui-id="protocol"\n                        data-ui-name="protocol"\n                        data-ui-width="122"\n                        data-ui-group="rule" >\n                        <option value="all">全部协议</option>\n                        <option value="tcp">tcp</option>\n                        <option value="udp">udp</option>\n                        <option value="icmp">icmp</option>\n                    </select>\n                </div>\n            </div>\n            <div class="rule-detail-item">\n                <label>端口范围：</label>\n                <div>\n                    <input\n                        data-ui-type="TextBox"\n                        data-ui-id="portRange"\n                        data-ui-name="portRange"\n                        data-ui-value="1-65535"\n                        data-ui-width="100"\n                        data-ui-disabled="true"\n                        data-ui-group="rule" />\n                    <span class="rule-item-note">例如：1-65535，8080，或all(所有端口)。</span>\n                </div>\n            </div>\n            <div class="rule-detail-item rule-detail-source">\n                <label>Source：</label>\n                <div>\n                    <select \n                        data-ui-type="Select"\n                        data-ui-id="source"\n                        data-ui-name="source"\n                        data-ui-width="122"\n                        data-ui-group="rule">\n                        \x3c!-- for: ${sourceDatasource} as ${item} --\x3e\n                            <option value="${item.value}">${item.name}</option>\n                        \x3c!-- /for --\x3e\n                    </select>\n                    <div data-ui="type:Panel;id:sourceUser">\n                        <input\n                            data-ui-type="TextBox"\n                            data-ui-id="remoteIP"\n                            data-ui-name="remoteIP"\n                            data-ui-value="all"\n                            data-ui-width="100"\n                            data-ui-group="rule" />\n                        <span class="rule-item-note">例如：180.76.1.0/16，或180.76.1.0，或all(所有IP)。</span>\n                    </div>\n                    <div data-ui-type="Select"\n                        data-ui-id="remoteGroupId"\n                        data-ui-name="remoteGroupId"\n                        data-ui-datasource="@securityGroups"\n                        data-ui-required="required"\n                        data-ui-hidden="true"\n                        data-ui-width="122"\n                        data-ui-group="rule">\n                    </div>\n                </div>\n            </div>\n\n            <div class="rule-detail-item">\n                <label>备注：</label>\n                <div>\n                    <input\n                        data-ui-type="TextBox"\n                        data-ui-id="name"\n                        data-ui-name="name"\n                        data-ui-width="120"\n                        data-ui-group="rule"\n                        maxLength="255" />\n                    <span class="rule-item-note">0-255个字符</span>\n                </div>\n            </div>\n        </div>\n        <div class="common-services">\n            <h5>快捷模板</h5>\n            <ul id="commonServices">\n            \x3c!-- for: ${commonServices} as ${item}, ${index} --\x3e\n                <li class="${item.className}"><span data-index="${index}" data-name="${item.name}" class="ui-button">${item.key}</span></li>\n            \x3c!-- /for --\x3e\n            </ul>\n        </div>\n    </div>\n</div>\n\n\x3c!-- target: TPL_bcc_security_edit_rule_child --\x3e\n\x3c!-- import: TPL_bcc_security_edit_rule --\x3e\n'}),define("bcc/security/EditRule",["require","bat-ria/mvc/BaseAction","./EditRuleModel","./EditRuleView","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("bat-ria/mvc/BaseAction");return e.prototype.modelType=require("./EditRuleModel"),e.prototype.viewType=require("./EditRuleView"),e.prototype.initBehavior=function(){t.prototype.initBehavior.apply(this,arguments)},require("er/util").inherits(e,t),e}),define("bcc/security/EditRuleModel",["require","bat-ria/mvc/BaseModel","underscore","./services","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("bat-ria/mvc/BaseModel"),a=require("underscore"),i=require("./services");return e.prototype.datasource={commonServices:function(e){var t={cs_c1:["PING","HTTP","FTP","DNS","SNMP"],cs_c2:["SSH","HTTPS","RDP","POP3","SMTP"],cs_c3:["MYSQL","SQL Server","SNMP Trap"]};return a.each(i,function(e){a.find(t,function(t,a){-1!==t.indexOf(e.key)&&(e.className=a)})}),i.slice(3)},sourceDatasource:function(e){var t=[{name:"源IP",value:"user"},{name:"安全组",value:"system"}];return"out"===e.get("ruleType")&&(t[0].name="目的IP"),t}},require("er/util").inherits(e,t),e}),define("bcc/security/EditRuleView",["require","bat-ria/tpl!./edit_rule.tpl","bat-ria/mvc/BaseView","underscore","jquery","./config","./rule","er/util"],function(require){function e(){t.apply(this,arguments)}require("bat-ria/tpl!./edit_rule.tpl");var t=require("bat-ria/mvc/BaseView"),a=require("underscore"),i=require("jquery"),n=require("./config"),s=require("./rule"),r=new s("全部协议","all","1-65535");return e.prototype.template="TPL_bcc_security_edit_rule",e.prototype.uiProperties={portRange:n.RULE.PORTRANGE,remoteIP:n.RULE.REMOTEIP},e.prototype.uiEvents={"protocol:change":function(e){var t=e.target.getValue(),a=e.target.get("oldRawValue");"all"===t?(this.get("portRange").setValue("1-65535"),this.get("portRange").disable(),this.get("name").setValue("全部协议")):"icmp"===t?(this.get("portRange").setValue("不涉及"),this.get("portRange").disable(),this.get("name").setValue("")):(this.get("portRange").enable(),this.get("name").setValue("")),"icmp"===a&&this.get("portRange").setValue("1-65535"),e.target.set("oldRawValue",t),this.highLightBtnByKey()},"portRange:change":function(e){this.highLightBtnByKey()},"source:change":function(e){"user"===e.target.getRawValue()?(this.get("sourceUser").show(),this.get("remoteGroupId").hide()):(this.get("sourceUser").hide(),this.get("remoteGroupId").show())}},e.prototype.highLightBtnByKey=function(){var e="skin-primary-button";i("."+e).removeClass(e)},e.prototype.showRule=function(e){a.each(this.getGroup("rule"),function(t){t.setValue(e[t.id])})},e.prototype.getRuleData=function(){var e=a.reduce(this.getGroup("rule"),function(e,t){return e[t.id]=t.getValue(),e},{});return s.fromJSON(e)},e.prototype.enterDocument=function(){t.prototype.enterDocument.apply(this,arguments);var e=this;i("#commonServices .ui-button").on("click",function(t){var a="skin-primary-button",n=i(this),s=n.hasClass(a),o=s?r:e.model.get("commonServices")[i(t.target).data("index")].rules[0];e.showRule(o),i("."+a).removeClass(a),!s&&n.addClass(a)}),e.showRule(r)},require("er/util").inherits(e,t),e}),define("bcc/security/List",["require","inf-ria/mvc/ListAction","../events","underscore","inf-i18n","./ListModel","./ListView","er/URL","er/util"],function(require){function e(){s.apply(this,arguments)}function t(){this.redirect("/bcc/security/create")}function a(e){this.redirect(require("er/URL").withQuery("/bcc/security/detail",{id:e.securityId}))}function i(e){var t=o.pluck(e.data,"id"),a=o.pluck(e.data,"name").map(o.escape);this.view.waitConfirm({title:c("删除安全组"),content:[c("您确定删除安全组 “ "),a.join("、"),c("” 吗？")].join(""),width:540,needFoot:!0,encode:!1}).then(o.partial(this.model.deleteSecurityGroupByIds,t)).then(o.bind(this.reload,this))}function n(e){var t=this.view.get("table").datasource[+e.rowIndex],a=t.id,i=e.value;i!==t.desc&&this.model.updateSecurityGroupField(a,"desc",i).then(o.bind(this.reload,this))}var s=require("inf-ria/mvc/ListAction"),r=require("../events"),o=require("underscore"),c=require("inf-i18n");return e.prototype.modelType=require("./ListModel"),e.prototype.viewType=require("./ListView"),e.prototype.initBehavior=function(){s.prototype.initBehavior.apply(this,arguments),this.view.on(r.CREATE_SECURITY,t,this),this.view.on(r.EDIT_SECURITY,a,this),this.view.on(r.REFRESH,this.reload,this),this.view.on(r.DELETE_SECURITY,i,this),this.view.on(r.SAVE_EDIT,n,this)},require("er/util").inherits(e,s),e}),define("bcc/security/list.tpl",[],function(){return'\x3c!-- target: TPL_bcc_security --\x3e\n<div class="bcc-security bcc-main-wrap main-wrap-new">\n    <div class="content-wrap">\n        <p class="breadcrumb">\n            <span>产品服务</span>\n            <span class="divider">/</span>\n            <span class="active">云服务器BCC-安全组列表</span>\n        </p>\n\n        <div class="list-content">\n            <h2>安全组</h2>\n            <div class="table-full-wrap">\n                <div class="operation-wrap" data-follow-thead="table">\n                    <div class="buttons-wrap">\n                        <button data-ui-id="createSecurity"\n                                data-ui-type="Button"\n                                data-ui-skin="create">创建安全组</button>\n                        <button data-ui-type="Button"\n                                data-ui-id="deleteInstance"\n                                title="批量删除安全组">删除</button>\n                    </div>\n                    <div class="buttons-quick-wrap">\n                        \x3c!-- import: TPL_bcc_search --\x3e\n                        <button type="button"\n                            data-ui-type="Button" data-ui-id="refreshList" title="刷新表格数据">\n                            <i class="iconfont icon-cdnrefresh"></i>\n                        </button>\n                    </div>\n                </div>\n                \x3c!-- import: listEditableTableWithCommand --\x3e\n                <div class="ui-row">\n                    \x3c!-- import: listPager --\x3e\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("bcc/security/ListModel",["require","inf-ria/mvc/ListModel","../config","common/util","er/util"],function(require){function e(){t.apply(this,arguments),this.listRequester=i.bccSecurityList}var t=require("inf-ria/mvc/ListModel"),a=require("../config"),i=a.api,n=require("common/util").isSubUser();return e.prototype.datasource={menu:function(e){return"securityinfo"},isSubUser:function(e){return n}},e.prototype.defaultArgs={keywordType:a.FILTER.SECURITY.NAME.value,pageSize:a.pageSize},e.prototype.deleteSecurityGroupByIds=function(e){return i.bccSecurityBatchDelete({securityGroupIds:e})},e.prototype.updateSecurityGroupField=function(e,t,a){var n={id:e};return n[t]=a,i.bccSecurityUpdateField(n)},require("er/util").inherits(e,t),e}),define("bcc/security/ListView",["require","bat-ria/tpl!./list.tpl","inf-ria/mvc/ListView","underscore","common/util","../events","../config","common/util/tableUtil","er/util"],function(require){function e(){t.apply(this,arguments)}require("bat-ria/tpl!./list.tpl");var t=require("inf-ria/mvc/ListView"),a=require("underscore"),i=require("common/util"),n=require("../events"),s=require("../config"),r=i.isSubUser();e.prototype.template="TPL_bcc_security";var o=[{field:"name",title:"安全组名称",width:200,stable:!0,sortable:!0,content:function(e){var t=a.escape(e.name);return'<a href="#/bcc/security/detail~id='+e.id+'" title="'+t+'">'+t+"</a>"}},{title:"关联实例数量",width:150,stable:!0,content:function(e){var t=e.instances?e.instances.length:0;return t?'<a href="#/bcc/security/detail~id='+e.id+'&toPart=bccInstances">'+t+"</a>":t}},{title:"所在网络",content:function(e){return i.getVpcName(e.vpcName)}},{title:"描述",field:"desc",content:function(e){return a.escape(e.desc)},editable:1,editRules:{required:!0,maxLength:255}},{title:"操作",width:150,stable:!0,content:function(e){return function(e){var t=[];return a.each(e,function(e){if(e){var i="<a ";i+=r?'class="disabled"':'href="'+e.href+'"',e.attr&&a.each(e.attr,function(e,t){i+=" "+t+'="'+e+'"'}),i+=">"+e.text+"</a>",t.push(i)}}),t.join("&nbsp;")}([{text:"复制",href:"#/bcc/security/copy~id="+a.escape(e.id)}])}}],c=require("common/util/tableUtil"),l=s.FILTER;return e.prototype.uiProperties={keywordType:{datasource:[l.SECURITY.NAME],width:110},keyword:{placeholder:"请输入安全组名称进行搜索"},table:c.tableProperty(o,{editable:1,noDataHtml:"<div><p>没有可选择的安全组！</p></div>"}),pager:{pageSizes:[10,20,50,100]},createSecurity:{disabled:"@isSubUser"}},e.prototype.uiEvents=c.getListEvents({"keyword:enter":function(e){this.submitSearch(e)},"createSecurity:click":function(e){this.fire(n.CREATE_SECURITY)},"deleteInstance:click":function(e){this.fire(n.DELETE_SECURITY,{data:this.get("table").getSelectedItems()})},"table:select":function(e){c.setButtonStatusOfTable(this,{deleteInstance:{rule:function(e){return"默认安全组"!==e.name&&(e.instances?e.instances.length:0)<=0&&!r}}})}}),e.prototype.getSearchArgs=c.getSearchArgs,e.prototype.enterDocument=function(){t.prototype.enterDocument.apply(this,arguments)},e.prototype.initTableSelectItem=c.initTableSelectItem,require("er/util").inherits(e,t),e}),define("bcc/security/rule",["require","underscore","./services"],function(require){function e(e,t,n){this.name=e,this.protocol=t,this.portRange=n,this.remoteGroupId=null,this.remoteGroupShortId=null,this.remoteGroupName=null,this.remoteIP=a,this.source=i,this.key=this.getKey()}var t=require("underscore"),a="all",i="user";return e.prototype.equal=function(e){var t=this.protocol===e.protocol&&this.source===e.source;return t&&"icmp"!==this.protocol&&(t=t&&this.portRange===e.portRange),t&&this.source===i?t=t&&this.remoteIP===e.remoteIP:t&&"system"===this.source&&(t=t&&this.remoteGroupId===e.remoteGroupId),t?this.protocol===a&&"1-65535"===this.portRange?t:t&&this.name===e.name:t},e.prototype.clone=function(){var t=new e(this.name,this.protocol,this.portRange);return t.remoteIP=this.remoteIP,t.remoteGroupId=this.remoteGroupId,t.remoteGroupShortId=this.remoteGroupShortId||this.remoteGroupId,t.remoteGroupName=this.remoteGroupName,t.source=this.source,t.key=this.key,t},e.prototype.getKey=function(){return[this.protocol,this.portRange,this.source===i?"a-"+this.source:"b-"+this.source,this.remoteIP,this.remoteGroupId,this.name,this.remoteGroupShortId].join("#")},e.findName=function(e){var a=require("./services"),i=t.find(a,function(a){return!!t.find(a.rules,function(t){return t.protocol===e.protocol&&t.portRange===e.portRange})});return i?i.name:"tcp"===e.protocol?"自定义TCP":"udp"===e.protocol?"自定义UDP":"全部协议"},e.fromJSON=function(t){var n=t.name||"",s=""===t.protocol?a:t.protocol,r=new e(n,s,""===t.portRange?"1-65535":t.portRange);return r.source=t.source||(t.remoteGroupId?"system":i),r.remoteIP=""===t.remoteIP?a:t.remoteIP,r.remoteGroupId=t.remoteGroupId||null,r.remoteGroupName=t.remoteGroupName||null,r.remoteGroupShortId=t.remoteGroupShortId||r.remoteGroupId,r.source===i?(r.remoteGroupId=null,r.remoteGroupName=null):"system"===r.source&&(r.remoteIP=null),"icmp"===s&&(r.portRange="不涉及"),r.key=r.getKey(),r},e.toJSON=function(e,t){var n=e.source.toLowerCase()===i?e.remoteIP:null,s=e.source.toLowerCase()===i?null:e.remoteGroupId,r=e.protocol.toLowerCase()===a?"":e.protocol,o=e.portRange;return""===r?o="":"icmp"===r&&(o=null),{name:e.name,protocol:r,portRange:o===a?"1-65535":o,direction:t,remoteIP:n===a?"":n,remoteGroupId:s}},e}),define("bcc/security/services",["require","./rule"],function(require){var e=require("./rule");return[{name:"全部协议",key:"CustomAll",rules:[new e("全部协议","all","1-65535")]},{name:"自定义TCP",key:"CustomTCP",rules:[new e("自定义TCP","tcp","1-65535")]},{name:"自定义UDP",key:"CustomUDP",rules:[new e("自定义UDP","udp","1-65535")]},{name:"PING请求",key:"PING",rules:[new e("PING请求","icmp","不涉及")]},{name:"SSH远程终端",key:"SSH",rules:[new e("SSH远程终端","tcp","22")]},{name:"HTTP服务",key:"HTTP",rules:[new e("HTTP服务","tcp","80")]},{name:"HTTPS服务",key:"HTTPS",rules:[new e("HTTPS服务","tcp","443")]},{name:"FTP文件传输",key:"FTP",rules:[new e("FTP文件传输","tcp","21"),new e("FTP文件传输","tcp","20")]},{name:"RDP远程桌面",key:"RDP",rules:[new e("RDP远程桌面","tcp","3389")]},{name:"DNS服务",key:"DNS",rules:[new e("DNS服务","tcp","53"),new e("DNS服务","udp","53")]},{name:"POP3邮件接收服务",key:"POP3",rules:[new e("POP3邮件接收服务","tcp","110")]},{name:"MySQL数据库",key:"MYSQL",rules:[new e("MySQL数据库","tcp","3306")]},{name:"SQL Server数据库",key:"SQL Server",rules:[new e("SQL Server数据库","tcp","1433")]},{name:"SNMP",key:"SNMP",rules:[new e("SNMP","tcp","161"),new e("SNMP","udp","161")]},{name:"SMTP邮件发送服务",key:"SMTP",rules:[new e("SMTP邮件发送服务","tcp","25")]},{name:"SNMP Trap",key:"SNMP Trap",rules:[new e("SNMP Trap","tcp","162"),new e("SNMP Trap","udp","162")]}]}),define("bcc/snapshot/config",["require","lodash","inf-ui/sanPage","common/component/action_category","er/controller"],function(require){var e=require("lodash"),t=require("inf-ui/sanPage"),a=require("common/component/action_category"),i=[{type:"bcc/snapshot/List",path:"/bcc/snapshot/list"},{type:"bcc/snapshot/List",path:"/bcc/snapshot/disk"},{type:"bcc/snapshot/List",path:"/bcc/snapshot/instance"},{type:"bcc/snapshot/Create",path:"/bcc/snapshot/create"},{type:"bcc/snapshot/CreateImage",path:"/bcc/snapshot/create_image"},{type:t("bcc/snapshot/policy/List"),path:"/bcc/snapshot/policyList"},{type:t("bcc/snapshot/policy/Update"),path:"/bcc/snapshot/updatePolicy"},{type:t("bcc/snapshot/policy/RelateDisks"),path:"/bcc/snapshot/relateDisk"},{type:t("bcc/snapshot/policy/RelatePolicys"),path:"/bcc/snapshot/relatePolicy"},{type:t("bcc/snapshot/policy/ASPList"),path:"/bcc/snapshot/aspList",category:a.LIST}];e.each(i,function(e){e.skipRegionCheck=!0});require("er/controller").registerAction(i);return{}}),define("bcc/snapshot/Create",["require","bat-ria/mvc/FormAction","./CreateModel","./CreateView","er/util"],function(require){function e(){a.apply(this,arguments)}function t(e){var t=e.instance;this.model.set("instance",t)}var a=require("bat-ria/mvc/FormAction");return e.prototype.modelType=require("./CreateModel"),e.prototype.viewType=require("./CreateView"),e.prototype.submit=function(e){var t=a.prototype.submit.apply(this,arguments),i=this;return t.done(function(){var e=i.view&&i.view.get("form");e&&e.fire("aftermanualvalidate",{isValid:!1})}),t},e.prototype.redirectAfterSubmit=function(){this.model.get("parentAction").reload()},e.prototype.initBehavior=function(){a.prototype.initBehavior.apply(this,arguments),this.view.on("INSTANCE_CHANGE",t,this);var e=this.model.get("instance")||this.model.get("instanceList")[0];this.view.fire("INSTANCE_CHANGE",{instance:e})},require("er/util").inherits(e,a),e}),define("bcc/snapshot/create.tpl",[],function(){return'\x3c!-- target: TPL_bcc_snapshot_create --\x3e\n<div class="bcc-dialog-form bcc-snapshot-create-form">\n    <form data-ui-type="Form" data-ui-id="form"\n        data-ui-auto-validate="true">\n        <div class="form-data-body">\n            <div class="form-row" id="instance-notice" style="display:none">\n                <div class="operation-tip">${i18n.温馨提示：创建快照会重启服务器，导致服务器停止几分钟，}\n                    ${i18n.为保证你的服务不受影响，请在确认执行此操作前做好预案准备。}</div>\n            </div>\n            \x3c!-- if: ${instanceId} --\x3e\n            <div class="form-row">\n                <div class="form-key">${i18n.实例ID：}</div>\n                <div class="form-value form-nowrap-text">\n                    ${instance.instanceId}\n                </div>\n            </div>\n            \x3c!-- else --\x3e\n            <div class="form-row">\n                <div class="form-key">${i18n.快照类型：}</div>\n                <div class="form-value">\n                    <div data-ui-type="Select"\n                         data-ui-name="diskType"\n                         data-ui-id="diskType"\n                         data-ui-width="120"\n                         data-ui-datasource="@diskTypeList">\n                    </div>\n                </div>\n            </div>\n            <div data-ui-type="Panel" data-ui-id="instancePanel" class="form-row">\n                <div class="form-key">${i18n.磁盘ID：}</div>\n                <div class="form-value">\n                    <div data-ui-type="Select"\n                         data-ui-name="instanceId"\n                         data-ui-id="instanceId"\n                         data-ui-width="283"\n                         data-ui-disabled="@instanceIdDisabled"\n                         data-ui-datasource="@instanceList">\n                    </div>\n                </div>\n            </div>\n            <div data-ui-type="Panel" data-ui-id="diskPanel" class="form-row">\n                <div class="form-key">${i18n.磁盘ID：}</div>\n                <div class="form-value">\n                    <div data-ui-type="Select"\n                         data-ui-name="diskId"\n                         data-ui-id="diskId"\n                         data-ui-width="283"\n                         data-ui-disabled="@diskIdDisabled"\n                         data-ui-datasource="@diskList">\n                    </div>\n                </div>\n            </div>\n            \x3c!-- /if --\x3e\n            <div class="form-row">\n                <div class="form-key">${i18n.快照名称：}</div>\n                <div class="form-value">\n                    <input\n                        data-ui-required-error-message="${i18n.快照名称必填}"\n                        data-ui-required="required"\n                        data-ui-type="TextBox"\n                        data-ui-id="name"\n                        data-ui-name="name"\n                        data-ui-width="370" />\n                    <div data-ui-type="Label" data-ui-id="nameNote" class="bcc-note"></div>\n                    <label data-ui-type="Validity"\n                        data-ui-id="nameValidity"></label>\n                </div>\n            </div>\n        </div>\n    </form>\n</div>\n\n\x3c!-- target: TPL_bcc_snapshot_create_child --\x3e\n\x3c!-- import: TPL_bcc_snapshot_create --\x3e\n'}),define("bcc/snapshot/CreateImage",["require","bat-ria/mvc/FormAction","./CreateImageModel","./CreateImageView","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("bat-ria/mvc/FormAction");return e.prototype.modelType=require("./CreateImageModel"),e.prototype.viewType=require("./CreateImageView"),e.prototype.redirectAfterSubmit=function(){this.model.get("parentAction").reload()},e.prototype.initBehavior=function(){t.prototype.initBehavior.apply(this,arguments)},require("er/util").inherits(e,t),e}),define("bcc/snapshot/createImage.tpl",[],function(){return'\x3c!-- target: TPL_bcc_snapshot_createImage --\x3e\n<div class="bcc-dialog-form image-create">\n    <form data-ui-type="Form" data-ui-id="form"\n        data-ui-auto-validate="true">\n        <div class="form-data-body">\n            <div class="form-row">\n                <div class="operation-tip">\n                    1.\t创建的自定义镜像将只包含系统盘的内容，不包括本地磁盘的数据。<br />\n                    2.\t创建完毕后，请在“<a href="#/bcc/image/list" data-redirect="global">镜像</a>”列表中查看管理创建的自定义镜像。&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n                </div>\n            </div>\n            <div class="form-row">\n                <div class="form-key">实例ID：</div>\n                <div class="form-value form-nowrap-text">${instanceId}</div>\n            </div>\n            <div class="form-row">\n                <div class="form-key">快照ID：</div>\n                <div class="form-value form-nowrap-text">${snapshotId}</div>\n            </div>\n            <div class="form-row">\n                <div class="form-key">自定义镜像名称：</div>\n                <div class="form-value">\n                    <input data-ui-type="TextBox" data-ui-id="name"\n                        data-ui-name="name" data-ui-width="350" />\n                    <div data-ui-type="Label" data-ui-id="nameNote" class="bcc-note"></div>\n                    <label data-ui-type="Validity"\n                        data-ui-id="nameValidity"></label>\n                </div>\n            </div>\n            \x3c!--<div class="form-row">--\x3e\n                \x3c!--<div class="form-key">自定义镜像描述：</div>--\x3e\n                \x3c!--<div class="form-value">--\x3e\n                    \x3c!--<textarea data-ui-type="TextBox" data-ui-id="desc"--\x3e\n                           \x3c!--data-ui-name="desc" data-ui-width="300" data-ui-height="100"></textarea>--\x3e\n                \x3c!--</div>--\x3e\n            \x3c!--</div>--\x3e\n        </div>\n    </form>\n</div>\n\n\x3c!-- target: TPL_bcc_snapshot_createImage_child --\x3e\n\x3c!-- import: TPL_bcc_snapshot_createImage --\x3e\n'}),define("bcc/snapshot/CreateImageModel",["require","bat-ria/mvc/FormModel","../config","er/util"],function(require){function e(){t.apply(this,arguments),this.submitRequester=a.bccSnapshotCreateImage}var t=require("bat-ria/mvc/FormModel"),a=require("../config").api;return e.prototype.getExtraData=function(){return{instanceId:this.get("instanceUuid"),snapshotId:this.get("snapshotUuid")}},e.prototype.datasource=null,require("er/util").inherits(e,t),e}),define("bcc/snapshot/CreateImageView",["require","bat-ria/tpl!./createImage.tpl","bat-ria/mvc/FormView","../config","er/util"],function(require){function e(){t.apply(this,arguments)}require("bat-ria/tpl!./createImage.tpl");var t=require("bat-ria/mvc/FormView");e.prototype.template="TPL_bcc_snapshot_createImage";var a=require("../config").RULE.NAME;return e.prototype.uiProperties={name:{placeholder:a.placeholder,required:"required",requiredErrorMessage:"自定义镜像名称必填",pattern:a.pattern,patternErrorMessage:a.patternErrorMessage,validityLabel:"nameValidity"},nameNote:{text:a.note}},e.prototype.uiEvents={},require("er/util").inherits(e,t),e}),define("bcc/snapshot/CreateModel",["require","bat-ria/mvc/FormModel","underscore","../config","moment","../enum","er/util"],function(require){function e(){t.apply(this,arguments),this.submitRequester=n.bccSnapshotCreate}var t=require("bat-ria/mvc/FormModel"),a=require("underscore"),i=require("../config"),n=i.api,s=i.SNAPSHOT_STATUS,r=i.DISK_STATUS,o=i.DISK_TYPE,c=require("moment"),l=require("../enum").ImageType;return e.prototype.filterData=function(e){return this.get("instanceId")?e.instanceId=this.get("instance").id:(e.diskType=undefined,this.get("diskType")===o.SYSTEM?(e.diskId=undefined,this.submitRequester=n.bccSnapshotCreate):(e.instanceId=undefined,this.submitRequester=n.bccCdsSnapshotCreate)),e},e.prototype.datasource={diskTypeList:function(){return[{name:o.SNAPSHOT_TXT[o.SYSTEM],value:o.SYSTEM},{name:o.SNAPSHOT_TXT[o.CDS],value:o.CDS}]},instance:function(e){var t=e.get("instanceId");if(t)return n.bccInstanceDetail({instanceId:t}).then(function(e){return e.instanceId=e.instanceId||t,e})},instanceList:function(e){if(!e.get("instanceId"))return n.bccDiskList({diskType:o.SYSTEM}).then(function(e){return a.filter(e.result,function(e){return e.name=e.volumeId,e.value=e.instanceUuid,e.imageType!==l.MKT&&(e.status===r.AVAILABLE||e.status===r.IN_USE)})})},diskList:function(e){if(!e.get("instanceId"))return n.bccDiskList({diskType:o.CDS}).then(function(e){return a.filter(e.result,function(e){return e.name=e.volumeId,e.value=e.id,e.status!==s.ERROR&&!a.contains(s.DOING_STATUS,e.status)&&!a.contains(s.CAN_DO_NOTHING,e.status)})})}},e.prototype.prepare=function(){this.set("diskType",o.SYSTEM),this.set("randomName","snapshot"+c().format("YYYYMMDD")+Math.floor(1e4*Math.random()).toString()),this.get("instanceList")&&0===this.get("instanceList").length&&this.set("instanceIdDisabled",!0),this.get("diskList")&&0===this.get("diskList").length&&this.set("diskIdDisabled",!0)},require("er/util").inherits(e,t),e}),define("bcc/snapshot/CreateView",["require","bat-ria/tpl!./create.tpl","bat-ria/mvc/FormView","inf-i18n","../config","er/util"],function(require){function e(){t.apply(this,arguments)}require("bat-ria/tpl!./create.tpl");var t=require("bat-ria/mvc/FormView"),a=require("inf-i18n"),i=require("../config"),n=i.DISK_TYPE;e.prototype.template="TPL_bcc_snapshot_create";var s=i.RULE.NAME;return e.prototype.uiProperties={name:{placeholder:s.placeholder,pattern:s.pattern,patternErrorMessage:s.patternErrorMessage,value:"@randomName",validityLabel:"nameValidity"},nameNote:{text:a(s.note)}},e.prototype.uiEvents={"instanceId:change":function(e){var t=this.get("instanceId");this.fire("INSTANCE_CHANGE",{instance:t.getSelectedItem()})},"diskType:change":function(e){var t=e.target.datasource[e.target.selectedIndex];this.model.set("diskType",t.value),t.value===n.SYSTEM?(this.get("instancePanel").show(),this.get("diskPanel").hide()):(this.get("instancePanel").hide(),this.get("diskPanel").show())}},e.prototype.enterDocument=function(){t.prototype.enterDocument.apply(this,arguments),this.get("diskPanel")&&this.get("diskPanel").hide()},require("er/util").inherits(e,t),e}),define("bcc/snapshot/List",["require","../mvc/ListAction","moment","underscore","er/util","common/constants","../events","../../common/util/dialog","../util","../config","./ListModel","./ListView","../operations","er/URL"],function(require){function e(){l.apply(this,arguments),this.on("beforemodelload",this.beforemodelload)}function t(e){return e.type===T.SYSTEM}function a(e){var t=this,a=this.model.get("tableData")[parseInt(e.rowIndex,10)],i="snapshot.rename",n={name:e.value,snapshotId:a.id};a.type===T.SYSTEM?n.instanceId=a.instanceUuid:(n.diskId=a.diskId,i="cds.snapshot.rename"),S.handler(i,this.view,n,null,function(e){t.view.get("table").showEditError(e.field.name)})}function i(e){var t=this.model.get("instance"),a=this.model.get("disk");a?a.type===T.SYSTEM?S.instanceCreateSnapshot.call(this,{instanceId:a.instanceId}):S.cdsCreateSnapshot.call(this,{diskId:a.id,volumeId:a.volumeId,diskType:a.type,attachment:a.attachment,instanceId:a.instanceId,instanceUuid:a.instanceUuid}):t?S.instanceCreateSnapshot.call(this,{instanceId:t.id}):S.instanceCreateSnapshot.call(this,{})}function n(e){var a,i=this,n=i.view.get("table").datasource[e.itemIndex],r=d(n.createTime).format(f.TIME_FORMAT);t(n)?b.bccInstanceDetail({instanceId:n.instanceUuid}).then(function(e){a='系统盘在"'+r+'"后的所有更新内容将被清除，确定回滚吗？',e.status===y.ACTIVE&&(a+="回滚快照需要先停止实例，导致服务器停止几分钟，为保证你的服务不受影响，请在确认执行此操作前做好预案准备。"),s.call(i,{operation:"snapshot.rollback",message:a,data:{instanceId:n.instanceUuid,snapshotId:n.id},item:n})}):b.bccDiskDetail({diskId:n.diskId}).then(function(e){a='回滚后云磁盘"'+e.name+'"在"'+r+'"后的数据将丢失，确定回滚吗？',s.call(i,{operation:"cds.snapshot.rollback",message:a,data:{diskId:n.diskId,snapshotId:n.id},item:n})})}function s(e){var a=t(e.item),i={snapshotId:e.item.id};a?i.instanceId=e.item.instanceUuid:i.diskId=e.item.diskId,h.waitActionDialog(this.view,{title:"回滚前确认",width:500,needFoot:!0,url:"/bcc/instance/require_auth_code",actionOptions:{extraData:i,requester:a?b.bccSnapshotRollback:b.bccCdsSnapshotRollback,tip:e.message,parentAction:this,needRedirectAfterSubmit:!0}}).then(function(e){var t=e.target;t.getFoot().getChild("btnOk").on("click",function(){t.hide()})})}function r(e){var t=this.view.get("table").datasource[e.itemIndex];S.snapshotCreateImage.call(this,{instanceId:t.instanceId,instanceUuid:t.instanceUuid,snapshotId:t.snapshotId,snapshotUuid:t.id})}function o(e){var t=this.view.get("table").datasource[e.itemIndex];this.redirect(require("er/URL").withQuery("/bcc/cds/create",{snapshotId:t.id,snapshotName:t.name,diskSize:t.size}))}function c(e){e.selectedItems&&e.selectedItems.length&&h.waitActionDialog(this.view,{title:"删除前确认",width:500,needFoot:!0,url:"/bcc/instance/require_auth_code",actionOptions:{extraData:function(e){for(var a,i={vmSnapsots:[],cdsSnapsots:[]},n=e.length-1;n>=0;n--)(a=e[n]).id&&(t(a)?i.vmSnapsots.push({instanceId:a.instanceUuid,snapshotId:a.id}):i.cdsSnapsots.push({diskId:a.diskId,snapshotId:a.id}));return i}(e.selectedItems),requester:b.bccSnapshotBatchDelete,tip:"快照删除后不可恢复，确定删除吗？",parentAction:this}}).then(function(e){var t=e.target;t.getFoot().getChild("btnOk").on("click",function(){t.hide()})})}var l=require("../mvc/ListAction"),d=require("moment"),u=require("underscore"),p=require("er/util"),f=require("common/constants"),m=require("../events"),h=require("../../common/util/dialog"),g=require("../util"),v=require("../config"),b=v.api,y=v.INSTANCE_STATUS,T=v.DISK_TYPE,x=v.SYSTEM_SNAPSHOT_STATUS,I=v.SNAPSHOT_STATUS;e.prototype.modelType=require("./ListModel"),e.prototype.viewType=require("./ListView"),e.prototype.beforemodelload=function(){var e=this.context.url.getPath(),t=this.model;"/bcc/snapshot/list"===e?t.set("SnapshotList",!0):"/bcc/snapshot/instance"===e?t.set("instanceSnapshotTab",!0):"/bcc/snapshot/disk"===e&&t.set("diskSnapshotTab",!0)};var S=require("../operations");return e.prototype.deleteSnapshot=function(e){var a=this.view.get("table").datasource[e.itemIndex],i={snapshotId:a.id};t(a)?i.instanceId=a.instanceUuid:i.diskId=a.diskId,h.waitActionDialog(this.view,{title:"删除前确认",width:600,needFoot:!0,url:"/bcc/instance/require_auth_code",actionOptions:{extraData:i,requester:b.bccSnapshotDelete,tip:"快照删除后不可恢复，确定删除吗？",parentAction:this}}).then(function(e){var t=e.target;t.getFoot().getChild("btnOk").on("click",function(){t.hide()})})},e.prototype.refreshTableStatus=function(e){var a=this.view.get("table");this.model.listRequester(this.model.getQuery(),{"X-silence":!0}).then(function(i){i&&i.result&&i.result.length>0&&u.each(a.datasource,function(n,s){var r=t(i.result[s])?x:I,o=i.result[s]&&i.result[s].id===n.id&&i.result[s].status||n.status;if(n.status!==o){var c=['<span class="',r.CLASS[o]||"status error",'">',r.TXT[o]||o,"</span>"].join("");a.setCellText(c,s,e,!1),n.status=o}})})},e.prototype.redirectAfterDelete=function(){this.redirect(this.getURLForPage(this.model.get("pageNo")||1))},e.prototype.setIntervalListenStatus=function(){var e=g.getStatusColumnIndex(this.view.get("table"),"status");this.timer=setInterval(p.bind(function(){this.refreshTableStatus(e)},this),v.BCC_LISTEN_INTERVAL)},e.prototype.initBehavior=function(){l.prototype.initBehavior.apply(this,arguments),this.view.on(m.FILTER,this.filterList,this),this.view.on(m.REFRESH,this.reload,this),this.view.on(m.DELETE_SNAPSHOT,this.deleteSnapshot,this),this.view.on(m.BATCH_DELETE_SNAPSHOT,c,this),this.view.on(m.SAVE_EDIT,a,this),this.view.on(m.CREATE_SNAPSHOT,i,this),this.view.on(m.ROLLBACK_SNAPSHOT,n,this),this.view.on(m.CREATE_IMAGE,r,this),this.view.on(m.CREATE_DISK,o,this),this.view.initTableSelectItem("id",this.model.get("id")),this.setIntervalListenStatus(),this.on("beforeleave",function(){clearInterval(this.timer)},this)},e.prototype.syncModelToViewIterator=function(e){switch(e.name){case"createDisabled":this.view.setCreateButtonStatus(e.newValue)}},e.prototype.filterList=function(e){this.model.setFilters(e.condition),this.view.submitSearch(e)},e.prototype.filterRedirect=function(e){if(this.context.isChildAction&&e.getPath()!==this.context.url.getPath())return location.href="/bcc/"+location.search+"#"+e.toString(),!1},require("er/util").inherits(e,l),e}),define("bcc/snapshot/list.tpl",[],function(){return'\x3c!-- target: TPL_bcc_snapshot --\x3e\n<div class="bcc-snapshot bcc-main-wrap main-wrap-new">\n    <div class="content-wrap">\n\n        ${*breadcrumb|makebreadcrumb}\n\n        \x3c!-- if: ${showType} == \'instance\' --\x3e\n        <div class="instance-info">\n            <h1 title="${instance.name}">${instance.name}</h1>\n            <span class="${statusClass}">${statusDesc}</span>\n        </div>\n        \x3c!-- elif: ${showType} == \'disk\' --\x3e\n        <div class="instance-info">\n            <h1 title="${disk.name}">${disk.name}</h1>\n            <span class="${statusClass}">${statusDesc}</span>\n        </div>\n        \x3c!-- /if --\x3e\n\n        \x3c!-- if: ${showType} == \'snapshot\' --\x3e\n        <div class="list-content">\n            <h2>${i18n.快照列表}</h2>\n            \x3c!-- import: TPL_bcc_snapshot_list_body--\x3e\n        </div>\n        \x3c!-- else --\x3e\n        <div class="detail-content">\n            <div class="ui-tab-content">\n            \x3c!-- import: TPL_bcc_snapshot_list_body--\x3e\n            </div>\n        </div>\n        \x3c!-- /if --\x3e\n    </div>\n</div>\n\n\x3c!-- target: TPL_bcc_snapshot_child --\x3e\n\x3c!-- import: TPL_bcc_snapshot_list_body --\x3e\n\n\x3c!-- target: TPL_bcc_snapshot_list_body --\x3e\n<div class="table-full-wrap">\n    <div class="operation-wrap" data-follow-thead="table">\n        <div class="buttons-wrap">\n            <div data-ui-id="createSnapshot" data-ui-type="Button" data-ui-skin="create"\n            data-ui-extension-popover-type="PopoverEx">${i18n.创建快照}</div>\n            <div data-ui-type="Button"\n                    data-ui-id="deleteSnapshot"\n                    data-ui-extension-popover-type="PopoverEx"\n                    title="${i18n.批量删除快照}">${i18n.删除所选快照}</div>\n        </div>\n\n        <div class="buttons-quick-wrap">\n            \x3c!-- import: TPL_bcc_search --\x3e\n            <button type="button"\n                data-ui-type="Button" data-ui-id="refreshList" title="${i18n.刷新表格数据}">\n                <i class="iconfont icon-cdnrefresh"></i>\n            </button>\n        </div>\n    </div>\n    <div data-ui-type="Table" data-ui-id="table"\n         data-ui-datasource="@tableData"\n         data-ui-order-by="@orderBy" data-ui-order="@order"\n         data-ui-select="@selectMode" data-ui-extension-tip-type="TableTip"\n         data-ui-extension-command-type="Command"\n         data-ui-extension-tableedit-type="TableEdit"\n         data-ui-extension-tablefilter-type="TableFilter">\n    </div>\n    <div class="ui-row clearfix">\n        \x3c!-- import: listPager --\x3e\n    </div>\n</div>\n'}),define("bcc/snapshot/ListModel",["require","../mvc/ListModel","underscore","common/util/PermissionChecker","../config","../enum","./rules","er/events","er/util"],function(require){function e(){t.apply(this,arguments),this.listRequester=c.bccSnapshotList}var t=require("../mvc/ListModel"),a=require("underscore"),i=require("common/util/PermissionChecker"),n=require("../config"),s=require("../enum"),r=require("./rules"),o=s.ImageType,c=n.api,l=n.INSTANCE_STATUS,d={"x-silent":!0};return e.prototype.datasource={tab:function(){return{snapshot:"ui-tab-item-active"}},instance:function(e){if(e.get("instanceSnapshotTab")&&e.get("instanceId"))return c.bccInstanceDetail({instanceId:e.get("instanceId")})},disk:function(e){if(e.get("diskSnapshotTab"))return c.bccDiskDetail({diskId:e.get("diskId"),instanceId:e.get("instanceId")},{globalFailCallback:function(){require("er/events").fire("globalError",{service:"CDS"})}})}},e.prototype.setFilters=function(e){this.set("filters",e)},e.prototype.filterQuery=function(e){var t=[];if(e.filters){var i=e.filters;delete e.filters;try{i=JSON.parse(i)}catch(n){}a.each(i,function(e){t.push({keywordType:e[0],keyword:e[1]})})}return e.keyword&&t.push({keywordType:e.keywordType,keyword:e.keyword}),e.filters=t,e.pageNo&&(e.pageNo=+e.pageNo),e},e.prototype.getExtraQuery=function(){var e=this.get("instanceId"),t=this.get("diskId");return e?{instanceId:e}:t?{diskId:t}:void 0},e.prototype.prepare=function(){var e,t=this,s=this.get("filters");if("string"==typeof s){try{s=JSON.parse(s)}catch(b){}this.set("filters",s,{silent:!0})}var c=i.check(r,[],"createSnapshot",{instance:this.get("instance"),disk:this.get("disk")});if(t.set("createDisabled",c.createSnapshot),t.get("instanceSnapshotTab")){t.set("showType","instance"),t.set("breadcrumb",[{title:"云服务器BCC-实例列表",href:"#/bcc/instance/list"},"本实例快照"]);e=t.get("instance").status,t.set("statusDesc",l.TXT[e]||e),t.set("statusClass",l.CLASS[e])}else if(t.get("diskSnapshotTab")){t.set("showType","disk");var d=n.DISK_TYPE,u=n.DISK_STATUS,p=n.SYSTEM_DISK_STATUS,f=t.get("disk"),m=f.type===d.SYSTEM;t.set("isSystemDisk",m),t.set("breadcrumb",[{title:"云磁盘CDS-磁盘列表",href:"#/bcc/instance/list"},(m?"系统":"CDS")+"磁盘快照"]);var h=m?p:u;this.set("statusDesc",h.TXT[f.status]||(m?"正常":f.status)),this.set("statusClass",h.CLASS[f.status]||"status error"),this.set("createSnapshotDisable",m?!a.contains(p.CAN_CREATE_SNAPSHOT,f.status)||f.imageType===o.MKT:f.status===u.ERROR||a.contains(u.DOING_STATUS,f.status)||a.contains(u.CAN_DO_NOTHING,f.status));for(var g=this.store.tableData,v=g.length-1;v>=0;v--)g[v].diskStatus=f.status}else t.set("showType","snapshot"),t.set("breadcrumb",["云服务器BCC-快照列表"]),this.getDisks().then(function(e){t.set("createDisabled",{disable:e.totalCount<1,message:e.totalCount<1?"当前还没有系统盘和云磁盘":""})}).fail(function(e){t.set("createDisabled",{disable:!0})});this.set("menu",this.get("showType"))},e.prototype.getDisks=function(){return c.bccDiskList({},d)},e.prototype.defaultArgs={keywordType:n.FILTER.SNAPSHOT.NAME.value,order:"desc",orderBy:"createTime",pageSize:n.pageSize},require("er/util").inherits(e,t),e}),define("bcc/snapshot/ListView",["require","bat-ria/tpl!./list.tpl","../mvc/ListView","underscore","etpl","jquery","inf-i18n","common/util/tableUtil","common/util/timeUtil","common/util/PermissionChecker","../events","../config","../util","./rules","er/util"],function(require){function e(){n.apply(this,arguments)}function t(e){var t=e.get("instance"),n=e.get("disk");return[{field:"name",breakLine:1,width:"17%",title:r("快照名称/ID"),sortable:!0,content:function(e,t,a){var i=l.check(f,e,d.SAVE_EDIT)[d.SAVE_EDIT].disable?'<span class="ui-table-cell-editentry"data-row="'+t+'" data-col="'+a+'"><i class="iconfont icon-edit"></i></span>':"",n=s.escape(e.name);return'<span title="'+n+'" class="instance-name">'+n+"</span>"+i+"<br/><span>"+(e.snapshotId||e.id)+"</span>"},editable:function(e){return l.check(f,e,d.SAVE_EDIT)[d.SAVE_EDIT].disable},editContent:function(e){return s.escape(e.name)},editRules:s.omit(u.RULE.NAME,"placeholder"),editNote:u.RULE.NAME.placeholder},{field:"diskId",title:r("磁盘ID"),width:"15%",sortable:!0,content:function(e){return e.volumeId=e.volumeId||e.diskId,e.instanceId=e.instanceId||e.instanceUuid,"MIGRATION"===e.createMethod?'<span class="instance-id" title="'+e.volumeId+'">'+e.volumeId+"</span>":e.instanceUuid?'<a href="#/bcc/cds/detail~instanceId='+e.instanceUuid+'" class="instance-id" title="'+e.volumeId+'">'+e.volumeId+"</a>":e.diskId?'<a href="#/bcc/cds/detail~diskId='+e.diskId+'" class="instance-id" title="'+e.volumeId+'">'+e.volumeId+"</a>":"-"}},{field:"createTime",title:r("创建时间"),width:"11%",minWidth:96,sortable:!0,content:function(e){return c.toTime(e.createTime)}},{field:"status",title:r("进度/状态"),width:"9%",minWidth:75,content:function(e){var t=a(e)?h:g;return s.contains([v.ROLLBACK_SNAPSHOT,v.TEMPLATE])?'<span class="'+(v.CLASS[e.instanceStatus]||"status error")+'">'+(v.TXT[e.instanceStatus]||e.instanceStatus)+"</span>":'<span class="'+(t.CLASS[e.status]||"status error")+'">'+(t.TXT[e.status]||e.status)+"</span>"}},{field:"type",title:r("类型"),width:"9%",minWidth:97,filter:{datasource:[{name:r("全部"),value:""},{name:r("系统盘"),value:"system"},{name:r("数据盘"),value:"cds"}]},content:function(e){return b.SNAPSHOT_TXT[e.type]&&b.SNAPSHOT_TXT[e.type]+"快照"||e.type||""}},{title:r("容量"),width:"8%",content:function(e){return e.size?s.escape(e.size)+"GB":"-"}},{title:r("创建方式"),width:"8%",content:function(e){return y.TXT[e.createMethod]||e.createMethod||""}},{title:r("操作"),width:"18%",stable:!0,content:function(e,s){var o=l.check(f,e,"",{instance:t,disk:n}),c=a(e),u=T(e),p="";return c?(p=i({label:r("创建自定义镜像"),command:d.CREATE_IMAGE,args:s,permission:o[d.CREATE_IMAGE]}),u&&(p+=i({label:r("创建CDS磁盘"),command:d.CREATE_DISK,args:s,permission:o[d.CREATE_DISK]}))):p=i({label:r("创建CDS磁盘"),command:d.CREATE_DISK,args:s,permission:o[d.CREATE_DISK]}),(e.volumeId||c)&&(p+=i({label:r("回滚快照"),command:d.ROLLBACK_SNAPSHOT,args:s,permission:o[d.ROLLBACK_SNAPSHOT]})),p}}]}function a(e){return e.type===b.SYSTEM}function i(e){return e.permission.disable?'<span class="opration"><span data-ui-type="Button"data-ui-id="'+e.command+e.args+'"data-ui-disabled="true" data-ui-extension-popover-type="PopoverEx"data-ui-popover="'+e.permission.message+'" class="cmd-button state-disabled">'+e.label+"</span></span>":'<span class="opration"><button data-command="'+e.command+'"data-command-args="'+e.args+'"class="cmd-button">'+e.label+"</button></span>"}require("bat-ria/tpl!./list.tpl");var n=require("../mvc/ListView"),s=require("underscore"),r=(require("etpl"),require("jquery"),require("inf-i18n")),o=require("common/util/tableUtil"),c=require("common/util/timeUtil"),l=require("common/util/PermissionChecker"),d=require("../events"),u=require("../config"),p=require("../util"),f=require("./rules"),m=u.FILTER,h=u.SYSTEM_SNAPSHOT_STATUS,g=u.SNAPSHOT_STATUS,v=u.INSTANCE_STATUS,b=u.DISK_TYPE,y=u.CREATE_METHOD,T=p.isRocV2Disk;return e.prototype.template="TPL_bcc_snapshot",e.prototype.getUIProperties=function(){return{createSnapshot:{disabled:"@createDisabled.disable",popover:"@createDisabled.message"},keywordType:{datasource:[m.SNAPSHOT.NAME,m.DISK.ID]},keyword:{placeholder:r("请输入快照名称进行搜索")},table:o.tableProperty(t(this.model),{editable:1,noDataHtml:"<div><p>"+r("没有可选择的快照！")+"</p></div>"}),pager:{pageSizes:[10,20,50,100]}}},e.prototype.getInstanceId=function(){return this.model.get("instanceId")},e.prototype.uiEvents=o.getListEvents({"keyword:enter":function(e){this.submitSearch(e)},"createSnapshot:click":function(e){this.fire(d.CREATE_SNAPSHOT,{instanceId:this.getInstanceId()})},"deleteSnapshot:click":function(e){this.fire(d.BATCH_DELETE_SNAPSHOT,{selectedItems:this.get("table").getSelectedItems()})},"table:select":function(e){var t=this.get("table").getSelectedItems(),a=l.check(f,t,"deleteSnapshot");o.setButtonStatusAndTip(this,a,t)},"table:command":function(e){this.fire(e.name,{itemIndex:+e.args})},"table:filter":function(e){var t=this.get("table").fields[e.fieldIndex],a=this.model.get("filters")||[],i=s.reject(a,function(e){return e[0]===t.field});i.push([t.field,e.value]),this.fire(d.FILTER,{condition:i})}}),e.prototype.enterDocument=function(){this.setTableFilterValue(),n.prototype.enterDocument.apply(this)},e.prototype.getSearchArgs=function(){var e=o.getSearchArgs.call(this),t=this.model.get("filters");return t&&t.length>0&&(e.filters=JSON.stringify(t)),e},e.prototype.setTableFilterValue=function(){var e=this.model.get("filters"),a=t(this.model);e&&e.length>0?s.each(a,function(t){t.filter&&s.each(e,function(e){return e[0]===t.field&&(t.filter.value=e[1])})}):s.each(a,function(e){e.filter&&(e.filter.value=null)})},e.prototype.initTableSelectItem=o.initTableSelectItem,e.prototype.setCreateButtonStatus=function(e){var t=this.get("createSnapshot");t&&(t.setDisabled(e.disable),t.popover=e.message)},require("er/util").inherits(e,n),e}),define("bcc/snapshot/policy/ASPList",["exports","module","lodash","babel-runtime/helpers/interop-require-default","san","inf-ui/x/biz/helper","inf-ui/appui","san-xui","../../enum","../../util","common/util","../../config","./fields"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d){var u=t["default"](e),p=t["default"](o),f=null;module.exports=a.defineComponent({template:'<template>\n<app-view class="no-sidebar snapshot-policy-list">\n    <app-sidebar menu="{{sidebarMenu}}" san-if="sidebarMenu" />\n    <div class="content-wrap san-page">\n        <div class="list-content">\n            <div>\n                <h2>{{\'自动快照策略列表\' | i18n}}\n                    <span class="quota-tip">{{\'(已建\' | i18n}}{{quota.aspCreated}}{{\'个策略；共可建\' | i18n}}\n                        {{quota.aspTotal}}{{\'个策略)\' | i18n}}</span>\n                    <a href="https://cloud.baidu.com/doc/CDS/GettingStarted.html#.E8.87.AA.E5.8A.A8.E5.BF.AB.E7.85.A7"\n                        target="_blank" class="help-tip">\n                        <i class="iconfont icon-information"></i>{{\'帮助文档\' | i18n}}\n                    </a>\n                </h2>\n            </div>\n            <div class="table-full-wrap">\n                <div class="operation-wrap">\n                    <div class="buttons-wrap">\n                        <xui-button\n                            skin="create"\n                            on-click="onCreatePolicy"\n                            disabled="{{createPolicyRule.disable}}"\n                            tip="{{createPolicyRule.tip}}">\n                            {{\'创建自动快照策略\' | i18n}}\n                        </xui-button>\n                        <xui-button\n                            on-click="onPolicyDelete"\n                            class="delete-btn"\n                            disabled="{{deletePolicyRule.disable}}"\n                            tip="{{deletePolicyRule.tip}}">\n                            {{\'删除所选策略\' | i18n}}\n                        </xui-button>\n                    </div>\n                    <div class="buttons-quick-wrap">\n                        <xui-searchbox\n                            width="135"\n                            placeholder="{{\'请输入策略名称进行搜索\' | i18n}}"\n                            value="{=searchbox.keyword=}"\n                            keyword-type="{=searchbox.keywordType=}"\n                            datasource="{{searchbox.keywordTypes}}"\n                            on-search="onSearch"\n                        />\n                        <xui-button on-click="onRefresh"><i class="iconfont icon-cdnrefresh"></i></xui-button>\n                    </div>\n                </div>\n                <xui-table s-ref="table"\n                    select="multi"\n                    datasource="{{table.datasource}}"\n                    schema="{{table.schema}}"\n                    cell-builder="{{table.cellRenderer}}"\n                    loading="{{table.loading}}"\n                    error="{{table.error}}"\n                    on-selected-change="onSelected($event)">\n                    <div slot="c-switch">\n                        <xui-switch\n                            checked="{{row.status === \'active\' ? true : false}}"\n                            on-change="siwtchStatus($event, rowIndex)"\n                        />\n                    </div>\n                    <div slot="c-operation">\n                        <xui-button\n                            on-click="editPolicy(rowIndex)"\n                            disabled="{{editPolicyRule.disable}}"\n                            tip="{{editPolicyRule.tip}}">\n                            {{\'修改策略\' | i18n}}\n                        </xui-button>\n                        <xui-button on-click="relateDisk(rowIndex, \'bind\')">{{\'绑定磁盘\' | i18n}}</xui-button>\n                        <xui-button\n                            disabled="{{row.volumeCount === 0}}"\n                            on-click="relateDisk(rowIndex, \'unbind\')">\n                            {{\'解绑磁盘\' | i18n}}\n                        </xui-button>\n                        <xui-button on-click="deletePolicy(rowIndex)">{{\'删除\' | i18n}}</xui-button>\n                    </div>\n                <xui-table>\n            </div>\n            <xui-pager size="{{pageSize}}"\n                with-total-count\n                page="{{pageNo}}"\n                count="{{totalCount}}"\n                on-change="onPagerChange($event)" \n                on-pagesizechange="onPageSizeChange($event)">\n                <span slot="size-select">\n                    <span class="size-label">{{\'每页显示\' | i18n}}</span>\n                    <xui-select class="size-select" layer-width="70"\n                        datasource="{{pageSizes}}" value="{=pageSize=}" on-change="onPageSizeChange($event)"/>\n                </span>\n            </xui-pager>\n        </div>\n    </div>\n</app-view>\n</template>',components:{"app-sidebar":n.AppSidebar,"app-view":n.AppView,"xui-searchbox":s.SearchBox,"xui-button":s.Button,"xui-table":s.Table,"xui-pager":s.Pager,"xui-switch":s.Switch,"xui-select":s.Select},computed:{createPolicyRule:function(){return c.isSubUser()?{disable:!0,tip:"子账户没有权限创建策略"}:{}},deletePolicyRule:function(){if(c.isSubUser())return{disable:!0,tip:"子账户没有权限删除策略"};var e=this.data.get("selectedItems");return e&&e.length?{}:{disable:!0,tip:"请选择需要删除的策略"}},editPolicyRule:function(){return c.isSubUser()?{disable:!0,tip:"子账户没有权限修改策略"}:{}}},initData:function(){return{sidebarMenu:"#/bcc/snapshot/policyList",table:{schema:d.ASP_LIST_FIELD,datasource:[],cellRenderer:function(e,t,a,i){if("name"===t)return'<div class="name">'+e.name+'</div><div class="name">'+e.aspId+"</div>";if("diskCount"===t)return'<a href="#/bcc/cds/list~keyword='+e.aspId+'&keywordType=aspId">\n                            '+e.volumeCount+"个</a>";if("detail"===t){var n=function(){var t=p["default"].get24HoursTime(),a="";u["default"].each(e.timePoints,function(e){a+=t[e]+"、"});var i="";u["default"].each(e.repeatWeekdays,function(e){i+=r.Week.getTextFromValue(e)+"、"});return{v:'<span><label>创建时间：</label>\n                            <span class="time-span">'+u["default"].trimRight(a,"、")+"</span></span>"+"<br>"+('<span><label>重复日期：</label>\n                            <span class="time-span">'+u["default"].trimRight(i,"、")+"</span></span>")+"<br>"+("<span>保留时间："+(-1===e.retentionDays?"永久保留":e.retentionDays+"天后自动删除")+"</span>")}}();if("object"==typeof n)return n.v}return e[t]}},pageSize:l.pageSize,pageSizes:[{text:"10",value:10},{text:"20",value:20},{text:"50",value:50},{text:"100",value:100}],pageNo:1,totalCount:0,searchbox:{keyword:"",keywordType:l.FILTER.ASPLIST[0].value,keywordTypes:l.FILTER.ASPLIST},selectedItems:[],childs:[]}},getASPQuota:function(){var e=this;return l.api.bccQuota({objType:"asp"},{"x-silent":!0}).then(function(t){e.data.set("quota",{aspCreated:t.aspCreated,aspTotal:t.aspTotal})})},loadListData:function(){var e=this;this.data.set("table.error",""),this.data.set("table.loading",!0);var t={pageNo:this.data.get("pageNo"),pageSize:this.data.get("pageSize"),keywordType:this.data.get("searchbox.keywordType")||"repository",keyword:this.data.get("searchbox.keyword"),orderBy:"createTime"};return l.api.aspList(t,{"x-silent":!0}).then(function(t){var a=t.result;e.data.set("table.datasource",a),e.data.set("totalCount",t.totalCount),e.data.set("table.loading",!1)}).fail(function(t){e.data.set("table.error","数据加载失败"),e.data.set("table.loading",!1)})},onPagerChange:function(e){var t=e.pageNo;this.data.set("pageNo",t),this.loadListData()},onPageSizeChange:function(e){this.data.set("pageNo",1),this.data.set("pageSize",e.value),this.loadListData()},onCreatePolicy:function(){this.$childs=[];var e={parentAction:this},t=i.waitActionDialog({title:"新建自动快照策略",width:660,url:"/bcc/snapshot/updatePolicy",needFoot:!1},e);this.$childs.push(t)},onPolicyDelete:function(){var e=this.data.get("selectedItems"),t=0,a=[],i=e.length;u["default"].each(e,function(e){t+=e.volumeCount,a.push(e.aspId)}),this.deleteConfirm({aspIds:a},i,t)},siwtchStatus:function(e,t){var a=this;clearTimeout(f),f=setTimeout(function(){var i=e.value?"active":"paused",n=a.data.get("table.datasource"),r=n[t].aspId;if(n[t].status!==i)return l.api.aspUpdate({aspId:r,status:i},{"x-silent":!0}).then(function(t){s.Toast.success((e.value?"开启":"关闭")+"成功！"),a.onRefresh()}).fail(function(e){e.global&&s.Toast.error(e.global?e.global:"操作失败",{messageType:"error"}),a.onRefresh()})},500)},editPolicy:function(e){this.$childs=[];var t={parentAction:this,policyInfo:this.data.get("table.datasource")[e]},a=i.waitActionDialog({title:"修改自动快照策略",width:660,url:"/bcc/snapshot/updatePolicy",needFoot:!1},t);this.$childs.push(a)},relateDisk:function(e,t){this.$childs=[];var a=this.data.get("table.datasource")[e].aspId,n={title:("bind"===t?"绑定":"解绑")+"磁盘",width:760,url:"/bcc/snapshot/relateDisk"},s={parentAction:this,oper:t,aspId:a},r=i.waitActionDialog(n,s);this.$childs.push(r)},deletePolicy:function(e){var t=this.data.get("table.datasource")[e],a=t.volumeCount,i=[t.aspId];this.deleteConfirm({aspIds:i},1,a)},deleteConfirm:function(e,t,a){var i=this;s.confirm({title:"删除策略提示",message:"您已选择"+t+"个快照策略，当前共"+a+"块磁盘生效，已选策略创建的快照将不会被删除，请确认是否删除？",width:540}).then(function(){return l.api.aspDelete(e,{"x-silent":!0}).then(function(e){s.Toast.success("删除成功！"),i.onRefresh()}).fail(function(e){e.global&&s.Toast.error(e.global?e.global:"操作失败",{messageType:"error"})})})},onSelected:function(e){this.data.set("selectedItems",e.selectedItems)},onRefresh:function(){this.loadListData()},onSearch:function(){this.data.set("pageNo",1),this.data.set("table.datasource",[]),this.onRefresh()},inited:function(){this.$childs=[]},attached:function(){this.loadListData(),this.getASPQuota()},disposed:function(){u["default"].each(this.$childs,function(e){e.dispose()}),this.$childs=[]}})}),define("bcc/snapshot/policy/fields",["exports","module"],function(exports,module){module.exports={RELATE_DISK_FIELD:[{name:"name",label:"磁盘名称/ID",width:"30%"},{name:"policy",label:"自动快照策略",width:"30%"},{name:"instance",label:"所属实例名称/ID",width:"40%"}],RELATE_POLICY_FIELD:[{name:"name",label:"快照策略名称/ID",width:"25%"},{name:"diskCount",label:"关联磁盘数",width:"15%"},{name:"detail",label:"策略详情",width:"60%"}],ASP_LIST_FIELD:[{name:"name",label:"策略名称/ID",width:"10%"},{name:"diskCount",label:"关联磁盘个数",width:"8%"},{name:"detail",label:"策略详情",width:"20%"},{name:"switch",label:"定期快照",width:"8%"},{name:"operation",label:"操作",width:"15%"}]}}),define("bcc/snapshot/policy/List",["exports","module","lodash","babel-runtime/helpers/interop-require-default","san","san-xui"],function(exports,module,e,t,a,i){var n=t["default"](e);module.exports=a.defineComponent({template:'<template class="com-list">\n    <div class="table-full-wrap">\n        <div class="operation-wrap">\n            <div class="buttons-wrap">\n                <slot name="table-toolbar-left"></slot>\n            </div>\n            <div class="buttons-quick-wrap">\n                <xui-searchbox s-if="searchbox"\n                    width="{{searchbox.width}}"\n                    placeholder="{{searchbox.placeholder}}"\n                    value="{=searchbox.keyword=}"\n                    keyword-type="{=searchbox.keywordType=}"\n                    datasource="{{searchbox.keywordTypes}}"\n                    on-search="onSearch"\n                />\n                <xui-button on-click="onRefresh" s-if="isShowRefresh"><i class="iconfont icon-cdnrefresh"></i></xui-button>\n                <slot name="table-toolbar-right"></slot>\n            </div>\n        </div>\n        <xui-table s-ref="table"\n            select="{{tableSelectType}}"\n            datasource="{{table.datasource}}"\n            schema="{{tableSchema}}"\n            cell-builder="{{tableCellRenderer}}"\n            selected-index="{=tableSelectedIndex=}"\n            loading="{{table.loading}}"\n            error="{{table.error}}"\n            on-command="onCommand($event)"\n            on-selected-change="onSelected($event)"\n            on-sort="onSort($event)">\n            <slot name="sp-td"></slot>\n        <xui-table>\n    </div>\n    <xui-pager size="{{pageSize}}" s-if="isShowPaper"\n        with-total-count\n        page="{{pageNo}}"\n        count="{{totalCount}}"\n        on-change="onPagerChange($event)" \n        on-pagesizechange="onPageSizeChange($event)">\n        <span slot="size-select">\n            <span class="size-label">{{\'每页显示\' | i18n}}</span>\n            <xui-select class="size-select" layer-width="70"\n                datasource="{{pageSizes}}" value="{=pageSize=}" on-change="onPageSizeChange($event)"/>\n        </span>\n    </xui-pager>\n</div>\n</template>',components:{"xui-searchbox":i.SearchBox,"xui-button":i.Button,"xui-table":i.Table,"xui-pager":i.Pager,"xui-select":i.Select},computed:{},commands:{},initData:function(){return{table:{datasource:[]},pageSize:10,pageSizes:[{text:"10",value:10},{text:"20",value:20},{text:"50",value:50},{text:"100",value:100}],pageNo:1,totalCount:0,searchbox:null,isShowPaper:!0,isShowRefresh:!0,staticData:[],orderPayload:{order:"desc",orderBy:"createTime"}}},loadListData:function(){var e=this;this.data.set("table.error",""),this.data.set("table.loading",!0);var t=this.data.get("orderPayload"),a=this.data.get("extraPayload"),i={pageNo:this.data.get("pageNo"),pageSize:this.data.get("pageSize"),keywordType:this.data.get("searchbox.keywordType"),keyword:this.data.get("searchbox.keyword"),order:t.order,orderBy:t.orderBy};n["default"].assign(i,a);return this.data.get("listRequester")(i,{"x-silent":!0}).then(function(t){var a=t.result;e.data.set("table.datasource",a),e.data.set("totalCount",t.totalCount),e.data.set("table.loading",!1),e.dispatch("table-page-data-loaded",t)}).fail(function(t){e.data.set("table.error","数据加载失败"),e.data.set("table.loading",!1)})},onPagerChange:function(e){var t=e.pageNo;this.data.set("pageNo",t),this.loadListData()},onPageSizeChange:function(e){this.data.set("pageNo",1),this.data.set("pageSize",e.value),this.loadListData()},onSort:function(e){var t=e.order,a=e.orderBy;this.data.set("orderPayload",{order:t,orderBy:a}),this.onRefresh()},onSelected:function(e){this.dispatch("ui:table-item-selected",e)},onRefresh:function(){this.loadListData()},onSearch:function(){this.data.set("pageNo",1),this.data.set("table.datasource",[]),this.onRefresh()},onCommand:function(e){var t=e.type,a=e.payload,i=e.rowIndex;this.dispatch(t,{data:a,rowIndex:i})},updateTableDataSource:function(e){this.data.set("table.datasource",e)},inited:function(){var e=this;this.watch("extraPayload",function(t){e.onSearch()})},attached:function(){this.data.get("listRequester")&&this.loadListData();var e=this.data.get("staticData");e&&this.data.set("table.datasource",e)},disposed:function(){}})}),define("bcc/snapshot/policy/RelateDisks",["exports","module","lodash","babel-runtime/helpers/interop-require-default","promise","san","san-xui","./List","../../config","./fields"],function(exports,module,e,t,a,i,n,s,r,o){var c=t["default"](e),l=t["default"](a),d=t["default"](s);module.exports=i.defineComponent({template:'<template>\n<div class="relate-dialog">\n    <div class="top-tip">\n        {{\'磁盘只有挂载到一个实例后才可关联快照策略，且一个磁盘只能关联到一个快照策略\' | i18n}}\n    </div>\n    <div class="com-table">\n        <x-list ref="list"\n            searchbox="{{searchbox}}"\n            table-select-type="multi"\n            table-schema="{{tableFields}}"\n            table-cell-renderer="{{cellRenderer}}"\n            list-requester="{{dataRequester}}"\n            extra-payload="{{extraPayload}}"\n            is-show-refresh="{{false}}" >\n            <div slot="table-toolbar-left">选择云磁盘</div>\n        </x-list>\n    </div>\n</div>\n</template>',components:{"x-list":d["default"]},messages:{"ui:table-item-selected":function(e){var t=e.value;this.data.set("selectedItems",t.selectedItems)}},initData:function(){return{searchbox:{width:145,placeholder:"请输入磁盘名称进行搜索",keyword:"",keywordType:r.FILTER.RELATEDISK[0].value,keywordTypes:r.FILTER.RELATEDISK},tableFields:o.RELATE_DISK_FIELD,cellRenderer:function(e,t,a,i){return"name"===t?'<div class="long-text">'+e.name+'</div><div class="name">'+e.volumeId+"</div>":"instance"===t?e.instanceId?'<div class="long-text">'+e.instanceName+'</div><div class="name">'+e.instanceId+"</div>":"<span>-</span>":"policy"===t?e.aspDetail&&!c["default"].isEmpty(e.aspDetail)?'<span class="long-text">'+e.aspDetail.name+"</span>":"<span>-</span>":e[t]},dataRequester:r.api.bccDiskList,selectedItems:[]}},doSubmit:function(){var e=this,t=this.data.get("selectedItems");if(0===t.length)return this.close(!1),l["default"].resolve();var a=this.data.get("context").aspId,i=[];c["default"].each(t,function(e){i.push(e.volumeId)});var s={aspId:a,volumeIds:i},o="bind"===this.data.get("context").oper?"aspAttach":"aspDetach";return r.api[o](s,{"x-silent":!0}).then(function(t){n.Toast.success("设置成功！"),e.close(!0)}).fail(function(e){e.global&&n.Toast.error(e.global?e.global:"操作失败",{messageType:"error"})})},close:function(e){var t=this.data.get("context").parentAction;if(t){e&&t.onRefresh&&t.onRefresh();var a=t.$childs[0];a&&a.closeDialog(),t.$childs=[]}},inited:function(){var e=this.data.get("context").aspId,t="bind"===this.data.get("context").oper?{excludeAspId:e,filters:[{keywordType:"status",keyword:"in-use"}]}:{filters:[{keywordType:"aspId",keyword:e}]};this.data.set("extraPayload",t)},attached:function(){}})}),define("bcc/snapshot/policy/RelatePolicys",["exports","module","babel-runtime/core-js/promise","lodash","babel-runtime/helpers/interop-require-default","san","san-xui","./List","../../config","../../enum","../../util","./fields"],function(exports,module,e,t,a,i,n,s,r,o,c,l){var d=a["default"](t),u=a["default"](s),p=a["default"](c);module.exports=i.defineComponent({template:'<template>\n<xui-form s-ref="form" class="relate-dialog">\n    <div class="top-tip">\n        {{\'一个磁盘只能关联一个自动快照策略，已关联的可被新策略覆盖，以最新关联的策略为生效准则\' | i18n}}\n    </div>\n    <div class="com-table">\n        <x-list ref="list"\n            searchbox="{{searchbox}}"\n            table-select-type="single"\n            table-schema="{{tableFields}}"\n            table-selected-index="{=tableSelectedIndex=}"\n            table-cell-renderer="{{cellRenderer}}"\n            list-requester="{{dataRequester}}"\n            is-show-refresh="{{false}}" >\n            <div slot="table-toolbar-left">选择自动快照策略</div>\n        </x-list>\n    </div>\n</xui-form>\n</template>',components:{"xui-form":n.Form,"x-list":u["default"]},messages:{"ui:table-item-selected":function(e){var t=e.value;this.data.set("selectedItems",t.selectedItems)},"table-page-data-loaded":function(e){var t=e.value.result,a=this.data.get("context").aspId,i=d["default"].findIndex(t,function(e){return e.aspId===a});-1!==i?this.data.set("tableSelectedIndex",i.toString()):this.data.set("tableSelectedIndex","")}},initData:function(){return{searchbox:{keyword:"",keywordType:r.FILTER.RELATEASP[0].value,keywordTypes:r.FILTER.RELATEASP},tableFields:l.RELATE_POLICY_FIELD,cellRenderer:function(e,t,a,i){if("name"===t)return'<div class="name">'+e.name+'</div><div class="name">'+e.aspId+"</div>";if("diskCount"===t)return e.volumeCount+"个";if("detail"===t){var n=function(){var t=p["default"].get24HoursTime(),a="";d["default"].each(e.timePoints,function(e){a+=t[e]+"、"});var i="";d["default"].each(e.repeatWeekdays,function(e){i+=o.Week.getTextFromValue(e)+"、"});return{v:'<span><label>创建时间：</label>\n                        <span class="time-span">'+d["default"].trimRight(a,"、")+"</span></span>"+"<br>"+('<span><label>重复日期：</label>\n                        <span class="time-span">'+d["default"].trimRight(i,"、")+"</span></span>")+"<br>"+("<span>保留时间："+(-1===e.retentionDays?"永久保留":e.retentionDays+"天后自动删除")+"</span>")}}();if("object"==typeof n)return n.v}},dataRequester:r.api.aspList,tableSelectedIndex:"",selectedItems:[]}},doSubmit:function(){var t=this,a=[this.data.get("context").volumeId],i=this.data.get("selectedItems");if(0===i.length)return this.close(!1),e["default"].resolve();var s={aspId:i[0].aspId,volumeIds:a};return r.api.aspAttach(s,{"x-silent":!0}).then(function(e){n.Toast.success("关联成功！"),t.close(!0)}).fail(function(e){e.global&&n.Toast.error(e.global?e.global:"操作失败",{messageType:"error"})})},close:function(e){var t=this.data.get("context").parentAction;if(t&&(e&&t.reload&&t.reload(),t.$childs)){var a=t.$childs[0];a&&a.closeDialog(),t.$childs=[]}},attached:function(){}})}),define("bcc/snapshot/policy/Update",["exports","module","inf-ui/san","san-xui","async-validator","lodash","babel-runtime/helpers/interop-require-default","../../enum","../rules","../../config"],function(exports,module,e,t,a,i,n,s,r,o){var c=n["default"](i),l=n["default"](r),d=new(0,a["default"])(c["default"].pick(l["default"],["policyName","reserveTime","createTime","repeatTime"]));module.exports=e.defineComponent({template:'\n<template class="create-snapshot-policy">\n    <xui-form s-ref="form" label-width="{{50}}" rules="{{rules}}" formData="{=formData=}" errors="{=formErrors=}">\n        <xui-item required name="policyName" inline label="{{\'策略名称\' | i18n}}">\n            <xui-textbox placeholder="{{\'请输入策略名称\' | i18n}}" type="text" value="{=formData.policyName=}" class="policy-name" />\n        </xui-item>\n        <xui-item required name="createTime" inline label="{{\'创建时间\' | i18n}}">\n            <xui-boxgroup\n                box-type="checkbox"\n                col-count="{{6}}"\n                datasource="{{createTimeDatasource}}"\n                value="{=formData.createTime=}"\n                />\n        </xui-item>\n        <xui-item required name="repeatTime" inline label="{{\'重复日期\' | i18n}}">\n            <xui-boxgroup\n                box-type="checkbox"\n                datasource="{{repeatTimeDatasource}}"\n                value="{=formData.repeatTime=}"\n                />\n        </xui-item>\n        <xui-item required name="reserveTime" inline label="{{\'保留时间\' | i18n}}">\n            <div>\n                <input type="radio" checked="{{reserveTimeCheckStatus}}" on-change="reserveTimeChange($event, 0)"/>\n                <span>{{\'保留\' | i18n}}</span>\n                <xui-textbox width="40" value="{=formData.reserveTime=}"\n                    placeholder="{{\'请输入\' | i18n}}" max="{{5}}" disabled="{{!reserveTimeCheckStatus}}"/>\n                <span>{{\'天后自动删除\' | i18n}}<label class="tip">{{\'（最多允许10000天）\' | i18n}}</label></span>\n            </div>\n        </xui-item>\n        <xui-item name="foreverTime">\n            <input type="radio" checked="{{!reserveTimeCheckStatus}}" on-change="reserveTimeChange($event, 1)"/>\n            <span>{{\'永久保留\' | i18n}}</span>\n        </xui-item>\n    </xui-form>\n    <div class="foot">\n        <xui-button\n            disabled="{{btnDisabled}}"\n            skin="primary"\n            class="{{btnDisabled ? \'tooltipped tooltipped-n\' : \'\'}}" \n            aria-label="{{confirmTip}}"\n             on-click="doSubmit"\n        >{{\'确定\' | i18n}}</xui-button>\n        <xui-button on-click="cancel">{{\'取消\' | i18n}}</xui-button>\n    </div>\n</template>\n',components:{"xui-form":t.Form,"xui-item":t.FormItem,"xui-textbox":t.TextBox,"xui-boxgroup":t.BoxGroup,"xui-button":t.Button,"xui-tip":t.Tip},initData:function(){return{rules:d,formErrors:{},formData:{policyName:"",createTime:[],repeatTime:[],reserveTime:"7"},createTimeDatasource:[],repeatTimeDatasource:[],reserveTimeCheckStatus:!0,confirmTip:"",btnDisabled:!0}},computed:{btnDisabled:function(){var e=this.data.get("formErrors"),t=this.data.get("formData.policyName")||"",a=this.data.get("formData.createTime"),i=this.data.get("formData.repeatTime"),n=!!a.length&&!!i.length;return this.data.get("reserveTimeCheckStatus")?""===t||!c["default"].isEmpty(e)||!n:!c["default"].isEmpty(e)&&!c["default"].isUndefined(e.policyName)||!n},confirmTip:function(){return this.data.get("btnDisabled")?"请正确填写信息":""}},doSubmit:function(){var e={name:this.data.get("formData.policyName"),timePoints:this.data.get("formData.createTime"),repeatWeekdays:this.data.get("formData.repeatTime"),retentionDays:this.data.get("reserveTimeCheckStatus")?this.data.get("formData.reserveTime"):-1},t="Create";return this.data.get("policyInfo")&&(t="Update",e.aspId=this.data.get("aspId")),this.updatePolicy(t,e)},cancel:function(){this.closeDialog();var e=this.data.get("parentAction");e&&e.onCloseAspCreate&&e.onCloseAspCreate()},updatePolicy:function(e,a){var i=this;return o.api["asp"+e](a,{"x-silent":!0}).then(function(a){t.Toast.success("Create"===e?"创建成功！":"修改成功！");var n=i.data.get("parentAction");n&&(n.onRefresh&&n.onRefresh(),n.onOkAspCreate&&n.onOkAspCreate(),i.closeDialog())}).fail(function(e){e.global&&t.Toast.error(e.global?e.global:"操作失败",{messageType:"error"})})},reserveTimeChange:function(e,t){e.target.checked&&(1===t?$(".ui-form-item-reserveTime .ui-form-item-invalid-label").hide():$(".ui-form-item-reserveTime .ui-form-item-invalid-label").show(),this.data.set("reserveTimeCheckStatus",!t))},closeDialog:function(){var e=this.data.get("parentAction");if(e){var t=c["default"].find(e.$childs,function(e){return"/bcc/snapshot/updatePolicy"===e.data.get("actionOptions.url")});t&&t.closeDialog(),e.$childs=[]}},inited:function(){for(var e=this.data.get("createTimeDatasource"),t=0;t<=23;t++){var a=t<10?"0"+t:t;e.push({text:a+":00",value:t})}this.data.set("repeatTimeDatasource",s.Week.toArray())},attached:function(){var e=this.data.get("policyInfo");e&&(this.data.set("aspId",e.aspId),this.data.set("formData.policyName",e.name),this.data.set("formData.createTime",e.timePoints),this.data.set("formData.repeatTime",e.repeatWeekdays),-1===e.retentionDays?this.data.set("reserveTimeCheckStatus",!1):(this.data.set("reserveTimeCheckStatus",!0),this.data.set("formData.reserveTime",e.retentionDays)))}})}),define("bcc/snapshot/rules",["exports","module","lodash","babel-runtime/helpers/interop-require-default","../enum","../events","../util"],function(exports,module,e,t,a,i,n){function s(e){return e.type===a.DiskType.SYSTEM}var r,o=t["default"](e),c=t["default"](i);module.exports=(r={createSnapshot:[{required:!1},{isSingle:!0,message:"无法批量创建快照"},{custom:function(e,t){var i=t.instance,n=t.disk;return i&&!o["default"].contains([a.InstanceStatus.ACTIVE,a.InstanceStatus.SHUTOFF],i.status)?{disable:!0,message:"当前实例状态无法创建快照"}:i&&i.imageType===a.ImageType.MKT?{disable:!0,message:"云市场镜像创建的实例无法创建快照"}:n&&!o["default"].contains([a.DiskStatus.AVAILABLE,a.DiskStatus.IN_USE],n.status)?{disable:!0,message:"当前磁盘状态无法创建快照"}:void 0}}],deleteSnapshot:[{status:[a.SnapshotStatus.AVAILABLE,a.SnapshotStatus.ERROR_DELETING,a.SnapshotStatus.ERROR,a.SysSnapshotStatus.ACTIVE,a.SysSnapshotStatus.ERROR],message:function(e){return e.length>1?"部分快照当前状态无法释放":"该快照当前状态无法释放"}},{subUserAble:!0,message:"子账户没有权限释放快照"},{custom:function(e,t){var i={};return o["default"].each(e,function(e){if(s(e)&&!o["default"].contains([a.InstanceStatus.ACTIVE,a.InstanceStatus.SHUTOFF],e.instanceStatus)&&e.status!==a.SysSnapshotStatus.ERROR)return i={disable:!0,message:"当前实例状态无法释放快照"},!1}),i}}]},r[c["default"].CREATE_IMAGE]=[{status:[a.SysSnapshotStatus.ACTIVE],message:"该实例当前状态无法创建自定义镜像"},{isSingle:!0,message:"无法批量创建自定义镜像"},{custom:function(e,t){var i=t.instance,n=i?i.status:e[0].instanceStatus;if(s(e[0])){if(n&&!o["default"].contains([a.InstanceStatus.ACTIVE,a.InstanceStatus.SHUTOFF],n))return{disable:!0,message:"当前实例状态无法创建快照"};if(i&&i.imageType===a.ImageType.MKT)return{disable:!0,message:"云市场镜像创建的实例无法再创建自定义镜像"}}}}],r[c["default"].ROLLBACK_SNAPSHOT]=[{status:[a.SnapshotStatus.AVAILABLE,a.SysSnapshotStatus.ACTIVE],message:"该实例当前状态无法回滚快照"},{isSingle:!0,message:"无法批量回滚快照"},{subUserAble:!0,message:"子账户没有权限回滚快照"},{custom:function(e,t){var i=t.instance,n=t.disk,r=i?i.status:e[0].instanceStatus,c=n?n.status:e[0].diskStatus;if(s(e[0])){if(r&&!o["default"].contains([a.InstanceStatus.ACTIVE,a.InstanceStatus.SHUTOFF],r))return{disable:!0,message:"当前实例状态无法回滚快照"}}else{if(c&&!o["default"].contains([a.DiskStatus.AVAILABLE],c))return{disable:!0,message:"当前磁盘状态无法回滚快照"};if("MIGRATION"===e[0].createMethod)return{disable:!0,message:"暂不支持"}}}}],r[c["default"].CREATE_DISK]=[{status:[a.SnapshotStatus.AVAILABLE,a.SnapshotStatus.ACTIVE],message:"该快照当前状态无法创建CDS盘"},{isSingle:!0,message:"无法批量创建CDS盘"},{subUserAble:!1,message:"子账户没有权限创建CDS盘"},{custom:function(e,t){if(s(e[0])&&!n.isRocV2Disk(e[0]))return{disable:!0,message:"只有CDS盘快照才能创建CDS盘"}}}],r[c["default"].SAVE_EDIT]=[{status:[a.SysSnapshotStatus.ACTIVE,a.SysSnapshotStatus.ERROR,a.SnapshotStatus.AVAILABLE,a.SnapshotStatus.ERROR_DELETING,a.SnapshotStatus.ERROR],message:"该快照当前状态无法修改名称"},{isSingle:!0,message:"无法批量修改快照名称"},{subUserAble:!0,message:"子账户没有权限修改名称"}],r.policyName=[{required:!0,message:"请填写策略名称"},{pattern:/^[a-zA-Z][\u4e00-\u9fa5\w\-\/\.]{0,64}$/,message:"名称不符合规则：支持大小写字母、数字以及-_ /.特殊字符，必须以字母开头，长度1-65"}],r.reserveTime=[{required:!0,message:"请填写保留时间"},{pattern:/^\+?[0-9][0-9]*$/,message:"保留时间不符合规则：天数范围为1~10000天"},{validator:function(e,t,a){if(parseInt(t,10)<=0||parseInt(t,10)>1e4)return a("保留时间不符合规则：天数范围为1~10000天");a()}}],r.createTime=[{required:!0,message:"请选择创建时间"}],r.repeatTime=[{required:!0,message:"请选择重复时间"}],r)}),define("bcc/ssh/action.conf",["exports","inf-ui/sanPage","babel-runtime/helpers/interop-require-default","er/controller"],function(exports,e,t,a){var i=t["default"](e),n=t["default"](a),s=[{path:"/bcc/ssh/list",type:i["default"]("bcc/ssh/list"),skipRegionCheck:!0},{path:"/bcc/ssh/create",type:i["default"]("bcc/ssh/create/create"),skipRegionCheck:!0}];n["default"].registerAction(s)}),define("bcc/ssh/bindSsh",["exports","module","inf-ui/sanx","san-xui","inf-i18n","babel-runtime/helpers/interop-require-default","underscore","../config","./create"],function(exports,module,e,t,a,i,n,s,r){var o=i["default"](a),c=i["default"](n),l=i["default"](r);module.exports=e.defineComponent({components:{"xui-table":t.Table,"xui-pager":t.Pager,"xui-searchbox":t.SearchBox,"xui-button":t.Button,"xui-select":t.Select,"xui-icon":t.Icon,"xui-dialog":t.Dialog,"x-row":t.Row,"xui-create-dialog":l["default"],"xui-tip":t.Tip},template:'\n<template>\n<xui-dialog s-ref="ssh-vm-dialog" class="ssh-vm-content" width="700" on-confirm="confirmVm" on-close="closeSshDialog" open="{=isShowbinglist=}" title="{{vmTitle}}">\n    <div class="ssh-vm-tip">{{vmTipText}}</div>\n    <div class="ssh-vm-herder">\n        <label class="ssh-vm-herder-label">您已选择{{payload.length}}个实例</label>\n        <div s-if="isOpen" on-click="openTable(false)" class="ssh-text ssh-inline-block">关闭详情<div class="hide-table"><xui-icon class="ssh-text" name="down-arrow"></div></div>\n        <div s-if="!isOpen" on-click="openTable(true)" class="ssh-text ssh-inline-block">展开详情<xui-icon class="ssh-text" name="down-arrow"></div>\n    </div>\n    <xui-table s-if="isOpen"\n        schema="{{vmTable.schema}}"\n        on-command="onCommand($event)"\n        cell-builder="{{vmTable.cellRenderer}}"\n        selected-index="{=vmTable.selectedIndex=}"\n        on-selected-change="onTableRowSelected($event)"\n        datasource="{{payload}}">\n    </xui-table>\n    <div s-if="{{type === \'BIND\'}}" class="selcet-ssh form-row">\n        <label class="required-label">密钥对：</label>\n        <div class="form-value">\n           <xui-select width="242" default-label="{{\'请选择密钥对\' | i18n}}" datasource="{{select.datasource}}" value="{=select.value=}" />\n           <xui-button icon="plus"\n            class="{{quota.keypairCreated >= quota.keypairTotal ? \'tooltipped\' : \'\'}} tooltipped-n"\n            aria-label="{{\'一个地域下最多只能创建500个密钥\' | i18n}}"\n            disabled="{{quota.keypairCreated >= quota.keypairTotal ? true : false}}" on-click="showFormDialog" label="{{\'创建密钥对\' | i18n}}" />\n        </div>\n    </div>\n    <xui-button\n        slot="foot"\n        on-click="onConfirmDialog"\n        skin="primary"\n        disabled="{{type === \'BIND\' ? select.value ? false : true : false}}">确认</xui-button>\n    <xui-button slot="foot" on-click="onCloseDialog">取消</xui-button>\n</xui-dialog>\n<xui-create-dialog on-ok="refresh" s-ref="keypairCreate"></xui-create-dialog>\n</template>\n',computed:{vmTipText:function(){return"BIND"===this.data.get("type")?"温馨提示：密钥对绑定成功后，虚机的原密码仍可用；虚机如有原密钥对会被替换为新密钥对":"温馨提示：密钥对解绑后，虚机可用原密码登录；对于没有设置密码的虚机，系统会自动生成一个原始密码"},vmTitle:function(){return"BIND"===this.data.get("type")?"绑定虚机":"解绑虚机"}},initData:function(){return{isBind:!0,isOpen:!0,select:{value:"",datasource:[]},vmTable:{selectedIndex:[],schema:[{name:"name",label:"已选实例名称"},{name:"instanceId",label:"已选实例ID"},{name:"keypairName",label:"所绑定密钥对"}],cellRenderer:function(e,t,a,i){if("name"===t){var n=c["default"].escape(e.name);return"<span>"+(n.length>22?n.slice(0,22)+"...":n)+"</span>"}return"instanceId"===t?"<span>"+e.instanceId+"</span>":"keypairName"===t?"<span>"+e.keypairName+"</span>"||"-":e[t]}},isShowbinglist:!0}},closeSshDialog:function(){this.data.set("isShowbinglist",!1),this.fire("close")},getQuota:function(){var e=this;s.api.bccQuota({objType:"bcc",needGlobalQuota:!0}).then(function(t){e.data.set("quota",t)})},openSshDialog:function(){this.data.set("isShowbinglist",!0)},openTable:function(e){this.data.set("isOpen",e)},confirmVm:function(){var e=this,a=this.data.get("type"),i=this.data.get("payload"),n=c["default"].map(i,function(e){return e.instanceId}),r="BIND"===a?s.api.sshAttach:s.api.sshDetach,l="BIND"===a?"绑定":"解绑";r({keypairId:"BIND"===a?this.data.get("select.value"):i[0].keypairId,instanceIds:n},{"x-silent":!0}).then(function(a){t.Toast.success(o["default"](l+"成功")),e.fire("ok")}).fail(function(a){e.fire("cancel"),a.field&&a.field.mfa||t.Toast.error(o["default"](l+"失败"))})},refresh:function(){this.getSshData()},showFormDialog:function(){this.ref("keypairCreate").showFormDialog()},attached:function(){this.getSshData(),this.getQuota()},onConfirmDialog:function(){this.ref("ssh-vm-dialog").onConfirmDialog()},onCloseDialog:function(){this.ref("ssh-vm-dialog").onCloseDialog()},getSshData:function(){var e=this;s.api.sshList({pageNo:1,pageSize:500},{"X-silence":!0}).then(function(t){var a=[];c["default"].each(t.result,function(e){a.push({text:e.name,value:e.keypairId})}),e.data.set("select.datasource",a)})}})}),define("bcc/ssh/create",["exports","module","inf-ui/sanx","san-xui","inf-i18n","babel-runtime/helpers/interop-require-default","../config"],function(exports,module,e,t,a,i,n){function s(e){var t=arguments.length<=1||arguments[1]===undefined?"":arguments[1],a=arguments.length<=2||arguments[2]===undefined?512:arguments[2],i=window.atob(e),n=[],s=undefined;for(s=0;s<i.length;s+=a){var r=i.slice(s,s+a),o=new Array(r.length),c=undefined;for(c=0;c<r.length;c+=1)o[c]=r.charCodeAt(c);var l=new window.Uint8Array(o);n.push(l)}return new window.Blob(n,{type:t})}var r=i["default"](a),o=e.defineComponent({template:'<template>\n    <span class="ui-form-ssh-create">\n       温馨提示：百度云平台不会保留您的私钥信息，点击确定后系统自动下载私钥到本地\n    </span>\n    </template>'});t.registerFormItem({type:"sshCreatText",tagName:"ui-form-item-create",Component:o,builder:function(e,t){return'\n        <ui-form-item-create s-if="!preview" value="{=formData.'+e.name+'=}" />\n        <span s-else>{{formData.'+e.name+"}}</span>"}});var c={controls:[{label:r["default"]("创建方式"),name:"creatStyle",type:"boxgroup",required:!0,datasource:[{text:r["default"]("创建新的密钥对"),value:"NEW"},{text:r["default"]("使用已有公钥"),value:"OLD"}]},{label:r["default"]("密钥对名称"),name:"name",help:"大小写字母、数字、中文以及-_／.特殊字符，必须<br/>以子母开头，长度1-65",type:"text",validator:function(e,t,a,i){if(!/^[a-zA-Z][\u4e00-\u9fa5\w\-\/\.]{0,64}$/.test(t))return a(r["default"]("名称不符合规则"));a()},required:!0},{label:r["default"]("密钥对描述"),name:"description",multiline:!0,validator:function(e,t,a,i){if(!/^.{0,140}$/.test(t))return a(r["default"]("描述长度必须在0~140个字符之间"));a()},type:"text",help:"描述长度必须在0~140个字符之间"},{label:r["default"]("输入公钥"),name:"publickey",type:"text",required:!0,multiline:!0,visibleOn:{creatStyle:"OLD"},validator:function(e,t,a,i){if(!/^ssh-rsa/.test(t))return a(r["default"]("名称不符合规则"));a()},help:"格式：ssh-rsa AGLUSJK..."},{name:"tipText",type:"sshCreatText",visibleOn:{creatStyle:"NEW"}}]};module.exports=e.defineComponent({components:{"xui-form-dialog":t.FormDialog},template:'\n<template class="ssh-create-container">\n<xui-form-dialog\n    s-if="keypairCreate"\n    title="创建密钥对"\n    width="{{550}}"\n    on-ok="save($event)"\n    on-close="closeFormDialog"\n    form-comp="{{ClintInfo}}"\n    form-data="{{formData}}"\n></xui-form-dialog>\n</template>\n',initData:function(){return{ClintInfo:t.createForm(c),formData:{creatStyle:"NEW"}}},save:function(e){var a=this;e.publickey?n.api.sshImport({publicKey:e.publickey,name:e.name,description:e.description}).then(function(i){t.Toast.success("密钥对创建成功"),a.fire("ok",e)}):n.api.sshCreate({name:e.name,description:e.description}).then(function(i){t.Toast.success("密钥对创建成功"),a.fire("ok",e);var n=i.name+"-"+i.keypairId+".txt",r=document.createElement("a"),o=function(e,t,a){var i=undefined;return window.navigator.msSaveBlob?(i=s(e,t),window.navigator.msSaveBlob(i,a),!1):window.URL.createObjectURL?(i=s(e,t),window.URL.createObjectURL(i)):"data:"+t+";base64,"+e}(function(e){return window.btoa(unescape(encodeURIComponent(e)))}(i.privateKey),"text/plain",n);r.href=o,r.download=n,r.style.display="none",document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(o)}),this.closeFormDialog()},closeFormDialog:function(){this.data.set("keypairCreate",!1)},showFormDialog:function(){this.data.set("keypairCreate",!0)}})}),define("bcc/ssh/detail",["exports","module","san","san-xui","moment","babel-runtime/helpers/interop-require-default","underscore","inf-i18n","common/util/timeUtil","../enum","../config"],function(exports,module,e,t,a,i,n,s,r,o,c){var l=i["default"](a),d=i["default"](n),u=i["default"](s),p=i["default"](r);module.exports=e.defineComponent({components:{"xui-table":t.Table,"xui-icon":t.Icon,"xui-pager":t.Pager,"xui-textbox":t.TextBox,"xui-instanteditor":t.InstantEditor,"xui-clipboard":t.Clipboard},template:'\n        <template>\n        <div class="ssh-detail-content">\n            <div class="detail-parts-table">\n                <div class="ssh-detail-body">\n                    <div class="form-row">\n                        <label>密钥对名称：</label>\n                        <div class="form-value">\n                            <span>{{keypairDetail.name || \'无\'}}</span>\n                            <xui-instanteditor\n                                active="{=active.name=}"\n                                submiting="{=submiting.name=}"\n                                on-submit="sshEditSubmit($event, \'name\', keypairDetail)">\n                                <xui-textbox value="{{keypairDetail.name}}" />\n                            </xui-instanteditor>\n                        </div>\n                    </div>\n                    <div class="form-row">\n                        <label>密钥对ID：</label>\n                        <div class="form-value">\n                            <span>{{keypairDetail.keypairId || \'无\'}}</span>\n                        </div>\n                    </div>\n                    <div class="form-row">\n                        <label>密钥对描述：</label>\n                        <div class="form-value">\n                            <span>{{keypairDetail.description || \'无\'}}</span>\n                            <xui-instanteditor\n                                active="{=active.description=}"\n                                submiting="{=submiting.description=}"\n                                on-submit="sshEditSubmit($event, \'description\', keypairDetail)">\n                                <xui-textbox value="{{keypairDetail.description}}" />\n                            </xui-instanteditor>\n                        </div>\n                    </div>\n                    <div class="form-row">\n                        <label>公钥内容：</label>\n                        <div class="form-value">\n                            <span>{{keypairDetail.publicKey || \'无\'}}</span>\n                            <xui-clipboard s-if="keypairDetail.publicKey"\n                                text="{{keypairDetail.publicKey}}" on-aftercopy="onAfterCopy">\n                                <xui-icon name="copy" />\n                            </xui-clipboard>\n                        </div>\n                    </div>\n                    <div class="form-row">\n                        <label>公钥指纹：</label>\n                        <div class="form-value">\n                            <span>{{keypairDetail.fingerPrint || \'无\'}}</span>\n                            <xui-clipboard s-if="keypairDetail.fingerPrint"\n                                text="{{keypairDetail.fingerPrint}}" on-aftercopy="onAfterCopy">\n                                <xui-icon name="copy" />\n                            </xui-clipboard>\n                        </div>\n                    </div>\n                    <div class="form-row">\n                        <label>创建时间：</label>\n                        <div class="form-value">\n                            <span>{{keypairDetail.createdTime | dateFormat("YYYY-MM-D HH:MM:SS")}}</span>\n                        </div>\n                    </div>\n                    <div class="form-row">\n                        <label>已绑定虚机：</label>\n                        <div class="form-value">\n                        <xui-table\n                            schema="{{table.schema}}"\n                            cell-builder="{{table.cellRenderer}}"\n                            on-command="onCommand($event)"\n                            loading="{{table.loading}}"\n                            error="{{table.error}}"\n                            datasource="{{table.datasource}}">\n                        </xui-table>\n                        <xui-pager class="float-right" size="{{pager.size}}"\n                            page="{{pager.pageNo}}"\n                            count="{{table.datasource.length}}"\n                            on-change="getBindVm($event)" />\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        </template>\n    ',initData:function(){return{keypairDetail:{},pager:{size:10,pageNo:1},table:{selectedIndex:[1],schema:[{name:"name",label:"实例名称/ID"},{name:"internalIp",label:"内网IP"},{name:"expireTime",label:"到期时间"},{name:"tags",label:"标签"}],loading:!1,cellRenderer:function(e,t,a,i){if("name"===t){if(!e.name)return"-";var n=d["default"].escape(e.name),s=n.length>22?n.slice(0,15)+"...":n;return'<a href="#/bcc/instance/detail~instanceId='+e.id+'"\n                            class="instance-name">'+s+"</a>\n                            </br><span>"+e.instanceId+"</span>"}if("expireTime"===t)return e.payment===o.ProductType.PREPAY?p["default"].toUtcTime(e.expireTime)||"-":"-";if("tags"===t){if(!e.tags||e.tags.length<1)return"-";var r="",c="";return d["default"].each(e.tags,function(e,t){c+="{"+e.tagKey+" : "+e.tagValue+"} ",t<2&&(r+=e.tagKey+" : "+e.tagValue+"<br/>")}),'\n                            <div title="'+c+'">\n                                '+r+"\n                            </div>"}return e[t]}}}},attached:function(){var e=this;this.watch("payload",function(t){e.getDetail(),e.getBindVm()})},filters:{dateFormat:function(e,t){return l["default"](e).format(t)}},getDetail:function(){var e=this,t=this.data.get("payload.keypairId");c.api.sshDetail({keypairId:t},{"x-silent":!0}).then(function(t){e.data.set("keypairDetail",t)})},getBindVm:function(e){var t=this,a=this.data.get("payload.keypairId"),i=d["default"].isObject(e)?e.pageNo:1;this.data.set("table.loading",!0),c.api.bccInstanceList({filters:[{keywordType:"osType",keyword:"linux"},{keywordType:"status",keyword:"SHUTOFF,ACTIVE"}],keypairId:a,pageNo:i,pageSize:this.data.get("pager.size")},{"x-silent":!0}).then(function(e){t.data.set("table.datasource",e.result),t.data.set("pager.pageNo",e.pageNo),t.data.set("table.loading",!1)})},sshEditSubmit:function(e,a,i){var n=this;this.data.set("submiting."+a,!0),"name"===a?c.api.sshRename({name:e.value,keypairIds:[i.keypairId]},{"x-silent":!0}).then(function(){t.Toast.success(u["default"]("名字修改成功")),n.data.set("submiting."+a,!1),n.data.set("active."+a,!1),n.getDetail()}).fail(function(){t.Toast.error(u["default"]("名字修改失败")),n.data.set("submiting."+a,!1),n.data.set("active."+a,!1)}):"description"===a&&c.api.sshUpdateDesc({description:e.value,keypairIds:[i.keypairId]},{"x-silent":!0}).then(function(){t.Toast.success(u["default"]("描述修改成功")),n.data.set("submiting."+a,!1),n.data.set("active."+a,!1),n.getDetail()}).fail(function(){t.Toast.error(u["default"]("描述修改失败")),n.data.set("submiting."+a,!1),n.data.set("active."+a,!1)})}})}),define("bcc/ssh/fields",["exports","module"],function(exports,module){module.exports=[{name:"name",label:"密钥对名称/ID",width:"25%",minWidth:100},{name:"status",label:"状态",width:"20%",minWidth:80,filter:{options:[{text:"已绑定",value:"binding"},{text:"未绑定",value:"unbind"}]}},{name:"instanceCount",label:"绑定虚机数量",width:"10%",minWidth:100},{name:"createdTime",label:"创建时间",sortable:!0,width:"25%",minWidth:110},{name:"operation",label:"操作",width:"20%",minWidth:60}]}),define("bcc/ssh/list",["exports","module","inf-ui/sanx","inf-ui/appui","san-xui","common/storage","babel-runtime/helpers/interop-require-default","common/util/timeUtil","inf-i18n","underscore","./fields","./detail","../config","./create","./vmBind"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p){var f=n["default"](i),m=n["default"](s),h=n["default"](r),g=n["default"](o),v=n["default"](c),b=n["default"](l),y=n["default"](u),T=n["default"](p);module.exports=e.defineComponent({components:{"app-content":t.AppContent,"app-view":t.AppView,"xui-as-drawer":a.asDrawer(b["default"]),"xui-button":a.Button,"xui-table":a.Table,"xui-textbox":a.TextBox,"xui-select":a.Select,"xui-pager":a.Pager,"xui-searchbox":a.SearchBox,"xui-dialog":a.Dialog,"x-row":a.Row,"xui-tip":a.Tip,"xui-create-dialog":y["default"],"xui-ssh-bind":T["default"],"xui-instanteditor":a.InstantEditor,"xui-table-column-toggle":a.TableColumnToggle},template:'\n<template class="ssh-main-container">\n<xui-ssh-bind on-ok="refresh" s-ref="showVmlist" bindType="{{bindType}}" payload="{{payload}}"></xui-ssh-bind>\n<xui-as-drawer class="ssh-asdrawer-content" expand="{= expand =}" payload="{{drawerPayload}}" expandTo="{{expandTo}}" width="{{\'650px\'}}" top="{{\'51px\'}}"><div slot="header">{{drawerPayload.name}}\n<button class="ssh-detail-bind-button" on-click="detailBindSsh">绑定虚机</button><button class="ssh-detail-unbind-button" s-if="{{drawerPayload.status === \'binding\'}}" on-click="detailUnbindSsh">解绑虚机</button></div></xui-as-drawer>\n<app-view class="ssh-common">\n    <app-sidebar menu="{{menu}}" />\n    <app-content>\n        <div class="list-content">\n            <h2 class="ssh-list-content-header">密钥对列表</h2>\n            <div class="link-wrap">\n                <a href="https://cloud.baidu.com/doc/BCC/GettingStarted.html#.E5.AF.86.E9.92.A5.E5.AF.B9" target="_blank"><i class="iconfont icon-information"></i>帮助文档</a>\n            </div>\n            <div class="operation-wrap">\n                <xui-button\n                    on-click="showFormDialog"\n                    class="{{listData.totalCount >= 500 ? \'tooltipped\' : \'\'}} tooltipped-e"\n                    disabled="{{listData.totalCount >= 500 ? true : false}}"\n                    aria-label="{{\'一个地域下最多只能创建500个密钥\' | i18n}}"\n                    icon="plus" skin="primary">\n                    {{\'创建密钥对\' | i18n}}\n                </xui-button>\n                <xui-button on-click="delete"\n                    class="{{isShowDeleteTip ? \'tooltipped\' : \'\'}} tooltipped-e"\n                    disabled="{{!canDelete}}"\n                    aria-label="{{\'已绑定虚机的密钥不能删除\' | i18n}}">\n                    {{\'删除\' | i18n}}\n                </xui-button>\n                <xui-table-column-toggle\n                on-change="toggleTableColumns"\n                layer-align="right"\n                class="float-right"\n                value="{=tct.value=}"\n                datasource="{{tct.datasource}}"\n                />\n                <xui-button class="float-right ssh-top-button" on-click="refresh" icon="refresh" />\n                <xui-searchbox class="float-right" \n                    on-search="requestList(searchbox)"\n                    value="{=searchbox.keyword=}"\n                    keyword-type="{=searchbox.keywordType=}"\n                    datasource="{{searchbox.keywordTypes}}"/>\n            </div>\n            <xui-table select="multi"\n                schema="{{table.schema}}"\n                on-command="onCommand($event)"\n                loading="{{table.loading}}"\n                error="{{table.error}}"\n                cell-builder="{{table.cellRenderer}}"\n                on-command="onCommand($event)"\n                on-filter="statusFilter($event)"\n                on-sort="listSort($event)"\n                datasource="{{listData.result}}"\n                selected-index="{=table.selectedIndex=}"\n                on-selected-change="onTableRowSelected($event)">\n                <div slot="c-name">\n                    <a data-command="DETAILS" href="javascript:void(0)" class="truncated">{{row.name}}</a>\n                    <xui-instanteditor\n                        class="ssh-list-editor"\n                        s-ref="ssh-{{row.keypairId}}"\n                        submiting="{= submiting.name =}"\n                        on-submit="sshEditSubmit($event, row)">\n                        <xui-textbox value="{{row.name}}" />\n                    </xui-instanteditor>\n                    <br/><span>{{row.keypairId}}</span>\n                </div>\n                <div class="ui-table-body-nodata" slot="empty">\n                    <div>\n                        <p>没有相关数据!</p>\n                    </div>\n                </div>\n            </xui-table>\n            <div class="ssh-pager">\n                <xui-pager\n                    class="ssh-pager-main"\n                    size="{{pager.size}}"\n                    page="{{pager.pageNo}}"\n                    count="{{listData.totalCount}}"\n                    on-change="requestList(searchbox,$event)" />\n                <div class="ssh-pager-select">\n                    <span class="ssh-pager-select-text">每页显示</span>\n                    <xui-select\n                        value="{=pagerSelect.value=}"\n                        on-change="pageSizeChange($event)"\n                        datasource="{{pagerSelect.datasource}}" />\n                </div>\n            </div>\n        </div>\n    </app-content>\n    <xui-create-dialog on-ok="refresh" s-ref="keypairCreate"></xui-create-dialog>\n</app-view>\n</template>\n',initData:function(){var e=f["default"].get("bccSshPagerSize")&&JSON.parse(f["default"].get("bccSshPagerSize"));return{menu:"/bcc/ssh/list",isShowDeleteTip:!1,canDelete:!1,pagerSelect:{value:e||10,datasource:[{text:"10",value:10},{text:"20",value:20},{text:"50",value:50},{text:"100",value:100}]},tct:{value:["name","status","instanceCount","createTime","operation"],datasource:[{text:"密钥对名称/ID",value:"name",disabled:!0},{text:"状态",value:"status"},{text:"绑定虚机数量",value:"instanceCount"},{text:"创建时间",value:"createTime"},{text:"操作",value:"operation",disabled:!0}]},table:{selectedIndex:[],schema:v["default"],loading:!1,cellRenderer:function(e,t,a,i){switch(t){case"status":return"binding"===e.status?'<span class="status normal">已绑定</span>':'<span class="status warning">未绑定</span>';case"instanceCount":var n='\n                                <a href="#/bcc/instance/list~keyword='+e.keypairId+'&keywordType=keypairId">\n                                '+e.instanceCount+"</a>";return e.instanceCount>0?n:"<span>"+e.instanceCount+"</span>";case"createdTime":return m["default"].toTime(e.createdTime)||"-";case"operation":return e.instanceCount?'<a class="cmd-button" data-command="VMBINDLIST">\n                                    绑定虚机</a><br/><a class="cmd-button" data-command="VMUNBINDLIST">解绑虚机</a>':'<a class="cmd-button" data-command="VMBINDLIST">绑定虚机</a><br/>\n                                    <xui-button aria-label="该密钥尚未绑定任何虚机" disabled \n                                    class="disabled-button  tooltipped tooltipped-s\n                                    ">解绑虚机</xui-button>';default:return e[t]}}},searchbox:{keyword:"",keywordType:"name",keywordTypes:[{text:"密钥对名称",value:"name"},{text:"密钥对ID",value:"keypairId"}]},pager:{size:e||10,pageNo:1},expand:!1,expandTo:"right",drawerPayload:{},payload:{}}},filters:{escape:function(e){return g["default"].escape(e)}},attached:function(){this.requestList()},onCommand:function(e){var t=e.type,a=e.payload,i=e.rowIndex;if("DETAILS"===t)a.name=a.name.length>22?a.name.slice(0,22)+"...":a.name,this.data.set("expand",!0),this.data.set("drawerPayload",a);else if("VMBINDLIST"===t){var n="BIND"+i;this.data.set("payload",a),this.data.set("bindType",n),this.ref("showVmlist").openSshDialog()}else if("VMUNBINDLIST"===t){n="UNBIND"+i;this.data.set("payload",a),this.data.set("bindType",n),this.ref("showVmlist").openSshDialog()}},statusFilter:function(e){this.data.set("withstatus",!0),this.data.set("statusData",e),this.requestList()},listSort:function(e){this.data.set("isSort",!0),this.data.set("sortData",e),this.requestList()},detailBindSsh:function(){this.data.set("payload",this.data.get("drawerPayload")),this.data.set("bindType","BIND"),this.ref("showVmlist").openSshDialog()},detailUnbindSsh:function(){this.data.set("payload",this.data.get("drawerPayload")),this.data.set("bindType","UNBIND"),this.ref("showVmlist").openSshDialog()},pageSizeChange:function(e){f["default"].set("bccSshPagerSize",JSON.stringify(e.value)),this.data.set("pager.size",e.value),this.requestList()},requestList:function(e,t){var a=this,i=[],n=undefined,s=g["default"].isObject(t)?t.pageNo:1,r=e||this.data.get("searchbox");if(r.keyword){var o=g["default"].trim(r.keyword),c=r.keywordType;i.push({keywordType:c,keyword:o})}if(this.data.get("withstatus")){var l=this.data.get("statusData");o=g["default"].values(l)[0],c=g["default"].keys(l)[0];i.push({keywordType:c,keyword:o})}n=i.length>=1?{filters:i,pageNo:s,pageSize:this.data.get("pager.size")}:{pageNo:s,pageSize:this.data.get("pager.size")};var u=this.data.get("isSort")?this.data.get("sortData"):{};this.data.set("table.loading",!0),d.api.sshList(g["default"].extend(n,u),{"X-silence":!0}).then(function(e){a.data.set("listData",e),a.data.set("pager.pageNo",e.pageNo),a.data.set("table.loading",!1)})},"delete":function(){var e=this;a.confirm({message:"密钥删除后无法恢复，请确认是否删除密钥",width:500}).then(function(){var t=e.data.get(),i=t.table,n=t.listData,s=g["default"].pick.apply(g["default"],[n.result].concat(i.selectedIndex)),r=g["default"].map(s,function(e){return e.keypairId});d.api.sshDelete({keypairIds:r},{"X-silence":!0}).then(function(){a.Toast.success(h["default"]("删除成功")),e.$reload()})})},toggleTableColumns:function(){for(var e=this.data.get("tct.value"),t=this.data.get("table.schema"),a=0;a<t.length;a++){var i=-1===e.indexOf(t[a].name);this.data.set("table.schema["+a+"].xui__hidden",i)}},onTableRowSelected:function(e){var t=e.selectedItems;if(t.length>=1){var a=g["default"].every(t,function(e){return"unbind"===e.status});this.data.set("canDelete",a),a?this.data.set("isShowDeleteTip",!1):this.data.set("isShowDeleteTip",!0)}else this.data.set("canDelete",!1),this.data.set("isShowDeleteTip",!1)},sshEditSubmit:function(e,t){var i=this;this.data.set("submiting.name",!0),d.api.sshRename({name:e.value,keypairIds:[t.keypairId]},{"X-silence":!0}).then(function(){i.ref("ssh-"+t.keypairId).toggleLayer(),a.Toast.success(h["default"]("修改成功")),i.data.set("submiting.name",!1),i.requestList()}).fail(function(){a.Toast.error(h["default"]("修改失败")),i.data.set("submiting.name",!1)})},showFormDialog:function(){this.ref("keypairCreate").showFormDialog()},refresh:function(){this.$reload()}})}),define("bcc/ssh/vmBind",["exports","module","inf-ui/sanx","san-xui","common/util/timeUtil","babel-runtime/helpers/interop-require-default","inf-i18n","../enum","underscore","../config"],function(exports,module,e,t,a,i,n,s,r,o){var c=i["default"](a),l=i["default"](n),d=i["default"](r);module.exports=e.defineComponent({components:{"xui-table":t.Table,"xui-textbox":t.TextBox,"xui-pager":t.Pager,"xui-searchbox":t.SearchBox,"xui-button":t.Button,"xui-icon":t.Icon,"xui-dialog":t.Dialog,"x-row":t.Row,"xui-tip":t.Tip},template:'\n<template>\n<xui-dialog s-ref="ssh-vm-dialog" class="ssh-vm-content" width="700" on-confirm="confirmVm" on-close="closeSshDialog" open="{=isShowbinglist=}" title="{{vmTitle}}">\n    <div class="ssh-vm-tip">{{vmTipText}}</div>\n    <div class="ssh-vm-herder">\n        <label class="ssh-vm-herder-label">请选择要绑定的虚机：</label>\n        <xui-searchbox\n            class="ssh-vm-herder-search"\n            width="200"\n            on-search="getVmList(vmSearch)"\n            value="{=vmSearch.keyword=}"\n            keyword-type="{=vmSearch.keywordType=}"\n            datasource="{{vmSearch.keywordTypes}}"/>\n    </div>\n    <xui-table\n        select="multi"\n        schema="{{vmTable.schema}}"\n        on-command="onCommand($event)"\n        loading="{{vmTable.loading}}"\n        error="{{vmTable.error}}"\n        cell-builder="{{vmTable.cellRenderer}}"\n        selected-index="{=vmTable.selectedIndex=}"\n        on-selected-change="onTableRowSelected($event)"\n        datasource="{{vmListTable.result}}">\n        <div slot="error">\n            {{table.error ? table.error : \'列表数据加载异常\' | raw}} <a href="javascript:void(0)" on-click="getVmList()">重新加载</a>\n        </div>\n    </xui-table>\n    <xui-pager size="{{pager.size}}"\n        class="float-right"\n        page="{{pager.pageNo}}"\n        count="{{vmListTable.totalCount}}"\n        on-change="getVmList(vmSearch,$event)" />\n    <xui-button slot="foot"\n        on-click="onConfirmDialog" skin="primary"\n        disabled="{{vmTable.selectedIndex.length === 0 ? true : false}}">确认</xui-button>\n    <xui-button slot="foot" on-click="onCloseDialog">取消</xui-button>\n</xui-dialog>\n</template>\n',initData:function(){return{vmTable:{selectedIndex:[],schema:[{name:"name",label:"实例名称"},{name:"instanceId",label:"实例ID"},{name:"internalIp",label:"内网IP"},{name:"expireTime",label:"到期时间"},{name:"tags",label:"标签"}],loading:!1,cellRenderer:function(e,t,a,i){if("name"===t){var n=d["default"].escape(e.name);return"<span>"+(n.length>22?n.slice(0,22)+"...":n)+"</span>"}if("instanceId"===t)return"<span>"+e.instanceId+"</span>";if("expireTime"===t)return e.payment===s.ProductType.PREPAY?c["default"].toUtcTime(e.expireTime)||"-":"-";if("tags"===t){if(!e.tags||e.tags.length<1)return"-";var r="",o="";return d["default"].each(e.tags,function(e,t){o+="{"+e.tagKey+" : "+e.tagValue+"} ",t<2&&(r+=e.tagKey+" : "+e.tagValue+"<br/>")}),'\n                            <div title="'+o+'">\n                                '+r+"\n                            </div>"}return e[t]}},vmSearch:{keyword:"",keywordType:"name",keywordTypes:[{text:"实例名称",value:"name"},{text:"实例ID",value:"instanceId"}]},pager:{size:10,pageNo:1}}},computed:{vmTipText:function(){var e=this.data.get("bindType");if(e)return-1===e.indexOf("UNBIND")?"温馨提示：密钥对绑定成功后，虚机的原密码仍可用；虚机如有原密钥对会被替换为新密钥对":"温馨提示：密钥对解绑后，虚机可用原密码登录；对于没有设置密码的虚机，系统会自动生成一个原始密码"},vmTitle:function(){var e=this.data.get("bindType");if(e)return-1===e.indexOf("UNBIND")?"绑定虚机":"解绑虚机"}},closeSshDialog:function(){this.data.set("isShowbinglist",!1)},openSshDialog:function(){this.data.set("isShowbinglist",!0)},confirmVm:function(){var e=this,a=this.data.get(),i=a.bindType,n=a.vmTable,s=a.vmListTable,r=this.data.get("payload.keypairId"),c=d["default"].pick.apply(d["default"],[s.result].concat(n.selectedIndex)),u=d["default"].map(c,function(e){return e.instanceId}),p=-1===i.indexOf("UNBIND")?o.api.sshAttach:o.api.sshDetach,f=-1===i.indexOf("UNBIND")?"绑定":"解绑";p({keypairId:r,instanceIds:u},{"x-silent":!0}).then(function(a){t.Toast.success(l["default"]("密钥对"+f+"成功")),e.fire("ok")}).fail(function(e){e.field&&e.field.mfa||t.Toast.error(l["default"]("密钥对"+f+"失败"))})},attached:function(){var e=this;this.watch("bindType",function(t){e.getVmList()}),this.watch("isShowbinglist",function(t){e.data.set("vmTable.selectedIndex",[]),e.data.set("vmSearch.keyword",""),e.data.set("vmSearch.keywordType","name"),!t&&e.getVmList()})},getVmList:function(e,t){var a=this,i=undefined,n=this.data.get("bindType"),s=e||this.data.get("vmSearch"),r=d["default"].isObject(t)?t.pageNo:1,c=s.keyword?d["default"].trim(d["default"].escape(s.keyword)):"",l=s.keyword?s.keywordType:"";if(this.data.set("vmTable.loading",!0),-1===n.indexOf("UNBIND")){i={excludeKeypairId:this.data.get("payload.keypairId"),pageNo:r,pageSize:this.data.get("pager.size")}}else{i={keypairId:this.data.get("payload.keypairId"),pageNo:r,pageSize:this.data.get("pager.size")}}o.api.bccInstanceList(d["default"].extend(i,{filters:[{keyword:c,keywordType:l},{keywordType:"osType",keyword:"linux"},{keywordType:"status",keyword:"SHUTOFF,ACTIVE"}]}),{"x-silent":!0}).then(function(e){a.data.set("vmListTable",e),a.data.set("pager.pageNo",e.pageNo),a.data.set("vmTable.loading",!1),a.data.set("vmTable.error",!1)}).fail(function(e){a.data.set("vmTable.loading",!1),a.data.set("vmTable.error",!0)})},onConfirmDialog:function(){this.ref("ssh-vm-dialog").onConfirmDialog()},onCloseDialog:function(){this.ref("ssh-vm-dialog").onCloseDialog()}})}),define("bcc/startup",["exports","module","bat-ria/tpl!./common.tpl","underscore","babel-runtime/helpers/interop-require-default","./config","common/startup","common/storage","./app/manager","./rpc/brpc"],function(exports,module,e,t,a,i,n,s,r,o){var c=a["default"](t),l=a["default"](i),d=a["default"](n),u=a["default"](s),p=a["default"](r),f=a["default"](o);module.exports={initialize:c["default"].once(function(){f["default"].activate(),d["default"].initialize(l["default"])}),start:function(){return l["default"].initData=c["default"].wrap(l["default"].initData,function(e,t,a){return e(t,a).then(function(){return p["default"].start()})}),p["default"].keep().then(function(){return d["default"].start(l["default"])}).then(function(){return l["default"].api.bccWhiteTags().then(function(e){u["default"].set("whiteTags",JSON.stringify({isNewFlavor:c["default"].contains(e,"BCCNewFlavor"),isCustomVmFlavor:c["default"].contains(e,"CustomVmFlavor"),isScriptFlavor:c["default"].contains(e,"BccCreateWithScript"),bindEip:c["default"].contains(e,"EipBlackList"),isGpuK1200:c["default"].contains(e,"gpuK1200"),isGpuResize:c["default"].contains(e,"gpuBccResizeWhiteList")}))})})},stop:function(){p["default"].dispose()}}}),define("bcc/tips",["exports","module","inf-i18n","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t){var a=t["default"](e);module.exports={forbiddenTip:a["default"]("因违反")+'<a target="_blank" href="http://bce.baidu.com/doc/UserGuide/info_safety.html">'+a["default"]("《百度云信息安全规定》")+"</a>，"+a["default"]("您的BCC产品服务已被封禁，")+a["default"]("请清理违规内容后通过")+'<a target="_blank" href="http://ticket.bce.baidu.com/#/ticket/create">'+a["default"]("工单")+"</a>"+a["default"]("申请解禁"),instance:{instanceType:{7:a["default"]("内置INTEL Xeon Broadwell ")+'<span class="bcc-color-red">E5-2680 V4 2.4GHZ</span>'+a["default"]("的新款CPU，搭配DDR4内存，整体计算性能显著提升，同时全面支持网络优化，提升报文转发能力。"),4:a["default"]("内置")+'Intel Xeon E5 V4 <span class="bcc-color-red">3.2GHz</span>'+a["default"]("超高主频CPU。")+'<a href="https://cloud.baidu.com/publicity/bccplus.html#bccplus-introduction">'+a["default"]("了解详情")+"&gt;</a>",5:a["default"]("内置NVME SSD高性能本地磁盘，提供")+'<span class="bcc-color-red">'+a["default"]("16万+IOPS")+"</span>"+a["default"]("的吞吐能力。")+'<a href="https://cloud.baidu.com/publicity/bccplus.html#bccplus-introduction">'+a["default"]("了解详情")+"&gt;</a>",8:a["default"]("内置FPGA加速卡，同时配备相关开发环境。"),9:a["default"]("内置英伟达GPU卡，最高可提供40+Tflops单精度浮点计算能力。"),10:a["default"]("采用Intel最新一代")+'Skylake Xeon Gold 6148 CPU 2.4GHz。<a href="https://cloud.baidu.com/doc/BCC/GettingStarted_new.html#.E5.AE.9E.E4.BE.8B.E7.B1.BB.E5.9E.8B" target="_blank">'+a["default"]("详情请参考")+"&gt;</a>"},gpuCard:a["default"]("NVIDIA Tesla V100：5210个CUDA单元、16GB显存、15Tflops单精度浮点运算处理能力。")+"<br>"+a["default"]("NVIDIA Tesla P40：3840个CUDA单元、24GB显存、12Tflops单精度浮点运算处理能力。")+"<br>"+a["default"]("NVIDIA Tesla P4：2560个CUDA单元、8GB显存、5.5Tflops单精度浮点运算处理能力。")+"<br>NVIDIA Tesla K40："+a["default"]("2880个CUDA单元、12GB显存、4.29Tflops单精度浮点运算处理能力。")+"<br>"+a["default"]("NVIDIA 深度学习开发卡：3594个CUDA单元、12GB 显存、11Tflops浮点运算处理能力。")+"<br>",cpu:a["default"]("如需特殊规格配置，可提交工单审核")+'<a href="http://ticket.bce.baidu.com/#/ticket/create" target="_blank">工单入口&gt;&gt;</a>',cds:'<a href="http://bce.baidu.com/doc/CDS/index.html" target="_blank">CDS（Cloud Disk Service）</a>'+a["default"]("即云磁盘服务， 是基于三副本存储机制的高可靠性、高伸缩性和高迁移能力的块存储磁盘设备")+"<br>"+a["default"]("最多可同时挂载5块云磁盘"),tempDisk:"本地磁盘具备高IO特性，以RAID5保障数据安全性。仅建议存储临时数据使用",highTempDisk:"高性能本地磁盘盘具备超高IO特性，适合高速吞吐的业务场景，无RAID，仅建议存储临时数据使用",tempDiskSize:{ssd:a["default"]("本地磁盘为基于Raid5的本地SSD磁盘，具备高IO特性，适用于存储临时数据或有极高IO需求的应用使用。该盘仅能创建1块，不能孤立")+a["default"]("存在，不支持快照，不支持挂载到其他云服务器实例。开通后暂不支持追加。"),nvme:a["default"]("高性能本地磁盘为使用最新接口标准NVME的本地SSD磁盘，具备超高IO特性， 适用于存储临时数据或有极高IO需求的")+a["default"]("应用场景。该盘仅能创建1块，不能孤立存在，不支持快照，不支持挂载到其他云服务器实例。开通后暂不支持追加。")},secureTip:a["default"]("安全组是在服务器外部做防护，如果服务器本身有防火墙（如windows高级安全防火墙，Linux的iptables防火墙）")+a["default"]("则需要在防火墙做相应设置。")+"</br>"+a["default"]("请在实例创建后，根据实际访问需求添加或修改访问规则"),bccDeleteTip:a["default"]("实例释放后不可恢复，该实例的所有快照也将同时删除，该实例挂载的云磁盘不会被释放，请确认是否继续操作"),snapshotRemender:a["default"]("温馨提示：")+"<br>"+a["default"]("1. 请选择业务负载低的时段执行自动快照，以免影响自动快照的创建。")+"<br>"+a["default"]("2. 本地磁盘不能创建自动快照，只能在系统盘和CDS云磁盘创建快照。")+"<br>",snapshotRemenderDcc:a["default"]("温馨提示：")+"<br>"+a["default"]("1. 请选择业务负载低的时段执行自动快照，以免影响自动快照的创建。")+"<br>"+a["default"]("2. 本地磁盘不能创建自动快照，只能在系统盘和CDS云磁盘创建快照。")+"<br>",saleTip:{12:{bcc:a["default"]("注：购买1年8.3折"),eip:"",cds:a["default"]("注：购买1年8.3折"),mkt:a["default"]("云市场镜像以商家定价为准")},24:{bcc:a["default"]("注：实例与磁盘购买2年7折"),eip:a["default"]("弹性公网IP购买2年8.3折"),cds:a["default"]("注：购买2年7折"),mkt:a["default"]("云市场镜像以商家定价为准")},36:{bcc:a["default"]("注：实例与磁盘购买3年5折"),eip:a["default"]("弹性公网IP购买3年8.3折"),cds:a["default"]("注：购买3年5折"),mkt:a["default"]("云市场镜像以商家定价为准")}},buyEipTip:"如需公网访问请购买弹性公网IP，或购买成功后绑定已有弹性公网IP",beianPostpay:a["default"]("后付费云服务器（BCC）暂不支持备案"),beianPrepay:a["default"]("1. 弹性公网IP（EIP）需绑定在负载均衡（BLB）或预付费云服务器（BCC）上方可进行备案。")+"<br>"+a["default"]("2. 若您涉及网站部署并需要使用独立域名，请绑定弹性公网IP（EIP）并进行备案；目前暂不受理西藏地区备案业务，请慎重购买。"),beianHKTip:a["default"]("于香港区域部署的网站服务无需进行备案操作，因此百度云不提供对此区域主机的备案服务。"),adminPassCustomTip:a["default"]("请牢记此管理员密码，系统将不再通过短信发送用户自定义密码"),adminPassRandomTip:a["default"]("请在购买成功后登录控制台重置密码，系统将不再通过短信发送随机密码"),osVersion:a["default"]("支持 Windows Server 2016 系统最小配置为2核CPU+2G内存"),ssh:a["default"]('SSH密钥对是一种比常规密码更安全的登录云服务器的方式，更多内容详见<a href="https://cloud.baidu.com/doc/BCC/GettingStarted.html#.E5.AF.86.E9.92.A5.E5.AF.B9" target="_blank">帮助文档&gt;</a>')},cds:{cds:'<a href="http://bce.baidu.com/doc/CDS/index.html" target="_blank">CDS（Cloud Disk Service）</a>'+a["default"]("即云磁盘服务， 是基于三副本存储机制的高可靠性、高伸缩性和高迁移能力的块存储磁盘设备"),attachTip:a["default"]("温馨提示：")+a["default"]("磁盘挂载成功后即可在云服务器上看到对应设备，但您仍需进入操作系统完成磁盘系统挂载操作：")+a["default"]("如登录Windows，进入磁盘管理，进行磁盘初始化和分区；如登录Linux，执行fdisk和mount命令。")+a["default"]("请参见")+'<a href="https://cloud.baidu.com/doc/CDS/GettingStarted.html#.E6.A0.BC.E5.BC.8F.E5.8C.96.E7.A3.81.E7.9B.98" target="_blank">'+a["default"]("操作指南")+"&gt;&gt;</a>",detachTip:a["default"]("为了安全卸载，Windows系统请对要卸载磁盘进行脱机，Linux系统请对磁盘执行unmount操作。")+a["default"]("请参见")+'<a href="https://cloud.baidu.com/doc/CDS/GettingStarted.html#.E5.8D.B8.E8.BD.BDCDS.E7.A3.81.E7.9B.98" target="_blank">'+a["default"]("操作指南")+"&gt;&gt;</a>",highCds:a["default"]("高性能云磁盘限速4000 IOPS，如需使用最高2w IOPS的云磁盘，请提交")+'<a target="_blank" href="http://ticket.bce.baidu.com/#/ticket/create">'+a["default"]("工单申请")+"</a>",sellOutTip:a["default"]("当前可用区的CDS云磁盘已售罄，您可以切换可用区进行购买；如您确实需要在当前可用区购买云磁盘，请通过")+'<a target="_blank" href="https://ticket.bce.baidu.com/#/ticket/create">'+a["default"]("工单")+"</a>"+a["default"]("与我们联系"),ssdTip:a["default"]("SSD云磁盘火热公测中，提供高达2.4w IOPS和260 MB/s吞吐，")+'<a target="_blank" href="https://cloud.baidu.com/survey/SsdCdsApply.html">'+a["default"]("点击申请")+">></a>",howToSelectTip:a["default"]("如何选择 SSD云磁盘 / 高性能云磁盘 / 普通云磁盘，")+'<a target="_blank" href="https://cloud.baidu.com/doc/CDS/ProductDescription.html">'+a["default"]("请查看详细说明")+">></a>"},cdsDiscount:{prepay:'<i class="iconfont icon-horn"></i>'+a["default"]("高性能CDS优惠促销中，原价0.7元/GB/月，")+'<span class="bcc_eb5252">'+a["default"]("现仅需0.3元/GB/月。")+"</span>",postpay:'<i class="iconfont icon-horn"></i>'+a["default"]("高性能CDS优惠促销中，原价0.0000163元/GB/分钟，")+'<span class="bcc_eb5252">'+a["default"]("现仅需0.000007元/GB/分钟。")+"</span>"},imageTips:{common:a["default"]("由百度云官方提供，仅包含基础操作系统环境"),custom:a["default"]("用户通过“创建自定义镜像”功能生成的镜像，")+a["default"]("包含用户针对系统盘基础操作系统、应用及软件环境的个性化配置。")+a["default"]("自定义镜像可以帮助您快速创建包含个性化配置的云服务器"),integration:a["default"]("基于基础操作系统并集成有通用服务和应用软件环境的镜像。")+a["default"]("由百度或第三方服务商提供，经由百度云审核后发布。")+a["default"]("服务集成镜像可帮助您快速创建包含控制面板、PHP等常用运行环境的云服务器"),sharing:a["default"]("支持用户将自定义镜像共享给其他用户，被共享用户可以通过管理控制台或API查询到其他用户共享的镜像。")+a["default"]("被共享用户可以使用其他用户共享的镜像创建实例和重装操作系统。"),fpgaImage:a["default"]("由百度云官方提供，仅包含基础操作系统环境"),fpgaCustom:a["default"]("用户通过“创建自定义镜像”功能生成的镜像，")+a["default"]("包含用户针对系统盘基础操作系统、应用及软件环境的个性化配置。")+a["default"]("自定义镜像可以帮助您快速创建包含个性化配置的云服务器"),gpuBccImage:a["default"]("由百度云官方提供，仅包含基础操作系统环境"),gpuBccCustom:a["default"]("用户通过“创建自定义镜像”功能生成的镜像，")+a["default"]("包含用户针对系统盘基础操作系统、应用及软件环境的个性化配置。")+a["default"]("自定义镜像可以帮助您快速创建包含个性化配置的云服务器"),mkt:a["default"]("由第三方服务商提供的，经百度云审核后发布在云市场的镜像环境。包含丰富的服务运行环境和应用软件，可帮助您")+a["default"]("快速应对各类解决方案场景（目前暂不支持后付费镜像）。")}}}),define("bcc/util",["require","jquery","underscore"],function(require){function e(e,t){var a=e.name,i=t.name;return a.localeCompare(i)}function t(e){return i.reduce(e,function(e,t){return e[t.key]?e[t.key]++:e[t.key]=1,e},{})}var a=require("jquery"),i=require("underscore"),n="";return{formatOsData:function(t,a,i,n){for(var s=i[t]||[],r=n[t]||{},o={},c={},l=0;l<a.length;++l){var d=a[l],u=d.osName;if(o[u]||(o[u]=1,s.push({name:u,value:d.osType,title:u.toLowerCase(),osType:d.osType})),r[u]||(r[u]=[],c[u]={}),"common"===t){var p=d.osVersion;c[u][p]||(c[u][p]=1,r[u].push({name:p,value:p,imageId:d.id,minMem:d.minMem,minCpu:d.minCpu,minDiskSize:d.ephemeralSize,imageType:d.imageType||t,fpgaType:d.fpgaType||"",minDiskGb:d.minDiskGb,maxRamGb:d.maxRamGb,osType:d.osType}))}else r[u].push({name:d.name,value:d.osVersion,imageId:d.id,minMem:d.minMem,minCpu:d.minCpu,minDiskSize:d.ephemeralSize,imageType:d.imageType||t,fpgaType:d.fpgaType||"",minDiskGb:d.minDiskGb,maxRamGb:d.maxRamGb,osType:d.osType})}s&&s.sort(e)},getStatusColumnIndex:function(e,t){for(var a=0,i=e.get("fields"),n=0;n<i.length;n++)if(i[n].field===t){a=n;break}return"multi"===e.get("select")&&a++,a},animate:function(e,t,i){t=a(t),i=i||1600,t.addClass(e);var n=setTimeout(function(){t.removeClass(e),clearTimeout(n)},i)},compareSecurityRulesList:function(e,a){if(e.length===a.length){var n=t(e),s=t(a);i.isEqual(n,s)}return!1},sortSecurityRule:function(e,t){return e.key.localeCompare(t.key)},triggerCommand:function(e,t){try{t=t||{},t=JSON.parse(t)}catch(a){}this.fire("command",{command:e,args:t})},isUpdateCDSSidebar:function(e){var t=!1;return n!==e&&(n=e,t=!0),t},get24HoursTime:function(){return{0:"00:00",1:"01:00",2:"02:00",3:"03:00",4:"04:00",5:"05:00",6:"06:00",7:"07:00",8:"08:00",9:"09:00",10:"10:00",11:"11:00",12:"12:00",13:"13:00",14:"14:00",15:"15:00",16:"16:00",17:"17:00",18:"18:00",19:"19:00",20:"20:00",21:"21:00",22:"22:00",23:"23:00"}},accAdd:function(e,t){var a,i,n,s;try{a=e.toString().split(".")[1].length}catch(o){a=0}try{i=t.toString().split(".")[1].length}catch(o){i=0}if(s=Math.abs(a-i),n=Math.pow(10,Math.max(a,i)),s>0){var r=Math.pow(10,s);a>i?(e=Number(e.toString().replace(".","")),t=Number(t.toString().replace(".",""))*r):(e=Number(e.toString().replace(".",""))*r,t=Number(t.toString().replace(".","")))}else e=Number(e.toString().replace(".","")),t=Number(t.toString().replace(".",""));return(e+t)/n},isRocV2Disk:function(e){return 1===e.rocV2}}}),define("dcc/action.conf",["exports","module","./host/action.conf","babel-runtime/helpers/interop-require-default","./instance/action.conf","./image/action.conf","./disk/action.conf","./snapshot/action.conf","./operation/action.conf"],function(exports,module,e,t,a,i,n,s,r){var o=t["default"](e),c=t["default"](a),l=t["default"](i),d=t["default"](n),u=t["default"](s),p=t["default"](r);module.exports=[o["default"],c["default"],l["default"],d["default"],u["default"],p["default"]]}),define("dcc/common.tpl",[],function(){return'\x3c!-- target: TPL_dcc_host_detail_navigator --\x3e\n<ul class="ui-tab-navigator">\n    <li class="ui-tab-item\x3c!-- if: ${activedTab} == \'detail\' --\x3e ui-tab-item-active\x3c!-- /if --\x3e">\n        <a href="#/dcc/host/detail~id=${id}">${i18n.专属服务器详情}</a>\n    </li>\n    <li class="ui-tab-item\x3c!-- if: ${activedTab} == \'instance\' --\x3e ui-tab-item-active\x3c!-- /if --\x3e">\n        <a href="#/dcc/host/instance~id=${id}">${i18n.关联专属实例}</a>\n    </li>\n</ul>\n\n\x3c!-- target: TPL_dcc_instance_detail_navigator --\x3e\n<ul class="ui-tab-navigator">\n    <li class="ui-tab-item ${tab.detail}">\n        <a href="#/dcc/instance/detail~instanceId=${instanceId}&id=${instance.hostUuid}">${i18n.专属实例详情}</a>\n    </li>\n    \x3c!-- if: !${instance.rdsUuid} --\x3e\n    <li class="ui-tab-item ${tab.cds}">\n        <a href="#/dcc/disk/list~instanceId=${instance.id}&id=${instance.hostUuid}">${i18n.本实例磁盘}</a>\n    </li>\n    <li class="ui-tab-item ${tab.snapshot}">\n        <a href="#/dcc/snapshot/list~instanceId=${instance.id}&id=${instance.hostUuid}">${i18n.本实例快照}</a>\n    </li>\n    <li class="ui-tab-item ${tab.security}">\n        <a href="#/dcc/instance/securityGroups~instanceId=${instance.id}&id=${instance.hostUuid}">${i18n.安全组}</a>\n    </li>\n    \x3c!-- /if --\x3e\n    \x3c!-- if: !${consoleContext.FLAGS.enable_baixin} --\x3e\n    <li class="ui-tab-item ${tab.monitor}">\n        <a href="#/dcc/instance/monitor~instanceId=${instance.id}&id=${instance.hostUuid}">${i18n.监控}</a>\n    </li>\n    \x3c!-- /if --\x3e\n</ul>\n\n\x3c!-- target: TPL_dcc_disk_detail_navigator --\x3e\n<ul class="ui-tab-navigator">\n    <li class="ui-tab-item ${tab.detail}">\n        <a href="#/dcc/disk/detail~instanceId=${instanceId}">${i18n.本地磁盘详情}</a>\n    </li>\n</ul>\n\n\x3c!-- target: TPL_dcc_common_search --\x3e\n<span class="ui-group ui-search-group">\n    <span data-ui-type="SelectEx" data-ui-id="keywordType"\n        data-ui-value="@keywordType" data-ui-has-child-list="true"\n        data-track-id="ti_bcc_dcc_search_select" data-track-name="下拉选择"></span>\n    <input class="search-box" data-ui-type="TextBox"\n        data-ui-id="keyword" data-ui-value="@keyword"/>\n    <button type="button" data-ui-type="Button" data-ui-id="searchBtn"\n    data-track-id="ti_bcc_dcc_search" data-track-name="搜索"></button>\n    \x3c!-- if: ${keyword} --\x3e\n    <button type="button"\n            data-ui-type="Button"\n            data-ui-id="clearKeyword"\n            title="${i18n.清空搜索条件}"\n            class="link-like clear-button"\n            data-track-id="ti_bcc_dcc_search_clear"\n            data-track-name="清空搜索">${i18n.清空}</button>\n    \x3c!-- /if --\x3e\n</span>\n\n\x3c!-- target: TPL_dcc_common_quick_search --\x3e\n<span class="quick-search-wrap">\n    ${i18n.快捷筛选：}\n    <ul class="quick-search-filters">\n        <li\n            \x3c!-- if: ${filterMapper.expiredDate<7} --\x3e\n            class="link-like actived"\n            title="${i18n.清除快捷筛选：7天即将到期}"\n            \x3c!-- else: --\x3e\n            class="link-like"\n            title="${i18n.快捷筛选：7天即将到期}"\n            \x3c!-- /if --\x3e\n            data-key="expiredDate" data-op="<" data-value="7">\n            ${i18n.7天即将到期}\n            <span class="close">×</span>\n        </li>\n    </ul>\n</span>\n\n\x3c!-- target: TPL_dcc_breadcrumb --\x3e\n<span>${i18n.产品服务}</span>\n<span class="divider">/</span>\n\x3c!-- if: ${fatherPage} --\x3e\n    <span><a href="${fatherUrl}">${fatherPage}</a></span>\n    <span class="divider">/</span>\n\x3c!-- /if --\x3e\n<span class="active">${currentPage}</span>\n\n\n\n\x3c!-- target: TPL_dcc_instance_detail_loading(master = TPL_dcc_instance_detail_structure) --\x3e\n\x3c!-- block: abstrct-info --\x3e\n<div class="loading-container">\n    <span class="loading">${i18n.数据加载中，请稍后…}</span>\n</div>\n\x3c!-- /block --\x3e\n\x3c!-- block: detail-info --\x3e\n<div class="loading-container">\n    <span class="loading">${i18n.数据加载中，请稍后…}</span>\n</div>\n\x3c!-- /block --\x3e\n\n\x3c!-- target: TPL_dcc_instance_detail_structure --\x3e\n<div class="dcc-wrapper main-wrap-new dcc-list dcc-detail">\n    <div class="content-wrap">\n\n        <div class="breadcrumb">\n            \x3c!-- block: detail-breadcrumb --\x3e\n            \x3c!-- use: TPL_dcc_breadcrumb(fatherUrl=\'#/dcc/instance/list\', fatherPage=\'专属服务器 - 实例列表\', currentPage=\'专属实例详情\') --\x3e\n            \x3c!-- /block --\x3e\n        </div>\n        <div class="instance-info">\n        \x3c!-- block: abstrct-info --\x3e\x3c!-- /block --\x3e\n        \x3c!-- block: operation-info --\x3e\x3c!-- /block --\x3e\n        </div>\n        <div class="detail-content">\n            \x3c!-- block: detail-navigator --\x3e\x3c!-- /block --\x3e\n            <div class="dcc-instance-info-detail ui-tab-content"\n                data-ui-type="Panel"\n                data-ui-id="instanceInfoDetailPanel"\n                data-ui-extension-command-type="Command">\n                \x3c!-- block: detail-info --\x3e\x3c!-- /block --\x3e\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("dcc/config",["exports","module","./config/action","./config/api","babel-runtime/helpers/interop-require-default","./config/tips","./config/events","./config/lang","./config/html","./config/host","./config/instance","./config/image","./config/disk","./config/rule","./config/flags","./util"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p,f){var m=a["default"](t),h=a["default"](i),g=a["default"](n),v=a["default"](s),b=a["default"](r),y=a["default"](o),T=a["default"](c),x=a["default"](l),I=a["default"](d),S=a["default"](u),E=a["default"](p);module.exports=f.deepExtend({DCC_LISTEN_INTERVAL:6e4},{api:m["default"],tips:h["default"],events:g["default"],html:b["default"],lang:v["default"],dcc:{host:y["default"],instance:T["default"],image:x["default"],disk:I["default"]},rule:S["default"],flags:E["default"]})}),define("dcc/config/action",["exports","underscore","babel-runtime/helpers/interop-require-default","er/controller","../host/action.conf"],function(exports,e,t,a,i){var n=t["default"](e),s=t["default"](a),r=[t["default"](i)["default"]];s["default"].registerAction(n["default"].flatten(r))}),define("dcc/config/api",["exports","module"],function(exports,module){module.exports={getDccHostPrice:"/api/bcc/dcc/order/price",getDccHostQuota:"/api/bcc/dcc/host/quota",getDccHostList:"/api/bcc/dcc/host/list",getDccHostDetail:"/api/bcc/dcc/host/detail",getDccHostDetails:"/api/bcc/dcc/host/details",getImageListGroup:"/api/bcc/image/list/group",getDccSecurityGroupList:"/api/network/v1/security/list_select",createDccInstance:"/api/bcc/dcc/instance/create",deleteDccHost:"/api/bcc/dcc/host/delete",updateDccHostVcpu:"/api/bcc/dcc/host/vcpu",deleteInstance:"/api/bcc/dcc/instance/delete",editHostName:"/api/bcc/dcc/host/rename",editHostDescription:"/api/bcc/dcc/host/redescription",sendAuthCode:"/api/bcc/authcode/send",invalidateAuthCode:"/api/bcc/authcode/invalidate",getDccInstanceList:"/api/bcc/dcc/instance/list",getDccInstanceDetail:"/api/bcc/instance/detail",editInstanceName:"/api/bcc/instance/rename",editInstanceDesc:"/api/bcc/instance/update_desc",startInstance:"/api/bcc/instance/start",stopInstance:"/api/bcc/instance/stop",rebootInstance:"/api/bcc/instance/reboot",changeInstancePwd:"/api/bcc/instance/changepwd",instanceRebuild:"/api/bcc/instance/rebuild",unbindEipInstance:"/api/bcc/eip/unbind",bindEipInstance:"/api/bcc/eip/bind",eipInstanceList:"/api/bcc/eip/unused_eips",vncUrlInstance:"/api/bcc/instance/vnc",configChangeInstance:"/api/bcc/dcc/instance/updateConfig/create",editImageName:"/api/bcc/image/rename",deleteImage:"/api/bcc/image/delete",dccImageShare:"/api/bcc/image/share",dccImageUnshare:"/api/bcc/image/unshare",dccImageShareAccountList:"/api/bcc/image/shared_users",dccQuota:"/api/bcc/instance/quota",vncUrl:"/api/bcc/instance/vnc",dccSnapshotCreate:"/api/bcc/snapshot/create",dccImageCreate:"/api/bcc/instance/create_image",getDccSecurityList:"/api/network/v1/security/list",joinSecurityGroups:"/api/network/v1/security/join_security_groups",dccSnapshotList:"/api/bcc/snapshot/list",getDccHostFlavor:"/api/bcc/dcc/host/flavor",getRecycleWhitelist:"/api/recycle/whitelist"}}),define("dcc/config/disk",["exports","module"],function(exports,module){module.exports={DEFAULT:{}}}),define("dcc/config/events",["exports","module","underscore","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t){var a=t["default"](e);module.exports=a["default"].defaults({OS_TYPE_CHANGE:"osTypeChange",FORM_CHANGED:"formchanged",EDIT_TAG:"editag"},{CHANGE:"change",BACKWARD:"backward",LOAD_ERROR:"loaderror",COMMAND:"command",FILTER:"filter"})}),define("dcc/config/flags",["exports","module","underscore","babel-runtime/helpers/interop-require-default","common/flags"],function(exports,module,e,t,a){var i=t["default"](e),n=t["default"](a);module.exports=i["default"].extend({enable_rsa_encrypt:!0},n["default"])}),define("dcc/config/host",["exports","module"],function(exports,module){module.exports={DEFAULT:{QUOTA:15,PAGE_SIZE:10},PRODUCT_TYPE:{PREPAY:"prepay",POSTPAY:"postpay"}}}),define("dcc/config/html",["exports","module","underscore","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t){var a=t["default"](e);module.exports={error:{inline:function(){return'<span class="dcc-error">'+(arguments.length<=0||arguments[0]===undefined?"":arguments[0])+"</span>"}},loading:{inline:function(){return'<span class="loading">'+(arguments.length<=0||arguments[0]===undefined?"":arguments[0])+"</span>"}},operation:{tableEdit:function(e){return e.disabled?"":'\n                        <span class="ui-table-cell-editentry"\n                            data-row="'+e.commandArgs.row+'" data-col="'+e.commandArgs.col+'">\n                            <i class="iconfont icon-edit"></i>\n                        </span>\n                    '},linkButton:function(e){var t=e.disabled?'disabled="disabled"':"",i="cmd-button"+(e.disabled?" state-disabled":""),n=JSON.stringify(e.commandArgs);return'\n                <span class="opration">\n                    <button\n                        title="'+e.title+'"\n                        data-command="'+e.command+"\"\n                        data-command-args='"+a["default"].escape(n)+"'\n                        "+t+'\n                        class="'+i+'"\n                        data-track-id="ti_bcc_dcc_'+e.command+'"\n                        data-track-name="'+e.label+'">\n                        '+e.label+"\n                    </button>\n                </span>\n            "},linkButtonEx:function(e){var t=JSON.stringify(e.commandArgs);return e.permission.disable?'\n                    <span class="opration">\n                        <span data-ui-type="Button"\n                            data-ui-id="'+(e.command+e.commandArgs.row)+'"\n                            data-ui-disabled="true"\n                            data-ui-extension-popover-type="PopoverEx"\n                            data-ui-popover="'+e.permission.message+'"\n                            class="cmd-button state-disabled"\n                            data-track-id="ti_bcc_dcc_'+e.command+'" data-track-name="'+e.label+'">\n                            '+e.label+"\n                        </span>\n                    </span>\n                ":'\n                <span class="opration">\n                    <button\n                        title="'+e.title+'"\n                        data-command="'+e.command+"\"\n                        data-command-args='"+a["default"].escape(t)+'\'\n                        class="cmd-button"\n                        data-track-id="ti_bcc_dcc_'+e.command+'"\n                        data-track-name="'+e.label+'">\n                        '+e.label+"\n                    </button>\n                </span>\n            "},operationSelect:function(e){var t=e.disabled?'disabled="disabled"':"";return'\n                <option\n                    value="'+e.value+'"\n                    '+t+">\n                    "+e.name+"\n                </option>\n            "},inlineEdit:function(e){return'\n                <span class="inline-edit-icon"></span>\n                <div class="inline-edit-main">\n                    <input type="text" />\n                    <button type="button">确定</button>\n                    <button type="button">取消</button>\n                </div>\n            '}}}}),define("dcc/config/image",["exports","module"],function(exports,module){module.exports={DEFAULT:{PAGE_SIZE:10,IMAGE_TYPE:{COMMON:"common",CUSTOM:"custom",INTEGRATION:"integration"}}}}),define("dcc/config/instance",["exports","module"],function(exports,module){module.exports={DEFAULT:{PAGE_SIZE:10},OS_IMAGE_NAME:["ubuntu","windows-server","centos","debian","windows","linux"]}}),define("dcc/config/lang",["exports","module"],function(exports,module){module.exports={PAYMENT:{FREE:"试用",prepay:"预付费",postpay:"后付费"}}}),define("dcc/config/rule",["exports","module"],function(exports,module){module.exports={HOST:{NAME:{placeholder:"大小写字母、数字以及-_ /.特殊字符，必须以字母开头，长度1-65",required:"required",requiredErrorMessage:"名称必填",pattern:/^[a-zA-Z][\w\-\/\.]{0,64}$/,patternErrorMessage:"名称不符合规则：支持大小写字母、数字以及-_ /.特殊字符，必须以字母开头，长度1-65"},DESCRIPTION:{placeholder:"长度0~140",maxLength:140,patternErrorMessage:"描述长度必须在0~140个字符之间"}},INSTANCE:{NAME:{placeholder:"大小写字母、数字以及-_ /.特殊字符，必须以字母开头，长度1-65",required:"required",requiredErrorMessage:"名称必填",pattern:/^[a-zA-Z][\w\-\/\.]{0,64}$/,patternErrorMessage:"名称不符合规则：支持大小写字母、数字以及-_ /.特殊字符，必须以字母开头，长度1-65"},PASSWORD:{required:"required",requiredErrorMessage:"密码必填",custom:function(e){return e.length>7&&e.length<33&&/[a-zA-Z]/.test(e)&&/\d/.test(e)&&/[!@#$%^*()]/.test(e)&&/^[a-zA-Z\d!@#$%^*()]+$/.test(e)},customErrorMessage:"8～32位字符，英文、数字和符号必须同时存在，符号仅限!@#$%^*()"}},SNAPSHOT:{NAME:{placeholder:"大小写字母、数字以及-_ /.特殊字符，必须以字母开头，长度1-65",required:"required",requiredErrorMessage:"名称必填",pattern:/^[a-zA-Z][\w\-\/\.]{0,64}$/,patternErrorMessage:"名称不符合规则：支持大小写字母、数字以及-_ /.特殊字符，必须以字母开头，长度1-65"}},IMAGE:{NAME:{placeholder:"大小写字母、数字以及-_ /.特殊字符，必须以字母开头，长度1-65",required:"required",requiredErrorMessage:"名称必填",pattern:/^[a-zA-Z][\w\-\/\.]{0,64}$/,patternErrorMessage:"名称不符合规则：支持大小写字母、数字以及-_ /.特殊字符，必须以字母开头，长度1-65"}}}}),define("dcc/config/tips",["exports","module","underscore","babel-runtime/helpers/interop-require-default","inf-i18n"],function(exports,module,e,t,a){var i=t["default"](e),n=t["default"](a);module.exports={saleTip:{12:n["default"]("注：购买10个月赠送2个月"),24:n["default"]("注：购买20个月赠送4个月"),36:n["default"]("注：购买30个月赠送6个月")},host:{description:n["default"]("专属服务器是部署了虚拟化程序的物理服务器，以套餐形式提供购买，需要在购买之后创建专属实例来进行使用"),status:n["default"]("一共有三种状态")+"<br />"+n["default"]("分别是运行中、已到期和离线"),noInstanceCreated:n["default"]("此专属服务器上还未创建专属实例，点击 “ + ” 开始创建专属实例。"),realname:i["default"].sprintf(n["default"]("温馨提示：购买专属服务器DCC需要实名认证，您还没有认证。请立即去%s"),'<a href="/qualify/#/qualify/index">'+n["default"]("认证")+"</a>"),quota:i["default"].sprintf(n["default"]("温馨提示：您创建的专属服务器实例已达到限额，如需增加配额请到%s申请"),'<a href="http://ticket.bce.baidu.com">'+n["default"]("工单")+"</a>"),vCpu:n["default"]("vCPU是DCC部署虚拟化程序后，用户能够实际使用的虚拟CPU核心。可以通过配置vCPU核数来有效利用CPU的能力。)")},instance:{description:n["default"]("专属实例是用户在专属服务器上创建的虚拟机，本质就是一个BCC实例，专属实例需占用服务器的cpu、内存、磁盘等资源才能够创建")},changePwd:{pwdDescription:n["default"]("8～17位字符，英文、数字和符号必须同时存在，符号仅限!@#$%^*()")},authCode:{hostInstance:i["default"].sprintf(n["default"](" 此操作将清除您专属服务器上的所有专属实例%s（不包括专属RDS实例，如需清除请在RDS实例页面中手动删除）%s，专属实例删除后将不可恢复，专属实例所有快照也将同时删除，请确认是否继续操作。"),'<span class="dcc-color-red">',"</span>"),instance:n["default"]("实例释放后不可恢复，该实例的所有快照也将同时删除，请确认是否继续操作。"),image:n["default"]("删除后不可恢复，请谨慎操作。"),host:n["default"]("温馨提示：专属服务器DCC释放后不可恢复，其所属专属实例的所有快照也将同时删除")},rebuildOs:{imageType:{common:n["default"]("由百度云官方提供，仅包含基础操作系统环境。"),custom:n["default"]("用户通过“创建自定义镜像”功能生成的镜像，")+n["default"]("包含用户针对系统盘基础操作系统、应用及软件环境的个性化配置。")+n["default"]("自定义镜像可以帮助您快速创建包含个性化配置的云服务器。"),integration:n["default"]("基于基础操作系统并集成有通用服务和应用软件环境的镜像。")+n["default"]("由百度或第三方服务商提供，经由百度云审核后发布。")+n["default"]("服务集成镜像可帮助您快速创建包含控制面板、PHP等常用运行环境的云服务器"),sharing:n["default"]("支持用户将自定义镜像共享给其他用户，被共享用户可以通过管理控制台或API查询到其他用户共享的镜像。")+n["default"]("被共享用户可以使用其他用户共享的镜像创建实例和重装操作系统。")},confirmPwd:n["default"]("请牢记此管理员密码，系统将不再通过短信发送用户自定义密码")}}}),define("dcc/disk/action.conf",["exports","module"],function(exports,module){module.exports=[{path:"/dcc/disk/list",type:"dcc/disk/list/Action"},{path:"/dcc/disk/detail",type:"dcc/disk/detail/Action"}]}),define("dcc/disk/detail/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","er/URL","babel-runtime/helpers/interop-require-default","../../../bcc/cds/Detail","./Model","./View"],function(exports,module,e,t,a,i,n,s,r){var o=i["default"](a),c=i["default"](n),l=i["default"](s),d=i["default"](r),u=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=l["default"],this.viewType=d["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.view.on("expandEphemeral",this.expandEphemeral,this)},i.prototype.expandEphemeral=function(e){var t=this.model.get("instanceId");this.redirect(o["default"].withQuery("/dcc/instance/configChange",{instanceId:t}))},i}(c["default"]);module.exports=u}),define("dcc/disk/detail/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","../../../bcc/cds/DetailModel","../../../bcc/config","../permission","../../enums"],function(exports,module,e,t,a,i,n,s,r,o,c){var l=n["default"](i),d=n["default"](s),u=n["default"](r),p=n["default"](o),f=u["default"].DISK_STATUS,m=u["default"].SYSTEM_DISK_STATUS,h=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.prepare=function(){i.prototype.prepare.call(this);var e=this.get("disk");e.diskTypeLabel=c.DiskType.getTextFromValue(e.type)||e.type||"",e.volumeId=e.volumeId||e.id;var t=c.DiskType.isCds(e.type)?f:m;this.set("statusDesc",t.TXT[e.status]||e.status),this.set("statusClass",t.CLASS[e.status]||"status error");var a={};a.CAN_EXPAND=p["default"].canExpand(e),this.set("commandState",a)},t["default"](n,[{key:"datasource",get:function(){var e={tab:l["default"].constant({detail:"ui-tab-item-active"})};return l["default"].extend({},i.prototype.datasource,e)}}]),n}(d["default"]);module.exports=h}),define("dcc/disk/detail/tpl",[],function(){return'\x3c!-- target: TPL_dcc_disk_detail(master = TPL_dcc_instance_detail_structure) --\x3e\n\n\x3c!-- block: detail-breadcrumb --\x3e\n\x3c!-- use: TPL_dcc_breadcrumb(fatherUrl=\'#/dcc/instance/list\', fatherPage=\'专属服务器 - 实例列表\', currentPage=\'本地磁盘详情\') --\x3e\n\x3c!-- /block --\x3e\n\n\x3c!-- block: abstrct-info --\x3e\n<h1 title="${disk.name}">${disk.name}</h1>\n<span class="status ${statusClass}">\n    ${statusDesc}\n</span>\n\x3c!-- /block --\x3e\n\n\x3c!-- block: operation-info   --\x3e\n\n<span class="ui-group ui-button-group">\n    <button data-ui-type="Button"\n            data-ui-id="expandEphemeral"\n            \x3c!-- if: !${commandState.CAN_EXPAND} --\x3e\n            data-ui-disabled="true"\n            \x3c!-- /if --\x3e\n            title="${i18n.扩容本地磁盘}">${i18n.扩容}</button>\n</span>\n\x3c!-- /block --\x3e\n\n\n\x3c!-- block: detail-navigator --\x3e\n    \x3c!-- import: TPL_dcc_disk_detail_navigator --\x3e\n\x3c!-- /block --\x3e\n\n\x3c!-- block: detail-info --\x3e\n<div class="dcc-disk-detail">\n    <div class="detail-parts">\n        <dl class="detail-part">\n            <dt class="detail-title">${i18n.基本信息}</dt>\n            <dd>\n                <div class="detail-row">\n                    <label>ID：</label>\n                    <span title="${disk.volumeId}">${disk.volumeId}</span>\n                </div>\n                <div class="detail-row">\n                    <label>${i18n.状态：}</label>\n                    <span class="${statusClass}">${statusDesc}</span>\n                </div>\n                <div class="detail-row">\n                    <label>${i18n.名称：}</label>\n                    <span class="container name-container">\n                        <span data-ui-type="Label"\n                                data-ui-id="nameLabel"\n                                data-ui-title="${disk.name}">${disk.name}</span>\n                    </span>\n                </div>\n                <div class="detail-row">\n                    <label>${i18n.容量：}</label>\n                    <span>${disk.diskSize}GB</span>\n                </div>\n                <div class="detail-row">\n                    <label>${i18n.磁盘类型：}</label>\n                    <span>${disk.diskTypeLabel}</span>\n                </div>\n                <div class="detail-row">\n                    <label>${i18n.挂载设备名：}</label>\n                    <span>${disk.device}</span>\n                </div>\n            </dd>\n        </dl>\n    </div>\n    <div class="cb"></div>\n    <div class="instance-profile-wrap instance-profile-monitor monitor">\n        <h3 class="section-title"><span>${i18n.监控信息}</span></h3>\n        \x3c!-- import: TPL_alarm_state_summary --\x3e\n        \x3c!-- use: monitor_trend_search(type="monitor") --\x3e\n        <div class="monitor-trends">\n            \x3c!-- for: ${monitorMetric} as ${chartMetric}, ${chart} --\x3e\n            <div class="monitor-trend-box">\n                <div class="monitor-trend-wrap">\n                    <span class="title">${chartMetric.name}</span>\n                    <span class="icon-show-big" data-chart="${chart}"></span>\n                    <div class="chart" id="js-chart-${chart}"></div>\n                </div>\n            </div>\n            \x3c!-- /for --\x3e\n        </div>\n    </div>\n</div>\n\x3c!-- /block --\x3e\n'}),define("dcc/disk/detail/ui",["exports"],function(exports){exports.__esModule=!0,exports.getUIProperties=function(){return{}},exports.getUIEvents=function(){return{"expandEphemeral:click":function(){this.fire("expandEphemeral")}}}}),define("dcc/disk/detail/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/tpl!./tpl","underscore","babel-runtime/helpers/interop-require-default","../../../bcc/cds/DetailView","./ui"],function(exports,module,e,t,a,i,n,s,r){var o=n["default"](i),c=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_disk_detail"}return e["default"](i,a),i.prototype.getUIProperties=function(){var e=a.prototype.getUIProperties.call(this);return o["default"].extend({},e,r.getUIProperties.apply(this))},i.prototype.getUIEvents=function(){var e=a.prototype.getUIEvents.call(this);return o["default"].extend({},e,r.getUIEvents.apply(this))},i}(n["default"](s)["default"]);module.exports=c}),define("dcc/disk/list/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","er/URL","../../../bcc/cds/List","./Model","./View"],function(exports,module,e,t,a,i,n,s,r,o){var c=i["default"](a),l=i["default"](n),d=i["default"](s),u=i["default"](r),p=i["default"](o),f=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=u["default"],this.viewType=p["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.view.on("expandEphemeral",this.expandEphemeral,this)},i.prototype.refresh=function(){var e=this.model.getQuery();if(e.keyword||c["default"].isArray(e.filters)&&e.filters.length)return delete e.filters,delete e.keyword,delete e.keywordType,this.redirect(l["default"].withQuery("/dcc/disk/list",e));this.asyncListPage()},i.prototype.syncModelToViewIterator=function(e){switch(e.name){case"viewData":this.view.repaint()}},i.prototype.expandEphemeral=function(e){var t=this.model.get("instance"),a=t?t.hostId:"",i=this.model.get("instanceId");this.redirect(l["default"].withQuery("/dcc/instance/configChange",{hostId:a,instanceId:i}))},i}(d["default"]);module.exports=f}),define("dcc/disk/list/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","moment","../../../bcc/cds/ListModel","../../config","../../enums","common/region","../../../bcc/config"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d){var u=n["default"](i),p=n["default"](s),f=n["default"](r),m=n["default"](l),h=n["default"](d),g=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.prepare=function(){i.prototype.prepare.call(this),this.updateViewData()},n.prototype.getExtraQuery=function(){var e={instanceId:this.get("instanceId"),ephemeral:!0},t=this.get("instance");return t&&t.flavorType===c.FlavorType.STORAGE&&u["default"].extend(e,{ephemeral:!1}),e},n.prototype.filterQuery=function(e){return(e=i.prototype.filterQuery.call(this,e)).filters&&u["default"].find(e.filters,function(e){return"type"===e.keywordType&&!!e.keyword})&&delete e.ephemeral,e},n.prototype.updateViewData=function(){var e=this.get("instance"),t=u["default"].deepClone(e);t.status={text:c.InstanceStatus.getTextFromValue(e.status),className:c.InstanceStatus.fromValue(e.status).kclass},t.createTime=p["default"](e.createTime).format("YYYY-MM-DD hh:mm:ss"),t.paymentText=o.lang.PAYMENT[e.payment],t.osText=(e.osName||e.osType)+e.osVersion,this.set("createDisabled",!u["default"].contains([c.InstanceStatus.ACTIVE,c.InstanceStatus.SHUTOFF],e.status)),this.set("viewData",t)},n.prototype.getSeachDatasource=function(){var e=u["default"].map(u["default"].keys(this.get("dccTags")),function(e){return{name:e,value:e}}),t=h["default"].FILTER;return[t.DISK.NAME,t.DISK.ID,t.DISK.INSTANCE_NAME,{name:"标签",value:"tag",children:e}]},t["default"](n,[{key:"datasource",get:function(){return u["default"].extend({},i.prototype.datasource,{dccTags:function(e){return o.api.getSearchTagList({serviceType:["DCC_BCC","CDS"],region:[m["default"].getCurrentRegion().id]}).then(function(e){var t=u["default"].groupBy(e,"tagKey");return u["default"].each(t,function(e,a){t[a]=u["default"].map(e,function(e){return{name:e.tagValue||"空值",value:e.tagValue}}),t[a].unshift({name:"所有值",value:"@@@"})}),t})}})}}]),n}(f["default"]);module.exports=g}),define("dcc/disk/list/tpl",[],function(){return'\x3c!-- target: TPL_dcc_disk_list(master = TPL_dcc_instance_detail_structure) --\x3e\n\n\x3c!-- block: detail-breadcrumb --\x3e\n\x3c!-- use: TPL_dcc_breadcrumb(fatherUrl=\'#/dcc/instance/list\', fatherPage=\'专属服务器 - 实例列表\', currentPage=\'本专属实例磁盘\') --\x3e\n\x3c!-- /block --\x3e\n\n\x3c!-- block: abstrct-info --\x3e\n\x3c!-- import: TPL_dcc_instance_detail_abstrct_info --\x3e\n\x3c!-- /block --\x3e\n\n\x3c!-- block: detail-navigator --\x3e\n\x3c!-- import: TPL_dcc_instance_detail_navigator --\x3e\n\x3c!-- /block --\x3e\n\n\x3c!-- block: detail-info --\x3e\n<div class="disk-table table-full-wrap">\n    <div class="operation-wrap" data-follow-thead="table">\n        <div class="buttons-wrap">\n            <button type="button"\n                    data-ui-id="createDisk"\n                    data-ui-type="Button"\n                    data-ui-skin="create">${i18n.创建CDS磁盘}\n            </button>\n            <button type="button"\n                    data-ui-type="Button"\n                    data-ui-id="recharge"\n                    title="${i18n.批量续费}">${i18n.续费}\n            </button>\n            <button data-ui-type="Button"\n                    data-ui-id="editTag"\n                    title="${i18n.标签}"\n                    data-intro="${i18n.资源可以打标签啦}">${i18n.编辑标签}\n            </button>\n            \x3c!-- <button type="button"\n                data-ui-type="Button"\n                data-ui-id="expandCds"\n                title="扩容">扩容</button>\n            <button type="button"\n                data-ui-type="Button"\n                data-ui-id="deleteCds"\n                title="释放">释放</button>\n            <button type="button"\n                data-ui-type="Button"\n                data-ui-id="alterProductType"\n                data-ui-disabled="true"\n                title="释放">计费变更</button> --\x3e\n            <span data-ui-type="Select" data-ui-id="moreOpt" data-ui-skin="light"></span>\n        </div>\n        <div class="buttons-quick-wrap">\n            <span class="ui-group ui-search-group">\n                <span data-ui-type="SelectEx" data-ui-id="keywordType"\n                      data-ui-value="@keywordType" data-ui-has-child-list="true"></span>\n                <input class="search-box" data-ui-type="TextBox"\n                       data-ui-id="keyword" data-ui-value="@keyword" data-ui-extension-textbox-type="TextBoxSelect"/>\n                <button type="button" data-ui-type="Button" data-ui-id="searchBtn"></button>\n                            \x3c!-- if: ${keyword} --\x3e\n                <button type="button"\n                        data-ui-type="Button"\n                        data-ui-id="clearKeyword"\n                        title="${i18n.清空搜索条件}"\n                        class="link-like clear-button">${i18n.清空}</button>\n                            \x3c!-- /if --\x3e\n            </span>\n            <button type="button"\n                    data-ui-type="Button" data-ui-id="refreshList" title="${i18n.刷新表格数据}">\n                <i class="iconfont icon-cdnrefresh"></i>\n            </button>\n            <button data-ui="type:Button;id:downloadList;" title="${i18n.下载当前列表展现的磁盘信息，编码格式为utf-8}">\n                <i class="iconfont icon-download"></i>\n            </button>\n            <div id="table-custom-fields-container"></div>\n        </div>\n    </div>\n    <div data-ui-type="Table" data-ui-id="table"\n         data-ui-datasource="@tableData"\n         data-ui-order-by="@orderBy" data-ui-order="@order"\n         data-ui-select="@selectMode" data-ui-extension-tip-type="TableTip"\n         data-ui-extension-command-type="Command"\n         data-ui-extension-tableedit-type="TableEdit"\n         data-ui-extension-tableex-type="TableEx"\n         data-ui-extension-customfields-type="TableCustomFields"\n         data-ui-extension-tablefilter-type="TableFilter">\n    </div>\n    <div class="ui-row">\n        \x3c!-- import: listPager --\x3e\n    </div>\n</div>\n\x3c!-- /block --\x3e\n\n\x3c!-- target: TPL_dcc_instance_detail_abstrct_info --\x3e\n\x3c!-- if: ${loading} --\x3e\n<div class="loading-container">\n    <span class="loading">${i18n.数据加载中，请稍后…}</span>\n</div>\n\x3c!-- else: --\x3e\n<h1 title="${viewData.name}">${viewData.name}</h1>\n<span class="status ${viewData.status.className}">\n    ${viewData.status.text}\n</span>\n\x3c!-- /if --\x3e\n'}),define("dcc/disk/list/ui",["exports","underscore","babel-runtime/helpers/interop-require-default","jquery","inf-i18n","common/util/tableUtil","common/util","../../../bcc/enum","./ui/tableFields","../permission","../../config"],function(exports,e,t,a,i,n,s,r,o,c,l){exports.__esModule=!0,exports.getUIProperties=function(){return{createDisk:{disabled:m["default"].isSubUser()},table:f["default"].tableProperty(h["default"],{followHead:!0,followHeadOffsetH:50,noFollowHeadCache:!0,followDoms:[u["default"](".operation-wrap")[0]],editable:1,select:"multi",noDataHtml:"<div><p>没有可选择的磁盘!</p></div>",extTableEx:["id","payment","expireTime","operation"],extTableCustomFields:{container:"#table-custom-fields-container",defaults:["id","status","payment","expireTime","instance","volumeType","type","diskSize","operation"],locked:{head:["id"],tail:["operation"]},maxFields:9}}),recharge:{disabled:"disabled"},keyword:{placeholder:"请输入磁盘名称进行搜索"},moreOpt:{width:130,datasource:r.MoreOperation.getOperation("DCCDISK"),emptyText:"更多操作",selectedIndex:-1},keywordType:{datasource:"@keywordTypeDatasource",hasChildList:!0,joinStr:"/",value:"name"}}},exports.getUIEvents=function(){return{"table:select":function(e){f["default"].setButtonStatusOfTable(this,{recharge:{rule:function(e){return g["default"].canRecharge(e)}},editTag:{rule:function(e){return g["default"].canEditTag(e)}}}),f["default"].setSelectStatusOfTable(this,"moreOpt",{DELETE:{rule:function(e){return g["default"].canDelete(e)}},ALTER_PRODUCTTYPE:{rule:function(e){return g["default"].canAlterProductType(e)}}})},"clearKeyword:click":function(e){this.get("keyword").setValue(""),this.submitSearch.call(this,e)},"keywordType:change":function(e){var t=this.model.get("dccTags"),a=this.get("keyword"),i=[];if(t){var n=e.target.getSelectedItem(),s=n[0].name||n[0].text;if(n.length>1){var r=n[1].value;s="",r&&(s="标签值",i=t[r])}a.setProperties({placeholder:s?d["default"].sprintf(p["default"]("请输入%s进行搜索"),s):p["default"]("搜索无标签实例")})}a.setProperties({datasource:i})},"editTag:click":function(e){var t=this.get("table").getSelectedItems();this.fire(l.events.EDIT_TAG,t)}}};var d=t["default"](e),u=t["default"](a),p=t["default"](i),f=t["default"](n),m=t["default"](s),h=t["default"](o),g=t["default"](c)}),define("dcc/disk/list/ui/tableFields",["exports","module","underscore","babel-runtime/helpers/interop-require-default","inf-i18n","common/util/timeUtil","common/region","../../../config","../../../../bcc/config","../../../../bcc/enum","../../permission","../../../enums"],function(exports,module,e,t,a,i,n,s,r,o,c,l){var d=t["default"](e),u=t["default"](a),p=t["default"](i),f=t["default"](n),m=t["default"](c);module.exports=[{field:"id",title:u["default"]("磁盘名称/ID"),width:"15%",minWidth:120,sortable:!0,content:function(e,t,a){if(!e.name)return'<span class="instance-id">'+(e.volumeId||e.id)+"</span>";var i=m["default"].canEditName(e)?'<span class="ui-table-cell-editentry"data-row="'+t+'" data-col="'+a+'"><i class="iconfont icon-edit"></i></span>':"";return'\n                <a href="'+(l.DiskType.SYSTEM===e.type?"#/bcc/cds/detail~instanceId="+e.instanceUuid+"&diskId="+e.id:l.DiskType.EPHEMERAL===e.type?"#/dcc/disk/detail~instanceId="+e.instanceUuid+"&diskId="+e.id:"#/bcc/cds/detail~diskId="+e.id)+'" title="'+d["default"].escape(e.name)+'" class="instance-name">\n                    '+d["default"].escape(e.name)+"\n                </a>\n                "+i+'<br/>\n                <span class="instance-id">\n                    '+(e.volumeId||e.id)+"\n                </span>"},editable:function(e){return m["default"].canEditName(e)},editContent:function(e){return d["default"].escape(e.name)},editNote:r.RULE.NAME.placeholder,editRules:d["default"].omit(r.RULE.NAME,"placeholder")},{field:"status",title:u["default"]("状态"),width:"9%",minWidth:75,filter:{datasource:o.DiskStatus.getFilterStatus()},content:function(e){var t='<span class="'+(r.SYSTEM_DISK_STATUS.CLASS[e.status]||"status normal")+'">\n                '+(r.SYSTEM_DISK_STATUS.TXT[e.status]||"正常")+"\n            </span>";return l.DiskType.isCds(e.type)&&(t='<span class="'+(r.DISK_STATUS.CLASS[e.status]||"status error")+'">\n                    '+(r.DISK_STATUS.TXT[e.status]||e.status)+"\n                </span>"),t}},{field:"payment",title:u["default"]("支付方式"),width:"9%",minWidth:98,filter:{datasource:[{name:u["default"]("全部"),value:""},{name:u["default"]("预付费"),value:"prepay"},{name:u["default"]("后付费"),value:"postpay"}]},content:function(e,t){return m["default"].canAlterProductType(e)?" "+r.PAYMENT_DESC[e.payment]+'\n                <span data-ui-type="Tip"\n                    data-ui-id="alterProductTip'+t+'"\n                    data-ui-skin="warning"\n                    data-ui-arrow="true"\n                    data-ui-content="'+u["default"]("已支持后付费转预付费功能，您可在更多操作中进行计费变更")+'"></span>':r.PAYMENT_DESC[e.payment]}},{field:"createTime",title:u["default"]("创建时间"),width:"11%",minWidth:96,sortable:!0,content:function(e,t,a){return p["default"].toDate(e.createTime)||"-"}},{field:"expireTime",title:u["default"]("到期时间"),width:"11%",minWidth:96,sortable:!0,content:function(e,t,a){var i="",n="",s=f["default"].getCurrentRegion().id,c='\n            <a href="/billing/#/billing/recharge/list~serviceType=CDS&instanceIds='+(e.id+";"+e.volumeId)+"&region="+s+'">\n                '+u["default"]("续费入口")+">>\n            </a>";return l.DiskType.isCds(e.type)&&(n=e.status===o.DiskStatus.EXPIRED?""+u["default"]("您的磁盘已经过期，请您尽快续费。")+c:"您的磁盘还有"+(e.expireDate-1)+"天到期，请您尽快续费。"+c,e.expireDate<7&&(i=' <span data-ui-type="Tip"\n                        data-ui-id="expireTimeTip'+t+'"\n                        data-ui-skin="warning"\n                        data-ui-arrow="true"\n                        data-ui-content=\''+n+"'></span>")),e.payment===r.PAYMENT.PREPAY?p["default"].toDate(e.expireTime)+i:"-"}},{field:"instance",title:u["default"]("专属实例名称"),width:"10%",minWidth:"80",content:function(e){var t=d["default"].escape(e.instanceName),a=e.instanceId?'<span class="instance-name" title="'+t+'">'+t+"</span>":"-";return e.instanceId&&e.status===r.DISK_STATUS.IN_USE&&(a='<a href="#/dcc/instance/detail~instanceId='+e.instanceId+'" class="instance-name" title="'+t+'">'+t+"</a>"),a}},{field:"type",title:u["default"]("磁盘类型"),width:"9%",minWidth:97,filter:{datasource:l.StorageType.getFilterType()},content:function(e){return l.StorageType.getTextFromValue(e.storageType)||""}},{field:"volumeType",title:u["default"]("磁盘作用"),width:"9%",minWidth:97,filter:{datasource:l.VolumeType.getFilterType()},content:function(e){return l.VolumeType.getTextFromValue(e.volumeType)||""}},{field:"device",title:u["default"]("挂载设备名"),width:"11%",content:function(e){return d["default"].escape(e.device)||"-"}},{field:"diskSize",title:u["default"]("容量"),width:"9%",content:function(e){return d["default"].escape(e.diskSize)+"GB"}},{field:"tag",title:u["default"]("标签"),sortable:!0,width:"9%",content:function(e,t,a){if(!e.tags||e.tags.length<1)return"-";var i="",n="";return d["default"].each(e.tags,function(e,t){n+="{"+e.tagKey+" : "+e.tagValue+"} ",t<2&&(i+=e.tagKey+" : "+e.tagValue+"<br/>")}),e.tags.length>2&&(i+="..."),'\n                <div title="'+n+'">\n                    '+i+"\n                </div>\n            "}},{field:"operation",title:u["default"]("操作"),width:"10%",minWidth:97,content:function(e,t){var a={commandArgs:t},i=d["default"].defaults({command:"createsnapshot",label:u["default"]("创建快照"),title:u["default"]("创建快照"),disabled:!m["default"].canCreateSnapshot(e)},a),n=d["default"].defaults({command:"createimage",label:u["default"]("创建镜像"),title:u["default"]("创建镜像"),disabled:!m["default"].canCreateImage(e)},a),r=d["default"].defaults({command:"expandEphemeral",label:u["default"]("扩容"),title:u["default"]("扩容"),disabled:!m["default"].canExpand(e)},a),o=d["default"].defaults({command:"attachcds",label:u["default"]("挂载"),title:u["default"]("挂载"),disabled:!m["default"].canAttach(e)},a),c=d["default"].defaults({command:"detachcds",label:u["default"]("卸载"),title:u["default"]("卸载"),disabled:!m["default"].canDetach(e)},a);return e.type===l.DiskType.SYSTEM?"\n                    "+s.html.operation.linkButton(i)+"\n                    "+s.html.operation.linkButton(n)+"\n                ":e.type===l.DiskType.EPHEMERAL?""+s.html.operation.linkButton(r):"\n                "+s.html.operation.linkButton(o)+"\n                "+s.html.operation.linkButton(c)+"\n                "+s.html.operation.linkButton(i)+"\n            "}}]}),define("dcc/disk/list/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./tpl","underscore","babel-runtime/helpers/interop-require-default","../../../bcc/cds/ListView","./ui","./ui/tableFields"],function(exports,module,e,t,a,i,n,s,r,o,c){var l=s["default"](n),d=s["default"](r),u=s["default"](c),p=function(i){function n(){a["default"](this,n),i.call(this),this.template="TPL_dcc_disk_list"}return e["default"](n,i),n.prototype.getUIEvents=function(){var e=i.prototype.getUIEvents.call(this);return l["default"].extend({},e,o.getUIEvents.apply(this))},n.prototype.repaint=function(){this.viewContext.dispose(),this.render()},n.prototype.setTableFilterValue=function(){var e=this.model.get("filters");e&&e.length>0?l["default"].each(u["default"],function(t){t.filter&&l["default"].each(e,function(e){e[0]===t.field&&(t.filter.value=e[1])})}):l["default"].each(u["default"],function(e){e.filter&&(e.filter.value=null)})},t["default"](n,[{key:"uiProperties",get:function(){var e=i.prototype.getUIProperties.call(this);return l["default"].extend({},e,o.getUIProperties.apply(this))}}]),n}(d["default"]);module.exports=p}),define("dcc/disk/permission",["exports","module","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","common/util","../../bcc/config","../enums"],function(exports,module,e,t,a,i,n,s){var r=a["default"](t),o=a["default"](i)["default"].isSubUser(),c=function(){function t(){e["default"](this,t)}return t.prototype.canEditName=function(e){var t=e.status;return!!s.DiskType.isCds(e.type)&&!r["default"].contains([n.DISK_STATUS.CREATING,n.DISK_STATUS.ERROR],t)},t.prototype.canRecharge=function(e){if(o)return!1;var t=e.status;return!(!s.DiskType.isCds(e.type)||e.payment!==n.PAYMENT.PREPAY)&&!r["default"].contains([n.DISK_STATUS.CREATING],t)},t.prototype.canExpand=function(e){if(o)return!1;var t=e.status;return e.type===s.DiskType.EPHEMERAL&&t===n.DISK_STATUS.IN_USE&&!e.uuid},t.prototype.canExpandCds=function(e){if(o)return!1;var t=e.status;return!(!s.DiskType.isCds(e.type)||t!==n.DISK_STATUS.AVAILABLE)},t.prototype.canCreateSnapshot=function(e){if("rds"===e.application&&1===e.instanceType)return!1;var t=e.status,a=[n.SYSTEM_DISK_STATUS.AVAILABLE,n.SYSTEM_DISK_STATUS.IN_USE],i=[n.DISK_STATUS.AVAILABLE,n.DISK_STATUS.IN_USE];return!(e.type!==s.DiskType.SYSTEM||!r["default"].contains(a,t))||!(!s.DiskType.isCds(e.type)||!r["default"].contains(i,t))},t.prototype.canCreateImage=function(e){if("rds"===e.application&&1===e.instanceType)return!1;var t=e.status,a=[n.SYSTEM_DISK_STATUS.AVAILABLE,n.SYSTEM_DISK_STATUS.IN_USE];return!(e.type!==s.DiskType.SYSTEM||!r["default"].contains(a,t))},t.prototype.canAttach=function(e){if(o)return!1;var t=e.status;return!(!s.DiskType.isCds(e.type)||!r["default"].contains([n.DISK_STATUS.AVAILABLE],t))},t.prototype.canDetach=function(e){if(o)return!1;var t=e.status;return!(!s.DiskType.isCds(e.type)||!r["default"].contains([n.DISK_STATUS.IN_USE,n.DISK_STATUS.EXPIRED],t))},t.prototype.canDelete=function(e){if(o)return!1;var t=e.status,a=[n.DISK_STATUS.AVAILABLE,n.DISK_STATUS.ERROR,n.DISK_STATUS.EXPIRED];return!(!s.DiskType.isCds(e.type)||e.payment===n.PAYMENT.PREPAY&&e.expireDate>0||e.instanceId||!r["default"].contains(a,t))},t.prototype.canAlterProductType=function(e){if(o)return!1;var t=e.status;return!(!s.DiskType.isCds(e.type)||e.orderStatus)&&!r["default"].contains([n.DISK_STATUS.CREATING],t)},t.prototype.canCancelAlterProductType=function(e){if(o)return!1;var t=e.status;return!(!s.DiskType.isCds(e.type)||"to_postpay"!==e.orderStatus)&&!r["default"].contains([n.DISK_STATUS.CREATING],t)},t.prototype.canEditTag=function(e){return e.status!==s.InstanceStatus.BUILD&&s.DiskType.isCds(e.type)&&!r["default"].contains([n.DISK_STATUS.CREATING],e.status)},t}();module.exports=new c}),define("dcc/enums",["exports","inf-i18n","babel-runtime/helpers/interop-require-default","inf-ria/EnumX"],function(exports,e,t,a){exports.__esModule=!0;var i=t["default"](e),n=t["default"](a),s=new n["default"]({alias:"PREPAY",text:i["default"]("预付费"),value:"prepay"},{alias:"POSTPAY",text:i["default"]("后付费"),value:"postpay"});exports.ProductType=s;var r=new n["default"]({alias:"UP",text:i["default"]("运行中"),value:"up"},{alias:"DOWN",text:i["default"]("离线"),value:"down"},{alias:"EXPIRED",text:i["default"]("已到期"),value:"expired"},{alias:"BUILD",text:i["default"]("创建中"),value:"build"},{alias:"RECHARGE",text:i["default"]("续费中"),value:"recharge"},{alias:"BILLING_CHANGING",text:i["default"]("计费变更中"),value:"billing_changing"});exports.HostStatus=r,r.getFilterStatus=function(){return[{name:"全部状态",value:""}].concat(r.toArray("UP","DOWN","EXPIRED","BUILD"))};var o=new n["default"]({alias:"CALCULATION",text:i["default"]("计算型"),value:"calculation"},{alias:"STORAGE",text:i["default"]("大数据机型"),value:"storage"});exports.FlavorType=o;var c=new n["default"]({alias:"ACTIVE",text:i["default"]("运行中"),value:"ACTIVE",kclass:"normal"},{alias:"SHUTOFF",text:i["default"]("已关机"),value:"SHUTOFF",kclass:"unavailable"},{alias:"PAUSED",text:i["default"]("已睡眠"),value:"PAUSED",kclass:"warning"},{alias:"SUSPENDED",text:i["default"]("已休眠"),value:"SUSPENDED",kclass:"warning"},{alias:"RESCUE",text:i["default"]("已修复"),value:"RESCUE",kclass:"warning"},{alias:"ERROR",text:i["default"]("错误"),value:"ERROR",kclass:"error"},{alias:"SOFT_DELETED",text:i["default"]("已删除"),value:"SOFT_DELETED",kclass:"warning"},{alias:"BUILD",text:i["default"]("创建中"),value:"BUILD",kclass:"warning rolling"},{alias:"VERIFY_RESIZE",text:i["default"]("扩容确认中"),value:"VERIFY_RESIZE",kclass:"warning"},{alias:"REVERT_RESIZE",text:i["default"]("扩容回滚中"),value:"REVERT_RESIZE",kclass:"warning"},{alias:"EXPIRED",text:i["default"]("已到期"),value:"EXPIRED",kclass:"error"},{alias:"SHELVED",text:i["default"]("搁置"),value:"SHELVED",kclass:"warning"},{alias:"SHELVED_OFFLOADED",text:i["default"]("搁置"),value:"SHELVED_OFFLOADED",kclass:"warning"},{alias:"SNAPSHOT",text:i["default"]("创建快照中"),value:"SNAPSHOT",kclass:"warning rolling"},{alias:"ROLLBACK_SNAPSHOT",text:i["default"]("回滚快照中"),value:"ROLLBACK_SNAPSHOT",kclass:"warning"},{alias:"DELETE_SNAPSHOT",text:i["default"]("删除快照中"),value:"DELETE_SNAPSHOT",kclass:"warning"},{alias:"TEMPLATE",text:i["default"]("创建镜像中"),value:"TEMPLATE",kclass:"warning rolling"},{alias:"REBOOT",text:i["default"]("重启中"),value:"REBOOT",kclass:"warning"},{alias:"HARD_REBOOT",text:i["default"]("重启中"),value:"HARD_REBOOT",kclass:"warning"},{alias:"PASSWORD",text:i["default"]("重置密码中"),value:"PASSWORD",kclass:"warning"},{alias:"REBUILD",text:i["default"]("重建中"),value:"REBUILD",kclass:"warning"},{alias:"MIGRATING",text:i["default"]("迁移中"),value:"MIGRATING",kclass:"warning"},{alias:"RESIZE",text:i["default"]("资源扩展中或未支付"),value:"RESIZE",kclass:"warning"},{alias:"DELETING",text:i["default"]("释放中"),value:"DELETING",kclass:"warning"},{alias:"BINDING",text:i["default"]("绑定中"),value:"BINDING",kclass:"warning"},{alias:"UNBINDING",text:i["default"]("解绑中"),value:"UNBINDING",kclass:"warning"},{alias:"POWERING_OFF",text:i["default"]("关机中"),value:"POWERING_OFF",klass:"warning"},{alias:"POWERING_ON",text:i["default"]("开机中"),value:"POWERING_ON",klass:"warning"},{alias:"OFFLINE",text:i["default"]("专属服务器离线"),value:"OFFLINE",kclass:"warning"},{alias:"DCC_EXPIRED",text:i["default"]("专属服务器已到期"),value:"DCC_EXPIRED",kclass:"warning"},{alias:"VOLUME_RESIZE",text:i["default"]("磁盘扩容中"),value:"VOLUME_RESIZE",kclass:"warning"},{alias:"BINDKEYPAIR",text:i["default"]("绑定密钥对中"),value:"BINDKEYPAIR",kclass:"warning"},{alias:"UNBINDKEYPAIR",text:i["default"]("解绑密钥对中"),value:"UNBINDKEYPAIR",kclass:"warning"});exports.InstanceStatus=c,c.getFilterStatus=function(){return[{name:i["default"]("全部状态"),value:""}].concat(c.toArray("ACTIVE","SHUTOFF","EXPIRED","BUILD","REBUILD"))};var l=new n["default"]({alias:"ACTIVE",text:i["default"]("已完成"),value:"active",kclass:"normal"},{alias:"ERROR",text:i["default"]("错误"),value:"error",kclass:"error"},{alias:"QUEUED",text:i["default"]("创建中"),value:"queued",kclass:"warning rolling"},{alias:"SAVING",text:i["default"]("创建中"),value:"saving",kclass:"warning rolling"});exports.ImageStatus=l;var d=new n["default"]({alias:"SYSTEM",text:i["default"]("系统盘"),value:"system"},{alias:"SSD",text:i["default"]("高性能云磁盘"),value:"ssd"},{alias:"SATA",text:i["default"]("普通云磁盘"),value:"sata"},{alias:"EPHEMERAL",text:i["default"]("本地磁盘"),value:"ephemeral"},{alias:"PREMIUM_SSD",text:i["default"]("SSD云磁盘"),value:"premium_ssd"});exports.DiskType=d,d.isCds=function(e){return e!==d.SYSTEM&&e!==d.EPHEMERAL},d.getFilterType=function(){return[{name:"全部",value:""}].concat(d.toArray("SYSTEM","SSD","SATA"))};var u=new n["default"]({alias:"CDS",text:i["default"]("数据盘"),value:"1"},{alias:"SYSTEM",text:i["default"]("系统盘"),value:"2"});exports.VolumeType=u,u.getFilterType=function(){return[{name:i["default"]("全部"),value:""}].concat(u.toArray("SYSTEM","CDS"))};var p=new n["default"]({alias:"SSD",text:i["default"]("高性能云磁盘"),value:"1"},{alias:"SATA",text:i["default"]("普通云磁盘"),value:"2"},{alias:"NVME",text:i["default"]("存储优化型磁盘"),value:"3"},{alias:"PREMIUM_SSD",text:i["default"]("SSD云磁盘"),value:"4"},{alias:"EPHEMERAL",text:i["default"]("本地盘磁盘"),value:"5"});exports.StorageType=p,p.getFilterType=function(){return[{name:i["default"]("全部"),value:""}].concat(p.toArray("SSD","SATA","PREMIUM_SSD","EPHEMERAL"))};var f=new n["default"]({alias:"COMMON",text:i["default"]("公共镜像"),value:"common"},{alias:"CUSTOM",text:i["default"]("自定义镜像"),value:"custom"},{alias:"INTEGRATION",text:i["default"]("服务集成镜像"),value:"integration"},{alias:"SHARING",text:i["default"]("共享镜像"),value:"sharing"},{alias:"FPGAIMAGE",text:i["default"]("FPGA公共镜像"),value:"fpgaImage"},{alias:"FPGACUSTOM",text:i["default"]("FPGA自定义镜像"),value:"fpgaCustom"},{alias:"GPUBCCIMAGE",text:i["default"]("GPU公共镜像"),value:"gpuBccImage"},{alias:"GPUBCCCUSTOM",text:i["default"]("GPU自定义镜像"),value:"gpuBccCustom"},{alias:"MKT",text:i["default"]("云市场镜像"),value:"mkt"});exports.ImageType=f,f.getFilterType=function(){return[{name:i["default"]("全部"),value:""}].concat(f.toArray("CUSTOM","SHARING","GPUBCCCUSTOM"))};var m=new n["default"]({alias:"MONTH",text:i["default"]("按月"),value:"month"},{alias:"YEAR",text:i["default"]("按年"),value:"year"});exports.TimeType=m;var h=new n["default"]({alias:"OME",text:i["default"]("1个月"),value:1},{alias:"TWO",text:i["default"]("2个月"),value:2},{alias:"THREE",text:i["default"]("3个月"),value:3},{alias:"FPUR",text:i["default"]("4个月"),value:4},{alias:"FIVE",text:i["default"]("5个月"),value:5},{alias:"SIX",text:i["default"]("6个月"),value:6},{alias:"SEVEN",text:i["default"]("7个月"),value:7},{alias:"EIGHT",text:i["default"]("8个月"),value:8},{alias:"NINE",text:i["default"]("9个月"),value:9});exports.Month=h;var g=new n["default"]({alias:"ONE",text:i["default"]("1年"),value:1},{alias:"TWO",text:i["default"]("2年"),value:2},{alias:"THREE",text:i["default"]("3年"),value:3});exports.Year=g}),define("dcc/helper",["exports","crypt/rsa","babel-runtime/helpers/interop-require-default","common/constants"],function(exports,e,t,a){exports.__esModule=!0;var i=t["default"](e),n=t["default"](a);exports.rsaEncrypt=function(e){if(!n["default"].publicKey)return e;var t=new i["default"];t.setPublicKey(n["default"].publicKey);var a=t.encrypt(e);return!1===a?e:a}}),define("dcc/host/action.conf",["exports","module","common/component/action_category","babel-runtime/helpers/interop-require-default","inf-ui/sanPage"],function(exports,module,e,t,a){var i=t["default"](e),n=t["default"](a);module.exports=[{path:"/dcc/host/create",type:"dcc/host/create/step1/Action",category:i["default"].CREATE},{path:"/dcc/host/create/step1",type:"dcc/host/create/step1/Action",category:i["default"].CREATE},{path:"/dcc/host/create/step2",type:"dcc/host/create/step3/Action",category:i["default"].CREATE},{path:"/dcc/host/create/step3",type:"dcc/host/create/step3/Action",category:i["default"].CREATE},{path:"/dcc/host/list",type:"dcc/host/list/Action",category:i["default"].LIST},{path:"/dcc/host/detail",type:"dcc/host/detail/Action"},{path:"/dcc/host/instance",type:"dcc/host/instance/Action"},{path:"/dcc/host/operation/changeName",type:"dcc/host/operation/changeName/Action"},{path:"/dcc/host/operation/updateVcpu",type:"dcc/host/operation/updateVcpu/Action"},{path:"/dcc/host/list/deleteHost",type:n["default"]("dcc/host/list/deleteHost/index")}]}),define("dcc/host/create/cache",["exports","module"],function(exports,module){module.exports={}}),define("dcc/host/create/CreateModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","bat-ria/mvc/FormModel","../../config","./cache"],function(exports,module,e,t,a,i,n,s,r){var o=i["default"](a),c=i["default"](n),l=i["default"](r),d=function(a){function i(e){t["default"](this,i),a.call(this,e),this.defaultDatasource=o["default"].defaults({tips:o["default"].constant(s.tips)},a.prototype.defaultDatasource)}return e["default"](i,a),i.prototype.prepare=function(){return this.restoreFromCache()},i.prototype.restoreFromCache=function(){throw new Error("请继承后覆盖此接口")},i.prototype.getCache=function(){return l["default"]},i.prototype.updateCache=function(){l["default"].hostData=this.get("hostData"),l["default"].price=this.get("price"),l["default"].viewFlavors=this.get("viewFlavors"),l["default"].flavors=this.get("flavors")},i.prototype.clearCache=function(){l["default"].hostData=null,l["default"].price=null,l["default"].viewFlavors=null,l["default"].flavors=null},i}(c["default"]);module.exports=d}),define("dcc/host/create/step1/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormAction","babel-runtime/helpers/interop-require-default","promise","er/URL","./Model","./View","../../../config"],function(exports,module,e,t,a,i,n,s,r,o,c){var l=i["default"](a),d=i["default"](n),u=i["default"](s),p=i["default"](r),f=i["default"](o),m=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=p["default"],this.viewType=f["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.view.on(c.events.FORM_CHANGED,this.updateFormDataToModel,this)},i.prototype.syncModelToViewIterator=function(e){switch(e.name){case"hostData":this.view.restoreForms();break;case"price":this.view.updateBuyBucket();break;case"productType":this.view.updateProductType(),this.view.updateAutoRenew();break;case"viewFlavors":this.view.updateFlavorDatasource();case"prePurchaseValid":case"posPurchaseValid":this.view.buyWarningShow(),this.view.updateBuyBucketSubmit()}},i.prototype.updateFormDataToModel=function(e){var t=this,a=e.toUpdate;if(this.model.updateHostData(a,{silent:!0}),a.productType||a.logicalZone)return this.model.getFlavors().then(function(){return t.updatePrice()});if(a.flavor)this.view.updateFlavor();else if(a.vCpu)return d["default"].resolve();return this.updatePrice()},i.prototype.updatePrice=function(){this.model.updatePrice()},i.prototype.submitEdit=function(){this.model.updateCache();this.redirect(u["default"].withQuery("#/dcc/host/create/step2"))},i}(l["default"]);module.exports=m}),define("dcc/host/create/step1/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","promise","inf-i18n","common/constants","common/zone","../CreateModel","../../../config","../../../enums","../../../config/flags"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p){var f=n["default"](i),m=n["default"](s),h=n["default"](r),g=n["default"](o),v=n["default"](c),b=n["default"](l),y=n["default"](p),T={"x-silent":!0},x=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.prepare=function(){var e=this;i.prototype.prepare.call(this),m["default"].all([this.getPrePurchaseValidation(),this.getPosPurchaseValidation()]),this.get("viewFlavors").loading&&this.getFlavors().then(function(){return e.updatePrice()})},n.prototype.restoreFromCache=function(){var e=this.getCache();return e.hostData&&e.viewFlavors&&e.prevPage?(e.prevPage=!1,this.set("hostData",e.hostData),this.set("viewFlavors",e.viewFlavors)):this.set("hostData",this.getDefaultData()),e.price?this.set("price",e.price):this.set("price","loading"),m["default"].resolve()},n.prototype.getPrePurchaseValidation=function(){var e=this;return y["default"].enable_baixin?(this.set("prePurchaseValid",{status:!0,failReason:""}),m["default"].resolve()):d.api.accountPurchaseValidation({serviceType:"DCC",productType:"prepay"},T).then(function(t){return e.set("prePurchaseValid",t)}).fail(function(t){e.set("prePurchaseValid",{status:!1,failReason:h["default"]("余额检查异常，请刷新后重试")})})},n.prototype.getPosPurchaseValidation=function(){var e=this;return y["default"].enable_baixin?(this.set("posPurchaseValid",{status:!0,failReason:""}),m["default"].resolve()):d.api.accountPurchaseValidation({serviceType:"DCC",productType:"postpay"},T).then(function(t){return e.set("posPurchaseValid",t)}).fail(function(t){e.set("posPurchaseValid",{status:!1,failReason:"余额检查异常，请刷新后重试"})})},n.prototype.getFlavors=function(e,t){var a=this,i=this.get("hostData");return e=e||i.productType,t=t||i.logicalZone,d.api.getDccHostFlavor({productType:e,logicalZone:t},T).then(function(e){var t=a.updateFlavors(e),i=t[u.FlavorType.CALCULATION],n=f["default"].find(i,function(e){return e.count>0})||i&&i[0]||{};a.updateHostData({flavor:n,type:u.FlavorType.CALCULATION,vCpu:n.detail&&n.detail.cpu},{silent:!0}),a.set("viewFlavors",t)})},n.prototype.updateFlavors=function(e){return f["default"].each(e,function(e){f["default"].each(e.detail.ephemeralDisks,function(t){t.storageType=t.storageType.toUpperCase(),e.type===u.FlavorType.STORAGE&&(t.sizePerDiskInGb=Math.floor(t.sizePerDiskInGb/1024))})}),f["default"].groupBy(e,"type")},n.prototype.getDefaultData=function(){var e=this.get("defaultHostData");return e||(this.initData(),this.get("defaultHostData"))},n.prototype.initData=function(){var e={type:this.get("type")||u.FlavorType.CALCULATION,flavor:{},autoRenew:!1,autoRenewTime:0,autoRenewTimeUnit:"month",purchaseLength:1,purchaseNum:1,needSubInstance:!1,logicalZone:this.get("zoneDatasource")?this.get("zoneDatasource")[0].value:"",productType:this.get("productType")||u.ProductType.PREPAY};this.set("defaultHostData",e,{silent:!0})},n.prototype.updatePrice=function(){var e=this,t=(new Date).valueOf()+f["default"].random(0,9)+f["default"].random(0,9)+f["default"].random(0,9);this.set("token",t,{silent:!0}),this.set("price","loading");var a=this.get("hostData"),i=this.getSubmitData(a);if(i.flavor)return d.api.getDccHostPrice({config:i},T).then(function(a){t===e.get("token")&&e.set("price",a)}).fail(function(t){e.set("price","ERROR")})},n.prototype.filterData=function(e){return e.productType===u.ProductType.POSTPAY&&(e.purchaseLength=1),f["default"].chain(e).pick("purchaseLength","purchaseNum","productType","autoRenewTime","autoRenewTimeUnit").extend({flavor:e.flavor.name,autoRenew:e.autoRenew}).value()},n.prototype.updateHostData=function(e,t){var a=this.get("hostData"),i=f["default"].clone(a);f["default"].extend(i,e),this.set("hostData",i,t),e.productType&&this.set("productType",e.productType)},t["default"](n,[{key:"datasource",get:function(){return{constants:function(){return g["default"]},tips:function(){return d.tips},step:function(){return 1},viewFlavors:function(){return{loading:!0}},quota:function(){return d.api.getDccHostQuota().fail(function(){return{hostQuotaTotal:d.dcc.host.DEFAULT.QUOTA,hostQuotaCreated:0,isWhiteAccount:!1}}).then(function(e){return f["default"].extend({available:e.hostQuotaTotal-e.hostQuotaCreated},e)})},zoneDatasource:function(e){return d.api.getZoneList().then(function(e){return v["default"].getZoneList(e)})}}}}]),n}(b["default"]);module.exports=x}),define("dcc/host/create/step1/tpl",[],function(){return'\x3c!-- target: TPL_dcc_host_create_step1(master = TPL_dcc_host_create)--\x3e\n\x3c!-- block: detail --\x3e\n\x3c!-- import: TPL_dcc_host_create_step_configuration --\x3e\n\x3c!-- /block --\x3e\n\n\x3c!-- target: TPL_dcc_host_create_step_configuration--\x3e\n<div class="ui-tab-content">\n    \x3c!-- <p data-ui-type="ToastLabel"\n        data-ui-id="warnToastLabel"\n        data-ui-message-type="alert"\n        data-ui-hidden="true"\n        class="cash-warning-panel"></p> --\x3e\n    <div class="create-main">\n        <form class="setting-form"\n            data-ui-type="Form"\n            data-ui-id="form">\n            <div data-ui-id="buyBucket" data-ui-type="BuyBucket" data-ui-disabled="true"></div>\n            <div class="detail-parts-table">\n                <dl class="detail-create detail-part-1-col">\n                    <dt><h4>${i18n.付费及地域}</h4></dt>\n                    <dd>\n                        <label>${i18n.付费方式：}</label>\n                        <div>\n                            <div data-ui-type="RadioSelect"\n                                data-ui-id="productType"\n                                data-ui-name="productType"></div>\n                        </div>\n                    </dd>\n                    <dd>\x3c!-- import: TPL_common_partial_create_current_region --\x3e</dd>\n                    <dd>\x3c!-- import: TPL_common_partial_create_zone --\x3e</dd>\n                </dl>\n                <dl class="detail-create-settings detail-create detail-part-1-col">\n                    <dt>\n                        <h4>${i18n.配置信息}</h4>\n                    </dt>\n                    <dd>\n                        <label>${i18n.类型：}</label>\n                        <div class="relative-field">\n                            <div data-ui-id="type" data-ui-name="type" data-ui-type="RadioSelect" class="ui-radioselect-custom"></div>\n                        </div>\n                    </dd>\n                    <dd>\n                        <label>${i18n.配置：}</label>\n                        <div data-ui-type="Panel" data-ui-id="flavor"\n                            data-ui-extension-command-type="Command">\n                            \x3c!-- use: TPL_dcc_host_flavors(viewFlavors=${viewFlavors}, inactiveFlavors=${inactiveFlavors}, hostData=${hostData}) --\x3e\n                        </div>\n                    </dd>\n                    <dd>\n                        <label>vCPU：</label>\n                        <div>\n                            \x3c!-- if: ${viewFlavors.loading} --\x3e\n                            <div class="v-cpu-loading">\n                                <span class="loading">${i18n.数据加载中，请稍候……}</span>\n                            </div>\n                            \x3c!-- /if --\x3e\n                            <div data-ui-type="Dragger" data-ui-id="vCpu" data-ui-name="vCpu" data-ui-hidden="true" class="v-cpu">\n                            </div>\n                            <div data-ui-type="Tip" data-ui-id="vCpuTip" data-ui-arrow="true"\n                                data-ui-content="${tips.host.vCpu}" data-ui-hidden="true" class="v-cpu-tip">\n                            </div>\n                        </div>\n                    </dd>\n                </dl>\n                <dl class="detail-create-settings detail-create detail-part-1-col">\n                    <dt>\n                        <h4>${i18n.购买信息}</h4>\n                    </dt>\n                    <dd class="prepay-related">\n                        <label>${i18n.时长：}</label>\n                        <div class="relative-field">\n                            <div\n                                data-ui-id="purchaseLength"\n                                data-ui-name="purchaseLength"\n                                data-ui-type="RadioSelect" class="ui-radioselect-pl dcc-purchase-length"></div>\n                        </div>\n                    </dd>\n                    <dd>\n                        <label>${i18n.台数：}</label>\n                        <div class="relative-field">\n                            <div data-ui-type="NumberTextline" data-ui-id="purchaseNum"\n                                 data-ui-width="100" data-ui-name="purchaseNum" class="ui-radioselect-pn"></div>\n                            <label data-ui-type="Validity"\n                                   data-ui-id="purchaseNumValidity"></label>\n                            \x3c!-- if: ${quota.hostQuotaCreated} > 0 --\x3e\n                            ${i18n.专属服务器已创建数量：}${quota.hostQuotaCreated}${i18n.个}/ ${i18n.可创建总数：}${quota.hostQuotaTotal}${i18n.个}${i18n.。}\n                            ${i18n.如需增加配额请到}<a href="${constants.domains.ticket}">${i18n.工单}</a>申请。\n                            \x3c!-- /if --\x3e\n                        </div>\n                    </dd>\n                    <dd data-ui-id="renewPanel" class="prepay-related" data-ui-type="Panel">\n                        <label>${i18n.自动续费：}</label>\n                        <div>\n                            <div data-ui-type="ToggleButton"\n                                  data-ui-id="autoRenew"\n                                  data-ui-name="autoRenew"></div>\n                            <a href="https://cloud.baidu.com/doc/Finance/Renew/24.5C.E8.87.AA.E5.8A.A8.E7.BB.AD.E8.B4.B9.html" target="_blank">什么是自动续费？</a>\n                            <div data-ui-id="autoRenewPanel" data-ui-type="Panel" data-ui-hidden="true">\n                                <div class="auto-renew-item">\n                                    <label>${i18n.选择续费周期：}</label>\n                                    <div class="ui-group ui-select-group">\n                                        <div data-ui-type="Select" data-ui-id="autoRenewTimeUnit" data-ui-name="autoRenewTimeUnit"></div>\n                                        <div data-ui-type="Select" data-ui-id="autoRenewTime" data-ui-name="autoRenewTime"></div>\n                                    </div>\n                                    <span data-ui="type:Label;id:expireTimeLabel;" class="renew-expire-time"></span>\n                                </div>\n                            </div>\n                        </div>\n                    </dd>\n                </dl>\n            </div>\n        </form>\n    </div>\n</div>\n\n\x3c!-- target: TPL_dcc_host_flavors --\x3e\n\x3c!-- if: ${viewFlavors.loading} --\x3e\n<div>\n    <span class="loading">${i18n.数据加载中，请稍候……}</span>\n</div>\n\x3c!-- elif: !${viewFlavors} || ${viewFlavors.length} < 0 --\x3e\n<div>\n    <span>${i18n.当前可用区没有可购买的套餐}</span>\n</div>\n\x3c!-- else: --\x3e\n<div class="dcc-host-flavors">\n    \x3c!-- for: ${viewFlavors} as ${flavor}, ${index} --\x3e\n    <ul data-ui-type="Panel" data-ui-id="${flavor.name}" data-command="flavor" data-command-args="${flavor.name}"\n        title="\x3c!-- if: ${flavor.count}  < 1 --\x3e${i18n.已售罄，请尝试切换可用区或提交工单申请}\x3c!-- /if --\x3e"\n        class="\x3c!-- if: ${flavor.count}  < 1 --\x3einactive\n        \x3c!-- elif: ${flavor.name} === ${hostData.flavor.name} --\x3e active\x3c!-- /if --\x3e">\n        \x3c!-- if: ${flavor.count}  < 1 --\x3e\n        <li class="inactive-item">${i18n.售罄}</li>\n        \x3c!-- /if --\x3e\n        <li>\n            <h4>${i18n.套餐：}${flavor.name}</h4>\n        </li>\n        <li class="separation""></li>\n        <li>cpu: ${flavor.detail.cpu}${i18n.核}/${flavor.detail.cpuFrequency}GHZ</li>\n        <li>${i18n.内存: }${flavor.detail.memoryInGB}GB</li>\n        \x3c!-- for: ${flavor.detail.ephemeralDisks} as ${disk}, ${i}--\x3e\n            <li>${disk.storageType}${i18n.盘：}\n                \x3c!-- if: ${flavor.type} === \'calculation\' --\x3e\n                ${disk.sizePerDiskInGb}GB\n                \x3c!-- else: --\x3e\n                ${disk.sizePerDiskInGb}TB*${disk.blockInSize}${i18n.块}\n                \x3c!-- /if --\x3e\n            </li>\n        \x3c!-- /for --\x3e\n    </ul>\n    \x3c!-- /for --\x3e\n</div>\n\x3c!-- /if --\x3e\n'}),define("dcc/host/create/step1/ui",["exports","underscore","babel-runtime/helpers/interop-require-default","inf-i18n","common/region","common/zone","../../../config","../../../enums"],function(exports,e,t,a,i,n,s,r){exports.__esModule=!0,exports.getUIProperties=function(){var e=this.model,t=e.get("hostData"),a=e.get("viewFlavors"),i=e.get("tips"),n=e.get("quota");return{productType:{datasource:n.isWhiteAccount?r.ProductType.toArray():r.ProductType.toArray("PREPAY"),value:t.productType},type:{datasource:"fsh"===l["default"].getCurrentRegion().id?o["default"].each(r.FlavorType.toArray("CALCULATION"),function(e){e.disable=!a[e.value]}):o["default"].each(r.FlavorType.toArray(),function(e){e.disable=!a[e.value]}),value:t.type},vCpu:{value:t.vCpu,unit:"核",length:280},purchaseLength:{datasource:[{name:c["default"]("1个月"),value:1},{name:"2",value:2},{name:"3",value:3},{name:"4",value:4},{name:"5",value:5},{name:"6",value:6},{name:"7",value:7},{name:"8",value:8},{name:"9",value:9},{name:c["default"]("1年"),value:12,hoverContent:c["default"](i.saleTip[12])},{name:c["default"]("2年"),value:24,hoverContent:c["default"](i.saleTip[24])},{name:c["default"]("3年"),value:36,hoverContent:c["default"](i.saleTip[36])}],value:t.purchaseLength||1},purchaseNum:{currentValue:t.purchaseNum||1,max:n.hostQuotaTotal-n.hostQuotaCreated,required:"required",requiredErrorMessage:c["default"]("购买数量必填"),pattern:"^[1-9][0-9]*$",patternErrorMessage:c["default"]("购买数量必须是正整数"),validityLabel:"purchaseNumValidity"},buyBucket:{fields:u,offsetTop:20,value:o["default"].extend({price:e.get("price")},t),confirmBtn:{text:c["default"]("下一步"),skin:"skin-primary-button"}},logicalZone:{value:t.logicalZone,datasource:"@zoneDatasource"},autoRenewTimeUnit:{datasource:r.TimeType.toArray()},autoRenewTime:{datasource:r.Month.toArray()}}},exports.getUIEvents=function(){return{"productType:change":"onFormChanged","autoRenew:change":function(e){e.target.isChecked()?(this.get("autoRenewPanel").show(),this.updateExpireTime()):this.get("autoRenewPanel").hide(),this.onFormChanged(e)},"autoRenewTimeUnit:change":function(e){var t=e.target.getValue(),a=this.get("autoRenewTime");t===r.TimeType.MONTH?a.updateDatasource(r.Month.toArray()):a.updateDatasource(r.Year.toArray()),this.updateExpireTime(),this.onFormChanged(e)},"autoRenewTime:change":function(e){this.updateExpireTime(),this.onFormChanged(e)},"type:change":"onFormChanged","flavor:command":"changeFlavor","vCpu:change":"onFormChanged","purchaseLength:change":"onFormChanged","purchaseNum:change":function(e){e.target.getValue()>0&&this.onFormChanged(e)},"logicalZone:change":"onFormChanged",buyBucket:{reset:function(e){e.preventDefault(),this.fire("reset")},confirm:function(e){e.preventDefault(),this.fire("submit")}}}};var o=t["default"](e),c=t["default"](a),l=t["default"](i),d=t["default"](n),u=[{title:c["default"]("购买配置："),content:function(e){var t="",a=e.flavor;return a.name?(o["default"].each(a.detail.ephemeralDisks,function(a){t+="、<br />"+a.storageType+c["default"]("盘：")+a.sizePerDiskInGb,e.type===r.FlavorType.STORAGE?t+="TB*"+a.blockInSize+c["default"]("块"):t+="GB"}),a.name+"<br />\n                CPU："+a.detail.cpu+c["default"]("核")+"/"+a.detail.cpuFrequency+"GHZ、<br />\n                "+c["default"]("内存")+"："+a.detail.memoryInGB+"GB\n                "+t+"\n            "):"-"}},{title:c["default"]("地域："),content:function(e){return l["default"].getCurrentRegion().label}},{title:c["default"]("可用区："),content:function(e){return d["default"].getLabel(e.logicalZone)}},{title:c["default"]("购买配额："),content:function(e){var t=e.autoRenewTimeUnit===r.TimeType.MONTH?"个月":"年";return(e.productType===r.ProductType.PREPAY?e.purchaseNum+"台 * "+e.purchaseLength+"月":e.purchaseNum+"台")+(e.autoRenew?"<br>开通自动续费"+e.autoRenewTime+t:"")}},{title:c["default"]("配置费用："),content:function(e){var t=e.productType===r.ProductType.PREPAY?"":c["default"]("/月");return e.price&&o["default"].isNumber(e.price.money)?'<span class="price">￥'+(e.price.money.toFixed(2)+t)+"</span>":"ERROR"===e.price||o["default"].isObject(e.price)&&null==e.price.money?s.html.error.inline(c["default"]("请求异常，请刷新后重试。")+'<a href="javascript:location.reload();">'+c["default"]("刷新")+"</a>"):s.html.loading.inline()}}]}),define("dcc/host/create/step1/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","jquery","babel-runtime/helpers/interop-require-default","underscore","bat-ria/mvc/FormView","bat-ria/tpl!../tpl","bat-ria/tpl!./tpl","inf-i18n","common/constants","../../../config","./ui","../../../enums"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p){var f=i["default"](a),m=i["default"](n),h=i["default"](s),g=i["default"](c),v=i["default"](l),b=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_host_create_step1"}return e["default"](i,a),i.prototype.getUIProperties=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return u.getUIProperties.apply(this,t)},i.prototype.getUIEvents=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return u.getUIEvents.apply(this,t)},i.prototype.enterDocument=function(){a.prototype.enterDocument.call(this),this.updateProductType(),this.model.get("viewFlavors").loading||(this.updateFlavorDatasource(),this.updateBuyBucketSubmit()),this.updateBuyBucket()},i.prototype.updateBuyBucket=function(){var e=this.model.get("hostData"),t=this.model.get("price");this.get("buyBucket").setValue(m["default"].chain(e).clone().extend({price:t}).value()),this.updateBuyBucketSubmit()},i.prototype.updateBuyBucketSubmit=function(){var e=this.model.get("hostData"),t=this.model.get("price"),a=this.model.get("quota");v["default"].verifyUser&&"PASS"===v["default"].verifyUser.verifyStatus&&a.available>0&&null!=t&&m["default"].isNumber(t.money)&&e.flavor.count>0&&this.checkPurchaseValid()?this.enableBuyBucketSubmit():this.disableBuyBucketSubmit()},i.prototype.checkPurchaseValid=function(){var e=this.model.get("hostData"),t=this.model.get("prePurchaseValid"),a=this.model.get("posPurchaseValid");return e.productType===p.ProductType.PREPAY?!t||t.status:e.productType!==p.ProductType.POSTPAY||(!a||a.status)},i.prototype.buyWarningShow=function(){var e=this.model.get("tips"),t=this.model.get("quota"),a=this.model.get("prePurchaseValid"),i=this.model.get("posPurchaseValid"),n=v["default"].verifyUser&&"PASS"===v["default"].verifyUser.verifyStatus,s=this.get("productType").getValue(),r=this.get("buyBucket"),o="";n?t.available<=0?o=e.host.quota:s===p.ProductType.PREPAY&&a&&!a.status?o=g["default"]("温馨提示：")+a.failReason+' <a href="/billing/#/account/recharge">'+g["default"]("立即充值")+"</a>":s===p.ProductType.POSTPAY&&i&&!i.status&&(o=g["default"]("温馨提示：")+i.failReason+' <a href="/billing/#/account/recharge">立即充值</a>'):o=e.host.realname;var c='<div class="buy-bucket-tip">'+o+"</div>",l=f["default"](r.main).find(".buy-bucket-tip");o?(l.length>0?l.html(o):f["default"](r.main).append(c),l.show()):l.hide()},i.prototype.disableBuyBucketSubmit=function(){this.get("buyBucket").disable()},i.prototype.enableBuyBucketSubmit=function(){this.get("buyBucket").enable()},i.prototype.onFormChanged=function(e){var t=undefined,a={},i=this.model.get("viewFlavors"),n=e.target.id;switch(n){case"type":t=e.target.getValue(),a.flavor=m["default"].find(i[t],function(e){return e.count>0})||i[t][0];break;case"autoRenew":t=e.target.getValue(),e.target.checked?(a.autoRenewTimeUnit=this.get("autoRenewTimeUnit").getValue(),a.autoRenewTime=+this.get("autoRenewTime").getValue()):a.autoRenewTime=0;break;case"productType":t=e.target.getValue(),"postpay"===e.item.value&&(a.autoRenewTime=0,a.autoRenew=!1);break;default:t=e.target.getValue()}a[n]=t,this.fire(d.events.FORM_CHANGED,{toUpdate:a})},i.prototype.updateProductType=function(){this.model.get("hostData").productType===p.ProductType.PREPAY?f["default"](".prepay-related").show():f["default"](".prepay-related").hide()},i.prototype.updateAutoRenew=function(){var e=this.model.get("hostData");this.get("autoRenew").setProperties({checked:e.autoRenew})},i.prototype.updateExpireTime=function(){var e=this.get("autoRenewTimeUnit").getValue(),t="系统将于到期前7天进行扣费，扣费时长为"+this.get("autoRenewTime").getValue()+(e===p.TimeType.YEAR?"年":"月");this.get("expireTimeLabel").setText(t)},i.prototype.updateFlavorDatasource=function(){var e=this.model.get("viewFlavors"),t=this.model.get("hostData");this.updateFlavor();var a=m["default"].each(p.FlavorType.toArray(),function(t){t.disable=!e[t.value]});this.get("type").setProperties({datasource:a,selectedIndex:m["default"].pluck(a,"value").indexOf(t.type)})},i.prototype.updateFlavor=function(){var e=this.model.get("viewFlavors"),t=this.model.get("hostData"),a=m["default"].filter(e[t.type],function(e){return e.count<1});this.get("flavor").setContent("");var i=this.templateRender("TPL_dcc_host_flavors",{viewFlavors:e[t.type],inactiveFlavors:a,hostData:t});this.get("flavor").setContent(i),this.updateVcpu(),this.updatePurchaseNum()},i.prototype.updateVcpu=function(){var e=this.model.get("hostData").flavor;f["default"](".v-cpu-loading").hide(),this.get("vCpu").setProperties({min:e.detail.cpu,max:e.detail.maxCpu,value:e.detail.cpu,hidden:!1}),this.get("vCpuTip").show()},i.prototype.changeFlavor=function(e){var t,a=this.model.get("hostData"),i=this.model.get("viewFlavors"),n=(t={},t[e.name]=m["default"].find(i[a.type],function(t){return t.name===e.args}),t);n.flavor.count>0&&this.fire(d.events.FORM_CHANGED,{toUpdate:n})},i.prototype.updatePurchaseNum=function(){var e=this.get("purchaseNum"),t=this.model.get("hostData"),a=this.model.get("quota"),i=Math.min(t.flavor.count,a.hostQuotaTotal-a.hostQuotaCreated);0===e.getValue()&&i>0&&e.setValue(1),e.setProperties({max:i})},i.prototype.backward=function(){this.fire(d.events.BACKWARD)},i.prototype.restoreForms=function(){var e=this.model.get("hostData");this.setFormData(e)},i}(h["default"]);module.exports=b}),define("dcc/host/create/step3/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","bat-ria/mvc/FormAction","./Model","./View","promise","../../../config"],function(exports,module,e,t,a,i,n,s,r,o,c){var l=i["default"](a),d=i["default"](n),u=i["default"](s),p=i["default"](r),f=i["default"](o),m=["/dcc/host/create","/dcc/host/create/step1","/dcc/host/create/step2"],h=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=u["default"],this.viewType=p["default"]}return e["default"](i,a),i.prototype.enter=function(e){var t=this,i=e.referrer;return i&&l["default"].some(m,function(e){return e===i.getPath()})?a.prototype.enter.call(this,e).fail(function(e){return t.redirect("/dcc/host/create"),f["default"].reject()}):(this.context=e||{},this.redirect("/dcc/host/create"),f["default"].reject())},i.prototype.back=function(){this.model.getCache().prevPage=!0,a.prototype.back.call(this)},i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.view.on(c.events.BACKWARD,this.back,this);var e=this.model.get("orderData"),t=this.model.get("hostData"),i=l["default"].extend({},t,{flavor:t.flavor.name});this.view.renderOrderConfirm(e,i)},i}(d["default"]);module.exports=h}),define("dcc/host/create/step3/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","inf-i18n","common/util/orderUtil","common/region","common/zone","common/constants","../CreateModel","../../../enums","promise"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p){var f=n["default"](i),m=n["default"](s),h=n["default"](r),g=n["default"](o),v=n["default"](c),b=n["default"](l),y=n["default"](d),T=n["default"](p),x=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.prepare=function(){var e=this;return this.restoreFromCache().then(function(){e.set("orderData",e.getOrderData())})},n.prototype.restoreFromCache=function(){var e=this.getCache();return f["default"].isObject(e.hostData)&&f["default"].isObject(e.price)?(this.set("hostData",e.hostData),this.set("price",e.price),this.set("viewFlavors",e.viewFlavors),T["default"].resolve()):T["default"].reject()},n.prototype.getOrderData=function(){var e=this.get("hostData"),t=this.get("price"),a=e.flavor,i="CPU："+a.detail.cpu+m["default"]("核/")+a.detail.cpuFrequency+"GHZ、"+m["default"]("内存：")+a.detail.memoryInGB+"GB";f["default"].each(a.detail.ephemeralDisks,function(e){i+="、"+e.storageType+m["default"]("盘：")+e.sizePerDiskInGb,a.type===u.FlavorType.STORAGE?i+="TB*"+e.blockInSize+m["default"]("块"):i+="GB"});var n=e.productType===u.ProductType.PREPAY?m["default"]("/台"):m["default"]("/月/台"),s={confirmV2Url:"/api/bcc/dcc/order/v2/confirm",serviceType:"DCC",productType:e.productType,type:"NEW",price:t.money,items:[{serviceType:"DCC",productType:e.productType,count:e.purchaseNum,time:e.purchaseLength,timeUnit:"MONTH",price:t.money,unitPrice:t.perMoney,unitPriceShow:"￥"+t.perMoney+n,chargeType:b["default"].SERVICE_TYPE.DCC.chargeType[e.productType],configuration:[m["default"]("地域：")+g["default"].getCurrentRegion().label,m["default"]("可用区：")+v["default"].getLabel(e.logicalZone),m["default"]("套餐：")+e.flavor.name,i]}]};return h["default"].make(s)},t["default"](n,[{key:"datasource",get:function(){return{step:function(){return 2}}}}]),n}(y["default"]);module.exports=x}),define("dcc/host/create/step3/tpl",[],function(){return'\x3c!-- target: TPL_dcc_host_create_step3(master = TPL_dcc_host_create)--\x3e\n\x3c!-- block: detail --\x3e\n\x3c!-- import: TPL_dcc_host_create_step_order_confirm --\x3e\n\x3c!-- /block --\x3e\n\n\n\x3c!-- target: TPL_dcc_host_create_step_order_confirm --\x3e\n<div id="order-confirm" class="order-confirm-panel">\n    <div data-ui="id:orderConfirmAction;type:ActionPanel">\n    </div>\n</div>'}),define("dcc/host/create/step3/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/tpl!./tpl","inf-ria/app/brpc","babel-runtime/helpers/interop-require-default","bat-ria/mvc/FormView","../../../config"],function(exports,module,e,t,a,i,n,s,r){var o=n["default"](i),c=function(a){function i(){t["default"](this,i);for(var e=arguments.length,n=Array(e),s=0;s<e;s++)n[s]=arguments[s];a.call.apply(a,[this].concat(n)),this.template="TPL_dcc_host_create_step3"}return e["default"](i,a),i.prototype.getUIEvents=function(){return{"orderConfirmAction:action@prevPage":"backward","orderConfirmAction:action@confirmed":"orderConfirm"}},i.prototype.backward=function(){this.fire(r.events.BACKWARD)},i.prototype.orderConfirm=function(){this.model.clearCache()},i.prototype.renderOrderConfirm=function(e,t){var a=this.get("orderConfirmAction"),i=this.get("buyStep"),n={order:e,config:t};o["default"].invokeService("billing://order_confirm",a,n).then(function(){return i.set("currentStep",2)})},i}(n["default"](s)["default"]);module.exports=c}),define("dcc/host/create/tpl",[],function(){return'\x3c!-- target: TPL_dcc_host_create --\x3e\n<div class="dcc-host-create main-wrap-new">\n    \x3c!-- import: TPL_inf_ria_page_breadcrumb --\x3e\n        \x3c!-- block: back_link --\x3e#/dcc/host/list\x3c!-- /block --\x3e\n        \x3c!-- block: create_step --\x3e\n            <div data-ui-type="ViewStep"\n                 data-ui-id="buyStep"\n                 data-ui-current-step="${step}">\n                <ul>\n                    <li>${i18n.选择专属服务器}</li>\n                    \x3c!-- <li>创建子实例</li> --\x3e\n                    <li>${i18n.确认订单}</li>\n                    <li>${i18n.在线支付}</li>\n                    <li>${i18n.支付成功}</li>\n                </ul>\n            </div>\n        \x3c!-- /block --\x3e\n    \x3c!-- /import --\x3e\n    <div class="content-wrap">\n        <div class="create-content create-content-wrapper">\n            \x3c!-- block: detail --\x3e\n            <span class="loading"></span>\n            \x3c!-- /block --\x3e\n        </div>\n    </div>\n</div>\n\n\x3c!-- target: TPL_dcc_host_create_navigator --\x3e\n\x3c!-- <div class="ui-tab-navigator"> --\x3e\n    <div data-ui-type="ViewStep"\n         data-ui-id="buyStep"\n         data-ui-current-step="${step}">\n        <ul>\n            <li>${i18n.选择专属服务器}</li>\n            \x3c!-- <li>创建子实例</li> --\x3e\n            <li>${i18n.确认订单}</li>\n            <li>${i18n.在线支付}</li>\n            <li>${i18n.支付成功}</li>\n        </ul>\n    </div>\n\x3c!-- </div> --\x3e\n'}),define("dcc/host/detail/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","bat-ria/mvc/BaseAction","./Model","./View","../../config","../operation","../permission"],function(exports,module,e,t,a,i,n,s,r,o,c,l){var d=i["default"](a),u=i["default"](n),p=i["default"](s),f=i["default"](r),m=i["default"](c),h=i["default"](l),g=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=p["default"],this.viewType=f["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){var e=this;a.prototype.initBehavior.call(this),this.model.on(o.events.CHANGE,function(t){"change"===t.type&&e.syncModelToView.call(e,t)},this),this.view.on(o.events.COMMAND,this.dispatchCommand,this)},i.prototype.syncModelToView=function(e){var t=this;d["default"].each(e.changes,function(e){switch(e.name){case"viewData":t.view.repaint();break;case"name":case"description":t.view.updateDetailView({key:e.name})}})},i.prototype.dispatchCommand=function(e){var t=e.command;if(!h["default"].checkIfShouldDisabled(t,this.model.get("host"))){var a=e.args;try{a=JSON.parse(a)}catch(e){}this[t]?this[t].call(this,a):m["default"][t]?m["default"][t].call(this,a):alert("请添加方法：operation."+t+"\nargs is:\n"+JSON.stringify(a,null,4))}},i.prototype.editName=function(e){var t=this,a=e.toUpdate.name;this.view.get("inline-edit-for-name-value").validate()&&m["default"].editName.call(this,e).then(function(){t.view.hideInlineEdit({key:"name"}),t.model.setName(a)})},i.prototype.editDescription=function(e){var t=this,a=e.toUpdate.description;this.view.get("inline-edit-for-description-value").validate()&&m["default"].editDescription.call(this,e).then(function(){t.view.hideInlineEdit({key:"description"}),t.model.setDescription(a)})},i.prototype.renewHost=function(e){var t=[e.data.id+";"+e.data.hostId];m["default"].renewHost.call(this,t)},i}(u["default"]);module.exports=g}),define("dcc/host/detail/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/BaseModel","babel-runtime/helpers/interop-require-default","underscore","common/util/timeUtil","common/region","common/zone","../../config","../../enums","../operation","../permission"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p){var f=n["default"](i),m=n["default"](s),h=n["default"](r),g=n["default"](o),v=n["default"](c),b=n["default"](u),y=n["default"](p),T=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.prepare=function(){this.loadHostData()},n.prototype.loadHostData=function(){var e=this;return this.set("loading",!0),l.api.getDccHostDetail({id:this.get("id")},{showLoading:!1,"X-silence":!0}).then(function(t){e.set("loading",!1,{silent:!0}),t.regionLabel=[g["default"].getCurrentRegion().label,v["default"].getLabel(t.logicalZone)].join("，"),e.set("host",t,{silent:!0})}).then(m["default"].bind(this.updateViewData,this))},n.prototype.updateViewData=function(){var e=this.get("host"),t=m["default"].deepClone(e),a=d.HostStatus.getTextFromValue(e.status);t.statusHTML='\n            <span class="status '+e.status+'">\n                '+a+"\n            </span>\n        ",t.createTime=h["default"].toTime(e.createTime),t.expireTime=h["default"].toTime(e.expireTime),t.paymentText=l.lang.PAYMENT[e.payment],t.hostId=t.hostId||t.id,t.typeText=d.FlavorType.getTextFromValue(t.flavorType),t.vCpu=t.vCpu||t.cpuTotal;var i=m["default"].without(m["default"].keys(b["default"]),"checkIfShouldDisabled");t.commandState=m["default"].object(i,m["default"].map(i,function(t){return!y["default"].checkIfShouldDisabled(t,e)})),this.set("viewData",t)},n.prototype.setName=function(e){this.set("name",e)},n.prototype.setDescription=function(e){this.set("description",e)},n.prototype.editName=function(e,t){var a=this;return l.api.editHostName({name:e,hostIds:[t]}).then(function(){var t=a.get("host"),i=a.get("viewData");t.name=e,i.name=e})},n.prototype.editDescription=function(e,t){var a=this;return l.api.editHostDescription({description:e,hostId:t}).then(function(){var t=a.get("host"),i=a.get("viewData");t.description=m["default"].escape(e),i.description=m["default"].escape(e)})},t["default"](n,[{key:"datasource",get:function(){return{menu:function(){return"host"},tips:m["default"].constant(l.tips),loading:m["default"].constant(!0),activedTab:function(){return"detail"}}}}]),n}(f["default"]);module.exports=T}),define("dcc/host/detail/tpl",[],function(){return'\x3c!-- target: TPL_dcc_host_detail --\x3e\n\x3c!-- if: ${loading} --\x3e\n\x3c!-- import: TPL_dcc_host_detail_loading --\x3e\n\x3c!-- else: --\x3e\n\x3c!-- import: TPL_dcc_host_detail_main --\x3e\n\x3c!-- /if --\x3e\n\n\x3c!-- target: TPL_dcc_host_detail_main(master = TPL_dcc_host_detail_structure) --\x3e\n\x3c!-- block: abstrct-info --\x3e\n<h1 title="${viewData.name}">${viewData.name}</h1>\n${viewData.statusHTML|raw}\n<span class="ui-group ui-button-group">\n    <button data-ui-type="Button" data-ui-id="createInstance"\n        \x3c!-- if: !${viewData.commandState.createInstance} --\x3e\n        data-ui-disabled="true"\n        \x3c!-- /if --\x3e>\n        ${i18n.创建专属实例}</button>\n    \x3c!-- if: ${viewData.instanceCount} > 0 --\x3e\n    <button data-ui-type="Button" data-ui-id="deleteAllInstance"\n        \x3c!-- if: !${viewData.commandState.deleteAllInstance} --\x3e\n        data-ui-disabled="true"\n        \x3c!-- /if --\x3e>\n        ${i18n.删除所有专属实例}</button>\n    \x3c!-- /if --\x3e\n</span>\n\x3c!-- /block --\x3e\n\x3c!-- block: detail-info --\x3e\n<div class="host-info-section">\n    <h2 class="host-info-title"><em>${i18n.基础信息}</em></h2>\n    <div class="host-info-content">\n        <ul>\n            <li>\n                <div class="inline-edit-container">\n                    <div class="inline-edit-label">\n                        ${i18n.专属服务器名称：}\n                        <span class="truncated update-value" title="${viewData.name}">\n                            \x3c!-- if: ${viewData.name} --\x3e\n                            ${viewData.name}\n                            \x3c!-- else: --\x3e\n                            ${i18n.无}\n                            \x3c!-- /if --\x3e\n                        </span>\n                        \x3c!-- if: ${!viewData.commandState.editName} --\x3e\n                        <span class="link-like state-disabled">${i18n.变更}</span>\n                        \x3c!-- else: --\x3e\n                        <span class="link-like" data-command="inlineedit" data-command-args=\'{"key": "name"}\'>${i18n.变更}</span>\n                        \x3c!-- /if --\x3e\n                    </div>\n                    <div class="inline-edit-main name" for="name">\n                        <input data-ui="id:inline-edit-for-name-value;type:TextBox;value:${viewData.name};width:350;" />\n                        <button data-ui="id:inline-edit-for-name-submit;type:Button;skin:ok;">${i18n.保存}</button>\n                        <button data-ui="id:inline-edit-for-name-cancel;type:Button;skin:cancel;">${i18n.取消}</button>\n                        <label data-ui="id:inline-edit-for-name-value-validity;type:Validity"></label>\n                    </div>\n                </div>\n            </li>\n            <li>${i18n.状态：}${viewData.statusHTML|raw}</li>\n            <li>\n                ${i18n.专属服务器ID：}${viewData.hostId}\n                <button type="button"\n                    data-ui-type="Clipboard"\n                    class="link-like"\n                    data-ui-clipboard-text="@viewData.hostId"\n                    data-ui-id="copyId">${i18n.复制}</button>\n            </li>\n            <li>${i18n.支付方式：}${viewData.paymentText}</li>\n            <li>${i18n.类型：}${viewData.typeText}</li>\n            <li>${i18n.套餐名称：}${viewData.flavor}</li>\n            <li>\n                <div class="inline-edit-container">\n                    <div class="inline-edit-label">\n                        ${i18n.描述：}\n                        <span class="truncated update-value" title="${viewData.name}">\n                            \x3c!-- if: ${viewData.description} --\x3e\n                            ${viewData.description}\n                            \x3c!-- else: --\x3e\n                            ${i18n.无}\n                            \x3c!-- /if --\x3e\n                        </span>\n                        \x3c!-- if: ${!viewData.commandState.editDescription} --\x3e\n                        <span class="link-like state-disabled">${i18n.变更}</span>\n                        \x3c!-- else: --\x3e\n                        <span class="link-like" data-command="inlineedit" data-command-args=\'{"key": "description"}\'>${i18n.变更}</span>\n                        \x3c!-- /if --\x3e\n                    </div>\n                    <div class="inline-edit-main description" for="description">\n                        <input data-ui="id:inline-edit-for-description-value;type:TextBox;value:${viewData.description};width:350;" />\n                        <button data-ui="id:inline-edit-for-description-submit;type:Button;skin:ok;">${i18n.保存}</button>\n                        <button data-ui="id:inline-edit-for-description-cancel;type:Button;skin:cancel;">${i18n.取消}</button>\n                        <label data-ui="id:inline-edit-for-description-value-validity;type:Validity"></label>\n                    </div>\n                </div>\n            </li>\n            <li>${i18n.创建时间：}${viewData.createTime}</li>\n            \x3c!-- if: ${viewData.payment} === \'prepay\' --\x3e\n            <li>${i18n.到期时间：}${viewData.expireTime}</li>\n            \x3c!-- /if --\x3e\n            <li>${i18n.区域：}${viewData.regionLabel}</li>\n        </ul>\n        \x3c!-- if: ${viewData.payment} === \'prepay\' --\x3e\n        <div class="host-info-operation">\n            <button type="button"\n                data-ui-type="Button" data-ui-id="renewHost"\n                data-ui-disabled="${!viewData.commandState.renewHost}">${i18n.续费}</button>\n        </div>\n        \x3c!-- /if --\x3e\n    </div>\n</div>\n<div class="separator"></div>\n<div class="host-info-section">\n        <h2 class="host-info-title"><em>${i18n.配置信息}</em></h2>\n        <div class="host-info-content">\n            <ul>\n                <li>CPU：${viewData.cpuLeft}${i18n.核} / ${viewData.vCpu}${i18n.核（可用/总量）}</li>\n                <li>内存：${viewData.memoryLeft}GB / ${viewData.memoryTotal}GB${i18n.（可用/总量）}</li>\n                \x3c!-- if: ${viewData.flavorType} === \'storage\' --\x3e\n                <li>${i18n.磁盘（6TB/块）：}${viewData.diskSizeLeft}块 / ${viewData.diskSizeTotal}${i18n.块}${i18n.（可用/总量）}</li>\n                \x3c!-- else: --\x3e\n                <li>${i18n.磁盘：}${viewData.diskSizeLeft}GB / ${viewData.diskSizeTotal}GB${i18n.（可用/总量）}</li>\n                \x3c!-- /if --\x3e\n            </ul>\n            <div class="host-info-operation">\n                \x3c!-- <button type="button"\n                    data-ui-type="Button" data-ui-id="buySameConfiguration"\n                    data-ui-disabled="${!viewData.commandState.buySameConfiguration}">购买同配专属服务器</button> --\x3e\n            </div>\n        </div>\n    </div>\n</div>\n\x3c!-- /block --\x3e\n\n\x3c!-- target: TPL_dcc_host_detail_loading(master = TPL_dcc_host_detail_structure) --\x3e\n\x3c!-- block: abstrct-info --\x3e\n<div class="loading-container">\n    <span class="loading">${i18n.数据加载中，请稍后…}</span>\n</div>\n\x3c!-- /block --\x3e\n\x3c!-- block: detail-info --\x3e\n<div class="loading-container">\n    <span class="loading">${i18n.数据加载中，请稍后…}</span>\n</div>\n\x3c!-- /block --\x3e\n\n\x3c!-- target: TPL_dcc_host_detail_structure --\x3e\n<div class="dcc-wrapper main-wrap-new dcc-list">\n    <div class="content-wrap">\n        <div class="breadcrumb">\n            <span>${i18n.产品服务}</span>\n            <span class="divider">/</span>\n            <span><a href="#/dcc/host/list" title="查看专属服务器列表">${i18n.专属服务器} - ${i18n.列表}</a></span>\n            <span class="divider">/</span>\n            <span class="active">${i18n.专属服务器详情}</span>\n\n        </div>\n        <div class="instance-info">\n            \x3c!-- block: abstrct-info --\x3e\x3c!-- /block --\x3e\n        </div>\n        <div class="detail-content">\n            <div class="host-info-detail"\n                data-ui-type="Panel"\n                data-ui-id="hostInfoDetailPanel"\n                data-ui-extension-command-type="Command">\n                \x3c!-- block: detail-info --\x3e\x3c!-- /block --\x3e\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("dcc/host/detail/ui",["exports","underscore","babel-runtime/helpers/interop-require-default","../../config","../permission"],function(exports,e,t,a,i){function n(e){var t=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];try{t=JSON.parse(t)}catch(i){}t.data=this.model.get("host"),this.fire(a.events.COMMAND,{command:e,args:t})}exports.__esModule=!0,exports.getUIProperties=function(){var e=this.model.get("host");return{renewHost:{disabled:e&&r["default"].checkIfShouldDisabled("renewHost",e)},buySameConfiguration:{disabled:e&&r["default"].checkIfShouldDisabled("buySameConfiguration",e)},"inline-edit-for-name-value":s["default"].defaults({validityLabel:"inline-edit-for-name-value-validity"},a.rule.HOST.NAME),"inline-edit-for-description-value":s["default"].defaults({validityLabel:"inline-edit-for-description-value-validity"},a.rule.HOST.DESCRIPTION)}},exports.getUIEvents=function(){return{"copyId:aftercopy":function(){this.showToast("已复制到剪贴板")},"renewHost:click":function(e){n.call(this,"renewHost")},"buySameConfiguration:click":function(e){n.call(this,"buySameConfiguration")},"hostInfoDetailPanel:command":function(e){n.call(this,e.name,e.args||{}),e.stopPropagation(),e.preventDefault()},"inline-edit-for-name-submit:click":function(e){n.call(this,"editName",{toUpdate:{name:this.get("inline-edit-for-name-value").getValue()}})},"inline-edit-for-description-submit:click":function(e){n.call(this,"editDescription",{toUpdate:{description:this.get("inline-edit-for-description-value").getValue()}})},"inline-edit-for-name-cancel:click":function(e){this.get("inline-edit-for-name-value").setValue(this.model.get("host").name),this.hideInlineEdit({key:"name"})},"inline-edit-for-description-cancel:click":function(e){this.get("inline-edit-for-description-value").setValue(this.model.get("host").description),this.hideInlineEdit({key:"description"})},"createInstance:click":function(e){n.call(this,"createInstance")},"deleteAllInstance:click":function(e){n.call(this,"deleteAllInstance")}}};var s=t["default"](e),r=t["default"](i)}),define("dcc/host/detail/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/tpl!./tpl","bat-ria/mvc/BaseView","babel-runtime/helpers/interop-require-default","inf-i18n","underscore","jquery","common/constants","esui/TextBox","esui/Button","./ui"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u){var p=n["default"](i),f=n["default"](s),m=n["default"](r),h=n["default"](o),g=n["default"](c),v=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_host_detail"}return e["default"](i,a),i.prototype.getUIProperties=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return u.getUIProperties.apply(this,t)},i.prototype.getUIEvents=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return u.getUIEvents.apply(this,t)},i.prototype.repaint=function(){this.viewContext.dispose(),this.render(),this.handleSidebar()},i.prototype.handleSidebar=function(){var e=g["default"].availableService?g["default"].availableService.split(","):[];m["default"].contains(e,"GPU")&&h["default"]("#gpuSidebarItem a").html('<i class="iconfont icon-gpu"></i>'+f["default"]("GPU服务器")).show()},i.prototype.updateDetailView=function(e){var t=e.key,a=this.model.get("host")[t];h["default"](".inline-edit-main[for="+t+"]").parent(".inline-edit-container").find(".update-value").attr("title",a).html(a)},i.prototype.showInlineEdit=function(e){var t=e.key;h["default"](".inline-edit-main[for="+t+"]").show()},i.prototype.hideInlineEdit=function(e){var t=e.key;h["default"](".inline-edit-main[for="+t+"]").hide()},i}(p["default"]);module.exports=v}),define("dcc/host/instance/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","../../instance/list/Action","./Model","./View","../operation"],function(exports,module,e,t,a,i,n,s,r,o){var c=i["default"](a),l=i["default"](n),d=i["default"](s),u=i["default"](r),p=i["default"](o),f=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=d["default"],this.viewType=u["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this)},i.prototype.syncModelToView=function(e){var t=this;c["default"].each(e.changes,function(e){switch(e.name){case"viewData":t.view.repaint()}}),a.prototype.syncModelToView.call(this,e)},i.prototype.createInstance=function(e){p["default"].createInstance.call(this,e)},i}(l["default"]);module.exports=f}),define("dcc/host/instance/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","../../instance/list/Model","../../config","../../enums","../operation","../permission","inf-i18n"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d){var u=n["default"](i),p=n["default"](s),f=n["default"](c),m=n["default"](l),h=n["default"](d),g=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.prepare=function(){i.prototype.prepare.call(this),this.loadHostData()},n.prototype.getExtraQuery=function(){return{id:this.get("id")}},n.prototype.loadHostData=function(){var e=this;return this.set("loading",!0),r.api.getDccHostDetail({id:this.get("id")},{showLoading:!1,"X-silence":!0}).then(function(t){e.set("loading",!1,{silent:!0}),e.set("host",t,{silent:!0})}).then(function(){return e.updateViewData()})},n.prototype.updateViewData=function(){var e=this.get("host"),t=u["default"].deepClone(e),a=o.HostStatus.getTextFromValue(e.status);t.statusHTML='\n            <span class="status '+e.status+'">\n                '+a+"\n            </span>\n        ";var i=u["default"].without(u["default"].keys(f["default"]),"checkIfShouldDisabled");t.commandState=u["default"].object(i,u["default"].map(i,function(t){return m["default"].checkIfShouldDisabled(t,e)})),this.set("viewData",t)},t["default"](n,[{key:"datasource",get:function(){return{menu:function(){return"host"},tips:u["default"].constant(r.tips),loading:u["default"].constant(!0),activedTab:function(){return"instance"},keywordTypeDatasource:function(){return[{name:h["default"]("专属实例名称"),value:"name"},{name:h["default"]("专属实例ID"),value:"instanceId"},{name:h["default"]("专属实例内网IP"),value:"internalIp"},{name:h["default"]("专属实例公网IP"),value:"publicIp"},{name:h["default"]("专属服务器"),value:"hostName"},{name:h["default"]("所在网络"),value:"vpcName"},{name:h["default"]("所在子网"),value:"subnetName"},{name:h["default"]("子网ID"),value:"subnetId"}]}}}}]),n}(p["default"]);module.exports=g}),define("dcc/host/instance/tpl",[],function(){return'\x3c!-- target: TPL_dcc_host_instance_list(master = TPL_dcc_host_instance_list_structure) --\x3e\n\x3c!-- block: abstrct-info --\x3e\n\x3c!-- import: TPL_dcc_host_instance_abstrct_info --\x3e\n\x3c!-- /block --\x3e\n\x3c!-- block: detail-info --\x3e\n<div class="table-full-wrap">\n    <div class="operation-wrap" data-follow-thead="table">\n        <div class="buttons-wrap">\n            <button type="button"\n                data-ui-id="createInstance"\n                data-ui-type="Button"\n                data-ui-skin="create"\n                data-auth="forbidden"\n                data-authtype="READONLY"\n                title="创建专属实例">${i18n.创建专属实例}</button>\n            <button type="Button"\n                data-ui-type="Button"\n                data-ui-id="startInstance"\n                data-ui-disabled="true"\n                title="启动专属实例">${i18n.开启}</button>\n            <button type="Button"\n                data-ui-type="Button"\n                data-ui-id="configChange"\n                data-ui-disabled="true"\n                title="调整专属实例配置">${i18n.调整配置}</button>\n            <button data-ui-type="Button"\n                    data-ui-id="editTag"\n                    title="${i18n.标签}"\n                    data-intro="${i18n.资源可以打标签啦}">${i18n.编辑标签}\n            </button>\n            <span data-ui-type="Select" data-ui-id="moreOperation" data-ui-skin="light"></span>\n        </div>\n        <div class="buttons-quick-wrap">\n            <span class="ui-group ui-search-group">\n                            <span data-ui-type="SelectEx" data-ui-id="keywordType"\n                                  data-ui-value="@keywordType" data-ui-has-child-list="true"></span>\n                            <input class="search-box" data-ui-type="TextBox"\n                                   data-ui-id="keyword" data-ui-value="@keyword" data-ui-extension-textbox-type="TextBoxSelect"/>\n                            <button type="button" data-ui-type="Button" data-ui-id="searchBtn"></button>\n                \x3c!-- if: ${keyword} --\x3e\n                            <button type="button"\n                                    data-ui-type="Button"\n                                    data-ui-id="clearKeyword"\n                                    title="${i18n.清空搜索条件}"\n                                    class="link-like clear-button">${i18n.清空}</button>\n                \x3c!-- /if --\x3e\n            </span>\n            \x3c!-- <a title="查看全部专属实例" href="/bcc/#/dcc/instance/list" class="link-like">查看全部专属实例</a> --\x3e\n            <div id="table-custom-fields-container"></div>\n            <button type="button"\n                data-ui-type="Button" data-ui-id="refreshList" title="刷新表格数据">\n                <i class="iconfont icon-cdnrefresh"></i>\n            </button>\n            <button data-ui="type:Button;id:downloadList;" title="下载当前列表展现的专属实例信息，编码格式为utf-8">\n                <i class="iconfont icon-download"></i>\n            </button>\n        </div>\n    </div>\n    <div data-ui-type="Table" data-ui-id="table"\n         data-ui-datasource="@tableData"\n         data-ui-order-by="@orderBy" data-ui-order="@order"\n         data-ui-select="@selectMode" data-ui-extension-tip-type="TableTip"\n         data-ui-extension-command-type="Command"\n         data-ui-extension-tableedit-type="TableEdit"\n         data-ui-extension-tableex-type="TableEx"\n         data-ui-extension-customfields-type="TableCustomFields"\n         data-ui-extension-tablefilter-type="TableFilter">\n    </div>\n    <div class="ui-row">\n        \x3c!-- import: listPager --\x3e\n    </div>\n\n</div>\n\x3c!-- /block --\x3e\n\n\x3c!-- target: TPL_dcc_host_instance_abstrct_info --\x3e\n\x3c!-- if: ${loading} --\x3e\n<div class="loading-container">\n    <span class="loading">${i18n.数据加载中，请稍后…}</span>\n</div>\n\x3c!-- else: --\x3e\n<h1 title="${viewData.name}">${viewData.name}</h1>\n${viewData.statusHTML|raw}\n\x3c!-- /if --\x3e\n\n\x3c!-- target: TPL_dcc_host_instance_list_structure --\x3e\n<div class="dcc-host-detail dcc-wrapper main-wrap-new dcc-list">\n    <div class="content-wrap">\n        <div class="breadcrumb">\n            <span>${i18n.产品服务}</span>\n            <span class="divider">/</span>\n            <span><a href="#/dcc/host/list" title="查看专属服务器列表">${i18n.专属服务器} - ${i18n.列表}</a></span>\n            <span class="divider">/</span>\n            <span class="active">${i18n.关联专属实例}</span>\n\n        </div>\n        <div class="instance-info"\n            data-ui-type="Panel"\n            data-ui-id="hostInfoAbstrctPanel">\n            \x3c!-- block: abstrct-info --\x3e\x3c!-- /block --\x3e\n        </div>\n        <div class="detail-content">\n            <div class="host-info-detail"\n                data-ui-type="Panel"\n                data-ui-id="hostInfoDetailPanel"\n                data-ui-extension-command-type="Command">\n                \x3c!-- block: detail-info --\x3e\x3c!-- /block --\x3e\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("dcc/host/instance/ui",["exports","../../config","inf-i18n","babel-runtime/helpers/interop-require-default"],function(exports,e,t,a){function i(t){var a=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];try{a=JSON.parse(a)}catch(i){}a.data=this.model.get("host"),this.fire(e.events.COMMAND,{command:t,args:a})}exports.__esModule=!0,exports.getUIProperties=function(){return{keywordType:{datasource:[{name:n["default"]("专属实例名称"),value:"name"},{name:n["default"]("专属实例ID"),value:"instanceId"},{name:n["default"]("专属实例内网IP"),value:"internalIp"},{name:n["default"]("专属实例公网IP"),value:"publicIp"}]}}},exports.getUIEvents=function(){return{"lookAboveInstance:click":function(e){i.call(this,"lookAboveInstance")},"hostInfoDetailPanel:command":function(e){i.call(this,e.name,e.args||{}),e.stopPropagation(),e.preventDefault()},"createInstance:click":function(e){i.call(this,"createInstance")}}};var n=a["default"](t)}),define("dcc/host/instance/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","../../util","../../instance/list/View","bat-ria/tpl!./tpl","./ui"],function(exports,module,e,t,a,i,n,s,r,o){var c=i["default"](a),l=i["default"](n),d=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_host_instance_list"}return e["default"](i,a),i.prototype.getUIProperties=function(){for(var e,t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];var s=c["default"].clone((e=a.prototype.getUIProperties).call.apply(e,[this].concat(i)));return l["default"].deepExtend(s,o.getUIProperties.apply(this,i))},i.prototype.getUIEvents=function(){for(var e,t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];var s=c["default"].clone((e=a.prototype.getUIEvents).call.apply(e,[this].concat(i)));return l["default"].deepExtend(s,o.getUIEvents.apply(this,i))},i.prototype.repaint=function(){var e=this.get("hostInfoAbstrctPanel").main,t=this.templateRender("TPL_dcc_host_instance_abstrct_info",this.getTemplateData());e.innerHTML=t,this.get("createInstance").setDisabled(this.model.get("viewData").commandState.createInstance)},i}(i["default"](s)["default"]);module.exports=d}),define("dcc/host/list/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","intro.js","bat-ria/mvc/ListAction","./Model","./View","common/storage","inf-ria/app/brpc","../../config","../operation","../permission","./deleteHost/index"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p,f){var m=i["default"](a),h=i["default"](n),g=i["default"](s),v=i["default"](r),b=i["default"](o),y=i["default"](c),T=i["default"](l),x=i["default"](u),I=i["default"](p),S=i["default"](f),E=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=v["default"],this.viewType=b["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){var e=this;a.prototype.initBehavior.call(this),this.enterWelcomHandler(),this.model.on(d.events.LOAD_ERROR,function(t){e.view.showTableLoadingError()},this),this.view.on(d.events.BACKWARD,this.back,this),this.view.on(d.events.COMMAND,this.dispatchCommand,this),this.view.on(d.events.FILTER,this.filterList,this),this.view.on(d.events.EDIT_TAG,this.editTag,this),this.model.loadListData(),this.model.getHostFlavors(),this.setIntervalRefreshTable(),this.on("beforeleave",function(){return clearInterval(e.timer)})},i.prototype.enterWelcomHandler=function(){var e=this;y["default"].get("DCC_WELCOME")||function(){var t=h["default"]();t.setOptions({tooltipClass:"introjs-tooltip-fullscreen dcc-product-intro",showBullets:!0,showButtons:!0,steps:[{intro:'<div class="title title1">欢迎使用专属服务器</div><div class="content content1">购买专属服务器，您可以在独享的物理机资源上创建并运行您的专属实例，当您需要与其他公有云客户的资源实现物理隔离时，专属服务器是您的不二选择。</div><div class="background background1"></div>'},{intro:'<div class="title title2">欢迎使用专属服务器</div><div class="content content2">专属服务器集成了百度业界领先的云计算和虚拟化技术，购买专属服务器后，您可以快速创建配置各异的专属实例，并可以像使用云服务器BCC一样，使用这些专属实例。</div><div class="background background2"></div>'},{intro:'<div class="title title3">欢迎使用专属服务器</div><div class="content content3">开始体验您的专属服务器，享受极限性能和专属实例随意扩缩容的美妙体验吧！</div><div class="background background3"></div><div class="opt"><a href="#/dcc/host/create" class="ui-ctrl ui-button skin-primary-button new-buy-host">购买专属服务器</a></div>'}]}),t.start(),y["default"].set("DCC_WELCOME",!0),e.on("beforeleave",function(e){return t.exit()})}()},i.prototype.filterList=function(e){this.model.setFilters(e.condition)},i.prototype.syncModelToView=function(e){var t=this,a=!1;m["default"].each(e.changes,function(i){switch(i.name){case"tableLoading":!0===i.newValue&&t.view.showTableLoading();break;case"tableData":t.view.hideTableLoading(),t.view.renderTable();break;case"totalCount":case"pageSize":case"pageNo":a||(t.view.renderPager(),a=!0);break;case"filters":t.view.submitSearch(e);break;case"dccTags":t.view.updateKeywordType()}})},i.prototype.dispatchCommand=function(e){var t=e.command,a=e.args;try{a=JSON.parse(a)}catch(e){}a&&a.data&&!m["default"].isArray(a.data)&&I["default"].checkIfShouldDisabled(t,a.data)||(this[t]?this[t].call(this,a):x["default"][t]?x["default"][t].call(this,a):alert("请添加方法：operation."+t+"\nargs is:\n"+JSON.stringify(a,null,4)))},i.prototype.edit=function(e){var t=e.toUpdate;m["default"].has(t,"name")?x["default"].editName.call(this,e):m["default"].has(t,"description")&&x["default"].editDescription.call(this,e)},i.prototype.renewHost=function(e){var t=[e.data.id+";"+e.data.hostId];x["default"].renewHost.call(this,t)},i.prototype.batchCreateInstance=function(e){var t=m["default"].pluck(e.data,"id");if(e.data.length<2)return x["default"].createInstance.call(this,{data:e.data[0]});x["default"].batchCreateInstance.call(this,{hostIds:t})},i.prototype.deleteHost=function(e){this._DeleteHost&&this._DeleteHost.dispose(),this._DeleteHost=new S["default"]({data:{hosts:e,tip:d.tips.authCode.host,parentAction:this}}),this._DeleteHost.attach(document.body)},i.prototype.alterProductType=function(e){var t=[],a=[];if(m["default"].each(e.data,function(e){a.push(e.id+";"+e.hostId),t.push(e.payment)}),m["default"].chain(t).uniq().value().length>1)return this.view.waitAlert({title:"温馨提示",content:"计费变更已经支持预付费转后付费和后付费转预付费两种模式。<br>请您将预付费资源和后付费资源分开操作，谢谢！",encode:!1});x["default"].alterProductType.call(this,a,t[0])},i.prototype.cancelAlterProductType=function(e){var t=this,a=m["default"].pluck(e.data,"hostId");this.view.waitConfirm({title:"取消计费变更",content:"确认取消计费变更？<br/>您已开通计费变更-预付费转后付费功能。<br/>实例将会在到期后自动转换为后付费的计费方式。",width:420,needFoot:!0,encode:!1}).then(function(e){return t.model.cancelAlterProductType(a).then(function(e){t.view.showToast("取消预付费转后付费成功"),t.model.loadListData()}).fail(function(e){return t.view.showToast("取消预付费转后付费失败。",{messageType:"error"})})}).ensure(function(){return t.view.resetMoreOperation()})},i.prototype.updateHostVcpu=function(e){x["default"].updateHostVcpu.call(this,e.data)},i.prototype.editTag=function(e){var t=this;m["default"].each(e.data,function(e){return e.resoureId=e.hostId});var a={serviceType:"DCC",instances:e.data,submitRequester:d.api.dccTagAssign};T["default"].invokeService("tag://edit",a).then(function(){return t.reload()})},i.prototype.setIntervalRefreshTable=function(){var e=this;this.timer=setInterval(function(){return e.intervalRefreshListPage()},d.DCC_LISTEN_INTERVAL)},i.prototype.intervalRefreshListPage=function(){var e=this;this.view.shouldKeepSelectedIndex=!0,this.model.loadListData({silent:!0}).then(function(){return e.view.shouldKeepSelectedIndex=!1})},i}(g["default"]);module.exports=E}),define("dcc/host/list/deleteHost/index",["exports","module","inf-ui/sanx","san-xui","inf-i18n","babel-runtime/helpers/interop-require-default","underscore","../../../config","../../../enums"],function(exports,module,e,t,a,i,n,s,r){var o=i["default"](a),c=i["default"](n);module.exports=e.defineComponent({template:'<template>\n<xui-dialog class="delete-host-content" width="{{740}}" open="{=isShowDelete=}" on-confirm="confirmDelete" title="释放专属服务器">\n    <div class="delete-host-header">\n        <span class="delete-host-total-tip">待释放专属服务器（{{hosts.length}}）台</span>\n        <span class="tip">{{tip}}</span>\n    </div>\n    <div class="delete-host-body">\n        <div class="delete-host-select-list">\n            <xui-table\n                tableWidth="{{260}}"\n                select="single"\n                selected-index="{=selectTable.selectedIndex=}"\n                schema="{{selectTable.schema}}"\n                cell-builder="{{selectTable.cellRenderer}}"\n                on-selected-change="onTableRowSelected($event)"\n                datasource="{{hosts}}">\n            </xui-table>\n        </div>\n        <div class="delete-host-select-detail">\n            <div class="delete-host-select-detail-header">\n                <span>专属服务器（{{instanceName}}）包含{{detailTable.datasource.length}}个实例</span>\n            </div>\n            <div class="delete-host-select-detail-list">\n                <xui-table\n                    tableWidth="{{414}}"\n                    loading="{{detailTable.loading}}"\n                    schema="{{detailTable.schema}}"\n                    datasource="{{detailTable.datasource}}">\n                </xui-table>\n            </div>\n        </div>\n    </div>\n    <div s-if="{{hasRecycle}}" class="recycle-check">\n        <xui-checkbox checked="{= recycleResources =}" title="进入回收站"/>\n        <span class="recycle-tip dcc-color-lightgray">（只有后付费资源进入回收站，其他资源状态不受影响）</span>\n    </div>\n</xui-dialog>\n</template>',components:{"xui-table":t.Table,"xui-dialog":t.Dialog,"xui-checkbox":t.CheckBox},initData:function(){return{isShowDelete:!0,selectTable:{selectedIndex:"0",schema:[{name:"name",label:"专属服务器名称/ID",width:"60%"},{name:"instanceCount",label:"实例数",width:"40%"}],cellRenderer:function(e,t,a,i){return"name"===t?"<span>"+e.name+"</span><br/><span>"+e.hostId+"</span>":e[t]}},detailTable:{loading:!1,schema:[{name:"name",label:"实例名称"},{name:"instanceId",label:"ID"},{name:"internalIp",label:"内网IP"}],datasource:[]},hasRecycle:!1,recycleResources:!1}},inited:function(){},onTableRowSelected:function(e){var t=e.selectedItems,a=t[0].id,i=t[0].name;this.data.set("instanceName",i),this.requestList(a)},requestList:function(e){var t=this;this.data.set("detailTable.loading",!0),s.api.getDccInstanceList({id:e}).then(function(e){t.data.set("detailTable.loading",!1),t.data.set("detailTable.datasource",e.result)})},confirmDelete:function(){var e=this.data.get(),a=e.hosts,i=e.recycleResources,n=e.parentAction;s.api.deleteDccHost({hostIds:c["default"].pluck(a,"id"),recycleResources:i}).then(function(e){t.Toast.success(o["default"]("释放成功")),n&&n.reload()})},getRecycleWhitelist:function(){var e=this,t=this.data.get("hosts");return s.api.getRecycleWhitelist().then(function(a){var i=!!c["default"].find(t,function(e){return e.payment===r.ProductType.POSTPAY&&e.status!==r.HostStatus.EXPIRED});e.data.set("hasRecycle",a.status&&i),e.data.set("recycleResources",a.status&&i)})}})}),define("dcc/host/list/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","promise","bat-ria/mvc/ListModel","common/region","../../config","er/URL"],function(exports,module,e,t,a,i,n,s,r,o,c){var l=n["default"](i),d=n["default"](s),u=n["default"](r),p=n["default"](o),f={"x-silent":!0},m=function(i){function n(e){a["default"](this,n),i.call(this,e);var t=this;t.listRequester=function(){var a=l["default"].extend({tips:c.tips,result:[]},l["default"].omit(e,"container","isChildAction","referrer","url"));return d["default"].resolve(l["default"].defaults(a,t.defaultArgs))}}return e["default"](n,i),n.prototype.prepare=function(){var e=this,t=this.get("filters");"string"==typeof t&&function(){try{t=JSON.parse(t)}catch(i){}e.set("filters",t,{silent:!0});var a={};l["default"].each(t,function(e){a[e.join("")]=!0}),e.set("filterMapper",a,{silent:!0})}(),this.getDccTags()},n.prototype.getHostFlavors=function(){var e=this;return c.api.getDccHostFlavor({},f).then(function(t){return e.set("hostFlavors",t)})},n.prototype.getExtraArgs=function(){var e=this.dump();return l["default"].pick(e,["keywordType","keyword","order","orderBy","pageSize","pageNo"])},n.prototype.filterQuery=function(e){var t=[],a=e.keyword,i=e.keywordType;if(e.filters){var n=e.filters;delete e.filters;try{n=JSON.parse(n)}catch(s){}l["default"].each(n,function(a){"expiredDate<7"===a.join("")?e.showMode="WILLEXPIRED":t.push({keywordType:a[0],keyword:a[1]})})}return i&&i.match(/^tag\/([\u4e00-\u9fa5\w\-\/\.]{0,64})$/)&&(i="tag","空值"===a&&(a=""),"所有值"===a&&(a="@@@")),(e.keyword||"tag"===i)&&t.push({keywordType:i,subKeywordType:e.subKeywordType||"",keyword:a||""}),e.filters=t,e.pageNo&&(e.pageNo=+e.pageNo),e.pageSize&&(e.pageSize=+e.pageSize),e},n.prototype.loadListData=function(){var e=this,t=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],a=this.getQuery();return t.silent||this.set("tableLoading",!0),c.api.getDccHostList(a,{"x-silent":!0}).then(function(t){e.set("tableData",t.result),e.fill(l["default"].pick(t,["totalCount","order","orderBy","pageNo","pageSize"]))},function(){e.fire(c.events.LOAD_ERROR)}).then(function(){e.set("tableLoading",!1)})},n.prototype.getDownloadUrl=function(){var e=this.getQuery();return e.filters&&(e.filters=JSON.stringify(e.filters)),delete e.pageNo,delete e.pageSize,"/api/bcc/dcc/host/download?"+require("er/URL").serialize(e)},n.prototype.setFilters=function(e){this.set("filters",e)},n.prototype.updateTableData=function(e,t,a,i){var n=this.get("tableData");if(i&&i.silent)n[a][e]=t,this.set("tableData",n);else{var s=l["default"].deepClone(n);s[a][e]=t,this.set("tableData",s)}},n.prototype.editName=function(e,t,a){var i=this;return c.api.editHostName({name:e,hostIds:[t]}).then(function(){i.updateTableData("name",e,a)})},n.prototype.editDescription=function(e,t,a){var i=this;return c.api.editHostDescription({description:e,hostId:t}).then(function(){i.updateTableData("description",e,a)})},n.prototype.getDccTags=function(){var e=this;return c.api.getSearchTagList({serviceType:["DCC"],region:[p["default"].getCurrentRegion().id]},f).then(function(t){var a=l["default"].groupBy(t,"tagKey");l["default"].each(a,function(e,t){a[t]=l["default"].map(e,function(e){return{name:e.tagValue||"空值",value:e.tagValue}}),a[t]=[{name:"所有值",value:"@@@"}].concat(a[t])}),e.set("dccTags",a)})},n.prototype.cancelAlterProductType=function(e){return c.api.dccCancelAlterProductType({serviceType:"DCC",instanceIds:e},{"x-silent":!0})},t["default"](n,[{key:"datasource",get:function(){return{menu:function(){return"host"},keywordTypeDatasource:function(){return[{name:"专属服务器名称",value:"name"}]}}}},{key:"defaultArgs",get:function(){return{order:"desc",orderBy:"createTime",pageSize:c.dcc.host.DEFAULT.PAGE_SIZE}}}]),n}(u["default"]);module.exports=m}),define("dcc/host/list/tpl",[],function(){return'\x3c!-- target: TPL_dcc_host_list--\x3e\n<div class="dcc-wrapper main-wrap-new dcc-list">\n    <div class="content-wrap">\n        <p class="breadcrumb">\n            <span>${i18n.产品服务}</span>\n            <span class="divider">/</span>\n            <span class="active">${i18n.专属服务器} - ${i18n.列表}</span>\n        </p>\n        <div class="list-content">\n            <h2>\n                ${i18n.专属服务器列表}\n            </h2>\n            <div class="link-wrap">\n            <span class="quick-search-wrap">\n                <ul class="quick-search-filters">\n                    <li\n                    \x3c!-- if: ${filterMapper.expiredDate<7} --\x3e\n                        class="link-like actived"\n                        title="${i18n.清除快捷筛选}：${i18n.7天即将到期}"\n                    \x3c!-- else: --\x3e\n                        class="link-like"\n                        title="${i18n.快捷筛选}：${i18n.7天即将到期}"\n                    \x3c!-- /if --\x3e\n                        data-key="expiredDate" data-op="<" data-value="7">\n                        ${i18n.7天即将到期}\n                        <span class="close">×</span>\n                    </li>\n                </ul>\n            </span>\n            <a href="/billing/#/renew/list~serviceType=DCC"><i class="iconfont icon-renewmanage"></i>${i18n.自动续费}</a></div>\n            <div class="table-full-wrap">\n                <div class="operation-wrap" data-follow-thead="table">\n                    <div class="buttons-wrap">\n                        <button type="button"\n                                data-ui-id="buyHost"\n                                data-ui-type="Button"\n                                data-ui-skin="create"\n                                data-auth="forbidden"\n                                data-authtype="READONLY"\n                                title="${i18n.购买专属服务器}">${i18n.购买专属服务器}\n                        </button>\n                        <button type="button"\n                                data-ui-type="Button" data-ui-id="batchEditName" data-ui-disabled="true"\n                                title="${i18n.修改实例名称}">${i18n.修改名称}\n                        </button>\n                        <button type="button"\n                                data-ui-type="Button" data-ui-id="deleteHost" data-ui-disabled="true"\n                                title="${i18n.释放专属服务器}">${i18n.释放}\n                        </button>\n                        <button data-ui-type="Button"\n                                data-ui-id="editTag"\n                                title="${i18n.标签}"\n                                data-intro="${i18n.资源可以打标签啦}">${i18n.编辑标签}\n                        </button>\n                        <span data-ui-type="Select" data-ui-id="moreOpt" data-ui-skin="light"></span>\n                    </div>\n                    <div class="buttons-quick-wrap">\n                        <span class="ui-group ui-search-group">\n                            <span data-ui-type="SelectEx" data-ui-id="keywordType"\n                                  data-ui-value="@keywordType"\n                                  data-ui-has-child-list="true"></span>\n                            <input class="search-box" data-ui-type="TextBox"\n                                   data-ui-id="keyword" data-ui-value="@keyword" data-ui-extension-textbox-type="TextBoxSelect"/>\n                            <button type="button" data-ui-type="Button" data-ui-id="searchBtn"></button>\n                            \x3c!-- if: ${keyword} --\x3e\n                            <button type="button"\n                                    data-ui-type="Button"\n                                    data-ui-id="clearKeyword"\n                                    title="${i18n.清空搜索条件}"\n                                    class="link-like clear-button">${i18n.清空}</button>\n                            \x3c!-- /if --\x3e\n                        </span>\n                        <button type="button"\n                        data-ui-type="Button" data-ui-id="refreshList" title="${i18n.刷新表格数据}">\n                        <i class="iconfont icon-cdnrefresh"></i>\n                        </button>\n                        <button data-ui="type:Button;id:downloadList;" title="${i18n.下载当前列表展现的专属服务器信息，编码格式为utf-8}">\n                            <i class="iconfont icon-download"></i>\n                        </button>\n                        <div id="table-custom-fields-container"></div>\n                    </div>\n                </div>\n                <div data-ui-type="Table" data-ui-id="table"\n                     data-ui-datasource="@tableData"\n                     data-ui-order-by="@orderBy" data-ui-order="@order"\n                     data-ui-select="@selectMode" data-ui-extension-tip-type="TableTip"\n                     data-ui-extension-command-type="Command"\n                     data-ui-extension-tableedit-type="TableEdit"\n                     data-ui-extension-tableex-type="TableEx"\n                     data-ui-extension-customfields-type="TableCustomFields"\n                     data-ui-extension-tablefilter-type="TableFilter">\n                </div>\n                <div class="ui-row">\n                    \x3c!-- import: listPager --\x3e\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("dcc/host/list/ui",["exports","underscore","babel-runtime/helpers/interop-require-default","jquery","inf-i18n","common/util/tableUtil","common/util","./ui/tableFields","../../config","../permission","../../enums"],function(exports,e,t,a,i,n,s,r,o,c,l){function d(e,t){this.fire(o.events.COMMAND,{command:e,args:t})}exports.__esModule=!0,exports.getUIProperties=function(){return{buyHost:{disabled:h["default"].isSubUser()},table:m["default"].tableProperty(g["default"],{followHead:!0,noFollowHeadCache:!0,followDoms:[p["default"](".operation-wrap")[0]],editable:1,noDataHtml:"<div><p>"+f["default"]("没有相关数据!")+"</p></div>",extTableEx:["name","expireTime","instance"],extTableCustomFields:{container:"#table-custom-fields-container",defaults:["name","status","payment","flavor","configuration","instance","tag","operation"],locked:{head:["name"],tail:["operation"]},maxFields:9}}),pager:{pageSizes:[10,20,50,100]},keyword:{placeholder:f["default"]("请输入专属服务器名称进行搜索")},moreOpt:{emptyText:f["default"]("更多操作"),selectedIndex:-1,datasource:[{name:f["default"]("创建专属实例"),value:"batchCreateInstance"},{name:f["default"]("计费变更"),value:"alterProductType"},{name:f["default"]("取消计费变更"),value:"cancelAlterProductType"},{name:f["default"]("设置vCPU"),value:"updateHostVcpu"}]},keywordType:{datasource:"@keywordTypeDatasource"}}},exports.getUIEvents=function(){return{"table:select":function(){var e=this.get("table").getSelectedItems();m["default"].setButtonStatusOfTable(this,{batchEditName:{rule:function(e){return!v["default"].checkIfShouldDisabled("editName",e)}},deleteHost:{rule:function(e){return!v["default"].checkIfShouldDisabled("deleteHost",e)}},editTag:{rule:function(e){return e.status!==b["default"].BUILD}}}),m["default"].setSelectStatusOfTable(this,"moreOpt",{batchCreateInstance:{rule:function(t){return!v["default"].checkIfShouldDisabled("createInstance",t,e)}},alterProductType:{rule:function(e){return!v["default"].checkIfShouldDisabled("alterProductType",e)}},cancelAlterProductType:{rule:function(e){return!v["default"].checkIfShouldDisabled("cancelAlterProductType",e)}},updateHostVcpu:{rule:function(t){return!v["default"].checkIfShouldDisabled("updateHostVcpu",t,e)}}})},"table:command":function(e){d.call(this,e.name,e.args),e.stopPropagation(),e.preventDefault()},"table:saveedit":function(e){var t,a=(t={},t[e.field.field]=e.value,t),i={row:[e.rowIndex],toUpdate:a,data:this.model.get("tableData")[e.rowIndex]};d.call(this,"edit",i)},"table:clipboard@aftercopy":function(e){this.showToast(f["default"]("已复制到剪贴板"))},"table:clipboard@error":function(e){e.originalTarget.hide()},"buyHost:click":function(e){d.call(this,"buyHost")},"keyword:enter":"submitSearch","searchBtn:click":"submitSearch","clearKeyword:click":function(e){this.get("keyword").setValue(""),this.submitSearch.call(this,e)},"refreshList:click":function(e){this.get("table").setProperties({selectedIndex:[]}),this.showRefreshLoading(),d.call(this,"refreshList")},"batchEditName:click":function(e){var t=this.get("table"),a=[],i=[];u["default"].each(t.getSelectedItems(),function(e){a.push(e.id),i.push(e.name)}),d.call(this,"batchEditName",{hostIds:a,hostNames:i})},"deleteHost:click":function(e){var t=this.get("table").getSelectedItems();d.call(this,"deleteHost",t)},"moreOpt:change":function(e){var t=this.get("table").getSelectedItems();e.target.getValue()&&t.length>0&&d.call(this,e.target.getValue(),{data:t})},"downloadList:click":function(e){window.open(this.model.getDownloadUrl())},"table:filter":function(e){var t=this.get("table").fields[e.fieldIndex],a=this.model.get("filters")||[],i=u["default"].reject(a,function(e){return e[0]===t.field});i.push([t.field,e.value]),this.fire(o.events.FILTER,{condition:i})},"editTag:click":function(e){var t=this.get("table").getSelectedItems();this.fire(o.events.EDIT_TAG,t)},"keywordType:change":function(e){var t=this.model.get("dccTags"),a=this.get("keyword"),i=[];if(t){var n=e.target.getSelectedItem(),s=n[0].name||n[0].text;if(n.length>1){var r=n[1].value;s="",r&&(s="标签值",i=t[r])}a.setProperties({placeholder:s?u["default"].sprintf(f["default"]("请输入%s进行搜索"),s):f["default"]("搜索无标签实例")})}a.setProperties({datasource:i})}}};var u=t["default"](e),p=t["default"](a),f=t["default"](i),m=t["default"](n),h=t["default"](s),g=t["default"](r),v=t["default"](c),b=t["default"](l)}),define("dcc/host/list/ui/tableFields",["exports","module","underscore","babel-runtime/helpers/interop-require-default","common/util/timeUtil","common/zone","common/region","inf-i18n","../../../config","../../../enums","../../permission"],function(exports,module,e,t,a,i,n,s,r,o,c){var l=t["default"](e),d=t["default"](a),u=t["default"](i),p=t["default"](n),f=t["default"](s),m=t["default"](c),h=r.dcc.host.PRODUCT_TYPE;module.exports=[{field:"name",title:f["default"]("专属服务器名称/ID"),width:"16%",minWidth:151,sortable:!0,content:function(e,t,a){var i=l["default"].escape(e.name);if(e.hostId=e.hostId||e.id,!e.hostId)return'<span class="truncated">'+i+"</span>";if(!e.name)return'\n                    <div>\n                        <span class="truncated" title="'+e.hostId+'">'+e.hostId+'</span>\n                        <button data-ui-type="Clipboard"\n                            class="link-copy link-like"\n                            data-ui-clipboard-text="'+e.hostId+'"\n                            data-ui-id="copyId'+t+'"\n                            data-ui-x-event-name="clipboard"\n                            data-ui-x-event-type="aftercopy,error"\n                            data-ui-x-event-bubble="true">\n                            <i class="iconfont icon-copy" title="'+f["default"]("复制到剪贴板")+'"></i>\n                        </button>\n                    </div>\n                ';var n={commandArgs:{row:t,col:a,data:e}},s=l["default"].defaults({command:"editName",disabled:m["default"].checkIfShouldDisabled("editName",e)},n);return'\n                <a href="#/dcc/host/detail~id='+e.id+'" title="'+i+'" class="truncated">\n                    '+i+"\n                </a>\n                "+r.html.operation.tableEdit(s)+'\n                <br />\n                <div>\n                    <span class="truncated" title="'+e.hostId+'">'+e.hostId+'</span>\n                    <button data-ui-type="Clipboard"\n                        class="link-copy link-like"\n                        data-ui-clipboard-text="'+e.hostId+'"\n                        data-ui-id="copyId'+t+'"\n                        data-ui-x-event-name="clipboard"\n                        data-ui-x-event-type="aftercopy,error"\n                        data-ui-x-event-bubble="true">\n                        <i class="iconfont icon-copy" title="'+f["default"]("复制到剪贴板")+'"></i>\n                    </button>\n                </div>\n            '},editContent:function(e){return l["default"].escape(e.name)},editNote:r.rule.HOST.NAME.placeholder,editRules:l["default"].omit(r.rule.HOST.NAME,"placeholder")},{field:"status",title:f["default"]("状态"),width:"9%",minWidth:75,filter:{datasource:o.HostStatus.getFilterStatus()},content:function(e){var t=o.HostStatus.getTextFromValue(e.status);return'\n                <span class="status '+e.status+'">\n                    '+t+"\n                </span>\n            "}},{field:"payment",title:f["default"]("支付方式"),width:"9%",minWidth:99,filter:{datasource:[{name:f["default"]("全部"),value:""},{name:f["default"]("预付费"),value:"prepay"},{name:f["default"]("后付费"),value:"postpay"}]},content:function(e){var t=f["default"]("该实例已开通计费变更-预付费转后付费，将会在到期后转为后付费资源，请关注！\n                <br>如需进行续费等操作，请先取消计费变更，谢谢！");return e.payment===h.PREPAY&&"to_postpay"===e.orderStatus?r.lang.PAYMENT[e.payment]+'&nbsp;<span data-ui-type="Tip"data-ui-skin="warning"data-ui-arrow="true"data-ui-content="'+t+'"></span>':r.lang.PAYMENT[e.payment]}},{title:f["default"]("创建时间"),field:"createTime",width:"11%",minWidth:96,sortable:!0,content:function(e){return d["default"].toDate(e.createTime)}},{title:f["default"]("到期时间"),field:"expireTime",width:"11%",minWidth:96,sortable:!0,content:function(e,t,a){var i="",n="",s=p["default"].getCurrentRegion().id,r='\n            <a href="/billing/#/billing/recharge/list~serviceType=DCC&instanceIds='+(e.id+";"+e.hostId)+"&region="+s+'">\n                '+f["default"]("续费入口")+">>\n            </a>";return n=e.status===o.HostStatus.EXPIRED?""+f["default"]("您的专属服务器已经过期，请您尽快续费。")+r:l["default"].sprintf(f["default"]("您的专属服务器还有%s天到期，请您尽快续费。"),e.expireDate)+r,e.expireDate<7&&(i=' <span data-ui-type="Tip"\n                    data-ui-id="expireTimeTip'+t+'"\n                    data-ui-skin="warning"\n                    data-ui-arrow="true"\n                    data-ui-content=\''+n+"'></span>"),e.payment===h.PREPAY?d["default"].toDate(e.expireTime)+i:"-"}},{field:"type",title:f["default"]("类型"),width:"7%",content:function(e){return o.FlavorType.getTextFromValue(e.flavorType)}},{field:"flavor",title:f["default"]("套餐名称"),width:"7%",minWidth:70,content:function(e){return e.flavor||"-"}},{field:"configuration",title:f["default"]("配置（可用/总量）"),width:"15%",content:function(e){var t=f["default"]("磁盘：")+e.diskSizeLeft+"/"+e.diskSizeTotal+"GB";return e.flavorType===o.FlavorType.STORAGE&&(t=f["default"]("磁盘（6TB/块）：")+e.diskSizeLeft+"/"+e.diskSizeTotal+f["default"]("块")),"\n                CPU："+e.cpuLeft+"/"+(e.vCpu||e.cpuTotal)+f["default"]("核")+" <br />\n                "+f["default"]("内存：")+e.memoryLeft+"/"+e.memoryTotal+"GB <br />\n                "+t+"\n            "}},{field:"instance",title:f["default"]("专属实例"),width:"11%",minWidth:80,sortable:!0,content:function(e,t,a){var i=e.instanceCount>0?'\n                    <a href="#/dcc/host/instance~id='+e.id+'" title="'+f["default"]("查看关联专属实例列表")+'">\n                        '+f["default"]("已创建"+e.instanceCount+"个")+"\n                    </a>":'\n                    <span class="empty">\n                        '+f["default"]("未创建")+'\n                        <span data-ui-type="Tip"\n                            data-ui-id="noInstanceTip'+t+'"\n                            data-ui-skin="warning"\n                            data-ui-arrow="true"\n                            data-ui-content="'+r.tips.host.noInstanceCreated+'"></span>\n                    </span>\n                ',n={command:"createInstance",commandArgs:{row:t,col:a,data:e},label:'<i class="iconfont icon-plus"></i>',title:f["default"]("创建专属实例")};return'\n                <span class="host-instances">\n                    '+i+"\n                </span>\n                "+(m["default"].checkIfShouldDisabled("createInstance",e)?"":r.html.operation.linkButton(n))+"\n            "}},{field:"description",title:f["default"]("描述"),width:"8%",minWidth:60,content:function(e,t,a){var i={command:"editDescription",commandArgs:{row:t,col:a,data:e},disabled:m["default"].checkIfShouldDisabled("editDescription",e)},n=l["default"].escape(e.description||"-");return'\n                <span title="'+n+'" class="truncated">'+n+"</span>\n                "+r.html.operation.tableEdit(i)+"\n            "},editContent:function(e){return e.description},editRules:r.rule.HOST.DESCRIPTION},{field:"logicalZone",title:f["default"]("所在可用区"),minWidth:"65",width:"8%",content:function(e){return u["default"].getLabel(e.logicalZone)}},{field:"tag",title:f["default"]("标签"),sortable:!0,width:"9%",content:function(e,t,a){if(!e.tags||e.tags.length<1)return"-";var i="",n="";return l["default"].each(e.tags,function(e,t){n+="{"+e.tagKey+" : "+e.tagValue+"} ",t<2&&(i+=e.tagKey+" : "+e.tagValue+"<br/>")}),e.tags.length>2&&(i+="..."),'\n                <div title="'+n+'">\n                    '+i+"\n                </div>\n            "}},{field:"operation",title:f["default"]("操作"),width:"8%",minWidth:85,content:function(e,t,a){var i={commandArgs:{row:t,col:a,data:e}},n=l["default"].defaults({command:"renewHost",label:f["default"]("续费"),title:f["default"]("续费"),disabled:m["default"].checkIfShouldDisabled("renewHost",e)},i),s=l["default"].defaults({command:"deleteAllInstance",label:f["default"]("清空资源"),title:f["default"]("清空资源"),disabled:m["default"].checkIfShouldDisabled("deleteAllInstance",e)},i);return"\n                "+r.html.operation.linkButton(n)+"\n                "+(e.instanceCount>0?r.html.operation.linkButton(s):"")+"\n            "}}]}),define("dcc/host/list/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","jquery","babel-runtime/helpers/interop-require-default","underscore","bat-ria/mvc/ListView","bat-ria/tpl!./tpl","esui/Button","inf-ria/ui/Clipboard","common/util/tableUtil","inf-i18n","./ui","./ui/tableFields","dcc/config"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p,f){var m=i["default"](a),h=i["default"](n),g=i["default"](s),v=i["default"](l),b=i["default"](d),y=i["default"](p),T=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_host_list"}return e["default"](i,a),i.prototype.getUIProperties=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return u.getUIProperties.apply(this,t)},i.prototype.getUIEvents=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return u.getUIEvents.apply(this,t)},i.prototype.bindEvents=function(){a.prototype.bindEvents.call(this);var e=this;m["default"](".quick-search-filters").on("click","li",function(t){m["default"](this).toggleClass("actived");var a=e.model.get("filters")||[],i=h["default"].reject(a,function(e){return"expiredDate<7"===e.join("")});m["default"](".quick-search-filters li").each(function(e,t){var a=m["default"](t);if(a.hasClass("actived")){var n=a.data();i.push([n.key,n.op,n.value])}}),e.fire(f.events.FILTER,{condition:i})})},i.prototype.enterDocument=function(){this.setTableFilterValue(),a.prototype.enterDocument.call(this)},i.prototype.setTableFilterValue=function(){var e=this.model.get("filters");e&&e.length>0?h["default"].each(y["default"],function(t){t.filter&&h["default"].each(e,function(e){e[0]===t.field&&(t.filter.value=e[1])})}):h["default"].each(y["default"],function(e){e.filter&&(e.filter.value=null)})},i.prototype.backward=function(){this.fire(f.events.BACKWARD)},i.prototype.showTableLoading=function(){this.get("table").addState("loading")},i.prototype.hideTableLoading=function(){this.get("table").removeState("loading")},i.prototype.showTableLoadingError=function(){var e="<div><p>"+b["default"]("列表数据加载异常，请刷新页面！")+"</p></div>";this.hideTableLoading(),this.get("table").setProperties({noDataHtml:e,datasource:[]})},i.prototype.renderTable=function(){var e=this.model.get("tableData"),t=this.get("table"),a={datasource:h["default"].clone(e)};this.shouldKeepSelectedIndex||(a.selectedIndex=[]),t.setProperties(a)},i.prototype.renderPager=function(){this.get("pager").setProperties({count:this.model.get("totalCount"),page:this.model.get("pageNo")})},i.prototype.getSearchArgs=function(){var e=v["default"].getSearchArgs.call(this),t=this.model.get("filters"),a=this.get("keywordType");if(a){var i=a.getSelectedItem();e.keywordType=a.getValue(),e.subKeywordType=i[1]&&i[1].value}return t&&t.length>0&&(e.filters=JSON.stringify(t)),e},i.prototype.showRefreshLoading=function(){this.get("refreshList").setProperties({content:'<span class="loading">'+b["default"]("刷新中")+"...</span>",disable:!0})},i.prototype.hideRefreshLoading=function(){this.get("refreshList").setProperties({content:'<i class="iconfont icon-cdnrefresh"></i>',disable:!1})},i.prototype.resetMoreOperation=function(){var e=this.get("moreOpt");e.get("selectedIndex")>-1&&e.setProperties({selectedIndex:-1})},i.prototype.updateKeywordType=function(){var e=this.model.get("keywordTypeDatasource"),t=this.model.get("dccTags"),a=this.model.get("keywordType"),i=h["default"].map(h["default"].keys(t),function(e){return{name:e,value:e}});e.push({name:b["default"]("标签"),value:"tag",children:i}),this.get("keywordType").setProperties({datasource:e,hasChildList:!0,joinStr:"/",value:a})},i}(g["default"]);module.exports=T}),define("dcc/host/operation",["exports","module","underscore","babel-runtime/helpers/interop-require-default","promise","er/URL","common/util/dialog","common/billing/common","../config"],function(exports,module,e,t,a,i,n,s,r){var o=t["default"](e),c=t["default"](a),l=t["default"](i),d=t["default"](n),u=t["default"](s),p=r.dcc.host.PRODUCT_TYPE;module.exports={buyHost:function(){this.redirect("/dcc/host/create")},buySameConfiguration:function(e){var t=e.data;return this.redirect(l["default"].withQuery("/dcc/host/create",{type:t.flavorType,flavor:t.flavor,productType:t.payment})),c["default"].resolve()},refreshList:function(){var e=this;return new c["default"](function(t,a){e.model.loadListData({silent:!0}).then(o["default"].bind(e.view.hideRefreshLoading,e.view)).then(t,a)})},renewHost:function(e){return u["default"].recharge("DCC",e,"","/api/bcc/dcc/order/v2/confirm"),c["default"].resolve()},alterProductType:function(e,t){u["default"].alterProductType("DCC",e,t===p.PREPAY?"TO_POSTPAY":"TO_PREPAY")},createInstance:function(e){this.redirect("/dcc/instance/create~hostId="+e.data.id+(e.data.logicalZone?"&logicalZone="+e.data.logicalZone:""))},batchCreateInstance:function(e){return this.redirect(l["default"].withQuery("/dcc/instance/create",{hostIds:e.hostIds})),c["default"].resolve()},editName:function(e){var t=e.toUpdate,a=e.data,i=e.row;return this.model.editName(t.name,a.id,i)},batchEditName:function(e){return d["default"].waitActionDialog(this.view,{title:"批量修改实例名称",width:540,needFoot:!0,url:"/dcc/host/operation/changeName",actionOptions:{hostIds:e.hostIds,hostNames:e.hostNames,parentAction:this}})},editDescription:function(e){var t=e.toUpdate,a=e.data,i=e.row;return this.model.editDescription(t.description,a.id,i)},deleteAllInstance:function(e){var t={hostId:e.data.id,instanceIds:[]};return d["default"].waitActionDialog(this.view,{title:"删除所有专属实例",width:600,needFoot:!0,url:"/dcc/operation/smsVerify",actionOptions:{extraData:t,requester:r.api.deleteInstance,tip:r.tips.authCode.hostInstance,parentAction:this}}).then(function(e){var t=e.target;t.getFoot().getChild("btnOk").on("click",function(e){t.getAction().view.fire("submit"),t.hide()})})},updateHostVcpu:function(e){var t=this;return this.view.waitActionDialogExt({title:"更新Vcpu",width:600,needFoot:!0,url:"/dcc/host/operation/updateVcpu",actionOptions:{hosts:e,hostFlavors:this.model.get("hostFlavors"),parentAction:this}}).then(function(e){var a=e.target;t.vCpuDialog=a,a.getChild("foot").getChild("btnOk").setDisabled(!0),a.on("cancel",function(){return t.view.resetMoreOperation&&t.view.resetMoreOperation()}),a.on("close",function(){return t.view.resetMoreOperation&&t.view.resetMoreOperation()})})},inlineedit:function(e){return this.view.showInlineEdit(e),c["default"].resolve()}}}),define("dcc/host/operation/changeName/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormAction","babel-runtime/helpers/interop-require-default","./Model","./View"],function(exports,module,e,t,a,i,n,s){var r=i["default"](a),o=i["default"](n),c=i["default"](s),l=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=o["default"],this.viewType=c["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this)},i.prototype.redirectAfterSubmit=function(){var e=this.model.get("parentAction");e&&(e.redirectAfterChangeName&&e.redirectAfterChangeName()||e.reload())},i}(r["default"]);module.exports=l}),define("dcc/host/operation/changeName/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormModel","babel-runtime/helpers/interop-require-default","../../../config"],function(exports,module,e,t,a,i,n,s){var r=function(i){function n(e){a["default"](this,n),i.call(this,e),this.submitRequester=s.api.editHostName}return e["default"](n,i),n.prototype.getExtraData=function(){return{hostIds:this.get("hostIds")||[]}},t["default"](n,[{key:"datasource",get:function(){return{}}}]),n}(n["default"](i)["default"]);module.exports=r}),define("dcc/host/operation/changeName/tpl",[],function(){return'\x3c!-- target: TPL_dcc_host_changeName --\x3e\n<div class="dcc-dialog-form change-name-dialog-form">\n    <form data-ui-type="Form" data-ui-id="form"\n        data-ui-auto-validate="true">\n        <div class="form-data-body">\n            <div class="form-row">\n                <label>${i18n.您选择的实例：}</label>\n                <ul class="form-value">\n                    \x3c!-- for: ${hostNames} as ${hostName} --\x3e\n                    <li class="host-name nowrap-text" title="${hostName}">${hostName}</li>\n                    \x3c!-- /for --\x3e\n                </ul>\n            </div>\n            <div class="form-row">\n                <label>${i18n.实例名称前缀：}</label>\n                <div class="form-value">\n                    <input data-ui-validity-label="nameValidity"\n                        data-ui-required="required"\n                        data-ui-required-error-message="${i18.实例名称前缀必填}"\n                        data-ui-type="TextBox"\n                        data-ui-id="name"\n                        data-ui-name="name"\n                        data-ui-width="350" />\n                    <label data-ui-type="Validity"\n                        data-ui-id="nameValidity"></label>\n                </div>\n            </div>\n        </div>\n    </form>\n</div>\n\n\x3c!-- target: TPL_dcc_host_changeName_child --\x3e\n\x3c!-- import: TPL_dcc_host_changeName --\x3e\n'}),define("dcc/host/operation/changeName/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormView","babel-runtime/helpers/interop-require-default","../../../config","bat-ria/tpl!./tpl"],function(exports,module,e,t,a,i,n,s){var r=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_host_changeName"}return e["default"](i,a),i.prototype.getUIProperties=function(){return{name:n.rule.HOST.NAME}},i}(i["default"](a)["default"]);module.exports=r}),define("dcc/host/operation/updateVcpu/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","inf-ria/mvc/FormAction","babel-runtime/helpers/interop-require-default","./Model","./View"],function(exports,module,e,t,a,i,n,s){var r=i["default"](a),o=i["default"](n),c=i["default"](s),l=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=o["default"],this.viewType=c["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this)},i.prototype.redirectAfterSubmit=function(){var e=this.model.get("parentAction");e&&e.reload()},i}(r["default"]);module.exports=l}),define("dcc/host/operation/updateVcpu/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","inf-ria/mvc/FormModel","babel-runtime/helpers/interop-require-default","lodash","../../../config"],function(exports,module,e,t,a,i,n,s,r){var o=n["default"](i),c=n["default"](s),l={"x-silent":!0},d=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.submitRequester=function(e){return r.api.updateDccHostVcpu(e,l)},n.prototype.prepare=function(){this.set("formData",this.initFormData())},n.prototype.initFormData=function(){var e=this.get("hosts"),t=this.get("hostFlavors"),a=c["default"].find(t,function(t){return t.name===e[0].flavor}),i=0,n=0;return c["default"].each(e,function(e){n=e.vCpu?Math.max(e.cpuTotal,e.vCpu-e.cpuLeft):e.cpuTotal,i<n&&(i=n)}),{vCpu:e.length>1?i:e[0].vCpu,minVcpu:i,maxVcpu:a?a.detail.maxCpu:2*(e[0].cpuTotal+2)}},n.prototype.getExtraData=function(){return{hostIds:c["default"].pluck(this.get("hosts"),"id")}},t["default"](n,[{key:"datasource",get:function(){return{tips:function(){return r.tips},hostFlavors:function(e){return e.get("hostFlavors")?e.get("hostFlavors"):r.api.getDccHostFlavor()}}}}]),n}(o["default"]);module.exports=d}),define("dcc/host/operation/updateVcpu/tpl",[],function(){return'\x3c!-- target: TPL_dcc_host_update_vcpu --\x3e\n<div class="dcc-dialog-form dcc-host-update-vcpu">\n    <div class="tip">${i18n.vCPU参数设置后立即生效，请点击确认后进行设置！}</div>\n    <form data-ui-type="Form"\n          data-ui-id="form"\n          data-ui-auto-validate="true">\n        <div class="form-data-body">\n            <div class="form-row">\n                <label>vCPU：</label>\n                <div class="form-value">\n                    <div data-ui-type="Dragger" data-ui-id="vCpu" data-ui-name="vCpu" class="v-cpu">\n                    </div>\n                    <div data-ui-type="Tip" data-ui-id="vCpuTip" data-ui-arrow="true" data-ui-content="${tips.host.vCpu}" class="v-cpu-tip">\n                    </div>\n                </div>\n            </div>\n        </div>\n    </form>\n\n</div>\n\n\x3c!-- target: TPL_dcc_host_update_vcpu_child --\x3e\n\x3c!-- import: TPL_dcc_host_update_vcpu --\x3e\n'}),define("dcc/host/operation/updateVcpu/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/tpl!./tpl","inf-ria/mvc/FormView","babel-runtime/helpers/interop-require-default","inf-i18n"],function(exports,module,e,t,a,i,n,s){var r=n["default"](i),o=n["default"](s),c=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_host_update_vcpu"}return e["default"](i,a),i.prototype.getUIProperties=function(){var e=this.model.get("formData");return{vCpu:{value:e.vCpu,min:e.minVcpu,max:e.maxVcpu,unit:o["default"]("核"),length:300}}},i.prototype.getUIEvents=function(){return{"vCpu:change":function(e){var t=this.model.get("formData");this.model.get("parentAction").vCpuDialog.getChild("foot").getChild("btnOk").setDisabled(+e.target.getValue()==+t.vCpu)}}},i}(r["default"]);module.exports=c}),define("dcc/host/permission",["exports","module","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","common/util","../enums","../config"],function(exports,module,e,t,a,i,n,s){var r,o=a["default"](t),c=a["default"](i),l=s.dcc.host.PRODUCT_TYPE,d=c["default"].isSubUser(),u=(r={},r[n.HostStatus.UP]=["editName","editDescription","deleteAllInstance","createInstance","renewHost","buySameConfiguration","edit","deleteHost","alterProductType","updateHostVcpu","cancelAlterProductType"],r[n.HostStatus.DOWN]=["editName","editDescription","buySameConfiguration","edit","deleteHost","alterProductType","cancelAlterProductType"],r[n.HostStatus.EXPIRED]=["renewHost","buySameConfiguration","deleteAllInstance","deleteHost"],r),p=["buySameConfiguration","buyHost","renewHost","alterProductType","cancelAlterProductType","deleteHost"],f=function(){function t(){e["default"](this,t)}return t.prototype.getOperationsByStatus=function(e){return u[e]||[]},t.prototype.isGranted=function(e,t){return o["default"].contains(this.getOperationsByStatus(e),t)},t.prototype.checkIfShouldDisabled=function(e,t,a){var i=t.status||"";if(o["default"].indexOf(["inlineedit"],e)>-1)return!1;if(d&&o["default"].contains(p,e))return!0;if(this.isGranted(i,e))switch(e){case"createInstance":var s=t.cpuLeft&&t.memoryLeft&&(t.flavorType===n.FlavorType.STORAGE||t.diskSizeLeft);return s&&a?!(o["default"].chain(a).pluck("logicalZone").uniq().value().length<=1&&o["default"].chain(a).pluck("flavorType").uniq().value().length<=1):!s;case"renewHost":return!(t.payment===l.PREPAY)||"to_postpay"===t.orderStatus;case"deleteHost":return t.payment===l.PREPAY&&t.status!==n.HostStatus.EXPIRED;case"alterProductType":return t.autoRenew||!!t.orderStatus;case"cancelAlterProductType":return"to_postpay"!==t.orderStatus;case"updateHostVcpu":return o["default"].chain(a).pluck("flavor").uniq().value().length>1;default:return!1}return!0},t}();module.exports=new f}),define("dcc/image/action.conf",["exports","module"],function(exports,module){module.exports=[{path:"/dcc/image/list",type:"dcc/image/list/Action",skipRegionCheck:!0},{path:"/bcc/image/list",type:"dcc/image/list/Action",skipRegionCheck:!0},{path:"/dcc/image/operation/shareImage",type:"dcc/image/operation/shareImage/Action",skipRegionCheck:!0},{path:"/dcc/image/operation/unshareImage",type:"dcc/image/operation/unshareImage/Action",skipRegionCheck:!0}]}),define("dcc/image/list/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","../../../bcc/mvc/ListAction","babel-runtime/helpers/interop-require-default","intro.js","common/storage","./Model","./View","../../config","../operation","../permission"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d){var u=i["default"](a),p=i["default"](n),f=i["default"](s),m=i["default"](r),h=i["default"](o),g=i["default"](l),v=i["default"](d),b=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=m["default"],this.viewType=h["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.view.on(c.events.COMMAND,this.dispatchCommand,this),this.view.on(c.events.FILTER,this.filterList,this),this.on("listDataFailed",this.listDataFailedHandler,this),this.on("listDataLoaded",this.showIntro,this)},i.prototype.listDataFailedHandler=function(){this.view.updatePageData({tableData:[]},"<div><p>列表数据加载异常，请刷新页面！</p></div>")},i.prototype.showIntro=function(){var e=this;f["default"].get("bcc-image-intro-20170408")||function(){e.view.setTableHeadIntro();var t=p["default"]();t.start(),f["default"].set("bcc-image-intro-20170408",!0),e.on("beforeleave",function(e){return t.exit()})}()},i.prototype.filterList=function(e){this.model.setFilters(e.condition)},i.prototype.syncModelToViewIterator=function(e){switch(e.name){case"filters":this.view.submitSearch(e);break;case"quota":this.view.renderQuotaTip()}},i.prototype.dispatchCommand=function(e){var t=e.command,a=e.args;try{a=JSON.parse(a)}catch(e){}a&&a.data&&v["default"].checkIfShouldDisabled(t,a.data)||(this[t]?this[t].call(this,a):g["default"][t]?g["default"][t].call(this,a):alert("请添加方法：operation."+t+"\nargs is:\n"+JSON.stringify(a,null,4)))},i.prototype.refresh=function(){this.asyncListPage()},i.prototype.editName=function(e){var t=this;g["default"].editName.call(this,e).then(function(){return t.view.renderTableByRow(e.row)}).fail(function(e){return t.view.get("table").showEditError(e.field.name)})},i.prototype.shareImage=function(e){g["default"].shareImage.call(this,e.data)},i.prototype.unshareImage=function(e){g["default"].unshareImage.call(this,e.data)},i}(u["default"]);module.exports=b}),define("dcc/image/list/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","../../../bcc/mvc/ListModel","../../config","../../enums","./ui/tableFields"],function(exports,module,e,t,a,i,n,s,r,o,c){var l=n["default"](i),d=function(i){function n(e){a["default"](this,n),i.call(this,e)}return e["default"](n,i),n.prototype.listRequester=function(e){return r.api.bccImageList(e,{"x-silent":!0})},n.prototype.prepare=function(){this.getQuota(),this.set("tableFields",this.getTableFields())},n.prototype.setFilters=function(e,t){this.set("filters",e,t)},n.prototype.getQuota=function(){var e=this;return r.api.dccQuota({objType:"template"},{"X-silence":!0}).then(function(t){return e.set("quota",t)})},n.prototype.getTableFields=function(){var e=this.get("filters"),t=this.get("hasHost"),a=l["default"].clone(c.tableFields);if(t?a.push(c.operationDcc):a.push(c.operationBcc),"string"==typeof e){try{e=JSON.parse(e)}catch(i){}this.setFilters(e,{silent:!0})}return e&&e.length>0?l["default"].each(a,function(t){t.filter&&l["default"].each(e,function(e){e[0]===t.field&&(t.filter.value=e[1])})}):l["default"].each(a,function(e){e.filter&&(e.filter.value=null)}),a},n.prototype.filterQuery=function(e){var t=e.filters;if(t){delete e.filters;try{t=JSON.parse(t)}catch(a){}l["default"].each(t,function(t){"imageType"===t[0]&&t[1]&&(e.imageTypes=[t[1]])})}return e},n.prototype.updateTableData=function(e,t,a,i){var n=this.get("tableData");if(i&&i.silent)n[a][e]=t,this.set("tableData",n);else{var s=l["default"].deepClone(n);s[a][e]=t,this.set("tableData",s)}},n.prototype.editName=function(e,t,a){var i=this;return r.api.editImageName({name:e,imageId:t}).then(function(){return i.updateTableData("name",e,a)})},t["default"](n,[{key:"datasource",get:function(){return{menu:function(e){return"mirror"},hasHost:function(){return r.api.getDccHostList({pageSize:1,pageNo:1}).then(function(e){return e.result.length>0}).then(function(e){return!!e||r.api.getDccInstanceList({pageSize:1,pageNo:1}).then(function(e){return e.result.length>0})})}}}},{key:"defaultArgs",get:function(){return{imageTypes:[o.ImageType.CUSTOM,o.ImageType.SHARING,o.ImageType.FPGACUSTOM,o.ImageType.GPUBCCCUSTOM],order:"desc",orderBy:"createTime",pageSize:r.dcc.image.DEFAULT.PAGE_SIZE}}}]),n}(n["default"](s)["default"]);module.exports=d}),define("dcc/image/list/tpl",[],function(){return'\x3c!-- target: TPL_dcc_image_list--\x3e\n<div class="dcc-wrapper main-wrap-new dcc-list">\n    <div class="content-wrap">\n        <p class="breadcrumb">\n            <span>${i18n.产品服务}</span>\n            <span class="divider">/</span>\n            <span class="active">${i18n.云服务器BCC} - ${i18n.镜像列表}</span>\n        </p>\n        <div class="list-content">\n            <h2>\n                ${i18n.镜像列表}\n                <span class="quota-tip"></span>\n            </h2>\n            <div class="table-full-wrap">\n                <div class="operation-wrap" data-follow-thead="table">\n                    <div class="buttons-wrap">\n                        <div type="button"\n                            data-ui-type="Button" data-ui-id="deleteImage" data-ui-disabled="true" tip="删除镜像"\n                            data-ui-extension-popover-type="PopoverEx"\n                            data-track-id="ti_bcc_image_delete" data-track-name="删除镜像">删除镜像</div>\n                    </div>\n                    <div class="buttons-quick-wrap">\n                        \x3c!-- import: TPL_dcc_common_search --\x3e\n                        <div id="table-custom-fields-container"\n                            data-ui-extension-popover-type="PopoverEx"\n                            data-track-id="ti_bcc_image_custom_fields" data-track-name="自定义列"></div>\n                        <button type="button"\n                            data-ui-type="Button" data-ui-id="refreshList" title="${i18n.刷新表格数据}"\n                            data-track-id="ti_bcc_image_refresh" data-track-name="刷新">\n                            <i class="iconfont icon-cdnrefresh"></i>\n                        </button>\n                    </div>\n                </div>\n                <div data-ui-type="Table" data-ui-id="table"\n                     data-ui-datasource="@tableData"\n                     data-ui-order-by="@orderBy" data-ui-order="@order"\n                     data-ui-select="@selectMode" data-ui-extension-tip-type="TableTip"\n                     data-ui-extension-command-type="Command"\n                     data-ui-extension-tableedit-type="TableEdit"\n                     data-ui-extension-tableex-type="TableEx"\n                     data-ui-extension-tablefilter-type="TableFilter"\n                     data-track-id="ti_bcc_image_table"\n                     data-track-name="列表操作">\n                </div>\n                <div class="ui-row">\n                    \x3c!-- import: listPager --\x3e\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("dcc/image/list/ui",["exports","jquery","babel-runtime/helpers/interop-require-default","underscore","inf-i18n","common/util/tableUtil","common/util/PermissionChecker","../../config","../rules"],function(exports,e,t,a,i,n,s,r,o){function c(e,t){this.fire(r.events.COMMAND,{command:e,args:t})}exports.__esModule=!0,exports.getUIProperties=function(){return{table:p["default"].tableProperty("@tableFields",{followHead:!0,noFollowHeadCache:!0,followDoms:[l["default"](".operation-wrap")[0]],editable:1,extTableEx:["imageType","operation"],noDataHtml:"<div><p>"+u["default"]("没有可选择的镜像！")+"</p></div>"}),pager:{pageSizes:[10,20,50,100]},keywordType:{datasource:[{name:u["default"]("镜像名称"),value:"MIRROR_NAME"}]},keyword:{placeholder:u["default"]("请输入镜像名称进行搜索")}}},exports.getUIEvents=function(){return{"table:select":function(){var e=this.get("table").getSelectedItems(),t=f["default"].check(m["default"],e,"deleteImage");p["default"].setButtonStatusAndTip(this,t,e)},"table:command":function(e){c.call(this,e.name,e.args),e.stopPropagation(),e.preventDefault()},"table:filter":function(e){var t=this.get("table").fields[e.fieldIndex],a=this.model.get("filters")||[],i=d["default"].reject(a,function(e){return e[0]===t.field});i.push([t.field,e.value]),this.fire(r.events.FILTER,{condition:i})},"table:saveedit":function(e){var t,a=(t={},t[e.field.field]=e.value,t),i={row:[e.rowIndex],toUpdate:a,data:this.model.get("tableData")[e.rowIndex]};c.call(this,"editName",i)},"keyword:enter":"submitSearch","searchBtn:click":"submitSearch","clearKeyword:click":function(e){this.get("keyword").setValue(""),this.submitSearch.call(this,e)},"refreshList:click":function(e){c.call(this,"refreshList")},"deleteImage:click":function(e){var t=this.get("table").getSelectedItems();c.call(this,"batchDeleteImage",t)}}};var l=t["default"](e),d=t["default"](a),u=t["default"](i),p=t["default"](n),f=t["default"](s),m=t["default"](o)}),define("dcc/image/list/ui/tableFields",["exports","underscore","babel-runtime/helpers/interop-require-default","inf-i18n","common/util/timeUtil","common/util/PermissionChecker","../../../config","../../../enums","../../rules"],function(exports,e,t,a,i,n,s,r,o){exports.__esModule=!0;var c=t["default"](e),l=t["default"](a),d=t["default"](i),u=t["default"](n),p=t["default"](o),f=[{field:"name",title:l["default"]("镜像名称/ID"),width:"20%",minWidth:150,sortable:!0,content:function(e,t,a){var i=c["default"].escape(e.name),n="";if(e.imageId=e.imageId||e.id,e.imageId){var r={commandArgs:{row:t,col:a,data:e}},o=c["default"].defaults({command:"editName",disabled:u["default"].check(p["default"],e,"editName").editName.disable},r);n='\n                    <span title="'+i+'" class="truncated">\n                        '+i+"\n                    </span>\n                    "+s.html.operation.tableEdit(o)+'\n                    <br />\n                    <span class="truncated" title="'+e.imageId+'">'+e.imageId+"</span>\n                "}else n='<span class="truncated">'+i+"</span>";return n},editContent:function(e){return c["default"].escape(e.name)},editNote:s.rule.IMAGE.NAME.placeholder,editRules:c["default"].omit(s.rule.IMAGE.NAME,"placeholder")},{field:"imageType",title:l["default"]("镜像类型"),width:"13%",minWidth:100,filter:{datasource:r.ImageType.getFilterType()},content:function(e){return"\n                <span>\n                    "+r.ImageType.getTextFromValue(e.imageType)+"\n                </span>\n            "}},{field:"createTime",title:l["default"]("创建时间"),sortable:!0,width:"17%",minWidth:110,content:function(e){return d["default"].toTime(e.createTime)||"-"}},{field:"status",title:l["default"]("状态"),width:"13%",minWidth:120,content:function(e){var t=r.ImageStatus.getTextFromValue(e.status);return'\n                <span class="status '+r.ImageStatus.fromValue(e.status).kclass+'">\n                    '+t+"\n                </span>\n            "}},{field:"os",title:l["default"]("操作系统/版本"),width:"10%",minWidth:120,content:function(e,t,a){return"\n                <span>\n                    "+c["default"].escape(e.osName||e.osType||"-")+"\n                </span>\n                /\n                <br />\n                "+c["default"].escape(e.osVersion||"-")+"\n            "}},{field:"minDiskGb",title:l["default"]("镜像大小"),width:"10%",minWidth:60,content:function(e,t,a){return"<span>"+c["default"].escape(e.minDiskGb?e.minDiskGb+"GB":"-")+"</span>"}}];exports.tableFields=f;var m={field:"operation",title:l["default"]("操作"),width:"17%",content:function(e,t,a){var i=l["default"]("本镜像的50个分享限额已用完，无法继续分享"),n={commandArgs:{row:t,col:a,data:e}},r=u["default"].check(p["default"],e),o=c["default"].defaults({command:"createInstance",label:l["default"]("创建实例"),title:l["default"]("创建实例"),permission:r.createInstance},n),d=c["default"].defaults({command:"shareImage",label:l["default"]("共享镜像"),title:l["default"]("共享镜像"),permission:r.shareImage},n),f=c["default"].defaults({command:"unshareImage",label:l["default"]("取消共享"),title:l["default"]("取消共享"),permission:r.unshareImage},n),m=e.sharedToUserNum>=50?' <span data-ui-type="Tip"\n                    data-ui-id="shareImageTip'+t+'"\n                    data-ui-skin="warning"\n                    data-ui-arrow="true"\n                    data-ui-content=\''+i+'\' class="share-image-tip"></span>':"";return"\n            "+s.html.operation.linkButtonEx(o)+"<br/>\n            "+s.html.operation.linkButtonEx(d)+"\n            "+m+"\n            "+s.html.operation.linkButtonEx(f)+"\n        "}};exports.operationBcc=m;var h={field:"operation",title:l["default"]("操作"),width:"17%",content:function(e,t,a){var i=l["default"]("本镜像的50个分享限额已用完，无法继续分享"),n={commandArgs:{row:t,col:a,data:e}},r=u["default"].check(p["default"],e),o=c["default"].defaults({command:"createHostInstance",label:l["default"]("创建专属实例"),title:l["default"]("创建专属实例"),permission:r.createHostInstance},n),d=c["default"].defaults({command:"createInstance",label:l["default"]("创建实例"),title:l["default"]("创建实例"),permission:r.createInstance},n),f=c["default"].defaults({command:"shareImage",label:l["default"]("共享镜像"),title:l["default"]("共享镜像"),permission:r.shareImage},n),m=c["default"].defaults({command:"unshareImage",label:l["default"]("取消共享"),title:l["default"]("取消共享"),permission:r.unshareImage},n),h=e.sharedToUserNum>=50?' <span data-ui-type="Tip"\n                    data-ui-id="shareImageTip'+t+'"\n                    data-ui-skin="warning"\n                    data-ui-arrow="true"\n                    data-ui-content=\''+i+'\' class="share-image-tip"></span>':"";return"\n            "+s.html.operation.linkButtonEx(o)+"\n            "+s.html.operation.linkButtonEx(d)+"\n            "+s.html.operation.linkButtonEx(f)+"\n            "+h+"\n            "+s.html.operation.linkButtonEx(m)+"\n        "}};exports.operationDcc=h}),define("dcc/image/list/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!../../common.tpl","bat-ria/tpl!../../../bcc/common.tpl","bat-ria/tpl!./tpl","../../../bcc/mvc/ListView","babel-runtime/helpers/interop-require-default","jquery","lodash","etpl","esui/lib","inf-i18n","common/util/tableUtil","./ui"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p,f,m){var h=o["default"](r),g=o["default"](c),v=o["default"](l),b=o["default"](d),y=o["default"](u),T=o["default"](p),x=o["default"](f),I=function(i){function n(){a["default"](this,n),i.call(this),this.template="TPL_dcc_image_list"}return e["default"](n,i),n.prototype.getUIEvents=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return m.getUIEvents.apply(this,t)},n.prototype.getSearchArgs=function(){var e=x["default"].getSearchArgs.call(this),t=this.model.get("filters");return t&&t.length>0&&(e.filters=JSON.stringify(t)),e},n.prototype.setTableHeadIntro=function(){var e=this.get("table").fields,t=this.get("table").get("headPanel").main.getElementsByClassName("ui-table-hcell-text");v["default"].each(e,function(e,a){"operation"===e.field&&(y["default"].setAttribute(t[a+1],"data-intro",T["default"]("自定义镜像可以共享给别人了")),y["default"].setAttribute(t[a+1],"data-position","bottom-middle-aligned"))})},n.prototype.renderQuotaTip=function(){var e="(自定义镜像${templateCreated}/${templateTotal}；"+T["default"]("共享镜像")+"${acceptedSharedImageNum}/${acceptSharedImageNumLimit})",t=b["default"].compile(e),a=this.model.get("quota");g["default"](".quota-tip").html(t(a))},n.prototype.updatePageData=function(e,t){this.get("table").setProperties({selectedIndex:[]}),i.prototype.updatePageData.call(this,e,t)},n.prototype.renderTableByRow=function(e){var t=this.model.get("tableData");this.get("table").updateRowAt(e,t[e])},t["default"](n,[{key:"uiProperties",get:function(){return m.getUIProperties.apply(this)}}]),n}(h["default"]);module.exports=I}),define("dcc/image/operation",["exports","module","underscore","babel-runtime/helpers/interop-require-default","promise","er/URL","common/util/dialog","../config","../enums"],function(exports,module,e,t,a,i,n,s,r){var o=t["default"](e),c=t["default"](a),l=t["default"](i),d=t["default"](n);module.exports={refreshList:function(){return this.refresh()},createHostInstance:function(e){var t=e.data,a={osType:t.osType,osName:t.osName,osVersion:t.osVersion,imageId:t.id,cpu:t.cpu,memory:t.memory,ephemeralSize:t.ephemeralSize,imageType:t.imageType};return this.redirect(l["default"].withQuery("/dcc/instance/create",a)),c["default"].resolve()},createInstance:function(e){var t=e.data,a={osType:t.osType,osName:t.osName,osVersion:t.osVersion,imageId:t.id,cpu:t.cpu,memory:t.memory,diskSize:t.diskSize,imageType:t.imageType};return this.redirect(l["default"].withQuery("/bcc/instance/create",a)),c["default"].resolve()},editName:function(e){var t=e.toUpdate,a=e.data,i=e.row;return this.model.editName(t.name,a.id,i)},batchDeleteImage:function(e){var t=[],a=[],i=[],n="";return o["default"].each(e,function(e){t.push(e.id),e.sharedToUserNum>0&&a.push(e.name),e.imageType===r.ImageType.SHARING&&i.push(e.name)}),n=a.length>0&&i.length>0?a.join(",")+"已经共享给了其它用户，请先取消所有共享，然后进行删除。</br>"+i.join(",")+"为共享镜像，不可以删除，您可以联系共享方取消共享。":a.length>0?a.join(",")+"已经共享给了其它用户，请先取消所有共享，然后进行删除，谢谢。":i.join(",")+"为共享镜像，不可以删除，您可以联系共享方取消共享，谢谢。",a.length>0||i.length>0?this.view.waitAlert({title:"温馨提示",content:n,encode:!1}):d["default"].waitActionDialog(this.view,{title:"删除前确认",width:600,needFoot:!0,url:"/dcc/operation/smsVerify",actionOptions:{extraData:{imageId:t.join(",")},requester:s.api.deleteImage,tip:s.tips.authCode.image,parentAction:this}}).then(function(e){var t=e.target;t.getFoot().getChild("btnOk").on("click",function(e){t.getAction().view.fire("submit"),t.hide()})})},shareImage:function(e){return d["default"].waitActionDialog(this.view,{title:"共享镜像",needFoot:!0,url:"/dcc/image/operation/shareImage",actionOptions:{image:e,parentAction:this}})},unshareImage:function(e){var t=this;return d["default"].waitActionDialog(this.view,{title:"共享镜像",width:570,needFoot:!1,url:"/dcc/image/operation/unshareImage",actionOptions:{image:e,parentAction:this}}).then(function(e){t.dialog=e.target})},inlineedit:function(e){return this.view.showInlineEdit(e),c["default"].resolve()}}}),define("dcc/image/operation/shareImage/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","inf-ria/mvc/FormAction","babel-runtime/helpers/interop-require-default","./Model","./View"],function(exports,module,e,t,a,i,n,s){var r=i["default"](a),o=i["default"](n),c=i["default"](s),l=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=o["default"],this.viewType=c["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this)},i.prototype.redirectAfterSubmit=function(){var e=this.model.get("parentAction");e&&(e.redirectAfterDialog&&e.redirectAfterDialog()||e.reload())},i.prototype.handleSubmitError=function(e){e&&e.field&&this.view.notifyErrors(e.field)},i}(r["default"]);module.exports=l}),define("dcc/image/operation/shareImage/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","inf-ria/mvc/FormModel","babel-runtime/helpers/interop-require-default","../../../config"],function(exports,module,e,t,a,i,n,s){var r={"x-silent":!0},o=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.submitRequester=function(e){return s.api.dccImageShare(e,r)},n.prototype.getExtraData=function(){return{imageId:this.get("image").id}},n.prototype.filterData=function(e){return e[e.accountType[0]+"List"]=[e.account],delete e.account,delete e.accountType,e},t["default"](n,[{key:"datasource",get:function(){return{}}}]),n}(n["default"](i)["default"]);module.exports=o}),define("dcc/image/operation/shareImage/tpl",[],function(){return'\x3c!-- target: TPL_dcc_image_share --\x3e\n<div class="dcc-wrapper dcc-dialog-form dcc-image-share-dialog">\n    <form data-ui="type:Form;id:form;autoValidate:true;">\n        <div>\n            <div class="form-row">\n                <div class="operation-tip dcc-color-lightgray">\n                    您可以将本镜像共享给${image.shareToUserNumLimit}位用户（已共享了<span class="dcc-color-red">${image.sharedToUserNum}</span>位用户），如需共享请输入目标用户的账号信息\n                </div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.帐号类型：}</label>\n                <div class="form-value">\n                    <div data-ui-type="BoxGroup"\n                        data-ui-id="accountType"\n                        data-ui-name="accountType"\n                        data-ui-box-type="radio"></div>\n                </div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.输入帐号：}</label>\n                <div class="form-value">\n                    <input\n                        data-ui-type="TextBox"\n                        data-ui-id="account"\n                        data-ui-name="account"\n                        data-ui-width="350" >\n                    <br/>\n                    <div data-ui="type:Label;id:baiduAccountLabel;" class="dcc-color-lightgray">${i18n.请填写百度账号用户名，暂不支持手机号/邮箱号}</div>\n                    <label data-ui-type="Validity"\n                        data-ui-id="accountValidity"></label>\n                </div>\n            </div>\n        </div>\n    </form>\n</div>\n\n\x3c!-- target: TPL_dcc_image_share_child --\x3e\n\x3c!-- import: TPL_dcc_image_share --\x3e\n'}),define("dcc/image/operation/shareImage/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","inf-ria/mvc/FormView","babel-runtime/helpers/interop-require-default","bat-ria/tpl!./tpl","inf-i18n"],function(exports,module,e,t,a,i,n,s){var r=i["default"](a),o=i["default"](s),c=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_image_share"}return e["default"](i,a),i.prototype.getUIProperties=function(){return{accountType:{datasource:[{name:o["default"]("百度帐号"),value:"baiduAccount"},{name:o["default"]("云账号（推广账号）"),value:"ucAccount"},{name:o["default"]("用户ID"),value:"iamAccountId"}]},account:{required:"required",requiredErrorMessage:o["default"]("账号为必填项，不能为空"),validityLabel:"accountValidity"}}},i.prototype.getUIEvents=function(){return{"accountType:change":function(e){"baiduAccount"===e.target.getValue()||"ucAccount"===e.target.getValue()?(this.get("baiduAccountLabel").setText("baiduAccount"===e.target.getValue()?o["default"]("请填写百度账号用户名，暂不支持手机号/邮箱号"):o["default"]("请填写云账号（推广账号）")),this.get("baiduAccountLabel").show()):this.get("baiduAccountLabel").hide()}}},i}(r["default"]);module.exports=c}),define("dcc/image/operation/unshareImage/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","inf-ria/mvc/ListAction","babel-runtime/helpers/interop-require-default","underscore","./Model","./View"],function(exports,module,e,t,a,i,n,s,r){var o=i["default"](a),c=i["default"](n),l=i["default"](s),d=i["default"](r),u=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=l["default"],this.viewType=d["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.on("listDataLoaded",this.updateSharedNum,this),this.view.on("submit",this.submit,this),this.view.on("cancel",this.cancel,this)},i.prototype.submit=function(){var e=this,t=this.view.getSubmitData();if(!(t.iamAccountIdList.length<1)){var a=c["default"].extend({},{imageId:this.model.get("image").id},t);this.model.unshareImage(a).then(function(){return e.redirectAfterSubmit()})}},i.prototype.cancel=function(){this.model.get("parentAction").dialog.dispose()},i.prototype.performSearch=function(e){this.retrieveListPage(e)},i.prototype.updateSharedNum=function(){this.view.updateSharedNum(this.model.get("tableData").length)},i.prototype.redirectAfterSubmit=function(){var e=this.model.get("parentAction");e&&e.reload()},i}(o["default"]);module.exports=u}),define("dcc/image/operation/unshareImage/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","inf-ria/mvc/ListModel","babel-runtime/helpers/interop-require-default","../../../config"],function(exports,module,e,t,a,i,n,s){var r={"x-silent":!0},o=function(i){function n(e){a["default"](this,n),i.call(this,e)}return e["default"](n,i),n.prototype.listRequester=function(e){return s.api.dccImageShareAccountList(e,r)},n.prototype.getExtraQuery=function(){return{imageId:this.get("image").id}},n.prototype.unshareImage=function(e){return s.api.dccImageUnshare(e,r)},t["default"](n,[{key:"datasource",get:function(){return{}}},{key:"defaultArgs",get:function(){return{pageSize:100}}}]),n}(n["default"](i)["default"]);module.exports=o}),define("dcc/image/operation/unshareImage/tpl",[],function(){return'\x3c!-- target: TPL_dcc_image_unshare --\x3e\n<div class="main-wrap-new dcc-wrapper dcc-image-unshare-dialog">\n    <div class="operation-tip dcc-color-lightgray">\n        ${i18n.本镜像已共享给了}<span data-ui-type="Label" data-ui-id="sharedNum">${image.sharedTemplateNum}</span>${i18n.位用户，您可以对选中的用户进行取消共享的操作}\n    </div>\n    <div class="list-content">\n        <div class="table-full-wrap">\n            <div class="search">\n                <span class="ui-group ui-search-group">\n                    <span data-ui-type="Select" data-ui-id="keywordType"\n                        data-ui-value="@keywordType"></span>\n                    <input class="search-box" data-ui-type="TextBox"\n                        data-ui-id="keyword" data-ui-value="@keyword" />\n                    <button type="button" data-ui-type="Button" data-ui-id="searchBtn"></button>\n                </span>\n            </div>\n            \x3c!-- import: listTable --\x3e\n            <div class="submit-container">\n                <button data-ui-id="submit" data-ui-type="Button" data-ui-skin="ok">${i18n.确定}</button>\n                <button data-ui-id="cancel" data-ui-type="Button" data-ui-skin="cancel">${i18n.取消}</button>\n            </div>\n        </div>\n    </div>\n</div>\n\n\x3c!-- target: TPL_dcc_image_unshare_child --\x3e\n\x3c!-- import: TPL_dcc_image_unshare --\x3e\n'}),define("dcc/image/operation/unshareImage/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/tpl!./tpl","inf-ria/mvc/ListView","babel-runtime/helpers/interop-require-default","underscore","inf-i18n","common/util/tableUtil"],function(exports,module,e,t,a,i,n,s,r,o){var c=n["default"](i),l=n["default"](s),d=n["default"](r),u=n["default"](o),p=[{field:"baiduAccount",title:d["default"]("百度帐号"),width:"30%",content:function(e,t,a){return'<span class="truncated" title="'+e.baiduAccount+'">'+(e.baiduAccount||"-")+"</span>"}},{field:"ucAccount",title:d["default"]("云账号（推广账号）"),width:"30%",content:function(e,t,a){return'<span class="truncated" title="'+e.ucAccount+'">'+(e.ucAccount||"-")+"</span>"}},{field:"userId",title:d["default"]("用户ID"),width:"40%",content:function(e,t,a){return'<span class="truncated" title="'+e.iamAccountId+'">'+e.iamAccountId+"</span>"}}],f=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_image_unshare"}return e["default"](i,a),i.prototype.getUIProperties=function(){return{table:{fields:p,select:"multi",selectedIndex:[],noDataHtml:"<div><p>没有可选择的用户！</p></div>"},keywordType:{datasource:[{name:d["default"]("百度帐号"),value:"baiduAccount"},{name:d["default"]("云账号（推广账号）"),value:"ucAccount"},{name:d["default"]("用户ID"),value:"iamAccountId"}]},keyword:{placeholder:d["default"]("请输入百度帐号进行搜索")}}},i.prototype.getUIEvents=function(){return u["default"].getListEvents({"keyword:enter":"submitSearch","submit:click":function(e){this.fire("submit")},"cancel:click":function(e){this.fire("cancel")}})},i.prototype.getSearchArgs=function(){return u["default"].getSearchArgs.call(this)},i.prototype.updateSharedNum=function(e){this.get("sharedNum").setText(e)},i.prototype.getSubmitData=function(){var e=this.get("table").getSelectedItems();return{iamAccountIdList:l["default"].pluck(e,"iamAccountId")}},i}(c["default"]);module.exports=f}),define("dcc/image/permission",["exports","module","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","common/util","../enums"],function(exports,module,e,t,a,i,n){var s,r=a["default"](t),o=a["default"](i)["default"].isSubUser(),c=(s={},s[n.ImageStatus.ACTIVE]=["editName","deleteImage","createInstance","createHostInstance","shareImage","unshareImage"],s[n.ImageStatus.ERROR]=["deleteImage"],s),l={editName:!0,deleteImage:!0,createInstance:!0,createHostInstance:!0},d=function(){function t(){e["default"](this,t)}return t.prototype.getOperationsByStatus=function(e){return c[e]||[]},t.prototype.isGranted=function(e,t){return r["default"].contains(this.getOperationsByStatus(e),t)},t.prototype.checkIfShouldDisabled=function(e,t){if(o&&l[e])return!0;var a=t.status||"";if(this.isGranted(a,e))switch(e){case"createInstance":return!1;case"createHostInstance":return r["default"].contains([n.ImageType.FPGAIMAGE,n.ImageType.FPGACUSTOM,n.ImageType.GPUBCCIMAGE,n.ImageType.GPUBCCCUSTOM],t.imageType);case"editName":return t.imageType===n.ImageType.SHARING;case"shareImage":return!r["default"].contains([n.ImageType.CUSTOM,n.ImageType.GPUBCCCUSTOM],t.imageType)||t.sharedToUserNum>=50;case"unshareImage":return!(r["default"].contains([n.ImageType.CUSTOM,n.ImageType.GPUBCCCUSTOM],t.imageType)&&t.sharedToUserNum>0);default:return!1}return!0},t}();module.exports=new d}),define("dcc/image/rules",["exports","module","lodash","babel-runtime/helpers/interop-require-default","../enums"],function(exports,module,e,t,a){var i=t["default"](e);module.exports={deleteImage:[{status:[a.ImageStatus.ACTIVE,a.ImageStatus.ERROR],message:function(e){return e.length>1?"部分镜像当前状态无法释放":"该镜像当前状态无法释放"}},{subUserAble:!1,message:"子账户没有权限释放镜像"}],createInstance:[{isSingle:!0,message:"无法批量操作"},{status:[a.ImageStatus.ACTIVE],message:"该镜像当前状态无法创建实例"},{subUserAble:!1,message:"子帐号没有权限创建实例"},{custom:function(e){if(e[0].imageType===a.ImageType.MKT)return{disable:!0,message:"云市场镜像无法创建实例"}}}],createHostInstance:[{isSingle:!0,message:"无法批量操作"},{status:[a.ImageStatus.ACTIVE],message:"该镜像当前状态无法创建专属实例"},{subUserAble:!1,message:"子帐号没有权限创建专属实例"},{custom:function(e){var t=[a.ImageType.FPGAIMAGE,a.ImageType.FPGACUSTOM,a.ImageType.GPUBCCIMAGE,a.ImageType.GPUBCCCUSTOM];if(i["default"].contains(t,e[0].imageType))return{disable:!0,message:"该镜像类型无法创建专属实例"}}}],shareImage:[{isSingle:!0,message:"无法批量共享镜像"},{status:[a.ImageStatus.ACTIVE],message:"该镜像当前状态无法共享"},{custom:function(e){return i["default"].contains([a.ImageType.CUSTOM,a.ImageType.GPUBCCCUSTOM],e[0].imageType)?e[0].sharedToUserNum>=50?{disable:!0,message:"最多共享50个用户，您已超出配额"}:void 0:{disable:!0,message:"只有自定义镜像、GPU自定义镜像可以共享"}}}],unshareImage:[{isSingle:!0,message:"无法批量取消共享镜像"},{status:[a.ImageStatus.ACTIVE],message:"该镜像当前状态无法取消共享"},{custom:function(e){return i["default"].contains([a.ImageType.CUSTOM,a.ImageType.GPUBCCCUSTOM],e[0].imageType)?e[0].sharedToUserNum<1?{disable:!0,message:"该镜像没有被共享出去"}:void 0:{disable:!0,message:"只有自定义镜像、GPU自定义镜像可以取消共享"}}}],editName:[{isSingle:!0,message:"无法批量修改名称"},{status:[a.ImageStatus.ACTIVE,a.ImageStatus.ERROR],message:"该镜像当前状态无法修改名称"},{subUserAble:!1,message:"子账户没有权限修改名称"},{custom:function(e){if(e[0].imageType===a.ImageType.SHARING)return{disable:!0,message:"该镜像正在共享中，请稍后重试"}}}]}}),define("dcc/instance/action.conf",["exports","module"],function(exports,module){module.exports=[{path:"/dcc/instance/create",type:"dcc/instance/create/Action"},{path:"/dcc/instance/list",type:"dcc/instance/list/Action"},{path:"/dcc/instance/detail",type:"dcc/instance/detail/Action"},{path:"/dcc/instance/monitor",type:"dcc/instance/monitor/Action"},{path:"/dcc/instance/operation/changeName",type:"dcc/instance/operation/changeName/Action"},{path:"/dcc/instance/operation/changePwd",type:"dcc/instance/operation/changePwd/Action"},{path:"/dcc/instance/operation/joinSecurityGroups",type:"dcc/instance/operation/joinSecurityGroups/Action"},{path:"/dcc/instance/operation/rebuildOs",type:"dcc/instance/operation/rebuildOs/Action"},{path:"/dcc/instance/configChange",type:"dcc/instance/operation/configChange/Action"},{path:"/dcc/instance/operation/createSnapshot",type:"dcc/instance/operation/createSnapshot/Action"},{path:"/dcc/instance/operation/createImage",type:"dcc/instance/operation/createImage/Action"},{path:"/dcc/instance/securityGroups",type:"dcc/instance/securityGroups/Action"}]}),define("dcc/instance/create/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormAction","babel-runtime/helpers/interop-require-default","./Model","./View","lodash","../../config"],function(exports,module,e,t,a,i,n,s,r,o){var c=i["default"](a),l=i["default"](n),d=i["default"](s),u=i["default"](r),p=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=l["default"],this.viewType=d["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.syncModelWithView(),this.view.on(o.events.OS_TYPE_CHANGE,this.osTypeChange,this),this.view.on(o.events.FORM_CHANGED,this.updateFormDataToModel,this)},i.prototype.syncModelWithView=function(){var e=this;this.model.on("vdatachanged",function(t){e.view.repaint(),e.validate()}),this.model.on("vdatachanged:osVersion",function(){return e.osTypeChange()})},i.prototype.updateFormDataToModel=function(e){var t=e.toUpdate;this.model.updateFormData(t),(e.toUpdate.osType||e.toUpdate.cpu||e.toUpdate.memory)&&this.osTypeChange()},i.prototype.osTypeChange=function(e){var t=this.model.get("formData"),a=this.model.get("osVersionDatasource")[t.osType],i=0,n=!0;a=u["default"].each(a,function(e){return e.memInvalid=!!e.minMem&&e.minMem>t.memory,e.cpuInvalid=!!e.minCpu&&e.minCpu>t.cpu,e.maxRamGbInvalid=!!e.maxRamGb&&t.memory>e.maxRamGb,e.disabled=e.memInvalid||e.cpuInvalid||e.maxRamGbInvalid,e.popover=e.maxRamGbInvalid?"您选择的内存已大于当前镜像支持的最大内存":"",e}),u["default"].every(a,function(e){return!0===e.disabled})?i=-1:a[i]&&a[i].disabled&&(i=u["default"].findIndex(a,function(e){return!e.disabled})),n=!u["default"].some(a,function(e){return e.memInvalid||e.cpuInvalid}),this.model.updateFormData({osVersion:{datasource:a,selectedIndex:i},osVersionTipHide:n})},i.prototype.validate=function(){var e=this.model.validateSubmitData(this.view.getFormData());!0!==e?(this.view.notifyErrors(e),this.view.disableSubmit()):this.view.enableSubmit()},i.prototype.submitEdit=function(){if(this.view.get("form").validate())return a.prototype.submitEdit.call(this)},i}(c["default"]);module.exports=p}),define("dcc/instance/create/config",["exports","module"],function(exports,module){module.exports={api2UiKeyMapper:{instanceCount:"purchaseNum",imageId:"osVersion",name:"instanceName",adminPass:"adminPassword",securityGroupIds:"securityGroupList",diskSize:"diskSize",osName:"osType"},uiKey2ApiMapper:{purchaseNum:"instanceCount",osVersion:"imageId",instanceName:"name",adminPassword:"adminPass",securityGroupList:"securityGroupIds",diskSize:"diskSize",osType:"osName"}}}),define("dcc/instance/create/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","promise","bat-ria/mvc/FormModel","inf-i18n","common/util","../../util","../../enums","../../config","../../host/permission","./config"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p,f){var m=n["default"](i),h=n["default"](s),g=n["default"](r),v=n["default"](o),b=n["default"](c),y=n["default"](l),T=n["default"](p),x=n["default"](f),I={silent:!0},S={showLoading:!1,"X-silence":!0},E=[{name:"加载中，请稍候……",value:"disabled"}],w=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.prepare=function(){var e=this;this.updateViewData({loading:!0}),this.get("imageId")&&this.loadImageData();var t=[this.loadHostList(I),this.loadImageAndOs(I)];this.get("instanceId")&&t.push(this.loadVpcAndSubnetOfInstance(this.get("instanceId"),I)),h["default"].all(t).then(function(){!e.get("instanceId")&&e.get("hostList").length>0&&e.loadVpc()}).then(function(){e.resetOriginFormData(I)}).then(function(){e.updateViewData({loading:!1})})["catch"](function(t){e.updateViewData({error:"数据加载异常"})})},n.prototype.loadImageData=function(){if(this.get("imageId")){var e={imageType:this.get("imageType")||"custom",imageId:this.get("imageId"),osType:this.get("osType")||"",osName:this.get("osName")||"",osVersion:this.get("osVersion")||"",cpu:parseFloat(this.get("cpu")),memory:parseFloat(this.get("memory")),ephemeralSize:parseFloat(this.get("ephemeralSize"))};this.set("imageData",e)}return h["default"].resolve()},n.prototype.loadHostList=function(e){var t=this,a=this.get("hostId"),i=this.get("hostIds");return new h["default"](function(n,s){(a?u.api.getDccHostDetail({id:a},S).then(function(e){return[e]}):i?u.api.getDccHostDetails({ids:i.split(",")},S):u.api.getDccHostList({},S).then(function(e){return e.result})).then(function(e){return t.filterHostList(e)}).then(function(a){return t.updateHostList(a,e)}).then(n,s)})},n.prototype.updateHostList=function(e,t){this.set("hostList",e,t);var a=e[0],i={host:{datasource:m["default"].map(e,function(e){return{name:e.name,value:e.id}})}};this.get("hostIds")&&(a=this.getVirtualMinHost(e),i={hostTable:{datasource:e,selectedIndex:m["default"].map(e,function(e,t){return t})}}),this.set("host",a,t),this.resetOriginFormData(t),m["default"].extend(i,{purchaseNum:{max:1,cpuLeft:0,memoryLeft:0,diskSizeLeft:0,ssdDiskSizeLeft:0,sataDiskSizeLeft:0}}),this.updateViewData(i,t)},n.prototype.getVirtualMinHost=function(){var e=arguments.length<=0||arguments[0]===undefined?[]:arguments[0];e.length<1&&(e=this.get("hostList"));var t=m["default"].clone(e[0]),a=t.memoryLeft,i=t.diskSizeLeft;return m["default"].each(e,function(e){e.cpuLeft<t.cpuLeft&&(t=e),e.memoryLeft<a&&(a=e.memoryLeft),e.diskSizeLeft<i&&(i=e.diskSizeLeft)}),t.memoryLeft=a,t.diskSizeLeft=i,t},n.prototype.filterHostList=function(e){var t=this;return m["default"].filter(e,function(e){var a=t.get("instance"),i=!T["default"].checkIfShouldDisabled("createInstance",e);return a&&a.flavorType===d.FlavorType.STORAGE?i&&e.flavorType===d.FlavorType.STORAGE:a&&a.flavorType!==d.FlavorType.STORAGE?i&&e.flavorType!==d.FlavorType.STORAGE:i})},n.prototype.loadImageAndOs=function(e){var t=this,a=this.get("formData"),i=a.imageType;return this.updateViewData({osloading:!0}),u.api.getImageListGroup({imageTypes:[i],keyword:"active",keywordType:"status"},S).then(function(e){return m["default"].isEmpty(e)?h["default"].reject(e):t.transforImageAndOs(e)}).then(function(i){t.set("imageList",i.imageList,e),t.set("osVersionDatasource",i.osVersionDatasource),t.updateFormData({osType:a.osType||m["default"].chain(i.osVersionDatasource).keys().sort().value()[0],osVersion:a.osVersion||""}),t.updateViewData({osType:{datasource:i.osTypeDatasource},osloading:!1,osNotAvailable:!1},e)}).fail(function(e){if(m["default"].isEmpty(e))return t.updateViewData({osloading:!1,osNotAvailable:!0}),h["default"].resolve(e)})},n.prototype.transforImageAndOs=function(e){var t=this.get("formData").imageType,a=m["default"].clone(this.get("imageList"));a[t]=e;var i=m["default"].chain(e).keys().sort().value(),n=m["default"].mapObject(e,function(e){return m["default"].chain(e).map(function(e,t){return{name:e.name,value:e.id,osType:e.osType,maxRamGb:e.maxRamGb,minDiskGb:e.minDiskGb,minCpu:e.minCpu,minMem:e.minMem}}).value()});return{imageList:a,osTypeDatasource:m["default"].map(i,function(e,t){return{name:e,value:e}}),osVersionDatasource:n}},n.prototype.loadSecurityGroupList=function(e,t){var a=this;return this.updateViewData({securityloading:!0},t),u.api.getDccSecurityGroupList({vpcId:e},S).then(function(e){a.set("securityGroupList",e.result,t),a.updateFormData({securityGroupList:""});var i=m["default"].map(e.result,function(e){return e.value=e.value||e.id,e});a.updateViewData({securityGroupList:{datasource:i},securityloading:!1,securityNotAvailable:!(i.length>0)})},function(e){a.updateViewData({securityloading:!1,securityNotAvailable:!0})})},n.prototype.transforVpcAndSubnet=function(e){var t=[];return m["default"].each(e,function(e){var a=!m["default"].isUndefined(e.subnetNum),i=(a?b["default"].getVpcName(e.name):b["default"].getSubnetName(e.name))+(e.cidr?"（"+e.cidr+"）":"");t.push({value:a?e.vpcId:e.subnetId,text:i,title:i})}),t},n.prototype.loadVpc=function(e){var t=this,a=this.get("formData");return this.updateViewData({vpcloading:!0}),u.api.vpcList({},m["default"].extend(S,{"x-silent":!0})).then(function(e){var i=e||[];return t.set("vpcList",i),t.updateFormData({vpc:a.vpc||(i.length>0?i[0].vpcId:"")}),t.transforVpcAndSubnet(i)}).then(function(e){return t.updateViewData({vpc:{disabled:0===e.length,datasource:e.length>0?e:[{name:"暂无数据",value:""}]},vpcloading:!1,vpcNotAvailable:!1}),e}).fail(function(e){t.updateFormData({vpc:""}),t.updateViewData({vpcloading:!1,vpcNotAvailable:!0,subnetloading:!1,subnetNotAvailable:!0,securityloading:!1,securityNotAvailable:!0})})},n.prototype.loadSubnet=function(e){var t=this,a=this.get("formData");this.updateViewData({subnetloading:!0});var i=this.get("host")?this.get("host").logicalZone:"";return u.api.subnetList({vpcId:e,zone:i,subnetTypes:[1,3]},m["default"].extend(S,{"x-silent":!0})).then(function(e){e=t.transforVpcAndSubnet(e);return m["default"].some(e,function(e){return e.value===a.subnetUuid})?t.updateFormData({subnetUuid:a.subnetUuid}):t.updateFormData({subnetUuid:e.length>0?e[0].value:""}),t.updateViewData({subnetUuid:{disabled:0===e.length,datasource:e.length>0?e:[{name:"暂无数据",value:""}]},subnetloading:!1,subnetNotAvailable:!1}),e}).fail(function(e){t.updateFormData({subnetUuid:""}),t.updateViewData({subnetloading:!1,subnetNotAvailable:!0})})},n.prototype.loadVpcAndSubnetOfInstance=function(e,t){var a=this,i=this.get("formData");return this.updateViewData({vpcloading:!0,subnetloading:!0}),u.api.getVpcDetail({bccIds:[e]},S).then(function(t){return m["default"].isEmpty(t)?h["default"].reject(t):t[e]||{vpc:{},subnet:{}}}).then(function(e){return a.updateFormData({vpc:i.vpc||e.vpc.vpcId,subnetUuid:i.subnetUuid||e.subnet.subnetId}),a.updateViewData({vpc:{datasource:a.transforVpcAndSubnet([e.vpc])},subnetUuid:{datasource:a.transforVpcAndSubnet([e.subnet])},vpcloading:!1,vpcNotAvailable:!1,subnetloading:!1,subnetNotAvailable:!1},t),a.set("vpcInfo",e),e}).fail(function(e){a.updateViewData({vpcloading:!1,vpcNotAvailable:!0,subnetloading:!1,subnetNotAvailable:!0},t)})},n.prototype.updateViewData=function(e){var t=this,a=arguments.length<=1||arguments[1]===undefined?{}:arguments[1],i=this.get("viewData"),n=[];m["default"].each(e,function(e,t){var a=m["default"].clone(i[t]),s=e;m["default"].isEqual(a,s)||n.push({name:t,oldValue:a,newValue:s}),i[t]=s}),this.set("viewData",i,I),a.silent||(this.fire("vdatachanged"),m["default"].each(n,function(e){t.fire("vdatachanged:"+e.name,e)}))},n.prototype.resetOriginFormData=function(e){var t=this.get("host")||{},a=this.get("formData"),i={host:"",cpu:t.cpuLeft,memory:t.memoryLeft,diskSize:t.diskSizeLeft,purchaseNum:1,imageType:a.imageType||"common",osType:a.osType||"",osVersion:a.osVersion||"",instanceNameType:"random",adminPasswordType:"custom",securityGroupList:"",vpc:"",subnetUuid:""};t.flavorType===d.FlavorType.STORAGE&&t.diskDetail&&m["default"].extend(i,{ssdDiskSize:t.diskDetail.ssd?t.diskDetail.ssd.diskLeft:0,sataDiskSize:t.diskDetail.sata?t.diskDetail.sata.diskLeft:0});var n=this.get("instance");n&&(y["default"].deepExtend(i,{host:n.hostId,cpu:n.cpu,memory:n.memory,diskSize:n.diskSize,imageType:n.imageType,osType:n[x["default"].uiKey2ApiMapper.osType],osVersion:n[x["default"].uiKey2ApiMapper.osVersion]}),n.flavorType===d.FlavorType.STORAGE&&m["default"].extend(i,{ssdDiskSize:n.diskDetail.ssd?n.diskDetail.ssd.diskTotal:0,sataDiskSize:n.diskDetail.sata?n.diskDetail.sata.diskTotal:0}));var s=this.get("vpcInfo");s&&y["default"].deepExtend(i,{vpc:s.vpc.vpcId,subnetUuid:s.subnet.subnetId});var r=this.get("imageData");if(r){var o=r.osType&&"windows"===r.osType.toLowerCase()?40:20;y["default"].deepExtend(i,r,{diskSize:r.ephemeralSize+o,osType:r[x["default"].uiKey2ApiMapper.osType],osVersion:r[x["default"].uiKey2ApiMapper.osVersion]})}this.set("origFormData",i,e);var c=m["default"].clone(i);this.set("formData",c,e),n&&this.updateFormData({imageType:n.imageType,host:n.hostUuid}),r&&this.updateFormData({imageType:i.imageType,diskSize:i.diskSize})},n.prototype.resetFormData=function(e){var t=m["default"].clone(this.get("origFormData"));this.set("formData",t,e)},n.prototype.getMaxNum=function(e,t){var a=1;return e.flavorType===d.FlavorType.STORAGE?(a=Math.min(Math.floor(e.cpuLeft/t.cpu),Math.floor(e.memoryLeft/t.memory)),e.diskDetail&&e.diskDetail.ssd&&e.diskDetail.ssd.diskLeft>0&&(a=Math.min(a,Math.floor(e.diskDetail.ssd.diskLeft/t.ssdDiskSize))),e.diskDetail&&e.diskDetail.sata&&e.diskDetail.sata.diskLeft>0&&(a=Math.min(a,Math.floor(e.diskDetail.sata.diskLeft/t.sataDiskSize)))):a=Math.min(Math.floor(e.cpuLeft/t.cpu),Math.floor(e.memoryLeft/t.memory),Math.floor(e.diskSizeLeft/t.diskSize)),a},n.prototype.updateFormData=function(e){var t=m["default"].clone(this.get("formData"));if(m["default"].extend(t,e),null!=e.host||e.hostTable){var a=this.get("hostList"),i={};if(null!=e.host){var n=m["default"].indexOf(m["default"].pluck(a,"id"),e.host);i=a[n=-1===n?0:n]}else i=this.getVirtualMinHost(e.hostTable);this.set("host",i,I),this.get("instance")||(t.cpu=i.cpuLeft,t.memory=i.memoryLeft,t.diskSize=i.diskSizeLeft,i.diskDetail&&i.diskDetail.ssd&&(t.ssdDiskSize=i.diskDetail.ssd.diskLeft),i.diskDetail&&i.diskDetail.sata&&(t.sataDiskSize=i.diskDetail.sata.diskLeft))}this.set("formData",t,I),null!=e.imageType&&this.loadImageAndOs();var s=m["default"].find(this.get("vpcList"),function(t){return t.vpcId===e.vpc});s&&(!s.defaultVpc&&e.vpc||s.defaultVpc||e.host)&&!this.get("instanceId")&&this.get("hostList").length>0&&(this.loadSubnet(e.vpc),this.loadSecurityGroupList(e.vpc)),this.transferViewData(e)},n.prototype.transferViewData=function(e){var t={},a=this.get("formData");if(null!=e.osType&&m["default"].extend(t,{osVersion:{datasource:this.get("osVersionDatasource")[e.osType]}}),null!=e.osVersionTipHide&&m["default"].extend(t,{osVersionTipHide:e.osVersionTipHide}),null!=e.adminPasswordType&&m["default"].extend(t,{adminPasswordType:{value:e.adminPasswordType}}),null!=e.instanceNameType&&m["default"].extend(t,{instanceNameType:{value:e.instanceNameType}}),e.host||e.hostTable||e.cpu||e.memory||e.diskSize||e.purchaseNum||m["default"].has(e,"ssdDiskSize")||m["default"].has(e,"sataDiskSize")){var i=this.get("host")||{},n=this.getMaxNum(i,a);(a.cpu>i.cpuLeft||a.memory>i.memoryLeft||a.diskSize>i.diskSizeLeft)&&(n=1),a.purchaseNum>n&&(a.purchaseNum=n),m["default"].extend(t,{purchaseNum:{max:n,value:a.purchaseNum,cpuLeft:Math.max(i.cpuLeft-a.cpu*a.purchaseNum,0),memoryLeft:Math.max(i.memoryLeft-a.memory*a.purchaseNum,0),diskSizeLeft:Math.max(i.diskSizeLeft-a.diskSize*a.purchaseNum,0)}}),i.flavorType===d.FlavorType.STORAGE&&i.diskDetail.ssd&&m["default"].extend(t.purchaseNum,{ssdDiskSizeLeft:Math.max(i.diskDetail.ssd.diskLeft-a.ssdDiskSize*a.purchaseNum,0)}),i.flavorType===d.FlavorType.STORAGE&&i.diskDetail.sata&&m["default"].extend(t.purchaseNum,{sataDiskSizeLeft:Math.max(i.diskDetail.sata.diskLeft-a.sataDiskSize*a.purchaseNum,0)})}e.instanceName||e.adminPassword||e.adminPasswordRepeat||e.subnetUuid?this.updateViewData(t,{silent:!0}):this.updateViewData(t)},n.prototype.validateSubmitData=function(e){if(!this.get("viewData").error){var t=!1,a={},i=function(e,i){t=!0,a[e]=i};e.osType&&"windows server"===e.osType.toLowerCase()&&e.diskSize<40?i("diskSize",v["default"]("windows系统至少占用40G，请调整磁盘容量。")):e.diskSize<20&&i("diskSize",v["default"]("linux系统至少占用20G，请调整磁盘容量。")),!e.imageType||this.get("viewData").osloading||e.osVersion||i("imageType",v["default"]("当前没有可用镜像，请选择其他镜像。"));var n=this.get("formData").vpc,s=m["default"].find(this.get("vpcList"),function(e){return e.vpcId===n});return!s||s.defaultVpc||n?!e.securityGroupIds&&!e.securityGroupList||e.securityGroupIds&&(0===e.securityGroupIds.length||!e.securityGroupIds[0])?i("securityGroupList",v["default"]("当前安全组不可用")):!s||s.defaultVpc||e.subnetUuid||i("subnetUuid",v["default"]("该自定义私有网络中没有子网，请先创建子网或者选择其他私有网络")):i("vpc",v["default"]("当前VPC不可用")),e.hostIds&&e.hostIds<1&&i("hostTable",v["default"]("请选择专属服务器")),e.osVersionCheck&&(/linux/.test(e.osVersionCheck.osType)&&e.osVersionCheck.minDiskGb>20&&i("osVersion",v["default"]("您当前系统盘容量小于重装该镜像所需系统盘容量，无法创建专属实例")),/windows/.test(e.osVersionCheck.osType)&&e.osVersionCheck.minDiskGb>40&&i("osVersion",v["default"]("您当前系统盘容量小于重装该镜像所需系统盘容量，无法创建专属实例"))),!t||a}},n.prototype.getExtraData=function(){return{hostId:this.get("host").id}},n.prototype.filterData=function(e){var t=m["default"].pick(e,["cpu","memory","diskSize","imageType","osType","subnetUuid","osVersion","ssdDiskSize","sataDiskSize"]);return m["default"].extend(t,{hostId:e.hostIds?"":e.hostId,hostIds:e.hostIds,instanceCount:e[x["default"].api2UiKeyMapper.instanceCount],imageId:e[x["default"].api2UiKeyMapper.imageId],name:e[x["default"].api2UiKeyMapper.name]||"",adminPass:e[x["default"].api2UiKeyMapper.adminPass]||"",securityGroupIds:[e[x["default"].api2UiKeyMapper.securityGroupIds]]}),t},n.prototype.submitRequester=function(e){return u.api.createDccInstance(e)},t["default"](n,[{key:"datasource",get:function(){return{host:function(){return null},hostList:function(){return[]},imageList:function(){return{common:null,custom:null,integration:null}},securityGroupList:function(){return[]},viewData:function(){return{hostList:{datasource:E},osType:{datasource:E},osVersion:{common:{datasource:E}},securityGroupList:{datasource:E},instanceNameType:{},adminPasswordType:{value:"custom"},loading:!0,osVersionTipHide:!0}},formData:function(){return{imageType:"common"}},instance:function(e){var t=e.get("instanceId");if(t)return u.api.getDccInstanceDetail({instanceId:t},S)}}}}]),n}(g["default"]);module.exports=w}),define("dcc/instance/create/tpl",[],function(){return'\x3c!-- target: TPL_dcc_instance_create --\x3e\n<div class="dcc-instance-create main-wrap-new">\n    <div class="content-wrap">\n        <p class="breadcrumb">\n            <span>${i18n.产品服务}</span>\n            <span class="divider">/</span>\n            <a href="#/dcc/instance/list">${i18n.专属服务器}-${i18n.实例列表}</a>\n            <span class="divider">/</span>\n            <span class="active">${i18n.创建专属实例}</span>\n        </p>\n        <div class="create-content">\n            <p data-ui-type="ToastLabel"\n                data-ui-id="warnToastLabel"\n                data-ui-message-type="alert"\n                data-ui-hidden="true"\n                data-auth="verifiedUser,forbidden"\n                data-auth-whenfailnotbreak="true"\n                data-authtype="SHOW"\n                class="cash-warning-panel"></p>\n            <div class="ui-tab-navigator">\n                <h1>${i18n.创建专属实例}</h1>\n            </div>\n            <div class="create-main">\n                <form class="setting-form"\n                    data-ui-type="Form"\n                    data-ui-id="form"\n                    data-ui-autoValidate="1">\n                    <div class="detail-parts-table">\n                        \x3c!-- if: ${viewData.error} --\x3e\n                        <div class="main-error">\n                            ${viewData.error}\n                            ${i18n.请}<a href="javascript:location.reload();">${i18n.刷新}</a>${i18n.后重试}\n                        </div>\n                        \x3c!-- elif: ${viewData.loading} --\x3e\n                        <div id="dcc-instance-create-loading">\n                            <span class="loading">${i18n.数据加载中，请稍候……}</span>\n                        </div>\n                        \x3c!-- elif: ${viewData.host.datasource.length} == 0 --\x3e\n                        <div class="main-error">\n                            ${i18n.您的专属服务器利用率很高，当前没有可用空闲资源用来创建新的专属实例，点击}<a href="#/dcc/host/list">>>${i18n.管理专属服务器}</a>\n                        </div>\n                        \x3c!-- else: --\x3e\n                        <dl class="detail-create-settings detail-create detail-part-1-col">\n                            <dt>\n                                <h4>${i18n.选取专属服务器}</h4>\n                                \x3c!-- if: ${hostIds} --\x3e\n                                <span class="selected-tip">${i18n.（已选择}<label data-ui-type="Label" data-ui-id="hostTableSelected"></label>${i18n.台）}</span>\n                                \x3c!-- /if --\x3e\n                            </dt>\n                            \x3c!-- if: ${hostIds} --\x3e\n                            <dd>\n                                <div data-ui-type="Table" data-ui-id="hostTable" data-ui-select="multi" class="host-table">\n                                </div>\n\n                            </dd>\n                            \x3c!-- else: --\x3e\n                            <dd >\n                                <label><i class="form-icon-required">*</i>${i18n.选取专属服务器：}</label>\n                                <div class="relative-field">\n                                    <div data-ui="id:host;name:host;type:Select;"></div>\n                                    \x3c!-- if: !${hostId} --\x3e\n                                    <div class="description">${i18n.列表中仅显示具备可用资源的专属服务器}</div>\n                                    \x3c!-- /if --\x3e\n                                </div>\n                            </dd>\n                            \x3c!-- /if --\x3e\n                        </dl>\n                        <div id="dcc-instance-create-settings">\n                            <dl class="detail-create-settings detail-create detail-part-1-col">\n                                <dt>\n                                    <h4>${i18n.配置信息}</h4>\n                                </dt>\n                                <dd>\n                                    <label><i class="form-icon-required">*</i>CPU：</label>\n                                    <div class="relative-field">\n                                        <div data-ui-id="cpu"\n                                            data-ui-name="cpu"\n                                            data-ui-type="Dragger"></div>\n                                    </div>\n                                </dd>\n                                <dd>\n                                    <label><i class="form-icon-required">*</i>${i18n.内存：}</label>\n                                    <div class="relative-field">\n                                        <div data-ui-id="memory"\n                                            data-ui-name="memory"\n                                            data-ui-type="Dragger"></div>\n                                        </div>\n                                </dd>\n                                <dd>\n                                    <label><i class="form-icon-required">*</i>${i18n.磁盘：}</label>\n                                    \x3c!-- if: ${host.flavorType} === \'calculation\' --\x3e\n                                    <div class="relative-field">\n                                        <div data-ui-id="diskSize"\n                                            data-ui-name="diskSize"\n                                            data-ui-type="Dragger"></div>\n                                        <div class="description">\n                                            ${i18n.系统盘占用容量会从您所选容量中默认扣除。Linux系统占用20GB，Windows系统占用40GB}\n                                        </div>\n                                    </div>\n                                    \x3c!-- else: --\x3e\n                                    <div class="relative-field">\n                                        \x3c!-- if: ${host.diskDetail.ssd}--\x3e\n                                        <div data-ui-id="ssdDiskSize"\n                                            data-ui-name="ssdDiskSize"\n                                            data-ui-type="Dragger"></div>\n                                        <span class="disk-detail">${i18n.SSD盘（6TB/块）}</span>\n                                        \x3c!-- /if --\x3e\n                                        \x3c!-- if: ${host.diskDetail.sata} --\x3e\n                                        <div data-ui-id="sataDiskSize"\n                                            data-ui-name="sataDiskSize"\n                                            data-ui-type="Dragger"></div>\n                                        <span class="disk-detail">${i18n.SATA盘（6TB/块）}</span>\n                                        \x3c!-- /if --\x3e\n                                        <div class="description">\n                                            ${i18n.Linux系统盘20GB，Windows系统盘40GB}\n                                        </div>\n                                    </div>\n                                    \x3c!-- /if --\x3e\n                                </dd>\n                                <dd class="purchase-number-field">\n                                    <label>${i18n.创建专属实例：}</label>\n                                    <div class="relative-field">\n                                        <div data-ui-type="NumberTextline" data-ui-id="purchaseNum"\n                                             data-ui-width="100" data-ui-name="purchaseNum" class="ui-radioselect-pn"></div>\n                                        <span>${i18n.（至多创建所选配置专属实例}<em>${viewData.purchaseNum.max}</em>${i18n.台）}</span>\n                                        \x3c!-- if: ${host.flavorType} === \'calculation\' --\x3e\n                                        <div class="description">${i18n.创建后剩余资源：}CPU：${viewData.purchaseNum.cpuLeft}${i18n.核、内存：}${viewData.purchaseNum.memoryLeft}GB、${i18n.数据盘：}${viewData.purchaseNum.diskSizeLeft}GB</div>\n                                        \x3c!-- else: --\x3e\n                                        <div class="description">\n                                            ${i18n.创建后剩余资源：}CPU：${viewData.purchaseNum.cpuLeft}${i18n.核、内存：}${viewData.purchaseNum.memoryLeft}GB、\n                                        \x3c!-- if: ${host.diskDetail.ssd} --\x3e\n                                            ${i18n.SSD盘：}${viewData.purchaseNum.ssdDiskSizeLeft}、\n                                        \x3c!-- /if --\x3e\n                                        \x3c!-- if: ${host.diskDetail.sata} --\x3e\n                                            ${i18n.SATA盘：}${viewData.purchaseNum.sataDiskSizeLeft}\n                                        \x3c!-- /if --\x3e\n                                        </div>\n                                        \x3c!-- /if --\x3e\n                                    </div>\n                                </dd>\n                                <dd>\n                                    <label><i class="form-icon-required">*</i>${i18n.网络类型：}</label>\n                                    <div class="relative-field">\n                                        \x3c!-- if: ${viewData.vpcloading} --\x3e\n                                        <span class="inline-loading-container">\n                                            <span class="loading">${i18n.加载中，请稍候...}</span>\n                                        </span>\n                                        \x3c!-- elif: ${viewData.vpcNotAvailable} --\x3e\n                                            <span class="inline-loading-container">\n                                                <span class="dcc-color-red">${i18n.当前没有可用虚拟私有网络}</span>\n                                            </span>\n                                        \x3c!-- else: --\x3e\n                                        <span data-ui="id:vpc;name:vpc;type:Select;"></span>\n                                        \x3c!-- /if --\x3e\n                                        \x3c!-- if: ${viewData.subnetloading} --\x3e\n                                        <span class="inline-loading-container">\n                                            <span class="loading">${i18n.加载中，请稍候...}</span>\n                                        </span>\n                                        \x3c!-- elif: ${viewData.subnetNotAvailable} --\x3e\n                                            <span class="inline-loading-container">\n                                                <span class="dcc-color-red">${i18n.当前没有可用子网}</span>\n                                            </span>\n                                        \x3c!-- else: --\x3e\n                                        <span data-ui="id:subnetUuid;name:subnetUuid;type:Select;"></span>\n                                        \x3c!-- /if --\x3e\n                                    </div>\n                                </dd>\n                            </dl>\n                            <dl class="detail-create-settings detail-create detail-part-1-col">\n                                <dt>\n                                    <h4>${i18n.系统信息}</h4>\n                                </dt>\n                                <dd>\n                                    <label><i class="form-icon-required">*</i>${i18n.镜像类型：}</label>\n                                    <div class="relative-field">\n                                        <div data-ui-id="imageType" data-ui-name="imageType" data-ui-type="RadioSelect" class="ui-radioselect-custom">\n                                        </div>\n                                    </div>\n                                </dd>\n                                <dd class="operating-system-field">\n                                    <label><i class="form-icon-required">*</i>${i18n.操作系统：}</label>\n                                    <div class="relative-field">\n                                        \x3c!-- if: ${viewData.osloading} --\x3e\n                                        <div class="inline-loading-container">\n                                            <span class="loading">${i18n.加载中，请稍候...}</span>\n                                        </div>\n                                        \x3c!-- elif: ${viewData.osNotAvailable} --\x3e\n                                            <div class="inline-loading-container">\n                                                <span class="dcc-color-red">${i18n.当前没有可用镜像}</span>\n                                            </div>\n                                        \x3c!-- else: --\x3e\n                                        <div data-ui="id:osType;name:osType;type:Select;"></div>\n                                        <div data-ui="id:osVersion;name:osVersion;type:Select;" data-ui-extension-popover-type="PopoverEx"></div>\n                                        \x3c!-- /if --\x3e\n                                        <div data-ui-type="Tip"\n                                         data-ui-id="osVersionTip"\n                                         \x3c!-- if: ${viewData.osVersionTipHide} --\x3e\n                                         data-ui-hidden="true"\n                                         \x3c!-- /if --\x3e\n                                         data-ui-content="支持 Windows Server 2016 系统最小配置为2核CPU+2G内存"\n                                         data-ui-skin="warning"\n                                         class="os-version-tip"></div>\n                                    </div>\n                                </dd>\n                            </dl>\n                            <dl class="detail-create-settings detail-create detail-part-1-col">\n                                <dt>\n                                    <h4>${i18n.登录信息}</h4>\n                                </dt>\n                                <dd>\n                                    <label>${i18n.专属实例名称：}</label>\n                                    <div class="relative-field">\n                                        <div data-ui-id="instanceNameType" data-ui-name="instanceNameType" data-ui-type="RadioSelect" class="ui-radioselect-custom">\n                                        </div>\n                                        \x3c!-- if: ${viewData.instanceNameType.value} == \'custom\' --\x3e\n                                        <div id="custom-area-instance-name">\n                                            <div data-ui="id:instanceName;name:instanceName;type:TextBox"></div>\n                                            <label data-ui-type="Validity" data-ui-id="instanceNameValidity"></label>\n                                            <div data-ui-type="Label" data-ui-id="nameTip"></div>\n                                        </div>\n                                        \x3c!-- /if --\x3e\n                                    </div>\n                                </dd>\n                                <dd>\n                                    <label><i class="form-icon-required">*</i>${i18n.管理员密码：}</label>\n                                    <div class="relative-field">\n                                        <div data-ui-id="adminPasswordType" data-ui-name="adminPasswordType" data-ui-type="RadioSelect" class="ui-radioselect-custom">\n                                        </div>\n                                        \x3c!-- if: ${viewData.adminPasswordType.value} == \'custom\' --\x3e\n                                        <div id="custom-area-admin-password">\n                                            <input type="password" data-ui="id:adminPassword;name:adminPassword;type:TextBox;mode:password;" autocomplete="off"/>\n                                            <label data-ui-type="Validity" data-ui-id="adminPasswordValidity"></label>\n                                            <div data-ui-type="Label" data-ui-id="adminPassTip" class="admin-pass-tip"></div>\n                                            <input type="password" data-ui="id:adminPasswordRepeat;name:adminPasswordRepeat;type:TextBox;mode:password;" autocomplete="off"/>\n                                            <label data-ui-type="Validity" data-ui-id="adminPasswordRepeatValidity"></label>\n                                            <div>${i18n.请输入确认密码}</div>\n                                        </div>\n                                        \x3c!-- /if --\x3e\n                                    </div>\n                                </dd>\n                                <dd class="operating-system-field">\n                                    <label>${i18n.安全组}</label>\n                                    <div class="relative-field">\n                                        \x3c!-- if: ${viewData.securityloading} --\x3e\n                                        <div class="inline-loading-container">\n                                            <span class="loading">${i18n.加载中，请稍候...}</span>\n                                        </div>\n                                        \x3c!-- elif: ${viewData.securityNotAvailable} --\x3e\n                                            <div class="inline-loading-container">\n                                                <span class="dcc-color-red">${i18n.当前没有可用安全组}</span>\n                                            </div>\n                                        \x3c!-- else: --\x3e\n                                        <div data-ui="id:securityGroupList;name:securityGroupList;type:Select;"></div>\n                                        \x3c!-- /if --\x3e\n                                        <div class="description">${i18n.请在专属实例创建后，根据实际访问需求添加或修改访问规则}</div>\n                                    </div>\n                                </dd>\n                            </dl>\n                        </div>\n                        \x3c!-- /if --\x3e\n                        <div class="submit-container">\n                            \x3c!-- if: ${viewData.error} || ${viewData.loading} || ${viewData.host.datasource.length} === 0 --\x3e\n                            <button type="button" data-ui="id:cancel;type:Button;skin:cancel;">${i18n.回退}</button>\n                            \x3c!-- else: --\x3e\n                            <button data-ui="id:submit;type:Button;skin:ok;">${i18n.创建}</button>\n                            <button type="button" data-ui="id:cancel;type:Button;skin:cancel;">${i18n.取消}</button>\n                            \x3c!-- /if --\x3e\n                        </div>\n                    </div>\n\n                </form>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("dcc/instance/create/ui",["exports","underscore","babel-runtime/helpers/interop-require-default","inf-i18n","../../util","../../config","../../enums","./ui/tableFields"],function(exports,e,t,a,i,n,s,r){function o(e){var t=this;p&&clearTimeout(p),p=setTimeout(function(){e.target.validate()?t.enableSubmit():t.disableSubmit()},150)}exports.__esModule=!0,exports.getUIProperties=function(){var e=this,t=e.model.get("viewData"),a=e.model.get("formData"),i=e.model.get("host")||{},r={host:{width:200,disabled:"@hostId",value:a.host},hostTable:{fields:u["default"]},cpu:{max:i.cpuLeft,min:i.cpuLeft>0?1:0,value:a.cpu>i.cpuLeft?i.cpuLeft:a.cpu,length:349,unit:l["default"]("核")},memory:{max:i.memoryLeft,min:i.memoryLeft>0?1:0,value:a.memory>i.memoryLeft?i.memoryLeft:a.memory,length:349,unit:"GB"},purchaseNum:{min:1},imageType:{datasource:s.ImageType.toArray("COMMON","CUSTOM","INTEGRATION","SHARING"),value:a.imageType},osType:{width:200,value:a.osType},osVersion:{width:250,value:a.osVersion},instanceNameType:{datasource:[{name:l["default"]("随机生成"),value:"random"},{name:l["default"]("用户自定义"),value:"custom"}],value:a.instanceNameType},instanceName:{value:a.instanceName,oninput:c["default"].bind(o,e),custom:function(t){return"random"===e.model.get("formData").instanceNameType||/^[a-zA-Z](\w|-|\.|\/){0,64}$/.test(t)},customErrorMessage:l["default"]("名称输入不合法！"),validityLabel:"instanceNameValidity"},nameTip:{text:n.rule.INSTANCE.NAME.placeholder},adminPasswordType:{value:a.adminPasswordType,datasource:[{name:l["default"]("随机生成"),value:"random"},{name:l["default"]("用户自定义"),value:"custom"}]},adminPassword:{value:a.adminPassword,oninput:c["default"].bind(o,e),custom:function(t){return"random"===e.model.get("formData").adminPasswordType||n.rule.INSTANCE.PASSWORD.custom(t)},customErrorMessage:l["default"]("密码不符合规则"),validityLabel:"adminPasswordValidity"},adminPassTip:{text:n.rule.INSTANCE.PASSWORD.customErrorMessage},adminPasswordRepeat:{value:a.adminPasswordRepeat,oninput:c["default"].bind(o,e),custom:function(t){return"random"===e.model.get("formData").adminPasswordType||e.get("adminPassword").getValue()===t},customErrorMessage:l["default"]("两次输入不一致！"),validityLabel:"adminPasswordRepeatValidity"},securityGroupList:{width:200,value:a.securityGroupList},submit:{disabled:!!t.error},vpc:{width:200,value:a.vpc},subnetUuid:{width:200,value:a.subnetUuid}},p={diskSize:{max:i.diskSizeLeft,min:i.diskSizeLeft>0?1:0,value:a.diskSize>i.diskSizeLeft?i.diskSizeLeft:a.diskSize,length:349,unit:"GB",step:1}};if(i.diskDetail&&i.diskDetail.ssd){var f={max:i.diskDetail.ssd.diskLeft,min:0,value:Math.min(a.ssdDiskSize,i.diskDetail.ssd.diskLeft,i.diskSizeLeft),length:349,unit:l["default"]("块"),step:1};c["default"].extend(p,{ssdDiskSize:f})}if(i.diskDetail&&i.diskDetail.sata){var m={max:i.diskDetail.sata.diskLeft,min:0,value:Math.min(a.sataDiskSize,i.diskDetail.sata.diskLeft,i.diskSizeLeft),length:349,unit:l["default"]("块"),step:1};c["default"].extend(p,{sataDiskSize:m})}var h=c["default"].pick(t,c["default"].keys(r));return d["default"].deepExtend(r,h,p)},exports.getUIEvents=function(){var e={};return c["default"].each(["host","cpu","memory","diskSize","vpc","imageType","osType","osVersion","instanceNameType","adminPasswordType","securityGroupList","purchaseNum","instanceName","adminPassword","adminPasswordRepeat","ssdDiskSize","sataDiskSize","subnetUuid"],function(t){e[t+":change"]="triggerFormChange"}),e};var c=t["default"](e),l=t["default"](a),d=t["default"](i),u=t["default"](r),p=null}),define("dcc/instance/create/ui/tableFields",["exports","module","../../../enums"],function(exports,module,e){module.exports=[{field:"name",title:"专属服务器名称",width:"16%",content:function(e,t,a){return'<span class="truncated">'+(e.name||"-")+"</span>"}},{field:"id",title:"专属服务器ID",width:"16%",content:function(e,t,a){return'<span class="truncated">'+(e.hostId||"-")+"</span>"}},{field:"flavorName",title:"套餐名称",width:"16%",content:function(e,t,a){return"<span>"+e.flavor+"</span>"}},{field:"cpu",title:"CPU（可用/总量）",width:"16%",content:function(e,t,a){return e.cpuLeft+"/"+(e.vCpu||e.cpuTotal)+"核"}},{field:"memory",title:"内存（可用/总量）",width:"16%",content:function(e,t,a){return e.memoryLeft+"/"+e.memoryTotal+"GB"}},{field:"diskSize",title:"磁盘（可用/总量）",width:"16%",content:function(t,a,i){var n=t.flavorType===e.FlavorType.STORAGE?"块":"GB";return t.diskSizeLeft+"/"+t.diskSizeTotal+n}}]}),define("dcc/instance/create/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","jquery","bat-ria/mvc/FormView","bat-ria/tpl!./tpl","./ui","../../config","./config"],function(exports,module,e,t,a,i,n,s,r,o,c,l){var d=i["default"](a),u=i["default"](n),p=i["default"](s),f=i["default"](l),m=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_instance_create"}return e["default"](i,a),i.prototype.getUIProperties=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return o.getUIProperties.apply(this,t)},i.prototype.getUIEvents=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return o.getUIEvents.apply(this,t)},i.prototype.bindTableEvents=function(){this.get("hostTable")&&this.get("hostTable").on("select",this.triggerFormChange,this)},i.prototype.enterDocument=function(){a.prototype.enterDocument.call(this),this.initHostTableSelected(),this.bindTableEvents()},i.prototype.repaint=function(){this.render()},i.prototype.initHostTableSelected=function(){var e=this.get("hostTable"),t=this.model.get("viewData");if(e&&!t.loading){var a=this.model.get("formData").hostTableSelectedIndex||e.selectedIndex;e.setRowSelected(a,!0),this.get("hostTableSelected").setText(a.length||"0")}},i.prototype.onFormChanged=function(e){var t=e.target.getValue(),a=e.target.id;this.fire(c.events.FORM_CHANGED,{id:a,value:t})},i.prototype.disableSubmit=function(){this.get("submit")&&this.get("submit").disable()},i.prototype.enableSubmit=function(){this.get("submit")&&this.get("submit").enable()},i.prototype.showSettings=function(){this.hideLoading(),u["default"]("#dcc-instance-create-settings").show()},i.prototype.hideSettings=function(){this.showLoading(),u["default"]("#dcc-instance-create-settings").hide()},i.prototype.showLoading=function(){u["default"]("#dcc-instance-create-loading").show()},i.prototype.hideLoading=function(){u["default"]("#dcc-instance-create-loading").hide()},i.prototype.triggerFormChange=function(e){var t,a=this,i=e.target.id,n=e.target.getValue&&e.target.getValue(),s={};switch(i){case"osType":case"securityGroupList":case"osVersion":case"host":case"vpc":case"subnetUuid":n=e.target.getSelectedItem().value;break;case"hostTable":n=e.target.getSelectedItems(),s.hostTableSelectedIndex=e.selectedIndex;break;case"imageType":s.osType=""}d["default"].extend(s,(t={},t[i]=n,t)),setTimeout(function(){a.fire(c.events.FORM_CHANGED,{toUpdate:s})},0)},i.prototype.notifyErrors=function(e){var t={};return d["default"].map(e,function(e,a){f["default"].api2UiKeyMapper[a]?t[f["default"].api2UiKeyMapper[a]]=e:t[a]=e}),a.prototype.notifyErrors.call(this,t)},i.prototype.getExtraFormData=function(){var e=this.get("osVersion"),t={osVersionCheck:!!e&&e.getSelectedItem()},a=this.get("hostTable");return a&&(t=d["default"].extend(t,{hostIds:d["default"].pluck(a.getSelectedItems(),"id")})),t},i}(p["default"]);module.exports=m}),define("dcc/instance/detail/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/BaseAction","babel-runtime/helpers/interop-require-default","./Model","./View","inf-ria/helper","../../config","../../enums","../operation","../permission","common/util/dialog"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u){var p=i["default"](a),f=i["default"](n),m=i["default"](s),h=i["default"](r),g=i["default"](l),v=i["default"](d),b=i["default"](u),y=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=f["default"],this.viewType=m["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.view.on(o.events.COMMAND,this.dispatchCommand,this),this.view.on("redirectToVpc",this.redirectToVpc,this),this.view.on("redirectToSubnet",this.redirectToSubnet,this),this.view.on("changeSubnet",this.changeSubnet,this)},i.prototype.syncModelToViewIterator=function(e){switch(e.name){case"viewData":this.view.repaint();break;case"name":case"desc":this.view.updateDetailView({key:e.name})}},i.prototype.dispatchCommand=function(e){var t=e.args,a=e.command;if(!v["default"].checkIfShouldDisabled(a,this.model.get("instance"))){try{t=JSON.parse(t)}catch(e){}this[a]?this[a].call(this,t):g["default"].processor[a]?g["default"].processor[a].call(this,t):alert("请添加方法：operation."+a+"\nargs is:\n"+JSON.stringify(t,null,4))}},i.prototype.inlineedit=function(e){this.view.showInlineEdit(e)},i.prototype.stopInstance=function(e){var t=this,a=e.data.id;g["default"].processor.stopInstance.call(this,{instanceId:a}).then(function(){return t.model.loadInstanceData()})},i.prototype.rebootInstance=function(e){var t=this,a=e.data.id;g["default"].processor.rebootInstance.call(this,{instanceId:a}).then(function(){return t.model.loadInstanceData()})},i.prototype.deleteInstance=function(e){g["default"].processor.deleteInstance.call(this,[e.data])},i.prototype.redirectAfterDelete=function(){this.redirect("/dcc/instance/list")},i.prototype.editName=function(e){var t=this,a=this.view.get("inline-edit-for-name-value");a.validate()&&g["default"].processor.editName.call(this,e).then(function(){t.view.hideInlineEdit({key:"name"})}).fail(function(e){return a.showValidationMessage(!1,e.field&&e.field.name)})},i.prototype.editDesc=function(e){var t=this,a=this.view.get("inline-edit-for-desc-value");a.validate()&&g["default"].processor.editDesc.call(this,e).then(function(){t.view.hideInlineEdit({key:"desc"})}).fail(function(e){return a.showValidationMessage(!1,e.field&&e.field.desc)})},i.prototype.resetPassword=function(e){var t=e.data,a=c.InstanceStatus.ACTIVE===t.status,i=[t.instanceId],n=[t.id];g["default"].processor.resetPassword.call(this,{isActive:a,instanceIds:i,instanceUuids:n})},i.prototype.getVncUrl=function(e){g["default"].processor.getVncUrl.call(this,e.data)},i.prototype.rebuildOs=function(e){g["default"].processor.rebuildOs.call(this,e.data)},i.prototype.configChange=function(e){g["default"].processor.configChange.call(this,e.data)},i.prototype.buySameConfig=function(e){g["default"].processor.buySameConfig.call(this,e.data)},i.prototype.unbindEip=function(e){var t=this;g["default"].processor.unbindEip.call(this,e.data).then(function(){return t.model.loadInstanceData()})},i.prototype.bindEip=function(e){g["default"].processor.bindEip.call(this,e.data)},i.prototype.redirectToVpc=function(){h["default"].redirectToModule("network","/vpc/instance/list")},i.prototype.redirectToSubnet=function(){var e=this.model.get("vpcInfo")||{vpc:{},subnet:{}};h["default"].redirectToModule("network","/vpc/subnet/list",{vpcId:e.vpc.vpcId,cidr:e.vpc.cidr,vpc:e.vpc.name})},i.prototype.changeSubnet=function(){var e=this.model.get("instance"),t=this.model.get("vpcInfo");b["default"].waitActionDialog(this.view,{title:"子网变更",width:500,needFoot:!0,url:"/bcc/instance/change_subnet",actionOptions:{parentAction:this,instance:e,vpc:t.vpc,subnet:t.subnet,serviceType:"DCC",requester:o.api.bccchangeSubnet}}).then(function(e){var t=e.target,a=t.getChild("foot").getChild("btnOk");a.disable(),t.getAction().view.on("okBtrigger",function(e){return a.setProperties({disabled:e.disable})})})},i}(p["default"]);module.exports=y}),define("dcc/instance/detail/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","bat-ria/mvc/BaseModel","common/util/timeUtil","common/region","common/zone","common/util","../../config","../../enums","../operation","../permission"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p,f){var m=n["default"](i),h=n["default"](s),g=n["default"](r),v=n["default"](o),b=n["default"](c),y=n["default"](l),T=n["default"](p),x=n["default"](f),I=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.prepare=function(){this.loadInstanceData(),this.loadVpcData()},n.prototype.loadInstanceData=function(){var e=this;return this.set("loading",!0),d.api.getDccInstanceDetail({instanceId:this.get("instanceId")},{showLoading:!1,"X-silence":!0}).then(function(t){e.set("loading",!1,{silent:!0}),t.regionLabel=[v["default"].getCurrentRegion().label,b["default"].getLabel(t.logicalZone)].join("，"),e.set("instance",t,{silent:!0})}).then(m["default"].bind(this.updateViewData,this))},n.prototype.loadVpcData=function(){var e=this,t=this.get("instanceId");return this.set("loading",!0),d.api.getVpcDetail({bccIds:[t]}).then(function(a){e.set("loading",!1,{silent:!0}),e.set("vpcInfo",a[t],{silent:!0})}).then(m["default"].bind(this.updateViewData,this))},n.prototype.updateViewData=function(){var e=this.get("instance")||{},t=m["default"].deepClone(e);t.status={text:u.InstanceStatus.getTextFromValue(e.status),className:u.InstanceStatus.fromValue(e.status).kclass},t.createTime=g["default"].toTime(e.createTime)||"-",t.paymentText=d.lang.PAYMENT[e.payment],t.osText=(e.osName||e.osType)+e.osVersion,t.osType="windows"===e.osType.toLowerCase()?"windows":"linux",t.instanceId=t.instanceId||t.id;var a=m["default"].values(T["default"].NAME);t.commandState=m["default"].object(a,m["default"].map(a,function(t){return!!x["default"].checkIfShouldDisabled(t,e)}));var i=this.get("vpcInfo");i&&(t.vpcInfo=m["default"].clone(i),t.vpcInfo.vpc.name=y["default"].getVpcName(t.vpcInfo.vpc.name),t.vpcInfo.subnet.name=y["default"].getSubnetName(t.vpcInfo.subnet.name)),this.set("viewData",t)},n.prototype.setName=function(e){this.get("instance").name=e,this.set("name",e)},n.prototype.editName=function(e,t){var a=this;return d.api.editInstanceName({name:e,instanceIds:t}).then(function(){return a.setName(e)})},n.prototype.editDesc=function(e,t){var a=this;return d.api.editInstanceDesc({desc:e,instanceId:t}).then(function(){a.get("instance").desc=e,a.set("desc",e)})},t["default"](n,[{key:"datasource",get:function(){return{menu:function(e){return"instance"},loading:m["default"].constant(!0),tab:m["default"].constant({detail:"ui-tab-item-active"}),isSubUser:function(e){return y["default"].isSubUser()}}}}]),n}(h["default"]);module.exports=I}),define("dcc/instance/detail/tpl",[],function(){return'\x3c!-- target: TPL_dcc_instance_detail --\x3e\n\x3c!-- if: ${loading} --\x3e\n\x3c!-- import: TPL_dcc_instance_detail_loading --\x3e\n\x3c!-- else: --\x3e\n\x3c!-- import: TPL_dcc_instance_detail_main --\x3e\n\x3c!-- /if --\x3e\n\n\x3c!-- target: TPL_dcc_instance_detail_main(master = TPL_dcc_instance_detail_structure) --\x3e\n\n\x3c!-- block: abstrct-info --\x3e\n<h1 title="${viewData.name}">${viewData.name}</h1>\n<span class="status ${viewData.status.className}">\n    ${viewData.status.text}\n</span>\n\x3c!-- /block --\x3e\n\n\x3c!-- block: operation-info   --\x3e\n<span class="ui-group ui-button-group">\n    <button data-ui-type="Button"\n            data-ui-id="stopInstance"\n            \x3c!-- if: ${viewData.commandState.stopInstance} --\x3e\n            data-ui-disabled="true"\n            \x3c!-- /if --\x3e\n            title="${i18n.关闭专属实例}">${i18n.停止}</button>\n    <button data-ui-type="Button"\n            data-ui-id="rebootInstance"\n            \x3c!-- if: ${viewData.commandState.rebootInstance} --\x3e\n            data-ui-disabled="true"\n            \x3c!-- /if --\x3e\n            title="${i18n.重新启动专属实例}">${i18n.重启}</button>\n    <button data-ui-type="Button"\n            data-ui-id="deleteInstance"\n            \x3c!-- if: ${viewData.commandState.deleteInstance} --\x3e\n            data-ui-disabled="true"\n            \x3c!-- /if --\x3e\n            title="${i18n.释放资源，删除专属实例}">${i18n.释放}</button>\n</span>\n\x3c!-- /block --\x3e\n\n\x3c!-- block: detail-navigator --\x3e\n    \x3c!-- import: TPL_dcc_instance_detail_navigator --\x3e\n\x3c!-- /block --\x3e\n\n\x3c!-- block: detail-info --\x3e\n<div class="instance-info-section">\n    <h2 class="instance-info-title"><em>${i18n.基础信息}</em></h2>\n    <div class="instance-info-content">\n        <ul>\n            <li>\n                <div class="inline-edit-container">\n                    <div class="inline-edit-label">\n                        ${i18n.子实例名称：}\n                        <span class="truncated update-value" title="${viewData.name}">\n                            \x3c!-- if: ${viewData.name} --\x3e\n                            ${viewData.name}\n                            \x3c!-- else: --\x3e\n                            ${i18n.无}\n                            \x3c!-- /if --\x3e\n                        </span>\n                        \x3c!-- if: ${viewData.commandState.editName} --\x3e\n                        <span class="link-like state-disabled">${i18n.变更}</span>\n                        \x3c!-- else: --\x3e\n                        <span class="link-like" data-command="inlineedit" data-command-args=\'{"key": "name"}\'>${i18n.变更}</span>\n                        \x3c!-- /if --\x3e\n                    </div>\n                    <div class="inline-edit-main name" for="name">\n                        <input data-ui="id:inline-edit-for-name-value;type:TextBox;value:${viewData.name};width:350;" />\n                        <button data-ui="id:inline-edit-for-name-submit;type:Button;skin:ok;">${i18n.保存}</button>\n                        <button data-ui="id:inline-edit-for-name-cancel;type:Button;skin:cancel;">${i18n.取消}</button>\n                        <label data-ui="id:inline-edit-for-name-value-validity;type:Validity"></label>\n                    </div>\n                </div>\n            </li>\n            <li>${i18n.所属服务器名称：}\n                \x3c!-- if: ${isSubUser} --\x3e-\x3c!-- else --\x3e\n                    <span class="truncated" title="${viewData.hostName}">${viewData.hostName}</span>\n                \x3c!-- /if --\x3e\n            </li>\n            <li>\n                ${i18n.专属实例ID：}\n                <span class="truncated" title="${viewData.instanceId}">${viewData.instanceId}</span>\n                <button type="button"\n                    data-ui-type="Clipboard"\n                    class="link-like"\n                    data-ui-clipboard-text="@viewData.instanceId"\n                    data-ui-id="copyId">${i18n.复制}</button>\n            </li>\n            <li>\n                ${i18n.所属服务器ID：}\n                \x3c!-- if: ${isSubUser} --\x3e-\x3c!-- else --\x3e\n                    <span class="truncated" title="${viewData.hostId}">${viewData.hostId}</span>\n                    \x3c!-- if: ${viewData.hostId} --\x3e\n                    <button type="button"\n                        data-ui-type="Clipboard"\n                        class="link-like"\n                        data-ui-clipboard-text="@viewData.hostId"\n                        data-ui-id="copyHostId">${i18n.复制}</button>\n                    \x3c!-- /if --\x3e\n                \x3c!-- /if --\x3e\n            </li>\n            <li>\n                <div class="inline-edit-container">\n                    <div class="inline-edit-label">\n                        ${i18n.描述：}\n                        <span class="truncated update-value" title="${viewData.desc}">\n                            \x3c!-- if: ${viewData.desc} --\x3e\n                            ${viewData.desc}\n                            \x3c!-- else: --\x3e\n                            ${i18n.无}\n                            \x3c!-- /if --\x3e\n                        </span>\n                        \x3c!-- if: ${viewData.commandState.editDesc} --\x3e\n                        <span class="link-like state-disabled">${i18n.变更}</span>\n                        \x3c!-- else: --\x3e\n                        <span class="link-like" data-command="inlineedit" data-command-args=\'{"key": "desc"}\'>${i18n.变更}</span>\n                        \x3c!-- /if --\x3e\n                    </div>\n                    <div class="inline-edit-main desc" for="desc">\n                        <input data-ui="id:inline-edit-for-desc-value;type:TextBox;value:${viewData.desc};width:350;" />\n                        <button data-ui="id:inline-edit-for-desc-submit;type:Button;skin:ok;">${i18n.保存}</button>\n                        <button data-ui="id:inline-edit-for-desc-cancel;type:Button;skin:cancel;">${i18n.取消}</button>\n                        <label data-ui="id:inline-edit-for-desc-value-validity;type:Validity"></label>\n                    </div>\n                </div>\n            </li>\n            <li>${i18n.状态：}\n                <span class="status ${viewData.status.className}">\n                    ${viewData.status.text}\n                </span>\n            </li>\n            <li>${i18n.创建时间：}${viewData.createTime}</li>\n            <li>${i18n.操作：}\n                <span data-command="resetPassword"\n                    class="link-like \x3c!-- if: ${viewData.commandState.resetPassword} --\x3e state-disabled\x3c!-- /if --\x3e">\n                    ${i18n.重置密码}</span>\n                <span data-command="getVncUrl"\n                    class="link-like \x3c!-- if: ${viewData.commandState.getVncUrl} --\x3e state-disabled\x3c!-- /if --\x3e">\n                    ${i18n.VNC远程}</span>\n            </li>\n            <li>${i18n.区域：}${viewData.regionLabel}</li>\n        </ul>\n    </div>\n</div>\n<div class="instance-info-section">\n    <h2 class="instance-info-title"><em>${i18n.配置信息}</em></h2>\n    <div class="instance-info-content">\n        <ul>\n            <li>CPU：${viewData.cpu}${i18n.核}</li>\n            <li>${i18n.公网IP：}\n                \x3c!-- if: ${viewData.publicIp} --\x3e\n                ${viewData.publicIp}${i18n.（带宽：}${viewData.network}${i18n.Mbps）}\n                <button data-ui-type="Button" data-ui-id="unbindEip"\n                \x3c!-- if: ${viewData.commandState.unbindEip} --\x3e\n                data-ui-disabled="true"\n                \x3c!-- /if --\x3e\n                class="skin-stringfy-button"\n                title="${i18n.解绑EIP}">${i18n.解绑EIP}</button>\n                \x3c!-- else --\x3e\n                ${i18n.未分配}\n                \x3c!-- if: ${vpcInfo.subnet.subnetType} === 3 --\x3e\n                <span>${i18n.（NAT专属子网内DCC无法绑定EIP）}</span>\n                \x3c!-- else --\x3e\n                <button data-ui-type="Button" data-ui-id="bindEip"\n                \x3c!-- if: ${viewData.commandState.bindEip} --\x3e\n                data-ui-disabled="true"\n                \x3c!-- /if --\x3e\n                class="skin-stringfy-button bind-eip-button"\n                title="${i18n.绑定EIP}">${i18n.绑定EIP}</button>\n                \x3c!-- /if --\x3e\n                \x3c!-- /if --\x3e\n            </li>\n            <li>${i18n.内存：}${viewData.memory}GB</li>\n            <li>${i18n.内网IP：}${viewData.internalIp}</li>\n            \x3c!-- if: ${viewData.flavorType} === \'storage\' --\x3e\n            <li>${i18n.本地磁盘：}${viewData.diskSize}${i18n.块}</li>\n            \x3c!-- else: --\x3e\n            <li>${i18n.本地磁盘：}${viewData.diskSize}GB</li>\n            \x3c!-- /if --\x3e\n            <li>${i18n.操作系统：}${viewData.osText}\n                <span data-command="rebuildOs"\n                    class="link-like \x3c!-- if: ${viewData.commandState.rebuildOs} --\x3e state-disabled\x3c!-- /if --\x3e">\n                    ${i18n.重装操作系统}</span>\n            </li>\n            <li>${i18n.系统盘：}${viewData.sysDisk}\n            </li>\n            \x3c!-- if: ${loading} --\x3e\n            <div class="loading-container">\n                <span class="loading">${i18n.数据加载中，请稍后…}</span>\n            </div>\n            \x3c!-- else: --\x3e\n            <li>${i18n.所在网络：}\n                <button data-ui-type="Button" data-ui-id="redirectToVpc" data-ui-skin="stringfy" class="vpc-button">${viewData.vpcInfo.vpc.name}\x3c!-- if:${viewData.vpcInfo.vpc.cidr} --\x3e（${viewData.vpcInfo.vpc.cidr}）\x3c!-- /if --\x3e</button>\n            </li>\n            \x3c!-- if: ${viewData.vpcInfo.subnet} --\x3e\n            <li>${i18n.所在子网：}\n                <button data-ui-type="Button" data-ui-id="redirectToSubnet" data-ui-skin="stringfy" class="vpc-button">${viewData.vpcInfo.subnet.name}\x3c!-- if:${viewData.vpcInfo.subnet.cidr} --\x3e（${viewData.vpcInfo.subnet.cidr}）\x3c!-- /if --\x3e</button>\n                <button data-ui-id="changeSubnet" data-ui-type="Button"\n                    \x3c!-- if: ${viewData.commandState.changeSubnet} --\x3e\n                    data-ui-disabled="true"\n                    \x3c!-- /if --\x3e\n                    class="skin-stringfy-button">变更子网</button>\n            </li>\n            \x3c!-- /if --\x3e\n            \x3c!-- /if --\x3e\n        </ul>\n        <div class="instance-info-operation">\n            <button type="button"\n                data-ui-type="Button" data-ui-id="configChange"\n                \x3c!-- if: ${viewData.commandState.configChange} --\x3e\n                data-ui-disabled="true"\n                \x3c!-- /if --\x3e\n                title="${i18n.调整配置}">${i18n.调整配置}</button>\n            \x3c!-- <button type="button"\n                data-ui-type="Button" data-ui-id="buySameConfig"\n                if: ${viewData.commandState.buySameConfig}\n                data-ui-disabled="true"\n                /if\n                title="创建同配置专属实例">创建同配置专属实例</button> --\x3e\n        </div>\n    </div>\n</div>\n\x3c!-- /block --\x3e\n'}),define("dcc/instance/detail/ui",["exports","underscore","babel-runtime/helpers/interop-require-default","../../config","../../util"],function(exports,e,t,a,i){exports.__esModule=!0,exports.getUIProperties=function(){return{"inline-edit-for-name-value":n["default"].defaults({validityLabel:"inline-edit-for-name-value-validity"},a.rule.INSTANCE.NAME),"inline-edit-for-desc-value":n["default"].defaults({validityLabel:"inline-edit-for-desc-value-validity"},a.rule.HOST.DESCRIPTION)}},exports.getUIEvents=function(){var e=this;return{"copyId:aftercopy":function(){e.showToast("已复制到剪贴板")},"copyHostId:aftercopy":function(){e.showToast("已复制到剪贴板")},"stopInstance:click":function(t){s["default"].triggerCommand.call(e,"stopInstance",{data:e.model.get("instance")})},"rebootInstance:click":function(t){s["default"].triggerCommand.call(e,"rebootInstance",{data:e.model.get("instance")})},"deleteInstance:click":function(t){s["default"].triggerCommand.call(e,"deleteInstance",{data:e.model.get("instance")})},"configChange:click":function(t){s["default"].triggerCommand.call(e,"configChange",{data:e.model.get("instance")})},"unbindEip:click":function(t){s["default"].triggerCommand.call(e,"unbindEip",{data:e.model.get("instance")})},"bindEip:click":function(t){s["default"].triggerCommand.call(e,"bindEip",{data:e.model.get("instance")})},"buySameConfig:click":function(t){s["default"].triggerCommand.call(e,"buySameConfig",{data:e.model.get("instance")})},"instanceInfoDetailPanel:command":function(t){var a=n["default"].extend(t.args||{},{data:e.model.get("instance")});s["default"].triggerCommand.call(e,t.name,a),t.stopPropagation(),t.preventDefault()},"inline-edit-for-name-submit:click":function(t){s["default"].triggerCommand.call(e,"editName",{data:e.model.get("instance"),toUpdate:{name:e.get("inline-edit-for-name-value").getValue()}})},"inline-edit-for-desc-submit:click":function(t){s["default"].triggerCommand.call(e,"editDesc",{data:e.model.get("instance"),toUpdate:{desc:e.get("inline-edit-for-desc-value").getValue()}})},"inline-edit-for-name-cancel:click":function(t){e.get("inline-edit-for-name-value").setValue(e.model.get("instance").name),e.hideInlineEdit({key:"name"})},"inline-edit-for-desc-cancel:click":function(t){e.get("inline-edit-for-desc-value").setValue(e.model.get("instance").desc),e.hideInlineEdit({key:"desc"})},"redirectToVpc:click":function(t){e.fire("redirectToVpc")},"redirectToSubnet:click":function(t){e.fire("redirectToSubnet")},"changeSubnet:click":function(){this.fire("changeSubnet")}}};var n=t["default"](e),s=t["default"](i)}),define("dcc/instance/detail/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/tpl!./tpl","bat-ria/mvc/BaseView","babel-runtime/helpers/interop-require-default","inf-i18n","underscore","jquery","common/constants","esui/TextBox","esui/Button","./ui"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u){var p=n["default"](i),f=n["default"](s),m=n["default"](r),h=n["default"](o),g=n["default"](c),v=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_instance_detail"}return e["default"](i,a),i.prototype.getUIProperties=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return u.getUIProperties.apply(this,t)},i.prototype.getUIEvents=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return u.getUIEvents.apply(this,t)},i.prototype.repaint=function(){this.viewContext.dispose(),this.render(),this.handleSidebar()},i.prototype.handleSidebar=function(){var e=g["default"].availableService?g["default"].availableService.split(","):[];m["default"].contains(e,"GPU")&&h["default"]("#gpuSidebarItem a").html('<i class="iconfont icon-gpu"></i>'+f["default"]("GPU服务器")).show(),h["default"]("#mirrorSidebarItem a").attr("href","#/bcc/image/list")},i.prototype.updateDetailView=function(e){var t=e.key,a=m["default"].escape(this.model.get("instance")[t]);h["default"](".inline-edit-main[for="+t+"]").parent(".inline-edit-container").find(".update-value").html(a)},i.prototype.showInlineEdit=function(e){var t=e.key;h["default"](".inline-edit-main[for="+t+"]").show()},i.prototype.hideInlineEdit=function(e){var t=e.key;h["default"](".inline-edit-main[for="+t+"]").hide()},i}(p["default"]);module.exports=v}),define("dcc/instance/list/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","bat-ria/mvc/ListAction","./Model","./View","../../config","../../enums","../operation","../permission","inf-ria/app/brpc"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u){var p=i["default"](a),f=i["default"](n),m=i["default"](s),h=i["default"](r),g=i["default"](l),v=i["default"](d),b=i["default"](u),y=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=m["default"],this.viewType=h["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){var e=this;a.prototype.initBehavior.call(this),this.model.on(o.events.CHANGE,function(e){e.type},this),this.model.on(o.events.LOAD_ERROR,function(t){e.view.showTableLoadingError()},this),this.view.on(o.events.BACKWARD,this.back,this),this.view.on(o.events.COMMAND,this.dispatchCommand,this),this.view.on(o.events.FILTER,this.filterList,this),this.view.on(o.events.EDIT_TAG,this.editTag,this),this.model.loadListData(),this.setIntervalRefreshTable(),this.on("beforeleave",function(){return clearInterval(e.timer)})},i.prototype.filterList=function(e){this.model.setFilters(e.condition)},i.prototype.syncModelToView=function(e){var t=this,a=!1;p["default"].each(e.changes,function(i){switch(i.name){case"tableLoading":!0===i.newValue&&t.view.showTableLoading();break;case"tableData":t.view.hideTableLoading(),t.view.renderTable();break;case"totalCount":case"pageSize":case"pageNo":a||(t.view.renderPager(),a=!0);break;case"filters":t.view.submitSearch(e);break;case"dccTags":t.view.updateKeywordType()}})},i.prototype.dispatchCommand=function(e){var t=e.command,a=e.args;try{a=JSON.parse(a)}catch(e){}a&&a.data&&!p["default"].isArray(a.data)&&v["default"].checkIfShouldDisabled(t,a.data)||(this[t]?this[t].call(this,a):g["default"].processor[t]?g["default"].processor[t].call(this,a):alert("请添加方法：operation."+t+"\nargs is:\n"+JSON.stringify(a,null,4)))},i.prototype.editName=function(e){p["default"].isArray(e.data)?g["default"].processor.batchEditName.call(this,e.data):g["default"].processor.editName.call(this,e)},i.prototype.startInstance=function(e){var t=this;g["default"].processor.startInstance.call(this,e).then(function(){return t.model.loadListData()})},i.prototype.stopInstance=function(e){var t=this,a=p["default"].pluck(e.data,"id").join(",");g["default"].processor.stopInstance.call(this,{instanceId:a}).then(function(){return t.model.loadListData()}).fail(function(){return t.view.resetMoreOperation()})},i.prototype.rebootInstance=function(e){var t=this,a=p["default"].pluck(e.data,"id").join(",");g["default"].processor.rebootInstance.call(this,{type:"soft",instanceId:a}).then(function(){return t.model.loadListData()}).fail(function(){return t.view.resetMoreOperation()})},i.prototype.deleteInstance=function(e){var t=this;g["default"].processor.deleteInstance.call(this,e.data).then(function(){return t.view.resetMoreOperation()}).fail(function(){return t.view.resetMoreOperation()})},i.prototype.configChange=function(e){g["default"].processor.configChange.call(this,e.data)},i.prototype.unbindEip=function(e){var t=this;g["default"].processor.unbindEip.call(this,e.data).then(function(){return t.model.loadListData()})},i.prototype.bindEip=function(e){g["default"].processor.bindEip.call(this,e.data)},i.prototype.createSnapshot=function(e){g["default"].processor.createSnapshot.call(this,e.data[0])},i.prototype.createImage=function(e){g["default"].processor.createImage.call(this,e.data[0])},i.prototype.rebuildOs=function(e){g["default"].processor.rebuildOs.call(this,e.data[0])},i.prototype.resetPassword=function(e){var t=p["default"].pluck(e.data,"instanceId"),a=p["default"].pluck(e.data,"id"),i=!(e.data.length>1)&&e.data[0].status===c.InstanceStatus.ACTIVE;g["default"].processor.resetPassword.call(this,{instanceUuids:a,instanceIds:t,isActive:i})},i.prototype.joinSecurityGroups=function(e){g["default"].processor.joinSecurityGroups.call(this,e.data)},i.prototype.networkChange=function(e){var t=e.data[0];g["default"].processor.networkChange.call(this,t)},i.prototype.getVncUrl=function(e){g["default"].processor.getVncUrl.call(this,e.data)},i.prototype.editTag=function(e){var t=this;p["default"].each(e.data,function(e){return e.resoureId=e.instanceId});var a={serviceType:"DBCC",instances:e.data,submitRequester:o.api.dbccTagAssign};b["default"].invokeService("tag://edit",a).then(function(){return t.reload()})},i.prototype.setIntervalRefreshTable=function(){var e=this;this.timer=setInterval(function(){return e.intervalRefreshListPage()},o.DCC_LISTEN_INTERVAL)},i.prototype.intervalRefreshListPage=function(){var e=this;this.view.shouldKeepSelectedIndex=!0,this.model.loadListData({silent:!0}).then(function(){return e.view.shouldKeepSelectedIndex=!1})},i}(f["default"]);module.exports=y}),define("dcc/instance/list/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","inf-i18n","promise","bat-ria/mvc/ListModel","common/region","common/storage","../../config","er/URL"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d){var u=n["default"](i),p=n["default"](s),f=n["default"](r),m=n["default"](o),h=n["default"](c),g=n["default"](l),v={"x-silent":!0},b=function(i){function n(e){a["default"](this,n),i.call(this,e),this.listRequester=function(){var t=u["default"].extend({tips:d.tips,result:[]},u["default"].omit(e,"container","isChildAction","referrer","url"));return f["default"].resolve(u["default"].defaults(t,this.defaultArgs))}}return e["default"](n,i),n.prototype.prepare=function(){var e=this,t=this.get("filters");"string"==typeof t&&function(){try{t=JSON.parse(t)}catch(i){}e.set("filters",t,{silent:!0});var a={};u["default"].each(t,function(e){a[e.join("")]=!0}),e.set("filterMapper",a,{silent:!0})}(),this.getDccTags()},n.prototype.filterQuery=function(e){var t=[],a=e.keyword,i=e.keywordType;if(e.filters){var n=e.filters;delete e.filters;try{n=JSON.parse(n)}catch(s){}u["default"].each(n,function(a){"expiredDate<7"===a.join("")?e.showMode="WILLEXPIRED":t.push({keywordType:a[0],keyword:a[1]})})}return i&&i.match(/^tag\/([\u4e00-\u9fa5\w\-\/\.]{0,64})$/)&&(i="tag","空值"===a&&(a=""),"所有值"===a&&(a="@@@")),(a||"tag"===i)&&t.push({keywordType:i,subKeywordType:e.subKeywordType||"",keyword:a||""}),e.filters=t,e.pageNo&&(e.pageNo=+e.pageNo),e},n.prototype.loadListData=function(){var e=this,t=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],a=this.getQuery();return t.silent||this.set("tableLoading",!0),d.api.getDccInstanceList(a,{"x-silent":!0}).then(function(t){e.set("tableData",t.result),e.fill(u["default"].pick(t,["totalCount","order","orderBy","pageNo","pageSize"]))},function(){e.fire(d.events.LOAD_ERROR)}).then(function(){e.set("tableLoading",!1)})},n.prototype.getDownloadUrl=function(){var e=this.getQuery();return e.filters&&(e.filters=JSON.stringify(e.filters)),delete e.pageNo,delete e.pageSize,"/api/bcc/dcc/instance/download?"+require("er/URL").serialize(e)},n.prototype.setFilters=function(e){this.set("filters",e)},n.prototype.updateTableData=function(e,t,a,i){var n=this.get("tableData");if(i&&i.silent)n[a][e]=t,this.set("tableData",n);else{var s=u["default"].deepClone(n);s[a][e]=t,this.set("tableData",s)}},n.prototype.editName=function(e,t,a){var i=this;return d.api.editInstanceName({name:e,instanceIds:t}).then(function(){i.updateTableData("name",e,a)})},n.prototype.getDccTags=function(){var e=this;return d.api.getSearchTagList({serviceType:["DCC_BCC"],region:[h["default"].getCurrentRegion().id]},v).then(function(t){var a=u["default"].groupBy(t,"tagKey");u["default"].each(a,function(e,t){a[t]=u["default"].map(e,function(e){return{name:e.tagValue||"空值",value:e.tagValue}}),a[t]=[{name:"所有值",value:"@@@"}].concat(a[t])}),e.set("dccTags",a)})},t["default"](n,[{key:"datasource",get:function(){return{menu:function(e){return"instance"},activedTab:function(e){return"hostInstance"},keywordTypeDatasource:function(){return[{name:p["default"]("专属实例名称"),value:"name"},{name:p["default"]("专属实例ID"),value:"instanceId"},{name:p["default"]("专属实例内网IP"),value:"internalIp"},{name:p["default"]("专属实例公网IP"),value:"publicIp"},{name:p["default"]("专属服务器"),value:"hostName"},{name:p["default"]("所在网络"),value:"vpcName"},{name:p["default"]("所在子网"),value:"subnetName"},{name:p["default"]("子网ID"),value:"subnetId"}]},onlyHasDcc:function(){return g["default"].get("bcc-only-dcc")}}}},{key:"defaultArgs",get:function(){return{order:"desc",orderBy:"createTime",pageSize:d.dcc.instance.DEFAULT.PAGE_SIZE,instanceType:[1]}}}]),n}(m["default"]);module.exports=b}),define("dcc/instance/list/tpl",[],function(){return'\x3c!-- target: TPL_dcc_instance_list--\x3e\n<div class="dcc-wrapper main-wrap-new dcc-list instance-list">\n    <div class="content-wrap">\n        <p class="breadcrumb">\n            <span>${i18n.产品服务}</span>\n            <span class="divider">/</span>\n            <span class="active">${i18n.专属服务器} - ${i18n.专属实例列表}</span>\n        </p>\n        <div class="list-content">\n            \x3c!-- if: ${onlyHasDcc} --\x3e\n                <h2>\n                    专属实例列表\n                </h2>\n            \x3c!-- else --\x3e\n                \x3c!-- import: TPL_bcc_instance_list_navigator --\x3e\n            \x3c!-- /if --\x3e\n\n            <div class="table-full-wrap">\n                <div class="operation-wrap" data-follow-thead="table">\n                    <div class="buttons-wrap">\n                        <button type="button"\n                            data-ui-id="createInstance"\n                            data-ui-type="Button"\n                            data-ui-skin="create"\n                            data-auth="forbidden"\n                            data-authtype="READONLY"\n                            title="${i18n.创建专属实例}">${i18n.创建专属实例}</button>\n                        <button type="Button"\n                            data-ui-type="Button"\n                            data-ui-id="startInstance"\n                            data-ui-disabled="true"\n                            title="${i18n.启动专属实例}">${i18n.开启}</button>\n                        <button type="Button"\n                            data-ui-type="Button"\n                            data-ui-id="configChange"\n                            data-ui-disabled="true"\n                            title="${i18.调整专属实例配置}">${i18n.调整配置}</button>\n                        <button data-ui-type="Button"\n                                data-ui-id="editTag"\n                                title="${i18n.标签}"\n                                data-intro="${i18n.资源可以打标签啦}">${i18n.编辑标签}\n                        </button>\n                        <span data-ui-type="Select" data-ui-id="moreOperation" data-ui-skin="light"></span>\n                    </div>\n                    <div class="buttons-quick-wrap">\n                        <span class="ui-group ui-search-group">\n                            <span data-ui-type="SelectEx" data-ui-id="keywordType"\n                                data-ui-value="@keywordType" data-ui-has-child-list="true"></span>\n                            <input class="search-box" data-ui-type="TextBox"\n                                data-ui-id="keyword" data-ui-value="@keyword" data-ui-extension-textbox-type="TextBoxSelect"/>\n                            <button type="button" data-ui-type="Button" data-ui-id="searchBtn"></button>\n                            \x3c!-- if: ${keyword} --\x3e\n                            <button type="button"\n                                    data-ui-type="Button"\n                                    data-ui-id="clearKeyword"\n                                    title="${i18n.清空搜索条件}"\n                                    class="link-like clear-button">${i18n.清空}</button>\n                            \x3c!-- /if --\x3e\n                        </span>\n                        <button type="button"\n                            data-ui-type="Button" data-ui-id="refreshList" title="${i18n.刷新表格数据}">\n                            <i class="iconfont icon-cdnrefresh"></i>\n                        </button>\n                        <button data-ui="type:Button;id:downloadList;" title="${i18n.下载当前列表展现的专属实例信息，编码格式为utf-8}">\n                            <i class="iconfont icon-download"></i>\n                        </button>\n                        <div id="table-custom-fields-container"></div>\n                    </div>\n                </div>\n                <div data-ui-type="Table" data-ui-id="table"\n                     data-ui-datasource="@tableData"\n                     data-ui-order-by="@orderBy" data-ui-order="@order"\n                     data-ui-select="@selectMode" data-ui-extension-tip-type="TableTip"\n                     data-ui-extension-command-type="Command"\n                     data-ui-extension-tableedit-type="TableEdit"\n                     data-ui-extension-tableex-type="TableEx"\n                     data-ui-extension-customfields-type="TableCustomFields"\n                     data-ui-extension-tablefilter-type="TableFilter">\n                </div>\n                <div class="ui-row">\n                    \x3c!-- import: listPager --\x3e\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("dcc/instance/list/ui",["exports","underscore","babel-runtime/helpers/interop-require-default","jquery","inf-i18n","common/util/tableUtil","common/util","./ui/tableFields","../../config","../operation","../permission"],function(exports,e,t,a,i,n,s,r,o,c,l){function d(e,t){this.fire(o.events.COMMAND,{command:e,args:t})}function u(e){if(!0===e.bubble){var t=e.originalTarget,a=t.getValue();if(a){var i=t.get("xRowIndex"),n=e.target.datasource[i];t.set("selectedIndex",-1),d.call(this,a,n)}}}exports.__esModule=!0,exports.getUIProperties=function(){return{table:h["default"].tableProperty(g["default"],{followHead:!0,noFollowHeadCache:!0,followHeadOffsetH:50,followDoms:[f["default"](".operation-wrap")[0]],editable:1,noDataHtml:"<div><p>"+m["default"]("没有相关数据!")+"</p></div>",extTableEx:["name","operation"],extTableCustomFields:{container:"#table-custom-fields-container",defaults:["name","status","host","publicIp","internalIp","configuration","os","tag","operation"],locked:{head:["name"],tail:["operation"]},maxFields:9},fontSize:12,colPadding:0}),pager:{pageSizes:[10,20,50,100]},keyword:{placeholder:m["default"]("请输入专属实例名称进行搜索")},keywordType:"@keywordTypeDatasource",moreOperation:{emptyText:m["default"]("更多操作"),selectedIndex:-1,datasource:[{name:m["default"]("停止"),value:v["default"].NAME.STOP_INSTANCE},{name:m["default"]("重启"),value:v["default"].NAME.REBOOT_INSTANCE},{name:m["default"]("释放"),value:v["default"].NAME.DELETE_INSTANCE},{name:m["default"]("修改名称"),value:v["default"].NAME.EDIT_NAME},{name:m["default"]("重置密码"),value:v["default"].NAME.RESET_PASSWORD},{name:m["default"]("关联安全组"),value:v["default"].NAME.JOIN_SECURITY_GROUPS},{name:m["default"]("调整带宽"),value:v["default"].NAME.NETWORK_CHANGE},{name:m["default"]("创建快照"),value:v["default"].NAME.CREATE_SNAPSHOT},{name:m["default"]("创建自定义镜像"),value:v["default"].NAME.CREATE_IMAGE},{name:m["default"]("重装操作系统"),value:v["default"].NAME.REBUILD_OS}]}}},exports.getUIEvents=function(){var e=this;return{"table:command":function(t){d.call(e,t.name,t.args),t.stopPropagation(),t.preventDefault()},"table:select":function(t){h["default"].setButtonStatusOfTable(e,{startInstance:{rule:function(e){return!b["default"].checkIfShouldDisabled(v["default"].NAME.START_INSTANCE,e)}},configChange:{single:!0,rule:function(e){return!b["default"].checkIfShouldDisabled(v["default"].NAME.CONFIG_CHANGE,e)}},editTag:{rule:function(e){return!b["default"].checkIfShouldDisabled(v["default"].NAME.EDIT_TAG,e)}}}),h["default"].setSelectStatusOfTable(e,"moreOperation",{stopInstance:{rule:function(e){return!b["default"].checkIfShouldDisabled(v["default"].NAME.STOP_INSTANCE,e)}},rebootInstance:{rule:function(e){return!b["default"].checkIfShouldDisabled(v["default"].NAME.REBOOT_INSTANCE,e)}},deleteInstance:{rule:function(e){return!b["default"].checkIfShouldDisabled(v["default"].NAME.DELETE_INSTANCE,e)}},editName:{rule:function(e){return!b["default"].checkIfShouldDisabled(v["default"].NAME.EDIT_NAME,e)}},resetPassword:{rule:function(e){return!b["default"].checkIfShouldDisabled(v["default"].NAME.RESET_PASSWORD,e)}},joinSecurityGroups:{rule:function(e){return 1===p["default"].uniq(p["default"].pluck(t.target.getSelectedItems(),"vpcId")).length&&!b["default"].checkIfShouldDisabled(v["default"].NAME.JOIN_SECURITY_GROUPS,e)}},networkChange:{single:!0,rule:function(e){return!b["default"].checkIfShouldDisabled(v["default"].NAME.NETWORK_CHANGE,e)&&!e.eipGroupId}},createSnapshot:{single:!0,rule:function(e){return!b["default"].checkIfShouldDisabled(v["default"].NAME.CREATE_SNAPSHOT,e)}},createImage:{single:!0,rule:function(e){return!b["default"].checkIfShouldDisabled(v["default"].NAME.CREATE_IMAGE,e)}},rebuildOs:{single:!0,rule:function(e){return!b["default"].checkIfShouldDisabled(v["default"].NAME.REBUILD_OS,e)}}})},"table:saveedit":function(t){var a,i=(a={},a[t.field.field]=t.value,a),n={row:[t.rowIndex],toUpdate:i,data:e.model.get("tableData")[t.rowIndex]};d.call(e,"editName",n)},"table:change":u,"table:clipboard@aftercopy":function(t){e.showToast(m["default"]("已复制到剪贴板"))},"table:clipboard@error":function(e){e.originalTarget.hide()},"createInstance:click":function(t){d.call(e,"createInstance")},"keyword:enter":"submitSearch","searchBtn:click":"submitSearch","clearKeyword:click":function(t){e.get("keyword").setValue(""),e.submitSearch.call(e,t)},"refreshList:click":function(t){e.get("table").setProperties({selectedIndex:[]}),e.showRefreshLoading(),d.call(e,"refreshList")},"startInstance:click":function(t){var a=function(){var e=this.get("table"),t=[];return p["default"].each(e.getSelectedItems(),function(e){t.push(e.id)}),t}.call(e).join(",");d.call(e,"startInstance",{instanceId:a})},"moreOperation:change":function(e){var t=this.get("table").getSelectedItems();e.target.getValue()&&t.length>0&&d.call(this,e.target.getValue(),{data:t})},"downloadList:click":function(e){window.open(this.model.getDownloadUrl())},"table:filter":function(e){var t=this.get("table").fields[e.fieldIndex],a=this.model.get("filters")||[],i=p["default"].reject(a,function(e){return e[0]===t.field});i.push([t.field,e.value]),this.fire(o.events.FILTER,{condition:i})},"configChange:click":function(e){var t=this.get("table").getSelectedItems();d.call(this,v["default"].NAME.CONFIG_CHANGE,{data:t[0]})},"keywordType:change":function(e){var t=this.model.get("dccTags"),a=this.get("keyword"),i=[];if(t){var n=e.target.getSelectedItem(),s=n[0].name||n[0].text;if(n.length>1){var r=n[1].value;s="",r&&(s="标签值",i=t[r])}a.setProperties({placeholder:s?p["default"].sprintf(m["default"]("请输入%s进行搜索"),s):m["default"]("搜索无标签实例")})}a.setProperties({datasource:i})},"editTag:click":function(e){var t=this.get("table").getSelectedItems();this.fire(o.events.EDIT_TAG,t)}}};var p=t["default"](e),f=t["default"](a),m=t["default"](i),h=t["default"](n),g=(t["default"](s),t["default"](r)),v=t["default"](c),b=t["default"](l)}),define("dcc/instance/list/ui/tableFields",["exports","module","underscore","babel-runtime/helpers/interop-require-default","inf-i18n","common/util/timeUtil","common/zone","common/util","../../../config","../../../enums","../../operation","../../permission"],function(exports,module,e,t,a,i,n,s,r,o,c,l){var d=t["default"](e),u=t["default"](a),p=t["default"](i),f=t["default"](n),m=t["default"](s),h=t["default"](c),g=t["default"](l),v=m["default"].isSubUser();module.exports=[{field:"name",title:u["default"]("专属实例名称")+"/ID",width:"15%",minWidth:137,sortable:!0,content:function(e,t,a){var i=d["default"].escape(e.name),n="";if(e.instanceId=e.instanceId||e.id,e.instanceId)if(e.name){var s={commandArgs:{row:t,col:a,data:e}},o=d["default"].defaults({command:h["default"].NAME.EDIT_NAME,disabled:g["default"].checkIfShouldDisabled(h["default"].NAME.EDIT_NAME,e)},s),c="cce"===e.application?'<i class="iconfont icon-cce-node" title='+u["default"]("容器节点")+"></i>":"";n='\n                    <a href="#/dcc/instance/detail~instanceId='+e.id+"&id="+e.hostUuid+'"\n                        title="'+i+'" class="truncated">\n                        '+i+"\n                    </a>\n                    "+(e.scheduledSnapshot?'<i title="'+u["default"]("定时自动快照任务已启动")+'" class="iconfont icon-alarm-clock"></i>':"")+"\n                    "+r.html.operation.tableEdit(o)+'\n                    <br />\n                    <div>\n                        <span class="truncated" title="'+e.instanceId+'">'+e.instanceId+"</span>\n                        "+c+'\n                        <button data-ui-type="Clipboard"\n                            class="link-copy link-like"\n                            data-ui-clipboard-text="'+e.instanceId+'"\n                            data-ui-id="copyId'+t+'"\n                            data-ui-x-event-name="clipboard"\n                            data-ui-x-event-type="aftercopy,error"\n                            data-ui-x-event-bubble="true">\n                            <i class="iconfont icon-copy" title="'+u["default"]("复制到剪贴板")+'"></i>\n                        </button>\n                    </div>\n                '}else n='\n                    <div>\n                        <span class="truncated" title="'+e.instanceId+'">'+e.instanceId+'</span>\n                        <button data-ui-type="Clipboard"\n                            class="link-copy link-like"\n                            data-ui-clipboard-text="'+e.instanceId+'"\n                            data-ui-id="copyId'+t+'"\n                            data-ui-x-event-name="clipboard"\n                            data-ui-x-event-type="aftercopy,error"\n                            data-ui-x-event-bubble="true">\n                            <i class="iconfont icon-copy" title="'+u["default"]("复制到剪贴板")+'"></i>\n                        </button>\n                    </div>\n                ';else n='<span class="truncated">'+i+"</span>";return n},editContent:function(e){return d["default"].escape(e.name)},editNote:r.rule.INSTANCE.NAME.placeholder,editRules:d["default"].omit(r.rule.INSTANCE.NAME,"placeholder")},{field:"status",title:u["default"]("状态"),width:"9%",minWidth:75,filter:{datasource:o.InstanceStatus.getFilterStatus()},content:function(e){var t=o.InstanceStatus.getTextFromValue(e.status);return'\n                <span class=" status '+o.InstanceStatus.fromValue(e.status).kclass+'">\n                    '+t+"\n                </span>\n            "}},{field:"createTime",title:u["default"]("创建时间"),width:"11%",minWidth:95,sortable:!0,content:function(e){return p["default"].toDate(e.createTime)||"-"}},{field:"host",title:u["default"]("专属服务器"),width:"12%",content:function(e,t,a){var i=d["default"].escape(e.hostName),n="";return n=null==e.hostId||v?"-":'\n                    <a href="#/dcc/host/detail~id='+(e.hostUuid||e.hostId)+'"\n                        title="'+i+'" class="truncated">\n                        '+i+"\n                    </a>\n                ",n}},{field:"publicIp",title:u["default"]("公网IP/带宽"),width:"12%",content:function(e,t,a){var i=e.publicIp?e.publicIp:"-",n=e.network?e.network+"Mbps":"-",s={command:h["default"].NAME.BIND_EIP,commandArgs:{row:t,col:a,data:e},label:'<i class="iconfont icon-bind"></i>',title:u["default"]("绑定EIP"),disabled:g["default"].checkIfShouldDisabled(h["default"].NAME.BIND_EIP,e)},o={command:h["default"].NAME.UNBIND_EIP,commandArgs:{row:t,col:a,data:e},label:'<i class="iconfont icon-unbind"></i>',title:u["default"]("解绑EIP"),disabled:g["default"].checkIfShouldDisabled(h["default"].NAME.UNBIND_EIP,e)},c=' <span data-ui-type="Tip"\n                    data-ui-id="eipTip'+t+'"\n                    data-ui-skin="warning"\n                    data-ui-arrow="true"\n                    data-ui-content=\'NAT专属子网无法绑定EIP\'></span>';return"BCC_NAT"===e.subnetType?"-/"+n+c:"\n                "+(e.publicIp?i+"/"+n+r.html.operation.linkButton(o):i+"/"+n+r.html.operation.linkButton(s))+"\n            "}},{field:"internalIp",title:u["default"]("内网IP"),width:"12%",content:function(e,t,a){return e.internalIp}},{field:"configuration",title:u["default"]("CPU/内存/本地磁盘"),width:"12%",minWidth:110,content:function(e,t,a){return"\n                "+e.cpu+u["default"]("核")+" /\n                "+e.memory+"GB /\n                "+e.diskSize+(e.flavorType===o.FlavorType.STORAGE?u["default"]("块"):"GB")+"\n            "}},{field:"os",title:"OS",width:"8%",minWidth:35,content:function(e,t,a){var i=d["default"].escape(e.osName||e.osType),n=i+d["default"].escape(e.osVersion),s=i.toLowerCase().replace(/\s/g,"-");return d["default"].contains(r.dcc.instance.OS_IMAGE_NAME,s)?'\n                <div class="sys-icon '+s+'" title="'+n+'">\n\n                </div>\n            ':"-"}},{field:"vpc",title:u["default"]("所在网络"),width:"8%",content:function(e){return m["default"].getVpcName(e.vpcName)}},{field:"subnet",title:u["default"]("所在子网"),width:"8%",content:function(e){return m["default"].getSubnetName(e.subnetName)}},{field:"logicalZone",title:u["default"]("所在可用区"),minWidth:"80",width:"8%",content:function(e){return f["default"].getLabel(e.logicalZone)}},{field:"tag",title:u["default"]("标签"),sortable:!0,width:"9%",content:function(e,t,a){if(!e.tags||e.tags.length<1)return"-";var i="",n="";return d["default"].each(e.tags,function(e,t){n+="{"+e.tagKey+" : "+e.tagValue+"} ",t<2&&(i+=e.tagKey+" : "+e.tagValue+"<br/>")}),e.tags.length>2&&(i+="..."),'\n                <div title="'+n+'">\n                    '+i+"\n                </div>\n            "}},{field:"application",title:u["default"]("关联服务"),content:function(e){if(e.application){var t=e.application.toUpperCase(),a=e[e.application+"Uuid"],i="";return"RDS"===t&&(i="/rds/#/rds/detail~rdsType=dcc&instanceId="+a),a?t+":"+(i?'<a href="'+i+'">'+d["default"].escape(e.rdsId)+"</a>":a):t}return"-"}},{field:"operation",title:u["default"]("操作"),width:"8%",minWidth:60,content:function(e,t,a){var i={commandArgs:{row:t,col:a,data:e}},n=d["default"].defaults({command:h["default"].NAME.GET_VNC_URL,label:u["default"]("VNC远程"),title:u["default"]("VNC远程"),disabled:g["default"].checkIfShouldDisabled(h["default"].NAME.GET_VNC_URL,e)},i);return"\n                "+r.html.operation.linkButton(n)+"\n            "}}]}),define("dcc/instance/list/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/tpl!../../common.tpl","bat-ria/mvc/ListView","babel-runtime/helpers/interop-require-default","jquery","underscore","inf-i18n","bat-ria/tpl!./tpl","esui/Button","inf-ria/ui/Clipboard","common/util/tableUtil","./ui","./ui/tableFields","dcc/config"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u,p,f,m){var h=n["default"](i),g=n["default"](s),v=n["default"](r),b=n["default"](o),y=n["default"](u),T=n["default"](f),x=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_instance_list"}return e["default"](i,a),i.prototype.getUIProperties=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return p.getUIProperties.apply(this,t)},i.prototype.getUIEvents=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return p.getUIEvents.apply(this,t)},i.prototype.bindEvents=function(){a.prototype.bindEvents.call(this);var e=this;g["default"](".quick-search-filters").on("click","li",function(t){g["default"](this).toggleClass("actived");var a=e.model.get("filters")||[],i=v["default"].reject(a,function(e){return"expiredDate<7"===e.join("")});g["default"](".quick-search-filters li").each(function(e,t){var a=g["default"](t);if(a.hasClass("actived")){var n=a.data();i.push([n.key,n.op,n.value])}}),e.fire(m.events.FILTER,{condition:i})})},i.prototype.enterDocument=function(){this.setTableFilterValue(),a.prototype.enterDocument.call(this)},i.prototype.setTableFilterValue=function(){var e=this.model.get("filters");e&&e.length>0?v["default"].each(T["default"],function(t){t.filter&&v["default"].each(e,function(e){e[0]===t.field&&(t.filter.value=e[1])})}):v["default"].each(T["default"],function(e){e.filter&&(e.filter.value=null)})},i.prototype.backward=function(){this.fire(m.events.BACKWARD)},i.prototype.showTableLoading=function(){this.get("table").addState("loading")},i.prototype.hideTableLoading=function(){this.get("table").removeState("loading")},i.prototype.showTableLoadingError=function(){this.hideTableLoading(),this.get("table").setProperties({noDataHtml:"<div><p>列表数据加载异常，请刷新页面！</p></div>",datasource:[]})},i.prototype.renderTable=function(){var e=this.model.get("tableData"),t=this.get("table"),a={datasource:e};this.shouldKeepSelectedIndex||(a.selectedIndex=[]),t.setProperties(a)},i.prototype.renderPager=function(){this.get("pager").setProperties({count:this.model.get("totalCount"),page:this.model.get("pageNo")})},i.prototype.getSearchArgs=function(){var e=y["default"].getSearchArgs.call(this),t=this.model.get("filters"),a=this.get("keywordType");if(a){var i=a.getSelectedItem();e.keywordType=a.getValue(),e.subKeywordType=i[1]&&i[1].value}return t&&t.length>0&&(e.filters=JSON.stringify(t)),e},i.prototype.showRefreshLoading=function(){this.get("refreshList").setProperties({content:'<span class="loading">'+b["default"]("刷新中...")+"</span>",disable:!0})},i.prototype.hideRefreshLoading=function(){this.get("refreshList").setProperties({content:'<i class="iconfont icon-cdnrefresh"></i>',disable:!1})},i.prototype.resetMoreOperation=function(){var e=this.get("moreOperation");e.get("selectedIndex")>-1&&e.setProperties({selectedIndex:-1})},i.prototype.updateKeywordType=function(){var e=this.model.get("keywordTypeDatasource"),t=this.model.get("dccTags"),a=this.model.get("keywordType"),i=v["default"].map(v["default"].keys(t),function(e){return{name:e,value:e}});e.push({name:b["default"]("标签"),value:"tag",children:i}),this.get("keywordType").setProperties({datasource:e,hasChildList:!0,joinStr:"/",value:a})},i}(h["default"]);module.exports=x}),define("dcc/instance/monitor/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","../../../bcc/instance/Monitor","babel-runtime/helpers/interop-require-default","./Model","./View"],function(exports,module,e,t,a,i,n,s){var r=i["default"](a),o=i["default"](n),c=i["default"](s),l=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=o["default"],this.viewType=c["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this)},i}(r["default"]);module.exports=l}),define("dcc/instance/monitor/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","../../../bcc/instance/MonitorModel","../../enums"],function(exports,module,e,t,a,i,n,s,r){var o=n["default"](i),c=function(i){function n(e){a["default"](this,n),i.call(this,e)}return e["default"](n,i),n.prototype.prepare=function(){i.prototype.prepare.call(this),this.updateViewData()},n.prototype.updateViewData=function(){var e=this.get("instance"),t=o["default"].deepClone(e);t.status={text:r.InstanceStatus.getTextFromValue(e.status),className:r.InstanceStatus.fromValue(e.status).kclass},this.set("viewData",t)},t["default"](n,[{key:"datasource",get:function(){return o["default"].extend({},i.prototype.datasource)}}]),n}(n["default"](s)["default"]);module.exports=c}),define("dcc/instance/monitor/tpl",[],function(){return'\x3c!-- target: TPL_dcc_instance_monitor(master = TPL_dcc_instance_detail_structure) --\x3e\n\n\x3c!-- block: detail-breadcrumb --\x3e\n\x3c!-- use: TPL_dcc_breadcrumb(fatherUrl=\'#/dcc/instance/list\', fatherPage=\'专属服务器 - 实例列表\', currentPage=\'监控\') --\x3e\n\x3c!-- /block --\x3e\n\n\x3c!-- block: abstrct-info --\x3e\n<h1 title="${viewData.name}">${viewData.name}</h1>\n<span class="status ${viewData.status.className}">\n    ${viewData.status.text}\n</span>\n\x3c!-- /block --\x3e\n\n\x3c!-- block: detail-navigator --\x3e\n    \x3c!-- import: TPL_dcc_instance_detail_navigator --\x3e\n\x3c!-- /block --\x3e\n\n\x3c!-- block: detail-info --\x3e\n<div class="dcc-instance-monitor monitor">\n    <h2 class="detail-parts-title"><em>监控信息</em>\n    <div data-ui-type="Tip"\n        data-ui-content="如需查看内存和磁盘空间的监控信息，请安装<a href=\'http://bce.baidu.com/doc/BCM/BCM-Agent.html\' target=\'_blank\'>BCM-Agent</a>"\n        data-ui-skin="warning"></div>\n    </h2>\n    \x3c!-- import: TPL_alarm_state_summary --\x3e\n    \x3c!-- use: monitor_trend_search(type="monitor") --\x3e\n    <div class="monitor-trends">\n        \x3c!-- for: ${monitorMetric} as ${chartMetric}, ${chart} --\x3e\n        <div class="monitor-trend-box">\n            <div class="monitor-trend-wrap" >\n                <div data-ui-type="BcmChart"\n                     data-ui-extension-showbig-type="BcmChartShowBigView"\n                     data-ui-group="chart"\n                     data-ui-title="${chartMetric.name}"\n                     data-ui-showbigable="show"\n                     data-ui-big-view-location="/common/bcm/monitorChart"\n                     data-ui-height="200"\n                     data-ui-api-type="metricName"\n                     data-ui-scope="BCE_BCC"\n                     data-ui-dimensions="${dimensions}"\n                     data-ui-metrics="${chartMetric.metricString}"\n                     data-ui-statistics="${chartMetric.statistics}"\n                     data-ui-period="60"\n                     data-ui-time="1h"\n                     data-ui-requester="@api.bcmMetricDataMetricName"\n                     data-ui-no-data="暂无数据<p style=\'font-size:12px;color:#aaa;\'>请检查是否安装了BCM客户端</p>"\n                     data-ui-unit="${chartMetric.unit}"\n                        ></div>\n            </div>\n        </div>\n        \x3c!-- /for --\x3e\n    </div>\n\n    <h2 class="detail-parts-title"><em>扩展监控项</em>\n        <div data-ui-type="Tip"\n            data-ui-content="查看扩展监控项需要安装<a href=\'http://bce.baidu.com/doc/BCM/BCM-Agent.html\' target=\'_blank\'>BCM-Agent</a>"\n            data-ui-skin="warning"></div>\n    </h2>\n    <esui-tab data-ui-id="tab" class="ui-smart-tab extra-tab">\n        <ul data-role="navigator">\n            \x3c!-- for: ${extraMetric} as ${category}, ${index} --\x3e\n            <li data-for="tab${index}">${category.title}</li>\n            \x3c!-- /for --\x3e\n        </ul>\n        \x3c!-- for: ${extraMetric} as ${category}, ${index} --\x3e\n        <div id="tab${index}" class="ui-tab-content">\n            \x3c!-- for: ${category.items} as ${item} --\x3e\n            <input data-ui-type="CheckBox"\n                   data-ui-group="extraMetricCheckbox"\n                   name="${category.title}"\n                   value="${item.value}"\n                   title="${item.name}"/>\n            \x3c!-- /for --\x3e\n        </div>\n        \x3c!-- /for --\x3e\n    </esui-tab>\n    \x3c!-- use: monitor_trend_search(type="extraMonitor") --\x3e\n    <div data-ui-type="Panel" data-ui-id="extraChartList" class="monitor-trends"></div>\n</div>\n\x3c!-- /block --\x3e\n\n'}),define("dcc/instance/monitor/ui",["exports"],function(exports){exports.__esModule=!0,exports.getUIProperties=function(){return{}},exports.getUIEvents=function(){return{}}}),define("dcc/instance/monitor/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/tpl!./tpl","underscore","babel-runtime/helpers/interop-require-default","../../../bcc/instance/MonitorView","./ui"],function(exports,module,e,t,a,i,n,s,r){var o=n["default"](i),c=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_instance_monitor"}return e["default"](i,a),i.prototype.getUIProperties=function(){var e=a.prototype.getUIProperties.call(this);return o["default"].extend({},e,r.getUIProperties.apply(this))},i.prototype.getUIEvents=function(){var e=a.prototype.getUIEvents.call(this);return o["default"].extend({},e,r.getUIEvents.apply(this))},i}(n["default"](s)["default"]);module.exports=c}),define("dcc/instance/operation",["exports","module","promise","babel-runtime/helpers/interop-require-default","er/URL","inf-ria/helper","inf-ria/app/brpc","inf-i18n","underscore","common/region","common/util/dialog","../config","../util"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d){var u=t["default"](e),p=t["default"](a),f=t["default"](i),m=t["default"](n),h=t["default"](s),g=t["default"](r),v=t["default"](o),b=t["default"](c);module.exports={NAME:{EDIT_NAME:"editName",CREATE_INSTANCE:"createInstance",REFRESH_LIST:"refreshList",CONFIG_CHANGE:"configChange",NETWORK_CHANGE:"networkChange",DELETE_INSTANCE:"deleteInstance",REBUILD_OS:"rebuildOs",GET_VNC_URL:"getVncUrl",STOP_INSTANCE:"stopInstance",RESET_PASSWORD:"resetPassword",JOIN_SECURITY_GROUPS:"joinSecurityGroups",REBOOT_INSTANCE:"rebootInstance",START_INSTANCE:"startInstance",BIND_EIP:"bindEip",UNBIND_EIP:"unbindEip",BUY_SAME_CONFIG:"buySameConfig",CREATE_SNAPSHOT:"createSnapshot",CREATE_AUTO_SNAPSHOT:"createAutoSnapshot",CREATE_IMAGE:"createImage",EDIT_DESC:"editDesc",EDIT_TAG:"editTag",CHANGE_SUBNET:"changeSubnet"},processor:{createInstance:function(){return this.redirect("/dcc/instance/create"),u["default"].resolve()},refreshList:function(){var e=this;return new u["default"](function(t,a){e.model.loadListData({silent:!0}).then(function(){return e.view.hideRefreshLoading()}).then(t,a)})},startInstance:function(e){return d.confirmHandler.call(this,{title:h["default"]("启动"),content:h["default"]("确定启动吗？"),width:280},l.api.startInstance,e)},stopInstance:function(e){return d.confirmHandler.call(this,{title:h["default"]("停止"),content:h["default"]("停止实例后相关服务将不可访问，确定停止吗？"),width:420},l.api.stopInstance,e)},rebootInstance:function(e){return d.confirmHandler.call(this,{title:h["default"]("重启"),content:h["default"]("重启过程中相关服务会中断，确定重启吗？"),width:400},l.api.rebootInstance,e)},editName:function(e){var t=e.row,a=e.toUpdate,i=e.data;return this.model.editName(a.name,i.id,t)},editDesc:function(e){var t=e.toUpdate,a=e.data;return this.model.editDesc(t.desc,a.id)},batchEditName:function(e){var t=this;return b["default"].waitActionDialog(this.view,{title:h["default"]("批量修改实例名称"),width:540,needFoot:!0,url:"/dcc/instance/operation/changeName",actionOptions:{instances:e,parentAction:this}}).then(function(e){var a=e.target;a.on("cancel",function(){return t.view.resetMoreOperation&&t.view.resetMoreOperation()}),a.on("close",function(){return t.view.resetMoreOperation&&t.view.resetMoreOperation()})})},resetPassword:function(e){var t=this;return b["default"].waitActionDialog(this.view,{title:h["default"]("重置密码"),width:600,needFoot:!0,url:"/dcc/instance/operation/changePwd",actionOptions:{extraData:e,parentAction:this}}).then(function(e){var a=e.target;t.dialog=a;a.getAction().view.get("form").on("aftervalidate",function(e){e.isValid&&a.hide()}),a.on("cancel",function(){return t.view.resetMoreOperation&&t.view.resetMoreOperation()}),a.on("close",function(){return t.view.resetMoreOperation&&t.view.resetMoreOperation()})})},joinSecurityGroups:function(e){var t=this;return b["default"].waitActionDialog(this.view,{title:h["default"]("关联安全组"),width:600,needFoot:!0,url:"/dcc/instance/operation/joinSecurityGroups",actionOptions:{instances:e,parentAction:this}}).then(function(e){var a=e.target;a.on("cancel",function(){return t.view.resetMoreOperation&&t.view.resetMoreOperation()}),a.on("close",function(){return t.view.resetMoreOperation&&t.view.resetMoreOperation()})})},createSnapshot:function(e){var t=this;return b["default"].waitActionDialog(this.view,{title:h["default"]("创建快照"),width:620,needFoot:!0,url:"/dcc/instance/operation/createSnapshot",actionOptions:{id:e.id,instanceId:e.instanceId,parentAction:this}}).then(function(e){var a=e.target;a.on("cancel",function(){return t.view.resetMoreOperation&&t.view.resetMoreOperation()}),a.on("close",function(){return t.view.resetMoreOperation&&t.view.resetMoreOperation()})})},createAutoSnapshot:function(e){var t=this;return b["default"].waitActionDialog(this.view,{title:h["default"]("设置本实例磁盘自动快照策略"),width:540,needFoot:!0,url:"/bcc/instance/auto_snapshot",actionOptions:{serviceType:"DCC",instanceId:e.id,parentAction:this}}).then(function(e){var a=e.target;a.on("cancel",function(){return t.view.resetMoreOperation&&t.view.resetMoreOperation()}),a.on("close",function(){return t.view.resetMoreOperation&&t.view.resetMoreOperation()})})},createImage:function(e){var t=this;return b["default"].waitActionDialog(this.view,{title:h["default"]("创建自定义镜像"),width:620,needFoot:!0,url:"/dcc/instance/operation/createImage",actionOptions:{id:e.id,instanceId:e.instanceId,parentAction:this}}).then(function(e){var a=e.target;a.on("cancel",function(){return t.view.resetMoreOperation&&t.view.resetMoreOperation()}),a.on("close",function(){return t.view.resetMoreOperation&&t.view.resetMoreOperation()})})},configChange:function(e){var t=e.hostUuid,a=e.instanceId;return this.redirect(p["default"].withQuery("/dcc/instance/configChange",{hostId:t,instanceId:a})),u["default"].resolve()},networkChange:function(e){var t=e.publicIp;return f["default"].redirectToModule("eip","/eip/instance/upgrade_config",{ip:t}),u["default"].resolve()},unbindEip:function(e){return d.confirmHandler.call(this,{title:"提示",content:"您确定解绑"+e.publicIp+"吗？",width:320},l.api.unbindEipInstance,{eip:e.publicIp})},bindEip:function(e){var t=this,a={instanceType:"DCC",instancePayment:e.payment,instanceId:e.id,listRequester:l.api.eipInstanceList,submitRequester:l.api.bindEipInstance};return m["default"].invokeService("eip://bind",a).then(function(){return t.reload()})},deleteInstance:function(e){var t=this,a={hostId:"",instanceIds:g["default"].pluck(e,"id")};return b["default"].waitActionDialog(this.view,{title:h["default"]("删除专属实例"),width:600,needFoot:!0,url:"/dcc/operation/smsVerify",actionOptions:{extraData:a,requester:l.api.deleteInstance,tip:l.tips.authCode.instance,serviceType:"DCC",instances:e,parentAction:this}}).then(function(e){var a=e.target;a.getFoot().getChild("btnOk").on("click",function(e){a.getAction().view.fire("submit"),a.hide()}),a.on("cancel",function(){return t.view.resetMoreOperation&&t.view.resetMoreOperation()}),a.on("close",function(){return t.view.resetMoreOperation&&t.view.resetMoreOperation()})})},rebuildOs:function(e){var t=this;return b["default"].waitActionDialog(this.view,{title:h["default"]("重装操作系统"),width:600,needFoot:!1,url:"/dcc/instance/operation/rebuildOs",actionOptions:{instance:e,parentAction:this}}).then(function(e){var a=e.target;t.dialog=a;a.getAction().view.get("form").on("aftervalidate",function(e){e.isValid&&a.hide()}),a.on("close",function(){return t.view.resetMoreOperation&&t.view.resetMoreOperation()})})},getVncUrl:function(e){var t=require.toUrl("bcc/vnc/relay.html"),a=p["default"].serialize({instanceId:e.id,type:"novnc",instanceName:e.name,region:v["default"].getCurrentRegion().id});return-1!==t.indexOf("?")?t+="&"+a:t+="?"+a,location.search&&(t+="&"+location.search.substr(1)),window.open(t),u["default"].resolve()},buySameConfig:function(e){return this.redirect("/dcc/instance/create~instanceId="+e.id),u["default"].resolve()}}}}),define("dcc/instance/operation/changeName/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormAction","babel-runtime/helpers/interop-require-default","./Model","./View"],function(exports,module,e,t,a,i,n,s){var r=i["default"](a),o=i["default"](n),c=i["default"](s),l=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=o["default"],this.viewType=c["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this)},i.prototype.redirectAfterSubmit=function(){var e=this.model.get("parentAction");e&&(e.redirectAfterChangeName&&e.redirectAfterChangeName()||e.reload())},i}(r["default"]);module.exports=l}),define("dcc/instance/operation/changeName/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","bat-ria/mvc/FormModel","../../../config"],function(exports,module,e,t,a,i,n,s,r){var o=n["default"](i),c=function(i){function n(e){a["default"](this,n),i.call(this,e),this.submitRequester=r.api.editInstanceName}return e["default"](n,i),n.prototype.prepare=function(){this.set("instanceIds",o["default"].pluck(this.get("instances"),"id")),this.set("instanceNames",o["default"].pluck(this.get("instances"),"name"))},n.prototype.getExtraData=function(){return{instanceIds:(this.get("instanceIds")||[]).join(",")}},t["default"](n,[{key:"datasource",get:function(){return{}}}]),n}(n["default"](s)["default"]);module.exports=c}),define("dcc/instance/operation/changeName/tpl",[],function(){return'\x3c!-- target: TPL_dcc_instance_changeName --\x3e\n<div class="dcc-dialog-form change-name-dialog-form">\n    <form data-ui-type="Form" data-ui-id="form"\n        data-ui-auto-validate="true">\n        <div class="form-data-body">\n            <div class="form-row">\n                <label>${i18n.您选择的实例：}</label>\n                <ul class="form-value">\n                    \x3c!-- for: ${instanceNames} as ${instanceName} --\x3e\n                    <li class="instance-name nowrap-text" title="${instanceName}">${instanceName}</li>\n                    \x3c!-- /for --\x3e\n                </ul>\n            </div>\n            <div class="form-row">\n                <label>${i18n.实例名称前缀：}</label>\n                <div class="form-value">\n                    <input data-ui-validity-label="nameValidity"\n                        data-ui-required="required"\n                        data-ui-required-error-message="实例名称前缀必填"\n                        data-ui-type="TextBox"\n                        data-ui-id="name"\n                        data-ui-name="name"\n                        data-ui-width="350" >\n                    <label data-ui-type="Validity"\n                        data-ui-id="nameValidity"></label>\n                </div>\n            </div>\n        </div>\n    </form>\n</div>\n\n\x3c!-- target: TPL_dcc_instance_changeName_child --\x3e\n\x3c!-- import: TPL_dcc_instance_changeName --\x3e\n'}),define("dcc/instance/operation/changeName/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormView","babel-runtime/helpers/interop-require-default","../../../config","bat-ria/tpl!./tpl"],function(exports,module,e,t,a,i,n,s){var r=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_instance_changeName"}return e["default"](i,a),i.prototype.getUIProperties=function(){return{name:n.rule.INSTANCE.NAME}},i}(i["default"](a)["default"]);module.exports=r}),define("dcc/instance/operation/changePwd/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormAction","babel-runtime/helpers/interop-require-default","./Model","./View"],function(exports,module,e,t,a,i,n,s){var r=i["default"](a),o=i["default"](n),c=i["default"](s),l=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=o["default"],this.viewType=c["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this)},i.prototype.submit=function(e){var t=this;return this.view.waitConfirm({title:"重置密码温馨提示",content:"重启您的专属实例，并重置密码？"}).then(function(){return a.prototype.submit.call(t,e)})},i.prototype.handleSubmitError=function(e){var t=this.model.get("parentAction");t&&t.dialog&&t.dialog.show(),e.field&&e.field.mfa||this.view.showToast(e&&e.global?e.global:"操作失败",{messageType:"error"})},i.prototype.redirectAfterSubmit=function(){var e=this.model.get("parentAction");e&&(e.redirectAfterChangePwd&&e.redirectAfterChangePwd()||e.reload())},i}(r["default"]);module.exports=l}),define("dcc/instance/operation/changePwd/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormModel","babel-runtime/helpers/interop-require-default","../../../config","../../../helper"],function(exports,module,e,t,a,i,n,s,r){var o=n["default"](i),c=n["default"](r),l={silent:!0},d=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.submitRequester=function(e){return s.api.changeInstancePwd(e,l)},n.prototype.getExtraData=function(){return s.flags.enable_baixin?{authCode:"123456",instanceIds:(this.get("extraData").instanceUuids||[]).join(",")}:{instanceIds:(this.get("extraData").instanceUuids||[]).join(",")}},n.prototype.validateSubmitData=function(e){var t=!!e._isPasswordMatch||{confirm:"确认密码和新密码不一致"};return e._isPasswordMatch=undefined,t},n.prototype.filterData=function(e){return e._isPasswordMatch=e.password===e.confirm,s.flags.enable_rsa_encrypt&&e.password&&e.confirm&&(e.password=c["default"].rsaEncrypt(e.password),e.confirm=e.password),e},t["default"](n,[{key:"datasource",get:function(){return{}}}]),n}(o["default"]);module.exports=d}),define("dcc/instance/operation/changePwd/tpl",[],function(){return'\x3c!-- target: TPL_dcc_instance_changePwd --\x3e\n<div class="dcc-dialog-form dcc-change-password-dialog-form">\n    <form data-ui-type="Form" data-ui-id="form"\n        data-ui-auto-validate="true">\n        <div class="form-data-body">\n            <div class="form-row">\n                <div class="operation-tip">\n                    \x3c!-- if: ${extraData.isActive} --\x3e\n                    ${i18n.温馨提示：重置密码会重启服务器，导致服务器停止几分钟，为保证你的服务不受影响，请在确认执行此操作前做好预案准备。}\n                    \x3c!-- else --\x3e\n                    ${i18n.温馨提示：重置的新密码在控制台重新启动服务器后才能生效。}\n                    \x3c!-- /if --\x3e\n                </div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.实例ID：}</label>\n                <div class="form-value form-nowrap-text">${extraData.instanceIds}</div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.管理员用户名：}</label>\n                <div class="form-value form-nowrap-text">${i18n.linux系统为root，windows系统为Administrator}</div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.管理员新密码：}</label>\n                <div class="form-value">\n                    <input type="password"\n                        data-ui-custom-error-message="${i18n.密码不符合规则}"\n                        data-ui-required="required"\n                        data-ui-required-error-message="${i18n.新密码必填}"\n                        data-ui-type="TextBox"\n                        data-ui-id="password"\n                        data-ui-name="password"\n                        data-ui-width="320" >\n                    <br>\n                    <label data-ui-type="Validity"\n                        data-ui-id="passwordValidity" ></label>\n                    <div data-ui="type:Label;id:passwordTip;" class="password-tip"></div>\n                </div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.确认密码：}</label>\n                <div class="form-value">\n                    <input type="password"\n                        data-ui-type="TextBox"\n                        data-ui-required="required"\n                        data-ui-required-error-message="${i18n.确认密码必填}"\n                        data-ui-id="confirm"\n                        data-ui-name="confirm"\n                        data-ui-width="320" >\n                    <br />\n                    <label data-ui-type="Validity"\n                        data-ui-id="confirmValidity" ></label>\n                </div>\n            </div>\n        </div>\n    </form>\n</div>\n\n\x3c!-- target: TPL_dcc_instance_changePwd_child --\x3e\n\x3c!-- import: TPL_dcc_instance_changePwd --\x3e\n'}),define("dcc/instance/operation/changePwd/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormView","babel-runtime/helpers/interop-require-default","../../../config","bat-ria/tpl!./tpl"],function(exports,module,e,t,a,i,n,s){var r=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_instance_changePwd"}return e["default"](i,a),i.prototype.getUIProperties=function(){return{password:{custom:function(e){return n.rule.INSTANCE.PASSWORD.custom(e)},validityLabel:"passwordValidity"},confirm:{custom:function(e){return this.viewContext.controls.password.getValue()===this.getValue()},customErrorMessage:"确认密码和新密码不一致",validityLabel:"confirmValidity"},passwordTip:{text:n.rule.INSTANCE.PASSWORD.customErrorMessage}}},i.prototype.getUIEvents=function(){return{"password:input":function(e){e.target.validate()},"confirm:input":function(e){this.get("password").getValue()!==e.target.getValue()?this.notifyErrors({confirm:"确认密码和新密码不一致"}):e.target.hideValidity()},"authCode:action":function(e){this.fire("SEND_AUTH_CODE")}}},i}(i["default"](a)["default"]);module.exports=r}),define("dcc/instance/operation/configChange/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormAction","babel-runtime/helpers/interop-require-default","./Model","./View"],function(exports,module,e,t,a,i,n,s){var r=i["default"](a),o=i["default"](n),c=i["default"](s),l=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=o["default"],this.viewType=c["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.view.on("submitConfig",this.submitConfig,this)},i.prototype.syncModelToViewIterator=function(e){switch(e.name){case"loading":this.view.repaint()}},i.prototype.submitConfig=function(e){var t=this;this.view.waitConfirm({title:"调整配置温馨提示",content:"亲爱的用户，为生效您调整的CPU、内存及本地磁盘配置，您的专属实例将会重启，请确认本次操作。"}).then(function(){return t.submitEdit()})},i}(r["default"]);module.exports=l}),define("dcc/instance/operation/configChange/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","moment","promise","bat-ria/mvc/FormModel","../../../config"],function(exports,module,e,t,a,i,n,s,r,o,c){var l=n["default"](i),d=n["default"](s),u=n["default"](r),p={silent:!0},f={showLoading:!1,"X-silence":!0},m=function(i){function n(e){a["default"](this,n),i.call(this,e),this.submitRequester=c.api.configChangeInstance}return e["default"](n,i),n.prototype.prepare=function(){var e=this;this.set("loading",!0),u["default"].all([this.loadHostList(p),this.loadInstanceList(p)]).then(function(){var t=e.get("hostId");return t&&"undefined"!==t?u["default"].resolve():(e.set("hostId",e.get("instance").hostId),e.loadHostList(p))}).then(function(){e.set("loading",!1)})},n.prototype.loadHostList=function(e){var t=this,a=this.get("hostId");return a&&"undefined"!==a?c.api.getDccHostDetail({id:a},f).then(function(a){t.set("host",a,e)}):u["default"].resolve()},n.prototype.loadInstanceList=function(e){var t=this,a=this.get("instanceId");return c.api.getDccInstanceDetail({instanceId:a},f).then(function(a){a.expireTimeDesc=d["default"](a.expireTime).format("YYYY-MM-DD hh:mm:ss"),a.paymentText=c.lang.PAYMENT[a.payment],t.set("instance",a,e)})},n.prototype.getExtraData=function(){return{instanceId:this.get("instance").id}},t["default"](n,[{key:"datasource",get:function(){return{loading:l["default"].constant(!0)}}}]),n}(n["default"](o)["default"]);module.exports=m}),define("dcc/instance/operation/configChange/tpl",[],function(){return'\x3c!-- target: TPL_dcc_instance_upgradeconfig --\x3e\n<div class="dcc-instance-upgradeconfig dcc-main-1col main-wrap-new dcc-main-wrap">\n    <div class="content-wrap">\n        <p class="breadcrumb">\n            <span>${i18n.产品服务}</span>\n            <span class="divider">/</span>\n            <a href="#/dcc/instance/list">${i18n.专属服务器} - ${i18n.实例列表}</a>\n            <span class="divider">/</span>\n            <span class="active">${i18n.调整配置}</span>\n        </p>\n        <div class="create-content">\n            <div class="ui-tab-navigator">\n                <h1>${i18n.调整配置}</h1>\n            </div>\n            <div class="create-main ui-tab-content">\n                <form class="setting-form"\n                    data-ui-type="Form"\n                    data-ui-id="form"\n                    data-ui-submit-button="toBuy"\n                    data-ui-auto-validate="true">\n                    <div class="detail-parts-table">\n                        \x3c!-- if: ${loading} --\x3e\n                        <div id="dcc-instance-create-loading">\n                            <span class="loading">${i18n.数据加载中，请稍候……}</span>\n                        </div>\n                        \x3c!-- else --\x3e\n                        <dl class="detail-part-1-col">\n                            <dt><h4>${i18n.当前配置}</h4></dt>\n                            <dd>\n                                <div class="detail-cell">\n                                    <label>${i18n.实例名称：}</label>\n                                    <span class="nowrap-text" title="${instance.name}">${instance.name}</span>\n                                </div>\n                                <div class="detail-cell">\n                                    <label>CPU：</label>\n                                    <span>${instance.cpu}${i18n.核}</span>\n                                </div>\n                                <div class="detail-cell">\n                                    <label>${i18n.公网IP：}</label>\n                                    <span>\n                                        \x3c!-- if: ${instance.publicIp} --\x3e\n                                        ${instance.publicIp|defaultValue}\n                                    ${i18n.带宽：}（${instance.network}Mbps）\n                                        \x3c!-- else --\x3e\n                                        ${i18n.未分配}\n                                        \x3c!-- /if --\x3e\n                                    </span>\n                                </div>\n                            </dd>\n                            <dd>\n                                <div class="detail-cell">\n                                    <label>${i18n.实例ID：}</label>\n                                    <span class="nowrap-text" title="${instance.instanceId}">${instance.instanceId}</span>\n                                </div>\n                                <div class="detail-cell">\n                                    <label>${i18n.内存：}</label>\n                                    <span>${instance.memory}GB</span>\n                                </div>\n                                <div class="detail-cell">\n                                    <label>${i18n.内网IP：}</label>\n                                    <span>${instance.internalIp|defaultValue}</span>\n                                </div>\n                            </dd>\n                            <dd>\n                                <div class="detail-cell">\n                                    <label>${i18n.操作系统：}</label>\n                                    <span>${instance.osName || instance.osType}/${instance.osVersion}</span>\n                                </div>\n                                <div class="detail-cell">\n                                    <label>${i18n.本地磁盘：}</label>\n                                    <span>\n                                    \x3c!-- if: ${instance.flavorType} === \'calculation\' --\x3e\n                                    ${instance.diskSize}GB\n                                    \x3c!-- else: --\x3e\n                                    ${instance.diskSize}${i18n.块}\n                                    \x3c!-- /if --\x3e\n                                    </span>\n                                </div>\n                                <div class="detail-cell">\n                                    \x3c!-- <label>宽带计费方式：</label>\n                                    <span>${instance.paymentText}</span> --\x3e\n                                </div>\n                            </dd>\n                            \x3c!-- <dd>\n                                <div class="detail-cell">\n                                    <label>到期时间：</label>\n                                    <span>${instance.expireTimeDesc}</span>\n                                </div>\n                            </dd> --\x3e\n                        </dl>\n                        <dl class="detail-create detail-part-1-col">\n                            <dt><h4>${i18n.变更配置}</h4></dt>\n                            <dd>\n                                <label>CPU：</label>\n                                <div class="relative-field">\n                                    <div data-ui-id="cpu"\n                                        data-ui-name="cpu"\n                                        data-ui-type="Dragger"></div>\n                                </div>\n                            </dd>\n                            <dd>\n                                <label>${i18n.内存：}</label>\n                                <div class="relative-field">\n                                    <div data-ui-id="memory"\n                                        data-ui-name="memory"\n                                        data-ui-type="Dragger"></div>\n                                </div>\n                            </dd>\n                            \x3c!-- if: ${instance.flavorType} === \'calculation\' --\x3e\n                            <dd>\n                                <label>${i18n.本地磁盘：}</label>\n                                <div class="relative-field">\n                                    <div data-ui-id="diskSize"\n                                        data-ui-name="diskSize"\n                                        data-ui-type="Dragger"></div>\n                                </div>\n                            </dd>\n                            \x3c!-- /if --\x3e\n                        </dl>\n                        \x3c!-- /if --\x3e\n                    </div>\n                    <div class="submit-container">\n                        <div type="button" data-ui="id:submit;type:Button;skin:ok;disabled:true;" data-ui-extension-popover-type="PopoverEx">${i18n.保存}</div>\n                        <button type="button" data-ui="id:cancel;type:Button;skin:cancel;">${i18n.取消}</button>\n                    </div>\n                </form>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("dcc/instance/operation/configChange/ui",["exports","inf-i18n","babel-runtime/helpers/interop-require-default"],function(exports,e,t){exports.__esModule=!0,exports.getUIProperties=function(){var e=this.model.get("host")||{},t=this.model.get("instance")||{};return{cpu:{max:e.cpuLeft+t.cpu,min:1,value:t.cpu,length:400,unit:a["default"]("核")},memory:{max:e.memoryLeft+t.memory,min:1,value:t.memory,length:400,unit:"GB"},diskSize:{max:e.diskSizeLeft+t.diskSize,min:t.diskSize,value:t.diskSize,length:400,unit:"GB"}}},exports.getUIEvents=function(){return{"submit:click":function(e){this.fire("submitConfig")},"cpu:change":this.handleChange,"memory:change":this.handleChange,"diskSize:change":this.handleChange}};var a=t["default"](e)}),define("dcc/instance/operation/configChange/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormView","babel-runtime/helpers/interop-require-default","bat-ria/tpl!./tpl","./ui"],function(exports,module,e,t,a,i,n,s){var r=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_instance_upgradeconfig"}return e["default"](i,a),i.prototype.getUIProperties=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return s.getUIProperties.apply(this,t)},i.prototype.getUIEvents=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return s.getUIEvents.apply(this,t)},i.prototype.repaint=function(){this.viewContext.dispose(),this.render()},i.prototype.handleChange=function(e){var t=this.model.get("instance"),a=this.get("cpu").getValue(),i=this.get("memory").getValue(),n=this.get("diskSize");a!==t.cpu||i!==t.memory||n&&n.getValue()!==t.diskSize?(this.get("submit").setDisabled(!1),t.maxRamGb&&i>t.maxRamGb&&this.get("submit").setProperties({disabled:!0,popover:"当前操作系统不支持大于64G的内存"})):this.get("submit").setProperties({disabled:!0,popover:""})},i}(i["default"](a)["default"]);module.exports=r}),define("dcc/instance/operation/createImage/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormAction","babel-runtime/helpers/interop-require-default","./Model","./View"],function(exports,module,e,t,a,i,n,s){var r=i["default"](a),o=i["default"](n),c=i["default"](s),l=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=o["default"],this.viewType=c["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this)},i.prototype.redirectAfterSubmit=function(){var e=this.model.get("parentAction");e&&(e.redirectAfterChangeName&&e.redirectAfterChangeName()||e.reload())},i}(r["default"]);module.exports=l}),define("dcc/instance/operation/createImage/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormModel","babel-runtime/helpers/interop-require-default","../../../config"],function(exports,module,e,t,a,i,n,s){var r=function(i){function n(e){a["default"](this,n),i.call(this,e),this.submitRequester=s.api.dccImageCreate}return e["default"](n,i),n.prototype.prepare=function(){},n.prototype.getExtraData=function(){return{instanceId:this.get("id")||{}}},t["default"](n,[{key:"datasource",get:function(){return{}}}]),n}(n["default"](i)["default"]);module.exports=r}),define("dcc/instance/operation/createImage/tpl",[],function(){return'\x3c!-- target: TPL_dcc_image_create --\x3e\n<div class="dcc-dialog-form">\n    <form data-ui-type="Form" data-ui-id="form"\n        data-ui-auto-validate="true">\n        <div class="form-data-body">\n            <div class="form-row">\n                <label>${i18n.实例ID：}</label>\n                <div class="form-value nowrap-text">${instanceId}</div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.镜像名称：}</label>\n                <div class="form-value">\n                    <input data-ui-type="TextBox" data-ui-id="name"\n                        data-ui-name="name" data-ui-width="370" />\n                    <label data-ui-type="Validity"\n                        data-ui-id="nameValidity"></label>\n                </div>\n            </div>\n        </div>\n    </form>\n</div>\n\n\x3c!-- target: TPL_dcc_image_create_child --\x3e\n\x3c!-- import: TPL_dcc_image_create --\x3e\n'}),define("dcc/instance/operation/createImage/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormView","babel-runtime/helpers/interop-require-default","../../../config","bat-ria/tpl!./tpl","inf-i18n"],function(exports,module,e,t,a,i,n,s,r){var o=i["default"](a),c=i["default"](r),l=n.rule.IMAGE.NAME,d=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_image_create"}return e["default"](i,a),i.prototype.getUIProperties=function(){return{name:{placeholder:l.placeholder,required:"required",requiredErrorMessage:c["default"]("自定义镜像名称必填"),pattern:l.pattern,patternErrorMessage:l.patternErrorMessage,validityLabel:"nameValidity"}}},i.prototype.getUIEvents=function(){return{}},i}(o["default"]);module.exports=d}),define("dcc/instance/operation/createSnapshot/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormAction","babel-runtime/helpers/interop-require-default","./Model","./View"],function(exports,module,e,t,a,i,n,s){var r=i["default"](a),o=i["default"](n),c=i["default"](s),l=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=o["default"],this.viewType=c["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this)},i.prototype.redirectAfterSubmit=function(){var e=this.model.get("parentAction");e&&(e.redirectAfterChangeName&&e.redirectAfterChangeName()||e.reload())},i}(r["default"]);module.exports=l}),define("dcc/instance/operation/createSnapshot/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormModel","babel-runtime/helpers/interop-require-default","../../../config"],function(exports,module,e,t,a,i,n,s){var r=function(i){function n(e){a["default"](this,n),i.call(this,e),this.submitRequester=s.api.dccSnapshotCreate}return e["default"](n,i),n.prototype.prepare=function(){},n.prototype.getExtraData=function(){return{instanceId:this.get("id")||{}}},t["default"](n,[{key:"datasource",get:function(){return{}}}]),n}(n["default"](i)["default"]);module.exports=r}),define("dcc/instance/operation/createSnapshot/tpl",[],function(){return'\x3c!-- target: TPL_dcc_snapshot_create --\x3e\n<div class="dcc-dialog-form dcc-snapshot-create-form">\n    <form data-ui-type="Form" data-ui-id="form"\n        data-ui-auto-validate="true">\n        <div class="form-data-body">\n            <div class="form-row" id="instance-notice" style="display:none">\n                <div class="operation-tip">${i18n.温馨提示：创建快照会重启服务器，导致服务器停止几分钟，}\n                    ${i18n.为保证你的服务不受影响，请在确认执行此操作前做好预案准备。}</div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.实例ID：}</label>\n                <div class="form-value nowrap-text">\n                    ${instanceId}\n                </div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.快照名称：}</label>\n                <div class="form-value">\n                    <input\n                        data-ui-required-error-message="快照名称必填"\n                        data-ui-required="required"\n                        data-ui-type="TextBox"\n                        data-ui-id="name"\n                        data-ui-name="name"\n                        data-ui-width="370" />\n                </div>\n            </div>\n        </div>\n    </form>\n</div>\n\n\x3c!-- target: TPL_dcc_snapshot_create_child --\x3e\n\x3c!-- import: TPL_dcc_snapshot_create --\x3e\n'}),define("dcc/instance/operation/createSnapshot/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormView","babel-runtime/helpers/interop-require-default","../../../config","bat-ria/tpl!./tpl"],function(exports,module,e,t,a,i,n,s){var r=i["default"](a),o=n.rule.SNAPSHOT.NAME,c=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_snapshot_create"}return e["default"](i,a),i.prototype.getUIProperties=function(){return{name:{placeholder:o.placeholder,pattern:o.pattern,patternErrorMessage:o.patternErrorMessage,value:"@randomName"}}},i.prototype.getUIEvents=function(){return{}},i}(r["default"]);module.exports=c}),define("dcc/instance/operation/joinSecurityGroups/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","bat-ria/mvc/FormAction","./Model","./View"],function(exports,module,e,t,a,i,n,s,r){var o=i["default"](a),c=i["default"](n),l=i["default"](s),d=i["default"](r),u=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=l["default"],this.viewType=d["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.on("entercomplete",this.initTableSelectItem,this)},i.prototype.redirectAfterSubmit=function(){var e=this.model.get("parentAction");e&&(e.redirectAfterChangeName&&e.redirectAfterChangeName()||e.reload())},i.prototype.syncModelToViewIterator=function(e){switch(e.name){case"selectedIndex":this.view.updateSelectedItem()}},i.prototype.initTableSelectItem=function(){var e=o["default"].pluck(this.model.get("instances"),"id"),t=this.model.get("securityGroups"),a=[];o["default"].each(t,function(t,i,n){o["default"].intersection(e,o["default"].pluck(t.instances,"id")).length===e.length?a[i]=+i:a[i]=!1}),this.model.setSelectedIndex(a)},i}(c["default"]);module.exports=u}),define("dcc/instance/operation/joinSecurityGroups/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","bat-ria/mvc/FormModel","../../../config"],function(exports,module,e,t,a,i,n,s,r){var o=n["default"](i),c=function(i){function n(e){a["default"](this,n),i.call(this,e),this.submitRequester=r.api.joinSecurityGroups}return e["default"](n,i),n.prototype.setSelectedIndex=function(e,t){t&&t.silent?this.set("selectedIndex",e,t.silent):this.set("selectedIndex",e)},n.prototype.getExtraData=function(){return{instanceIds:o["default"].pluck(this.get("instances"),"id")}},n.prototype.getAllSecurityGroups=function(e){return r.api.getDccSecurityList(e).then(function(e){return o["default"].isArray(e.result)&&o["default"].each(e.result,function(e){e.name=o["default"].escape(e.name),e.desc=o["default"].escape(e.desc)}),e.result})},t["default"](n,[{key:"datasource",get:function(){return{securityGroups:function(e){var t={},a=o["default"].pluck(e.get("instances"),"vpcId");return a&&a.length>0&&a[0]&&(t.vpcId=a[0]),e.getAllSecurityGroups(t)}}}}]),n}(n["default"](s)["default"]);module.exports=c}),define("dcc/instance/operation/joinSecurityGroups/tpl",[],function(){return'\x3c!-- target: TPL_dcc_instance_joinSecurityGroups --\x3e\n<div class="main-wrap-new dcc-instance-join-security-groups">\n<form data-ui-type="Form"\n      data-ui-id="form"\n      data-ui-auto-validate="true">\n    \x3c!-- if: ${instances.length} --\x3e\n    <p>\n        ${i18n.您选择的需要关联的云服务器实例为}\n        \x3c!-- for: ${instances} as ${item} --\x3e\n        “${item.name}”、\n        \x3c!-- /for --\x3e\n        ${i18n.请在下方选择需要关联的安全组}\n    </p>\n    \x3c!-- /if --\x3e\n\n    <div data-ui-type="Table"\n         data-ui-id="securityGroups"></div>\n</form>\n</div>\n\n\x3c!-- target: TPL_dcc_instance_joinSecurityGroups_child --\x3e\n\x3c!-- import: TPL_dcc_instance_joinSecurityGroups --\x3e\n'}),define("dcc/instance/operation/joinSecurityGroups/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/tpl!./tpl","bat-ria/mvc/FormView","babel-runtime/helpers/interop-require-default","underscore","common/util"],function(exports,module,e,t,a,i,n,s,r){var o=n["default"](i),c=n["default"](s),l=n["default"](r),d=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_instance_joinSecurityGroups"}return e["default"](i,a),i.prototype.getUIProperties=function(){return{securityGroups:{fields:[{title:"安全组名称",content:"name"},{title:"所在网络",content:function(e){return l["default"].getVpcName(e.vpcName)}},{title:"安全组描述",content:"desc"}],select:"multi",selectMode:"line",datasource:"@securityGroups"}}},i.prototype.getUIEvents=function(){return{}},i.prototype.getExtraFormData=function(){return{securityGroupIds:c["default"].pluck(this.get("securityGroups").getSelectedItems(),"id")}},i.prototype.updateSelectedItem=function(){this.get("securityGroups").setRowSelected(this.model.get("selectedIndex"),!0)},i}(o["default"]);module.exports=d}),define("dcc/instance/operation/rebuildOs/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","bat-ria/mvc/FormAction","./Model","./View","inf-i18n","../../../enums"],function(exports,module,e,t,a,i,n,s,r,o,c){var l=i["default"](a),d=i["default"](n),u=i["default"](s),p=i["default"](r),f=i["default"](o),m=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=u["default"],this.viewType=p["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.view.on("IMAGE_TYPE_CHANGE",this.imageTypeChange,this),this.view.on("OS_TYPE_CHANGE",this.osTypeChange,this),this.view.on("rebuildOs",this.rebuildOs,this)},i.prototype.syncModelToViewIterator=function(e){switch(e.name){case"formData":this.view.repaint();break;case"osNotAvailable":!0===e.newValue?this.view.showOsNotAvailable():this.view.hideOsNotAvailable();case"osloading":if(!e.newValue){var t=this.model.get("osTypeDatasource");this.osTypeChange({osType:t[0].value})}}},i.prototype.imageTypeChange=function(e){this.model.updateFormData(e.toUpdate)},i.prototype.osTypeChange=function(e){var t=this.model.get("instance"),a=this.model.get("osTypeDatasource"),i=this.model.get("osVersionDatasource"),n=l["default"].clone(i[e.osType]);n=l["default"].filter(n,function(e){var a=!!e.minMem&&e.minMem>t.memory,i=!!e.minCpu&&e.minCpu>t.cpu;return!a&&!i}),n=l["default"].each(n,function(e){return e.maxRamGbInvalid=!!e.maxRamGb&&t.memory>e.maxRamGb,e.disabled=e.maxRamGbInvalid,e.popover=e.maxRamGbInvalid?"您选择的内存已大于当前镜像支持的最大内存":"",e}),this.model.updateFormData({osType:{datasource:a,value:e.osType,disabled:!a.length},osVersion:{datasource:n,value:n.length>0?n[0]:"",disabled:!n.length}})},i.prototype.redirectAfterSubmit=function(){var e=this.model.get("parentAction");e&&(e.redirectAfterChangePwd&&e.redirectAfterChangePwd()||e.reload())},i.prototype.handleSubmitError=function(e){var t=this.model.get("parentAction");t&&t.dialog&&t.dialog.show(),e.field&&e.field.mfa||this.view.showToast(e&&e.global?e.global:"操作失败",{messageType:"error"})},i.prototype.rebuildOs=function(e){var t=this;if(this.view.get("form").validate()){var a=this.model.get("instance"),i=this.view.get("osType").getValue().toLowerCase();return"linux"!==a.osType||"windows server"!==i||a.uuid?this.submitEdit():this.model.get("host").diskSizeLeft>=20||a.flavorType===c.FlavorType.STORAGE?this.view.waitConfirm({title:f["default"]("重装操作系统温馨提示"),content:f["default"]("亲爱的用户，从linux系统更换到Windows系统，系统盘容量会调整到40G，请知晓。")}).then(function(){return t.submitEdit()}):this.view.waitAlert({title:f["default"]("重装操作系统温馨提示"),content:f["default"]("亲爱的用户， 您的空闲磁盘容量不足20G，无法支持扩展到Windows系统所需的40G，本次重装无法进行。")})}},i.prototype.cancelEdit=function(e){var t=this.model.get("parentAction");this.model.get("authCodeSent")&&this.model.invalidateAuthCode(),t.dialog.dispose(),t.view.resetMoreOperation&&t.view.resetMoreOperation()},i}(d["default"]);module.exports=m}),define("dcc/instance/operation/rebuildOs/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormModel","babel-runtime/helpers/interop-require-default","underscore","promise","../../../config","../../../enums","../../../helper","../../../util","../../create/config"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u){var p=n["default"](i),f=n["default"](s),m=n["default"](r),h=n["default"](l),g=n["default"](d),v=n["default"](u),b={silent:!0},y={showLoading:!1,"X-silence":!0},T=[{name:"加载中，请稍候……",value:"disabled"}],x=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.submitRequester=function(e){return o.api.instanceRebuild(e,b)},n.prototype.prepare=function(){this.loadImageAndOs(b)},n.prototype.loadImageAndOs=function(e){var t=this,a=this.get("formData"),i=a.imageType;return this.set("osloading",!0),o.api.getImageListGroup({imageType:i},y).then(function(e){return t.transforImageAndOs(e)}).then(function(e){if(f["default"].isEmpty(e))return t.updateFormData({osType:{value:"",disabled:!0},osVersion:{value:"",disabled:!0}}),t.set("osNotAvailable",!0),m["default"].resolve();var i=a.osType.value||f["default"].chain(e.osVersionDatasource).keys().sort().value()[0];return t.updateFormData({osType:{datasource:e.osTypeDatasource,value:i,disabled:!1},osVersion:{datasource:e.osVersionDatasource[i],value:a.osVersion.value,disabled:!1}}),t.set("osNotAvailable",!1),t.set("osloading",!1),m["default"].resolve()})},n.prototype.transforImageAndOs=function(e){if(f["default"].isEmpty(e))return{};var t=f["default"].chain(e).keys().sort().value(),a=f["default"].mapObject(e,function(e){return f["default"].chain(e).map(function(e,t){return{name:e.name,value:e.id,osType:e.osType,minDiskGb:e.minDiskGb,maxRamGb:e.maxRamGb,minMem:e.minMem,minCpu:e.minCpu}}).value()}),i=f["default"].map(t,function(e,t){return{name:e,value:e}});return this.set("osVersionDatasource",a),this.set("osTypeDatasource",i),{osTypeDatasource:i,osVersionDatasource:a}},n.prototype.updateFormData=function(e){arguments.length<=1||arguments[1]===undefined||arguments[1];var t=f["default"].clone(this.get("formData"));g["default"].deepExtend(t,e),this.set("formData",t),null!=e.imageType&&this.loadImageAndOs()},n.prototype.getExtraData=function(){return o.flags.enable_baixin?{authCode:"123456",instanceId:this.get("instance").id}:{instanceId:this.get("instance").id}},n.prototype.validateSubmitData=function(e){var t=!!e._isPasswordMatch||{confirm:"确认密码和新密码不一致"};return e._isPasswordMatch=undefined,t},n.prototype.filterData=function(e){return e._isPasswordMatch=e.adminPass===e.confirm,o.flags.enable_rsa_encrypt&&e.password&&e.confirm&&(e.password=h["default"].rsaEncrypt(e.password),e.confirm=e.password),e.imageId=e[v["default"].api2UiKeyMapper.imageId],e},n.prototype.invalidateAuthCode=function(){return o.api.invalidateAuthCode()},t["default"](n,[{key:"datasource",get:function(){return{tips:function(){return o.tips},formData:function(e){var t=e.get("instance");return{imageType:t.imageType||"common",osType:{datasource:T,value:t[v["default"].uiKey2ApiMapper.osType]},osVersion:{datasource:T,value:t[v["default"].uiKey2ApiMapper.osVersion]},isActive:t.status===c.InstanceStatus.ACTIVE,osloading:!0}},snapshoted:function(e){return o.api.dccSnapshotList({instanceId:e.get("instance").instanceId}).then(function(e){return e.result&&e.result.length})},host:function(e){var t=e.get("instance"),a=t.hostUuid||t.hostId;if(a)return o.api.getDccHostDetail({id:a},y)}}}}]),n}(p["default"]);module.exports=x}),define("dcc/instance/operation/rebuildOs/tpl",[],function(){return'\x3c!-- target: TPL_dcc_instance_rebuild --\x3e\n<div class="dcc-dialog-form dcc-rebuild-dialog">\n    <form data-ui="type:Form;id:form;autoValidate:true;">\n        <div class="form-data-body">\n            <div class="form-row">\n                <div class="operation-tip">\n                    ${i18n.重装系统会清除系统盘内数据且不可恢复（数据盘数据不受影响），}\n                    \x3c!-- if: ${formData.isActive} --\x3e${i18n.同时云服务器服务会中断几分钟，}\x3c!-- /if --\x3e\n                    \x3c!-- if: ${snapshoted} --\x3e${i18n.且该服务器创建的系统盘快照会被删除，}\x3c!-- /if --\x3e\n                    ${i18n.确定重装吗？}\n                </div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.镜像类型：}</label>\n                <div class="form-value">\n                    <div data-ui-id="imageType"\n                         data-ui-type="RadioSelect"\n                         class="ui-radioselect-custom"></div>\n                    <div data-ui-type="Tip"\n                         data-ui-id="imageTip"\n                         data-ui-arrow="true"\n                         class="image-tip"></div>\n                </div>\n            </div>\n            <div class="form-row dcc-os-row">\n                <label>${i18n.操作系统：}</label>\n                <div class="form-value">\n                    <div data-ui-type="Select"\n                         data-ui-width="120"\n                         data-ui-id="osType"\n                         data-ui-name="osType"></div>\n                    <div data-ui-type="Select"\n                         data-ui-width="260"\n                         data-ui-required="required"\n                         data-ui-name="osVersion"\n                         data-ui-extension-popover-type="PopoverEx"\n                         data-ui-required-error-message="${i18n.请选择一个镜像}"\n                         data-ui-id="osVersion"></div>\n                    <div class="os_available">\n                    </div>\n                    <div data-ui="type:Panel;id:osHelpLinkPanel;hidden:true;">\n                    <a target="_blank" class="os_helplink"\n                        href="http://bce.baidu.com/doc/BCC/Resources.html#.A8.AF.04.0F.7A.C0.66.72.DF.F3.53.E9.8C.5E.94.D2">\n                        ${i18n.镜像环境详情}\n                    </a>&nbsp;\n                    <a target="_blank" class="os_helplink"\n                        href="http://bce.baidu.com/doc/BCC/Resources.html#.FB.81.0D.6E.08.3E.F1.B0.D7.0B.3A.8A.56.EA.42.84">\n                        <input type="checkbox" disabled="disabled" checked="checked">&nbsp; ${i18n.确认《百度云镜像服务协议》}\n                    </a>\n                    </div>\n                    <div data-ui-type="Panel" data-ui-id="osOversizedTip" data-ui-hidden="true" class="os-oversized-tip">\n                        您当前系统盘容量小于重装该镜像所需系统盘容量，无法重装操作系统。\n                    </div>\n                </div>\n            </div>\n            <div class="form-row dcc-admin-name-row">\n                <label>${i18n.管理员用户名：}</label>\n                <div class="form-value">\n                    <div data-ui="type:Label;id:adminName;" class="dcc-admin-name">root</div>\n                </div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.管理员新密码：}</label>\n                <div class="form-value">\n                    <input type="password"\n                        data-ui-custom-error-message="${i18n.密码不符合规则}"\n                        data-ui-required="required"\n                        data-ui-required-error-message="${i18n.新密码必填}"\n                        data-ui-type="TextBox"\n                        data-ui-id="adminPass"\n                        data-ui-name="adminPass"\n                        data-ui-width="320" />\n                    <br />\n                    <label data-ui-type="Validity"\n                        data-ui-id="adminPassValidity" ></label>\n                    <div data-ui="type:Label;id:passwordTip;" class="dcc-note password-tip"></div>\n                </div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.确认密码：}</label>\n                <div class="form-value">\n                    <input type="password"\n                        data-ui-type="TextBox"\n                        data-ui-required="required"\n                        data-ui-required-error-message="${i18n.确认密码必填}"\n                        data-ui-id="confirm"\n                        data-ui-name="confirm"\n                        data-ui-width="320" /><br/>\n                    <label data-ui-type="Validity"\n                        data-ui-id="confirmValidity" ></label>\n                    <div class="dcc-note">${tips.rebuildOs.confirmPwd}</div>\n                </div>\n            </div>\n        </div>\n        \x3c!-- /if --\x3e\n        <div class="submit-container">\n            <button type="button" data-ui="id:submit;type:Button;skin:ok;">${i18n.保存}</button>\n            <button type="button" data-ui="id:cancel;type:Button;skin:cancel;">${i18n.取消}</button>\n        </div>\n    </form>\n</div>\n\n\x3c!-- target: TPL_dcc_instance_rebuild_child --\x3e\n\x3c!-- import: TPL_dcc_instance_rebuild --\x3e\n'}),define("dcc/instance/operation/rebuildOs/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormView","babel-runtime/helpers/interop-require-default","bat-ria/tpl!./tpl","jquery","inf-i18n","../../../config","../../../enums"],function(exports,module,e,t,a,i,n,s,r,o,c){var l=i["default"](a),d=i["default"](s),u=i["default"](r),p=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_instance_rebuild"}return e["default"](i,a),i.prototype.getUIProperties=function(){var e=this.model.get("formData");return{adminPass:{custom:function(e){return o.rule.INSTANCE.PASSWORD.custom(e)},validityLabel:"adminPassValidity"},confirm:{custom:function(e){return this.viewContext.controls.adminPass.getValue()===this.getValue()},customErrorMessage:u["default"]("确认密码和新密码不一致"),validityLabel:"confirmValidity"},passwordTip:{text:o.rule.INSTANCE.PASSWORD.customErrorMessage},imageType:{datasource:c.ImageType.toArray("COMMON","CUSTOM","INTEGRATION","SHARING"),value:e.imageType},imageTip:{content:o.tips.rebuildOs.imageType[e.imageType]},osType:{datasource:e.osType.datasource,value:e.osType.value,disabled:e.osType.disabled},osVersion:{datasource:e.osVersion.datasource,value:e.osVersion.value,disabled:e.osVersion.disabled}}},i.prototype.getUIEvents=function(){return{"imageType:change":function(e){var t=e.item.value,a={imageType:t,osType:""};this.fire("IMAGE_TYPE_CHANGE",{toUpdate:a}),this.get("imageTip").setProperties({content:o.tips.rebuildOs.imageType[t]})},"osType:change":function(e){var t=e.target.getSelectedItem(),a=undefined;t&&(a="windows server"===t.value.toLowerCase()?"Administrator":"root",this.get("adminName").setText(a),this.fire("OS_TYPE_CHANGE",{osType:t.value,memory:this.model.get("instance").memory}))},"osVersion:change":function(){var e=this.get("osVersion").getSelectedItem(),t=this.get("osOversizedTip"),a=this.get("submit");e&&e.osType&&/linux/.test(e.osType.toLowerCase())&&(e.minDiskGb>20?(t.show(),a.disable()):(t.hide(),a.enable())),e&&e.osType&&/windows/.test(e.osType.toLowerCase())&&(e.minDiskGb>40?(t.show(),a.disable()):(t.hide(),a.enable())),e||(t.hide(),a.disable())},"adminPass:input":function(e){e.target.validate()},"confirm:input":function(e){this.get("adminPass").getValue()!==e.target.getValue()?this.notifyErrors({confirm:u["default"]("确认密码和新密码不一致")}):e.target.hideValidity()},"submit:click":function(e){this.fire("rebuildOs")}}},i.prototype.repaint=function(){this.repaintOsType(),this.repaintOsVersion(),this.repaintOsHelpLinkPanel()},i.prototype.repaintOsType=function(){var e=this.model.get("formData"),t=e.osType,a=t.datasource,i=t.value;this.get("osType").setProperties({datasource:a,value:i,disabled:e.osType.disabled})},i.prototype.repaintOsVersion=function(){var e=this.model.get("formData"),t=e.osVersion,a=t.datasource,i=t.value;this.get("osVersion").setProperties({datasource:a,value:i,disabled:e.osVersion.disabled}),this.get("osVersion").fire("change")},i.prototype.repaintOsHelpLinkPanel=function(){"integration"===this.model.get("formData").imageType?this.get("osHelpLinkPanel").show():this.get("osHelpLinkPanel").hide()},i.prototype.showOsNotAvailable=function(){d["default"](".os_available").html(u["default"]("当前镜像下没有可用操作系统"))},i.prototype.hideOsNotAvailable=function(){d["default"](".os_available").html("")},i}(l["default"]);module.exports=p}),define("dcc/instance/permission",["exports","module","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","common/util","common/storage","./operation","../enums"],function(exports,module,e,t,a,i,n,s,r){var o,c,l,d=a["default"](t),u=a["default"](i),p=a["default"](n),f=a["default"](s),m=u["default"].isSubUser(),h=f["default"].NAME,g=(o={},o[r.InstanceStatus.ACTIVE]=[h.STOP_INSTANCE,h.REBOOT_INSTANCE,h.DELETE_INSTANCE,h.EDIT_NAME,h.RESET_PASSWORD,h.JOIN_SECURITY_GROUPS,h.CONFIG_CHANGE,h.REBUILD_OS,h.GET_VNC_URL,h.BIND_EIP,h.UNBIND_EIP,h.BUY_SAME_CONFIG,h.NETWORK_CHANGE,h.CREATE_IMAGE,h.CREATE_SNAPSHOT,h.CREATE_AUTO_SNAPSHOT,h.EDIT_DESC,h.EDIT_TAG,h.CHANGE_SUBNET],o[r.InstanceStatus.SHUTOFF]=[h.START_INSTANCE,h.DELETE_INSTANCE,h.EDIT_NAME,h.RESET_PASSWORD,h.JOIN_SECURITY_GROUPS,h.CONFIG_CHANGE,h.REBUILD_OS,h.BUY_SAME_CONFIG,h.NETWORK_CHANGE,h.CREATE_IMAGE,h.CREATE_SNAPSHOT,h.BIND_EIP,h.UNBIND_EIP,h.CREATE_AUTO_SNAPSHOT,h.EDIT_DESC,h.EDIT_TAG],o[r.InstanceStatus.PAUSED]=[h.BIND_EIP,h.UNBIND_EIP,h.EDIT_TAG],o[r.InstanceStatus.SUSPENDED]=[h.BIND_EIP,h.UNBIND_EIP,h.EDIT_TAG],o[r.InstanceStatus.RESCUE]=[h.STOP_INSTANCE,h.BIND_EIP,h.UNBIND_EIP,h.EDIT_TAG],o[r.InstanceStatus.ERROR]=[h.STOP_INSTANCE,h.EDIT_TAG],o[r.InstanceStatus.EXPIRED]=[h.DELETE_INSTANCE,h.BUY_SAME_CONFIG,h.EDIT_TAG],o[r.InstanceStatus.SNAPSHOT]=[h.DELETE_INSTANCE,h.JOIN_SECURITY_GROUPS,h.BUY_SAME_CONFIG,h.EDIT_TAG],o[r.InstanceStatus.ROLLBACK_SNAPSHOT]=[h.DELETE_INSTANCE,h.JOIN_SECURITY_GROUPS,h.BUY_SAME_CONFIG,h.EDIT_TAG],o[r.InstanceStatus.DELETE_SNAPSHOT]=[h.JOIN_SECURITY_GROUPS,h.EDIT_TAG],o[r.InstanceStatus.TEMPLATE]=[h.DELETE_INSTANCE,h.JOIN_SECURITY_GROUPS,h.BUY_SAME_CONFIG,h.EDIT_TAG],o[r.InstanceStatus.REBOOT]=[h.DELETE_INSTANCE,h.JOIN_SECURITY_GROUPS,h.BUY_SAME_CONFIG,h.EDIT_TAG],o[r.InstanceStatus.HARD_REBOOT]=[h.DELETE_INSTANCE,h.JOIN_SECURITY_GROUPS,h.BUY_SAME_CONFIG,h.EDIT_TAG],o[r.InstanceStatus.PASSWORD]=[h.DELETE_INSTANCE,h.JOIN_SECURITY_GROUPS,h.BUY_SAME_CONFIG,h.EDIT_TAG],o[r.InstanceStatus.RESIZE]=[h.DELETE_INSTANCE,h.JOIN_SECURITY_GROUPS,h.EDIT_TAG],o[r.InstanceStatus.BINDING]=[h.JOIN_SECURITY_GROUPS,h.EDIT_TAG],o[r.InstanceStatus.UNBINDING]=[h.JOIN_SECURITY_GROUPS,h.EDIT_TAG],o[r.InstanceStatus.DCC_EXPIRED]=[h.DELETE_INSTANCE,h.EDIT_TAG],o[r.InstanceStatus.SOFT_DELETED]=[h.EDIT_TAG],o[r.InstanceStatus.VERIFY_RESIZE]=[h.EDIT_TAG],o[r.InstanceStatus.REVERT_RESIZE]=[h.EDIT_TAG],o[r.InstanceStatus.SHELVED]=[h.EDIT_TAG],o[r.InstanceStatus.SHELVED_OFFLOADED]=[h.EDIT_TAG],o[r.InstanceStatus.REBUILD]=[h.EDIT_TAG],o[r.InstanceStatus.MIGRATING]=[h.EDIT_TAG],o[r.InstanceStatus.POWERING_OFF]=[h.EDIT_TAG],o[r.InstanceStatus.POWERING_ON]=[h.EDIT_TAG],o[r.InstanceStatus.OFFLINE]=[h.EDIT_TAG],o),v=(c={},c[h.NETWORK_CHANGE]=!0,c[h.CONFIG_CHANGE]=!0,c[h.BIND_EIP]=!0,c[h.UNBIND_EIP]=!0,c[h.CREATE_AUTO_SNAPSHOTG]=!0,c),b=(l={},l[h.DELETE_INSTANCE]=!0,l[h.CONFIG_CHANGE]=!0,l[h.REBUILD_OS]=!0,l[h.CHANGE_SUBNET]=!0,l),y=function(){function t(){e["default"](this,t)}return t.prototype.getOperationsByStatus=function(e){return g[e]||[]},t.prototype.isGranted=function(e,t){return d["default"].contains(this.getOperationsByStatus(e),t)},t.prototype.checkIfShouldDisabled=function(e,t){var a=p["default"].get("whiteTags")&&JSON.parse(p["default"].get("whiteTags")).bindEip;if(m&&v[e])return!0;if(t.rdsUuid)return!0;if(d["default"].indexOf(["createInstance","inlineedit"],e)>-1)return!1;if("cce"===t.application&&b[e])return!0;if(this.isGranted(t.status,e))switch(e){case f["default"].NAME.NETWORK_CHANGE:return!t.publicIp||!!t.uuid;case f["default"].NAME.BUY_SAME_CONFIG:case f["default"].NAME.DELETE_INSTANCE:case f["default"].NAME.CONFIG_CHANGE:return!!t.uuid;case f["default"].NAME.BIND_EIP:return a;default:return!1}return!0},t}();module.exports=new y}),define("dcc/instance/securityGroups/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","../../../bcc/instance/SecurityGroups","babel-runtime/helpers/interop-require-default","./Model","./View"],function(exports,module,e,t,a,i,n,s){var r=i["default"](a),o=i["default"](n),c=i["default"](s),l=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=o["default"],this.viewType=c["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this)},i}(r["default"]);module.exports=l}),define("dcc/instance/securityGroups/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","../../../bcc/instance/SecurityGroupsModel","../../enums"],function(exports,module,e,t,a,i,n,s,r){var o=n["default"](i),c=function(i){function n(e){a["default"](this,n),i.call(this,e)}return e["default"](n,i),n.prototype.prepare=function(){i.prototype.prepare.call(this),this.updateViewData()},n.prototype.updateViewData=function(){var e=this.get("instance"),t=o["default"].deepClone(e);t.status={text:r.InstanceStatus.getTextFromValue(e.status),className:r.InstanceStatus.fromValue(e.status).kclass},this.set("viewData",t)},t["default"](n,[{key:"datasource",get:function(){return o["default"].extend({},i.prototype.datasource)}}]),n}(n["default"](s)["default"]);module.exports=c}),define("dcc/instance/securityGroups/tpl",[],function(){return'\x3c!-- target: TPL_dcc_instance_securitygroups(master = TPL_dcc_instance_detail_structure) --\x3e\n\n\x3c!-- block: detail-breadcrumb --\x3e\n\x3c!-- use: TPL_dcc_breadcrumb(fatherUrl=\'#/dcc/instance/list\', fatherPage=\'专属服务器 - 实例列表\', currentPage=\'安全组\') --\x3e\n\x3c!-- /block --\x3e\n\n\x3c!-- block: abstrct-info --\x3e\n<h1 title="${viewData.name}">${viewData.name}</h1>\n<span class="status ${viewData.status.className}">\n    ${viewData.status.text}\n</span>\n\x3c!-- /block --\x3e\n\n\x3c!-- block: detail-navigator --\x3e\n    \x3c!-- import: TPL_dcc_instance_detail_navigator --\x3e\n\x3c!-- /block --\x3e\n\n\x3c!-- block: detail-info --\x3e\n<div class="dcc-instance-securitygroups">\n    <section class="ui-tab-content">\n        <article>\n            <header><h2>当前应用的安全组规则</h2></header>\n            <esui-tab data-ui-id="ruleTab" class="ui-smart-tab">\n                <ul data-role="navigator" class="ui-tab-navigator">\n                    <li data-for="rule-in-list">入站</li>\n                    <li data-for="rule-out-list">出站</li>\n                </ul>\n                <div id="rule-in-list" class="ui-tab-content">\n                    <div data-ui-type="Table"\n                         data-ui-id="ingressRules"\n                         data-ui-datasource="@ingressRules">\n                    </div>\n                </div>\n                <div id="rule-out-list" class="ui-tab-content">\n                    <div data-ui-type="Table"\n                         data-ui-id="egressRules"\n                         data-ui-datasource="@egressRules">\n                    </div>\n                </div>\n            </esui-tab>\n        </article>\n\n\n        <article>\n            <header><h2>关联的安全组列表</h2></header>\n            <p><div data-ui-type="Button"\n                    data-ui-id="joinSecurityGroups">关联安全组</div></p>\n            <div data-ui-type="Table"\n                 data-ui-id="securityGroups"\n                 data-ui-datasource="@securityGroups"\n                 data-ui-extension-tableedit-type="TableEdit"\n                 data-ui-extension-command-type="Command"\n                 data-ui-extension-tablesubrow-type="TableSubrow">\n            </div>\n        </article>\n    </section>\n</div>\n\x3c!-- /block --\x3e\n\n'}),define("dcc/instance/securityGroups/ui",["exports"],function(exports){exports.__esModule=!0,exports.getUIProperties=function(){return{}},exports.getUIEvents=function(){return{}}}),define("dcc/instance/securityGroups/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/tpl!./tpl","underscore","babel-runtime/helpers/interop-require-default","../../../bcc/instance/SecurityGroupsView","./ui"],function(exports,module,e,t,a,i,n,s,r){var o=n["default"](i),c=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_instance_securitygroups"}return e["default"](i,a),i.prototype.getUIProperties=function(){var e=a.prototype.getUIProperties.call(this);return o["default"].extend({},e,r.getUIProperties.apply(this))},i.prototype.getUIEvents=function(){var e=a.prototype.getUIEvents.call(this);return o["default"].extend({},e,r.getUIEvents.apply(this))},i}(n["default"](s)["default"]);module.exports=c}),define("dcc/instance/viewDataUtil",["exports","module","underscore","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t){var a=t["default"](e),i={};i.getOsType=function(e){return function(e,t){return a["default"].mapObject(e,function(e){return a["default"].chain(e).map(function(e){return e[t]}).unique().value()})}(e,"osType")},i.getOsVersion=function(e){var t=i.getOsType(e),n={};return a["default"].each(t,function(t,i){n[i]={},a["default"].each(t,function(t){n[i][t]=a["default"].chain(e[i]).filter(function(e){return e.osType===t}).map(function(e){return e.osVersion}).value()})}),n},module.exports=i}),define("dcc/operation/action.conf",["exports","module"],function(exports,module){module.exports=[{path:"/dcc/operation/smsVerify",type:"dcc/operation/smsVerify/Action"},{path:"/dcc/operation/welcome",type:"dcc/operation/welcome/Action"}]}),define("dcc/operation/smsVerify/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormAction","babel-runtime/helpers/interop-require-default","./Model","./View"],function(exports,module,e,t,a,i,n,s){var r=i["default"](a),o=i["default"](n),c=i["default"](s),l=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=o["default"],this.viewType=c["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this)},i.prototype.redirectAfterSubmit=function(){var e=this.model.get("parentAction");e&&(e.redirectAfterDelete&&e.redirectAfterDelete()||e.reload())},i.prototype.handleSubmitError=function(e){var t=this.model.get("parentAction");t&&t.dialog&&t.dialog.show(),e.field&&e.field.mfa||this.view.showToast(e&&e.global?e.global:"操作失败",{messageType:"error"})},i}(r["default"]);module.exports=l}),define("dcc/operation/smsVerify/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormModel","babel-runtime/helpers/interop-require-default","underscore","../../config"],function(exports,module,e,t,a,i,n,s,r){var o=n["default"](i),c=n["default"](s),l={"x-silent":!0},d=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.submitRequester=function(e){var t=this.get("requester");if(t)return t(e,l)},n.prototype.getExtraData=function(){return r.flags.enable_baixin?c["default"].extend({authCode:"123456"},this.get("extraData")):this.get("extraData")||{}},t["default"](n,[{key:"datasource",get:function(){return{}}}]),n}(o["default"]);module.exports=d}),define("dcc/operation/smsVerify/tpl",[],function(){return'\x3c!-- target: TPL_dcc_host_sms_verify --\x3e\n<div class="dcc-host-sms-verify">\n    \x3c!-- if: ${tip} --\x3e\n    <div class="tip">${tip|raw}</div>\n    \x3c!-- /if --\x3e\n    \x3c!-- if: ${serviceType} && ${serviceType}  === \'DCC\' --\x3e\n    <div class="dcc-info-container">\n        <div class="info-head"><span>实例名称 / 实例ID / 内网IP</span></div>\n        <label>待删除实例：</label>\n        <div class="dcc-info">\n\n            \x3c!-- for: ${instances} as ${instance}--\x3e\n            <div>\n                ${instance.name | formatName(20)} / ${instance.instanceId} / ${instance.internalIp}\n            </div>\n            \x3c!-- /for --\x3e\n        </div>\n    </div>\n    \x3c!-- /if --\x3e\n</div>\n\n\x3c!-- target: TPL_dcc_host_sms_verify_child --\x3e\n\x3c!-- import: TPL_dcc_host_sms_verify --\x3e\n'}),define("dcc/operation/smsVerify/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormView","babel-runtime/helpers/interop-require-default","bat-ria/tpl!./tpl"],function(exports,module,e,t,a,i,n){var s=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_host_sms_verify"}return e["default"](i,a),i.prototype.getUIProperties=function(){return{}},i.prototype.getUIEvents=function(){return{}},i}(i["default"](a)["default"]);module.exports=s}),define("dcc/snapshot/action.conf",["exports","module"],function(exports,module){module.exports=[{path:"/dcc/snapshot/list",type:"dcc/snapshot/list/Action"}]}),define("dcc/snapshot/list/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","../../../bcc/snapshot/List","babel-runtime/helpers/interop-require-default","./Model","./View"],function(exports,module,e,t,a,i,n,s){var r=i["default"](a),o=i["default"](n),c=i["default"](s),l=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=o["default"],this.viewType=c["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this)},i.prototype.beforemodelload=function(){this.model.set("instanceSnapshotTab",!0)},i}(r["default"]);module.exports=l}),define("dcc/snapshot/list/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","../../../bcc/snapshot/ListModel","../../enums"],function(exports,module,e,t,a,i,n,s,r){var o=n["default"](i),c=function(i){function n(e){a["default"](this,n),i.call(this,e)}return e["default"](n,i),n.prototype.prepare=function(){i.prototype.prepare.call(this),this.updateViewData()},n.prototype.updateViewData=function(){var e=this.get("instance"),t=o["default"].deepClone(e);t.status={text:r.InstanceStatus.getTextFromValue(e.status),className:r.InstanceStatus.fromValue(e.status).kclass},this.set("viewData",t)},t["default"](n,[{key:"datasource",get:function(){return o["default"].extend({},i.prototype.datasource)}}]),n}(n["default"](s)["default"]);module.exports=c}),define("dcc/snapshot/list/tpl",[],function(){return'\x3c!-- target: TPL_dcc_snapshot_list(master = TPL_dcc_instance_detail_structure) --\x3e\n\n\x3c!-- block: detail-breadcrumb --\x3e\n\x3c!-- use: TPL_dcc_breadcrumb(fatherUrl=\'#/dcc/instance/list\', fatherPage=\'专属服务器 - 实例列表\', currentPage=\'本专属实例快照\') --\x3e\n\x3c!-- /block --\x3e\n\n\x3c!-- block: abstrct-info --\x3e\n<h1 title="${viewData.name}">${viewData.name}</h1>\n<span class="status ${viewData.status.className}">\n    ${viewData.status.text}\n</span>\n\x3c!-- /block --\x3e\n\n\x3c!-- block: detail-navigator --\x3e\n    \x3c!-- import: TPL_dcc_instance_detail_navigator --\x3e\n\x3c!-- /block --\x3e\n\n\x3c!-- block: detail-info --\x3e\n<div class="snapshot-table table-full-wrap">\n    <div class="operation-wrap" data-follow-thead="table">\n        <div class="buttons-wrap">\n            <button data-ui-id="createSnapshot" data-ui-type="Button" data-ui-skin="create">创建快照</button>\n            <button data-ui-type="Button"\n                    data-ui-id="deleteSnapshot"\n                    title="${i18n.批量删除快照}">${i18n.删除所选快照}</button>\n        </div>\n\n        <div class="buttons-quick-wrap">\n            \x3c!-- import: TPL_bcc_search --\x3e\n            <button type="button"\n                data-ui-type="Button" data-ui-id="refreshList" title="${i18n.刷新表格数据}">\n                <i class="iconfont icon-cdnrefresh"></i>\n            </button>\n        </div>\n    </div>\n    \x3c!-- import: listEditableTableWithCommand --\x3e\n    <div class="ui-row clearfix">\n        \x3c!-- import: listPager --\x3e\n    </div>\n</div>\n\x3c!-- /block --\x3e\n\n'}),define("dcc/snapshot/list/ui",["exports"],function(exports){exports.__esModule=!0,exports.getUIProperties=function(){return{}},exports.getUIEvents=function(){return{}}}),define("dcc/snapshot/list/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/tpl!./tpl","underscore","babel-runtime/helpers/interop-require-default","inf-i18n","../../../bcc/snapshot/ListView","./ui"],function(exports,module,e,t,a,i,n,s,r,o){var c=n["default"](i),l=(n["default"](s),function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_dcc_snapshot_list"}return e["default"](i,a),i.prototype.getUIProperties=function(){var e=a.prototype.getUIProperties.call(this);return c["default"].extend({},e,o.getUIProperties.apply(this))},i.prototype.getUIEvents=function(){var e=a.prototype.getUIEvents.call(this);return c["default"].extend({},e,o.getUIEvents.apply(this))},i}(n["default"](r)["default"]));module.exports=l}),define("dcc/startup",["exports","bat-ria/tpl!./common.tpl","underscore","babel-runtime/helpers/interop-require-default","promise","er/controller","./config","./action.conf"],function(exports,e,t,a,i,n,s,r){exports.__esModule=!0;var o=a["default"](t),c=a["default"](i),l=a["default"](n),d=a["default"](s),u=a["default"](r);exports.start=function(){return l["default"].registerAction(o["default"].flatten(u["default"])),c["default"].resolve(d["default"])}}),define("dcc/util",["exports","module","underscore","babel-runtime/helpers/interop-require-default","promise"],function(exports,module,e,t,a){function i(e){var t=arguments.length;if(t<2)return e;for(var a=1;a<t;a++)!function(e,t){for(var a in t)if(t.hasOwnProperty(a)){var s=o.call(e[a]),r=o.call(t[a]);switch(r){case"[object Object]":s!==r?e[a]=n["default"].clone(t[a]):(e[a]||(e[a]=n["default"].clone(t[a])),i(e[a],t[a]));break;case"[object Array]":e[a]=n["default"].clone(t[a]);break;default:e[a]=t[a]}}}(arguments[0],arguments[a]);return arguments[0]}var n=t["default"](e),s=t["default"](a),r={},o=Object.prototype.toString;r.deepExtend=i,r.confirmHandler=function(e,t,a,i,n){var r=this;return this.view.waitConfirm({title:e.title,content:e.content,width:e.width||540,needFoot:e.needFoot||!0,encode:e.encode}).then(function(){return function(e,t,a,i){var n=this;return e?(t=t||{},e(t).then(function(){return a?a.call(n):s["default"].resolve()}).fail(function(e){return i&&i.call(n,e)})):s["default"].resolve()}.call(r,t,a,i,n)})},r.triggerCommand=function(e){var t=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];try{t=JSON.parse(t)}catch(a){}this.fire("command",{command:e,args:t})},module.exports=r}),define("gpu/common/common.tpl",[],function(){return'\x3c!-- target: TPL_gpu_common_search --\x3e\n<span class="ui-group ui-search-group">\n    <span data-ui-type="Select" data-ui-id="keywordType"\n        data-ui-value="@keywordType"></span>\n    <input class="search-box" data-ui-type="TextBox"\n        data-ui-id="keyword" data-ui-value="@keyword" />\n    <button type="button" data-ui-type="Button" data-ui-id="searchBtn"></button>\n    \x3c!-- if: ${keyword} --\x3e\n    <button type="button"\n            data-ui-type="Button"\n            data-ui-id="clearKeyword"\n            title="清空搜索条件"\n            class="link-like clear-button">清空</button>\n    \x3c!-- /if --\x3e\n</span>\n\n\x3c!-- target: TPL_gpu_breadcrumb --\x3e\n<p class="breadcrumb">\n    <span>产品服务</span>\n    <span class="divider">/</span>\n    \x3c!-- if: ${fatherPage} --\x3e\n        <span><a href="${fatherUrl}">${fatherPage}</a></span>\n        <span class="divider">/</span>\n    \x3c!-- /if --\x3e\n    <span class="active">${currentPage}</span>\n</p>'}),define("gpu/common/mvc/ListAction",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","inf-ria/mvc/ListAction","babel-runtime/helpers/interop-require-default","inf-ria/decorators","../../config","./ListModel","./ListView"],function(exports,module,e,t,a,i,n,s,r,o){var c=i["default"](a),l=i["default"](r),d=i["default"](o),u=function(a){function i(){t["default"](this,r),a.apply(this,arguments)}e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.view.on(s.events.REFRESH,this.refresh,this),this.view.on(s.events.COMMAND,this.dispatchCommand,this),this.on(s.events.LIST_LOAD_ERROR,this.listDataFailedHandler,this)},i.prototype.refresh=function(){this.asyncListPage()},i.prototype.listDataFailedHandler=function(){this.view.updatePageData({tableData:[]},"<div><p>列表数据加载异常，请刷新页面！</p></div>")};var r=i;return i=n.action(l["default"],d["default"])(i)||i}(c["default"]);module.exports=u}),define("gpu/common/mvc/ListModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","inf-ria/mvc/ListModel","babel-runtime/helpers/interop-require-default","underscore","../../config"],function(exports,module,e,t,a,i,n,s,r){var o=n["default"](i),c=n["default"](s),l=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.filterQuery=function(e){var t=[];if(e.filters){var a=e.filters;delete e.filters;try{a=JSON.parse(a)}catch(i){}c["default"].each(a,function(e){t.push({keywordType:e[0],keyword:e[1]})})}return e.keyword&&t.push({keywordType:e.keywordType,keyword:e.keyword}),e.filters=t,e.pageNo&&(e.pageNo=+e.pageNo),e},n.prototype.getDownloadQuery=function(){var e=this.getQuery();return e.filters&&(e.filters=JSON.stringify(e.filters)),delete e.pageNo,delete e.pageSize,e},t["default"](n,[{key:"defaultArgs",get:function(){return{order:"desc",orderBy:"createTime",pageSize:r.gpu.instance.DEFAULT.PAGE_SIZE}}}]),n}(o["default"]);module.exports=l}),define("gpu/common/mvc/ListView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","inf-ria/mvc/ListView","babel-runtime/helpers/interop-require-default","underscore","common/util/tableUtil","../../config"],function(exports,module,e,t,a,i,n,s,r){var o=i["default"](a),c=i["default"](n),l=i["default"](s),d=function(a){function i(){t["default"](this,i),a.apply(this,arguments)}return e["default"](i,a),i.prototype.getUIEvents=function(){var e=this;return c["default"].extend({},l["default"].getListEvents(),{"table:command":function(t){e.triggerCommand(t.name,t.args),t.stopPropagation(),t.preventDefault()},"table:clipboard@aftercopy":function(t){e.showToast("已复制到剪贴板")},"table:clipboard@error":function(e){e.originalTarget.hide()},"keyword:enter":"submitSearch","refreshList:click":function(t){e.fire(r.events.REFRESH)},"clearKeyword:click":function(t){e.get("keyword").setValue(""),e.submitSearch(t)},"downloadList:click":function(e){window.open(this.model.getDownloadUrl())}})},i.prototype.updatePageData=function(e,t){var a=this.get("table");a&&a.setProperties({selectedIndex:[]}),a&&a.setProperties({datasource:e.tableData,noDataHtml:t||this.getUIProperties().table.noDataHtml});var i=this.get("pager");i.setProperties({count:e.totalCount}),i&&i.setProperties({page:e.pageNo})},i.prototype.renderTableByRow=function(e){var t=this.model.get("tableData");this.get("table").updateRowAt(e,t[e])},i.prototype.getSearchArgs=function(){var e=l["default"].getSearchArgs.call(this),t=this.model.get("filters");return t&&t.length>0&&(e.filters=JSON.stringify(t)),e},i.prototype.triggerCommand=function(e,t){try{t=JSON.parse(t)}catch(a){}this.fire(r.events.COMMAND,{command:e,args:t})},i}(o["default"]);module.exports=d}),define("gpu/config",["exports","module","underscore","babel-runtime/helpers/interop-require-default","./config/api","./config/tips","./config/events","./config/lang","./config/html","./config/rule","./config/instance"],function(exports,module,e,t,a,i,n,s,r,o,c){var l=t["default"](e),d=t["default"](a),u=t["default"](i),p=t["default"](n),f=t["default"](s),m=t["default"](r),h=t["default"](o),g=t["default"](c);module.exports=l["default"].extend({},{api:d["default"],tips:u["default"],events:p["default"],html:m["default"],lang:f["default"],gpu:{instance:g["default"]},rule:h["default"]})}),define("gpu/config/action",["exports","underscore","babel-runtime/helpers/interop-require-default","er/controller","../instance/action.conf"],function(exports,e,t,a,i){exports.__esModule=!0;var n=t["default"](e),s=t["default"](a),r=[t["default"](i)["default"]];exports.register=function(){return s["default"].registerAction(n["default"].flatten(r))}}),define("gpu/config/api",["exports","module"],function(exports,module){module.exports={getGpuInstanceList:"/api/bcc/gpu/instance/list",getGpuInstanceDetail:"/api/bcc/gpu/instance/detail",modGpuInstanceName:"/api/bcc/gpu/instance/rename",modGpuInstanceDesc:"/api/bcc/gpu/instance/update_desc",startGpuInstance:"/api/bcc/gpu/instance/start",stopGpuInstance:"/api/bcc/gpu/instance/stop",rebootGpuInstance:"/api/bcc/gpu/instance/reboot",rebuildGpuInstance:"/api/bcc/gpu/instance/rebuild",getGpuImageList:"/api/bcc/image/list",modBbcInstanceName:"/api/bbc/instance/rename",modBbcInstanceDesc:"/api/bbc/instance/update_desc",bbcInstanceRebuild:"/api/bbc/instance/rebuild"}}),define("gpu/config/events",["exports","module","underscore","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t){var a=t["default"](e);module.exports=a["default"].defaults({FORM_CHANGED:"formchanged",LIST_LOAD_ERROR:"listDataFailed"},{CHANGE:"change",BACKWARD:"backward",LOAD_ERROR:"loaderror",COMMAND:"command",FILTER:"filter",REFRESH:"refresh"})}),define("gpu/config/html",["exports","module","underscore","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t){var a=t["default"](e);module.exports={error:{inline:function(e){return'<span class="error">'+(e||"")+"</span>"}},loading:{inline:function(e){return'<span class="loading">'+(e||"")+"</span>"}},operation:{tableEdit:function(e){return e.disabled?"":'\n                        <span class="ui-table-cell-editentry"\n                            data-row="'+e.commandArgs.row+'" data-col="'+e.commandArgs.col+'"><i class="iconfont icon-edit"></i></span>\n                    '},linkButton:function(e){var t=e.disabled?'disabled="disabled"':"",i="cmd-button"+(e.disabled?" state-disabled":""),n=JSON.stringify(e.commandArgs);return'\n                <span class="opration">\n                    <button\n                        title="'+e.title+'"\n                        data-command="'+e.command+"\"\n                        data-command-args='"+a["default"].escape(n)+"'\n                        "+t+'\n                        class="'+i+'">\n                        '+e.label+"\n                    </button>\n                </span>\n            "},operationSelect:function(e){var t=e.disabled?'disabled="disabled"':"";return'\n                <option\n                    value="'+e.value+'"\n                    '+t+">\n                    "+e.name+"\n                </option>\n            "},inlineEdit:function(e){return'\n                <span class="inline-edit-icon"></span>\n                <div class="inline-edit-main">\n                    <input type="text" />\n                    <button type="button">确定</button>\n                    <button type="button">取消</button>\n                </div>\n            '},clipboard:function(e){return'\n                <button data-ui-type="Clipboard"\n                    class="link-copy link-like"\n                    data-ui-clipboard-text="'+e+'"\n                    data-ui-x-event-name="clipboard"\n                    data-ui-x-event-type="aftercopy,error"\n                    data-ui-x-event-bubble="true"\n                    data-ui-id="clipboard'+(arguments.length<=1||arguments[1]===undefined?"":arguments[1])+'">\n                    <i class="iconfont icon-copy" title="复制到剪贴板"></i>\n                </button>\n            '}}}}),define("gpu/config/instance",["exports","module"],function(exports,module){module.exports={DEFAULT:{PAGE_SIZE:10},IMAGE_TYPE:{COMMON:"gpuBbcCommon",CUSTOM:"gpuBbcCustom"},OS:{linux:{IMAGE_NAME:["ubuntu","centos","debian","linux"],ADMIN_NAME:"root"},windows:{IMAGE_NAME:["windows-server","windows"],ADMIN_NAME:"Administrator"}}}}),define("gpu/config/lang",["exports","module"],function(exports,module){module.exports={PAYMENT:{FREE:"试用",prepay:"预付费",postpay:"后付费"}}}),define("gpu/config/rule",["exports","module"],function(exports,module){module.exports={INSTANCE:{NAME:{placeholder:"大小写字母、数字以及-_ /.特殊字符，必须以字母开头，长度1-65",required:"required",requiredErrorMessage:"名称必填",pattern:/^[a-zA-Z][\w\-\/\.]{0,64}$/,patternErrorMessage:"名称不符合规则：支持大小写字母、数字以及-_ /.特殊字符，必须以字母开头，长度1-65"},PASSWORD:{required:"required",requiredErrorMessage:"密码必填",custom:function(e){return e.length>7&&e.length<33&&/[a-zA-Z]/.test(e)&&/\d/.test(e)&&/[!@#$%^*()]/.test(e)&&/^[a-zA-Z\d!@#$%^*()]+$/.test(e)},customErrorMessage:"8～32位字符，英文、数字和符号必须同时存在，符号仅限!@#$%^*()"}}}}),define("gpu/config/tips",["exports","module"],function(exports,module){module.exports={changePwd:{pwdDescription:"8～17位字符，英文、数字和符号必须同时存在，符号仅限!@#$%^*()"},rebuildOs:{confirmPwd:"请牢记此管理员密码，系统将不再通过短信发送用户自定义密码"}}}),define("gpu/enums",["exports","inf-ria/EnumX","babel-runtime/helpers/interop-require-default"],function(exports,e,t){exports.__esModule=!0;var a=new(t["default"](e)["default"])({alias:"ACTIVE",text:"运行中",value:"ACTIVE",klass:"normal"},{alias:"SHUTOFF",text:"已关机",value:"SHUTOFF",klass:"unavailable"},{alias:"PAUSED",text:"已睡眠",value:"PAUSED",klass:"warning"},{alias:"SUSPENDED",text:"已休眠",value:"SUSPENDED",klass:"warning"},{alias:"RESCUE",text:"已修复",value:"RESCUE",klass:"warning"},{alias:"ERROR",text:"错误",value:"ERROR",klass:"error"},{alias:"SOFT_DELETED",text:"已删除",value:"SOFT_DELETED",klass:"warning"},{alias:"BUILD",text:"创建中",value:"BUILD",klass:"warning rolling"},{alias:"VERIFY_RESIZE",text:"扩容确认中",value:"VERIFY_RESIZE",klass:"warning"},{alias:"REVERT_RESIZE",text:"扩容回滚中",value:"REVERT_RESIZE",klass:"warning"},{alias:"EXPIRED",text:"已到期",value:"EXPIRED",klass:"error"},{alias:"SHELVED",text:"搁置",value:"SHELVED",klass:"warning"},{alias:"SHELVED_OFFLOADED",text:"搁置",value:"SHELVED_OFFLOADED",klass:"warning"},{alias:"SNAPSHOT",text:"创建快照中",value:"SNAPSHOT",klass:"warning rolling"},{alias:"ROLLBACK_SNAPSHOT",text:"回滚快照中",value:"ROLLBACK_SNAPSHOT",klass:"warning"},{alias:"DELETE_SNAPSHOT",text:"删除快照中",value:"DELETE_SNAPSHOT",klass:"warning"},{alias:"TEMPLATE",text:"创建镜像中",value:"TEMPLATE",klass:"warning rolling"},{alias:"REBOOT",text:"重启中",value:"REBOOT",klass:"warning"},{alias:"HARD_REBOOT",text:"重启中",value:"HARD_REBOOT",klass:"warning"},{alias:"PASSWORD",text:"重置密码中",value:"PASSWORD",klass:"warning"},{alias:"REBUILD",text:"重建中",value:"REBUILD",klass:"warning"},{alias:"MIGRATING",text:"迁移中",value:"MIGRATING",klass:"warning"},{alias:"RESIZE",text:"资源扩展中",value:"RESIZE",klass:"warning"},{alias:"DELETING",text:"释放中",value:"DELETING",klass:"warning"},{alias:"BINDING",text:"绑定中",value:"BINDING",klass:"warning"},{alias:"UNBINDING",text:"解绑中",value:"UNBINDING",klass:"warning"},{alias:"POWERING_OFF",text:"关机中",value:"POWERING_OFF",klass:"warning"},{alias:"POWERING_ON",text:"开机中",value:"POWERING_ON",klass:"warning"},{alias:"OFFLINE",text:"专属服务器离线",value:"OFFLINE",klass:"warning"},{alias:"DCC_EXPIRED",text:"专属服务器已到期",value:"DCC_EXPIRED",klass:"warning"});exports.InstanceStatus=a,a.getFilterStatus=function(){return[{name:"全部状态",value:""}].concat(a.toArray("ACTIVE","SHUTOFF","EXPIRED","BUILD","REBUILD"))}}),define("gpu/instance/action.conf",["exports","module","common/component/action_category","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t){var a=t["default"](e);module.exports=[{path:"/gpu/instance/list",type:"gpu/instance/list/Action",category:a["default"].LIST},{path:"/gpu/instance/operation/rebuildOs",type:"gpu/instance/operation/rebuildOs/Action"}]}),define("gpu/instance/list/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","../../common/mvc/ListAction","babel-runtime/helpers/interop-require-default","inf-ria/decorators","underscore","./Model","./View","../../config","../operation"],function(exports,module,e,t,a,i,n,s,r,o,c,l){var d=i["default"](a),u=i["default"](s),p=i["default"](r),f=i["default"](o),m=i["default"](l),h=function(a){function i(){t["default"](this,s),a.apply(this,arguments)}e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.view.on(c.events.FILTER,this.filterList,this)},i.prototype.filterList=function(e){this.model.setFilters(e.condition)},i.prototype.syncModelToViewIterator=function(e){switch(e.name){case"filters":this.view.submitSearch(e)}},i.prototype.dispatchCommand=function(e){var t=e.command,a=e.args;this[t]?this[t](a):m["default"].processor[t]?m["default"].processor[t].call(this,a):alert("请添加方法：operation."+t+"\nargs is:\n"+JSON.stringify(a,null,4))},i.prototype.edit=function(e){var t=this,a=e.toUpdate,i=e.row;u["default"].has(a,"name")&&m["default"].processor.editName.call(this,e).then(function(){return t.view.renderTableByRow(i)}).fail(function(e){return t.view.get("table").showEditError(e.field.name)})},i.prototype.unbindEip=function(e){var t=this;m["default"].processor.unbindEip.call(this,e).then(function(){return t.refresh()})},i.prototype.bindEip=function(e){m["default"].processor.bindEip.call(this,e)},i.prototype.startInstance=function(e){var t=this;m["default"].processor.startInstance.call(this,e).then(function(){return t.refresh()})},i.prototype.stopInstance=function(e){var t=this;m["default"].processor.stopInstance.call(this,e).then(function(){return t.refresh()})},i.prototype.rebootInstance=function(e){var t=this;m["default"].processor.rebootInstance.call(this,e).then(function(){return t.refresh()})};var s=i;return i=n.action(p["default"],f["default"])(i)||i}(d["default"]);module.exports=h}),define("gpu/instance/list/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","../../common/mvc/ListModel","babel-runtime/helpers/interop-require-default","underscore","../../config","./ui/tableFields","er/URL"],function(exports,module,e,t,a,i,n,s,r,o){var c=n["default"](i),l=n["default"](s),d=n["default"](o),u={"x-silent":!0},p=function(i){function n(e){a["default"](this,n),i.call(this,e)}return e["default"](n,i),n.prototype.listRequester=function(e){return r.api.getGpuInstanceList(e,u)},n.prototype.prepare=function(){this.setTableFields()},n.prototype.setTableFields=function(){var e=this.get("filters");if("string"==typeof e){try{e=JSON.parse(e)}catch(t){}this.set("filters",e,{silent:!0})}e&&e.length>0?l["default"].each(d["default"],function(t){t.filter&&l["default"].each(e,function(e){e[0]===t.field&&(t.filter.value=e[1])})}):l["default"].each(d["default"],function(e){e.filter&&(e.filter.value=null)}),this.set("tableFields",d["default"])},n.prototype.setFilters=function(e){this.set("filters",e)},n.prototype.updateTableData=function(e,t,a,i){var n=this.get("tableData");if(i&&i.silent)n[a][e]=t,this.set("tableData",n);else{var s=l["default"].deepClone(n);s[a][e]=t,this.set("tableData",s)}},n.prototype.editName=function(e,t,a){var i=this;return r.api.modBbcInstanceName({name:e,instanceIds:t},u).then(function(t){i.updateTableData("name",e,a)})},n.prototype.getDownloadUrl=function(){return"/api/bcc/gpu/instance/download?"+require("er/URL").serialize(this.getDownloadQuery())},t["default"](n,[{key:"datasource",get:function(){return{menu:function(e){return"gpu"}}}}]),n}(c["default"]);module.exports=p}),define("gpu/instance/list/tpl",[],function(){return'\x3c!-- target: TPL_gpu_instance_list --\x3e\n<div class="gpu-wrapper gpu-list main-wrap-new instance-list">\n    <div class="content-wrap">\n        \x3c!-- use: TPL_gpu_breadcrumb(currentPage=\'GPU服务器 - 列表\') --\x3e\n        <div class="list-content">\n            <h2>\n                ${i18n.GPU服务器列表}\n            </h2>\n            <div class="table-full-wrap">\n                <div class="operation-wrap" data-follow-thead="table">\n                    <div class="buttons-wrap">\n                        <button data-ui-type="Button"\n                            data-ui-id="startInstance"\n                            title="${i18n.启动GPU服务器}">${i18n.开启}</button>\n                        <button data-ui-type="Button"\n                                data-ui-id="stopInstance"\n                                title="${i18n.关闭GPU服务器}">${i18n.停止}</button>\n                        <button data-ui-type="Button"\n                                data-ui-id="rebootInstance"\n                                title="${i18n.重新启动GPU服务器}">${i18n.重启}</button>\n                        <button type="Button"\n                            data-ui-type="Button"\n                            data-ui-id="batchEditName"\n                            title="${i18n.批量修改名称}">${i18n.修改名称}</button>\n                        <button type="Button"\n                            data-ui-type="Button"\n                            data-ui-id="rebuildOs"\n                            title="${i18n.重装操作系统}">${i18n.重装操作系统}</button>\n                    </div>\n                    <div class="buttons-quick-wrap">\n                        \x3c!-- import: TPL_gpu_common_search --\x3e\n                        <button type="button"\n                            data-ui-type="Button" data-ui-id="refreshList" title="${i18n.刷新表格数据}">\n                            <i class="iconfont icon-refresh"></i>\n                        </button>\n                        <button data-ui="type:Button;id:downloadList;" title="${i18n.下载当前列表展现的专属服务器信息，编码格式为utf-8}">\n                            <i class="iconfont icon-download"></i>\n                        </button>\n                        <div id="table-custom-fields-container"></div>\n                    </div>\n                </div>\n                <div data-ui-type="Table" data-ui-id="table"\n                     data-ui-datasource="@tableData"\n                     data-ui-order-by="@orderBy" data-ui-order="@order"\n                     data-ui-select="@selectMode" data-ui-extension-tip-type="TableTip"\n                     data-ui-extension-command-type="Command"\n                     data-ui-extension-tableedit-type="TableEdit"\n                     data-ui-extension-tableex-type="TableEx"\n                     data-ui-extension-customfields-type="TableCustomFields"\n                     data-ui-extension-tablefilter-type="TableFilter">\n                </div>\n                <div class="ui-row">\n                    \x3c!-- import: listPager --\x3e\n                </div>\n            </div>\n        </div>\n    </div>\n</div>'}),define("gpu/instance/list/ui",["exports","jquery","babel-runtime/helpers/interop-require-default","underscore","inf-i18n","common/util/tableUtil","../../config","../operation","../permission"],function(exports,e,t,a,i,n,s,r,o){function c(){var e=this.get("table").getSelectedItems();return d["default"].pluck(e,"id")}exports.__esModule=!0,exports.getUIProperties=function(){return{table:p["default"].tableProperty("@tableFields",{followHead:!0,noFollowHeadCache:!0,followDoms:[l["default"](".operation-wrap")[0]],editable:1,noDataHtml:"<div><p>"+u["default"]("没有相关数据!")+"</p></div>",extTableEx:["name"],extTableCustomFields:{container:"#table-custom-fields-container",defaults:["name","status","flavor","flavorDetail","publicIp","internalIp"],locked:{head:["name"]}}}),pager:{pageSizes:[10,20,50,100]},keywordType:{datasource:[{name:"GPU服务器名称",value:"name"},{name:"GPU服务器ID",value:"instanceId"},{name:"GPU服务器内网IP",value:"internalIp"},{name:"GPU服务器公网IP",value:"publicIp"}]},keyword:{placeholder:"请输入GPU服务器名称进行搜索"}}},exports.getUIEvents=function(){return{"table:select":function(){p["default"].setButtonStatusOfTable(this,{startInstance:{rule:function(e){return!m["default"].checkIfShouldDisabled(f["default"].NAME.START_INSTANCE,e)}},stopInstance:{rule:function(e){return!m["default"].checkIfShouldDisabled(f["default"].NAME.STOP_INSTANCE,e)}},rebootInstance:{rule:function(e){return!m["default"].checkIfShouldDisabled(f["default"].NAME.REBOOT_INSTANCE,e)}},batchEditName:{rule:function(e){return!m["default"].checkIfShouldDisabled(f["default"].NAME.EDIT_NAME,e)}},rebuildOs:{rule:function(e){return!m["default"].checkIfShouldDisabled(f["default"].NAME.REBUILD_OS,e)}}})},"table:saveedit":function(e){var t,a=(t={},t[e.field.field]=e.value,t),i={row:[e.rowIndex],toUpdate:a,data:this.model.get("tableData")[e.rowIndex]};this.triggerCommand("edit",i)},"batchEditName:click":function(e){var t=this.get("table").getSelectedItems();this.triggerCommand("batchEditName",t)},"startInstance:click":function(e){var t=c.call(this).join(",");this.triggerCommand("startInstance",{instanceId:t})},"stopInstance:click":function(e){var t=c.call(this).join(",");this.triggerCommand("stopInstance",{instanceId:t})},"rebootInstance:click":function(e){var t=c.call(this).join(",");this.triggerCommand("rebootInstance",{type:"soft",instanceId:t})},"rebuildOs:click":function(e){this.triggerCommand("rebuildOs",this.get("table").getSelectedItems())},"table:filter":function(e){var t=this.get("table").fields[e.fieldIndex],a=this.model.get("filters")||[],i=d["default"].reject(a,function(e){return e[0]===t.field});i.push([t.field,e.value]),this.fire(s.events.FILTER,{condition:i})}}};var l=t["default"](e),d=t["default"](a),u=t["default"](i),p=t["default"](n),f=t["default"](r),m=t["default"](o)}),define("gpu/instance/list/ui/tableFields",["exports","module","underscore","babel-runtime/helpers/interop-require-default","inf-i18n","common/util/timeUtil","../../../config","../../../enums","../../operation","../../permission"],function(exports,module,e,t,a,i,n,s,r,o){var c=t["default"](e),l=t["default"](a),d=t["default"](i),u=t["default"](r),p=t["default"](o);module.exports=[{field:"name",title:l["default"]("名称/ID"),width:"15%",minWidth:145,sortable:!0,content:function(e,t,a){var i=c["default"].escape(e.name);if(!e.id&&!e.instanceId)return'<span class="instance-name">'+i+"</span>";var s={commandArgs:{row:t,col:a,data:e}},r=c["default"].defaults({command:u["default"].NAME.EDIT_NAME,disabled:p["default"].checkIfShouldDisabled(u["default"].NAME.EDIT_NAME,e)},s);return'\n                <span title="'+i+'" class="instance-name">\n                    '+i+"\n                </span>\n                "+n.html.operation.tableEdit(r)+'\n                <br />\n                <div>\n                    <span class="intsance-id" title="'+(e.instanceId||e.id)+'">\n                        '+(e.instanceId||e.id)+"\n                    </span>\n                    "+n.html.operation.clipboard(e.instanceId,t)+"\n                </div>\n            "},editContent:function(e){return c["default"].escape(e.name)},editNote:n.rule.INSTANCE.NAME.placeholder,editRules:c["default"].omit(n.rule.INSTANCE.NAME,"placeholder")},{field:"status",title:l["default"]("状态"),width:"9%",minWidth:75,filter:{datasource:s.InstanceStatus.getFilterStatus()},content:function(e){var t=s.InstanceStatus.getTextFromValue(e.status);return'\n                <span class=" status '+s.InstanceStatus.fromValue(e.status).klass+'">\n                    '+t+"\n                </span>\n            "}},{field:"flavor",title:l["default"]("套餐"),width:"10%",minWidth:70,content:function(e,t,a){return e.bbcFlavor?e.bbcFlavor.name_fri:"-"}},{field:"flavorDetail",title:l["default"]("套餐详情"),width:"15%",minWidth:200,content:function(e,t,a){var i=e.bbcFlavor;return i?"\n                CPU："+(i.bbc_cpu_type?i.bbc_cpu_type:"-")+"/\n                "+(i.bbc_cpu_cores?i.bbc_cpu_cores:"-")+"<br />\n                内存："+(i.bbc_memory?i.bbc_memory:"-")+"<br />\n                磁盘："+(i.bbc_disk?i.bbc_disk:"-")+"<br />\n                网卡："+(i.bbc_network?i.bbc_network:"-")+"<br />\n                GPU："+(i.bbc_gpu?i.bbc_gpu:"-")+"\n            ":"-"}},{field:"publicIp",title:l["default"]("公网IP/带宽"),width:"12%",minWidth:120,content:function(e,t,a){var i=e.publicIp?e.publicIp:"-",s=e.network?e.network+"Mbps":"-",r={command:u["default"].NAME.BIND_EIP,commandArgs:{row:t,col:a,data:e},label:'<i class="iconfont icon-bind"></i>',title:l["default"]("绑定EIP"),disabled:p["default"].checkIfShouldDisabled(u["default"].NAME.BIND_EIP,e)},o={command:u["default"].NAME.UNBIND_EIP,commandArgs:{row:t,col:a,data:e},label:'<i class="iconfont icon-unbind"></i>',title:l["default"]("解绑EIP"),disabled:p["default"].checkIfShouldDisabled(u["default"].NAME.UNBIND_EIP,e)};return"\n                "+(e.publicIp?i+"/"+s+n.html.operation.linkButton(o):i+"/"+s+n.html.operation.linkButton(r))+"\n            "}},{field:"internalIp",title:l["default"]("内网IP"),width:"12%",minWidth:120,content:function(e,t,a){return e.internalIp||"-"}},{field:"os",title:"OS",width:"6%",minWidth:40,content:function(e,t,a){var i=c["default"].escape(e.osName||e.osType),s=i+c["default"].escape(e.osVersion),r=i.toLowerCase().replace(/\s/g,"-");return c["default"].find(n.gpu.instance.OS,function(e){return c["default"].contains(e.IMAGE_NAME,r)})?'\n                <div class="sys-icon '+r+'" title="'+s+'">\n\n                </div>\n            ':"-"}},{field:"createTime",title:l["default"]("创建时间"),width:"11%",minWidth:100,sortable:!0,content:function(e){return d["default"].toDate(e.createTime)||"-"}}]}),define("gpu/instance/list/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!../../common/common.tpl","bat-ria/tpl!./tpl","../../common/mvc/ListView","babel-runtime/helpers/interop-require-default","inf-ria/decorators","underscore","esui/Button","inf-ria/ui/Clipboard","./ui"],function(exports,module,e,t,a,i,n,s,r,o,c,l,d,u){var p=r["default"](s),f=r["default"](c),m=function(i){function n(){a["default"](this,s),i.apply(this,arguments)}e["default"](n,i),n.prototype.getUIEvents=function(){var e=i.prototype.getUIEvents.call(this);return f["default"].extend({},e,u.getUIEvents.apply(this))},n.prototype.enterDocument=function(){i.prototype.enterDocument.call(this),this.model.get("keywordType")&&this.get("keywordType").fire("change")},t["default"](n,[{key:"uiProperties",get:function(){return u.getUIProperties.apply(this)}}]);var s=n;return n=o.template("TPL_gpu_instance_list")(n)||n}(p["default"]);module.exports=m}),define("gpu/instance/operation",["exports","module","promise","babel-runtime/helpers/interop-require-default","inf-ria/helper","inf-ria/app/brpc","common/util/dialog","../config","../util"],function(exports,module,e,t,a,i,n,s,r){var o=t["default"](e),c=t["default"](a),l=t["default"](i),d=t["default"](n);module.exports={NAME:{EDIT_NAME:"editName",NETWORK_CHANGE:"networkChange",BIND_EIP:"bindEip",UNBIND_EIP:"unbindEip",REBUILD_OS:"rebuildOs",REBOOT_INSTANCE:"rebootInstance",START_INSTANCE:"startInstance",STOP_INSTANCE:"stopInstance"},processor:{editName:function(e){var t=e.row,a=e.toUpdate,i=e.data;return this.model.editName(a.name,i.id,t)},batchEditName:function(e){return d["default"].waitActionDialog(this.view,{title:"批量修改GPU服务器名称名称",width:540,needFoot:!0,url:"/dcc/instance/operation/changeName",actionOptions:{instances:e,parentAction:this}})},networkChange:function(e){var t=e.publicIp;return c["default"].redirectToModule("eip","/eip/instance/upgrade_config",{ip:t}),o["default"].resolve()},unbindEip:function(e){var t=e.data;return r.confirmHandler.call(this,{title:"提示",content:"您确定解绑"+t.publicIp+"吗？",width:320},s.api.unbindEipInstance,{eip:t.publicIp})},bindEip:function(e){var t=this,a=e.data,i={instanceType:"GPU",instancePayment:a.payment,instanceId:a.id,listRequester:s.api.eipInstanceList,submitRequester:s.api.bindEipInstance};return l["default"].invokeService("eip://bind",i).then(function(){return t.reload()})},startInstance:function(e){return r.confirmHandler.call(this,{title:"启动",content:"确定启动吗？",width:280},s.api.startGpuInstance,e)},stopInstance:function(e){return r.confirmHandler.call(this,{title:"停止",content:"GPU服务器停止后相关服务将不可访问，确定停止吗？",width:420},s.api.stopGpuInstance,e)},rebootInstance:function(e){return r.confirmHandler.call(this,{title:"重启",content:"重启过程中相关服务会中断，确定重启吗？",width:400},s.api.rebootGpuInstance,e)},rebuildOs:function(e){var t=this;return d["default"].waitActionDialog(this.view,{title:"重装操作系统",width:600,needFoot:!0,url:"/gpu/instance/operation/rebuildOs",actionOptions:{instances:e,parentAction:this}}).then(function(e){var a=e.target;t.dialog=a;a.getAction().view.get("form").on("aftervalidate",function(e){e.isValid&&a.hide()})})}}}}),define("gpu/instance/operation/rebuildOs/Action",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormAction","babel-runtime/helpers/interop-require-default","./Model","./View"],function(exports,module,e,t,a,i,n,s){var r=i["default"](a),o=i["default"](n),c=i["default"](s),l=function(a){function i(e){t["default"](this,i),a.call(this,e),this.modelType=o["default"],this.viewType=c["default"]}return e["default"](i,a),i.prototype.initBehavior=function(){a.prototype.initBehavior.call(this)},i.prototype.syncModelToViewIterator=function(e){switch(e.name){case"osLoading":this.view.repaintOs()}},i.prototype.redirectAfterSubmit=function(){var e=this.model.get("parentAction");e&&(e.redirectAfterChangePwd&&e.redirectAfterChangePwd()||e.reload())},i.prototype.handleSubmitError=function(e){var t=this.model.get("parentAction");t&&t.dialog&&t.dialog.show(),e.field&&e.field.mfa||this.view.showToast(e&&e.global?e.global:"操作失败",{messageType:"error"})},i}(r["default"]);module.exports=l}),define("gpu/instance/operation/rebuildOs/Model",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormModel","babel-runtime/helpers/interop-require-default","underscore","promise","../../../config","../../../enums"],function(exports,module,e,t,a,i,n,s,r,o,c){var l=n["default"](i),d=n["default"](s),u=n["default"](r),p={silent:!0},f={showLoading:!1,"X-silence":!0},m=function(i){function n(){a["default"](this,n),i.apply(this,arguments)}return e["default"](n,i),n.prototype.submitRequester=function(e){return o.api.bbcInstanceRebuild(e,p)},n.prototype.prepare=function(){this.loadImageAndOs(),this.set("isActive",this.get("instances")[0].status===c.InstanceStatus.ACTIVE)},n.prototype.loadImageAndOs=function(){var e=this,t=o.gpu.instance.IMAGE_TYPE;this.set("osLoading",!0),u["default"].all([this.getImageslist({imageType:t.COMMON}),this.getImageslist({imageType:t.CUSTOM})]).then(function(){var a,i,n=e.get(t.COMMON),s=e.get(t.CUSTOM);e.set("osTypeMap",(a={},a[t.COMMON]=n.osType,a[t.CUSTOM]=s.osType,a)),e.set("osVersionMap",(i={},i[t.COMMON]=n.osVersion,i[t.CUSTOM]=s.osVersion,i)),e.set("osLoading",!1)})},n.prototype.getImageslist=function(e){var t=this;return o.api.getGpuImageList(e,f).then(function(a){t.set(e.imageType,t.transforImageAndOs(a.result))})},n.prototype.transforImageAndOs=function(e){var t=[],a={},i=d["default"].groupBy(e,"osName");return d["default"].each(i,function(e,i){t.push({name:i,value:e[0].osType,title:i.toLowerCase()}),a[i]=d["default"].map(e,function(e){return{name:e.name,value:e.id,imageId:e.id}})}),{osType:t,osVersion:a}},n.prototype.getExtraData=function(){return{instanceId:d["default"].pluck(this.get("instances"),"id").join(",")}},n.prototype.validateSubmitData=function(e){var t=!!e._isPasswordMatch||{confirm:"确认密码和新密码不一致"};return e._isPasswordMatch=undefined,t},n.prototype.filterData=function(e){return e._isPasswordMatch=e.adminPass===e.confirm,e},n.prototype.invalidateAuthCode=function(){return o.api.invalidateAuthCode()},t["default"](n,[{key:"datasource",get:function(){return{tips:function(){return o.tips}}}}]),n}(l["default"]);module.exports=m}),define("gpu/instance/operation/rebuildOs/tpl",[],function(){return'\x3c!-- target: TPL_gpu_instance_rebuild --\x3e\n<div class="bbc-wrapper gpu-rebuild-dialog">\n    <form data-ui="type:Form;id:form;autoValidate:true;">\n        <div class="form-data-body">\n            <div class="form-row">\n                <div class="operation-tip">\n                    ${i18n.重装系统会清除系统盘内数据且不可恢复（数据盘数据不受影响），}\n                    \x3c!-- if: ${isActive} --\x3e${i18n.同时云服务器服务会中断几分钟，}\x3c!-- /if --\x3e\n                    ${i18n.确定重装吗？}\n                </div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.镜像类型：}</label>\n                <div class="form-value">\n                    <div data-ui-id="imageType"\n                         data-ui-type="RadioSelect"\n                         class="ui-radioselect-custom"></div>\n                </div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.选择镜像：}</label>\n                <div class="form-value">\n                    <div data-ui-type="Select"\n                         data-ui-width="120"\n                         data-ui-id="osType"\n                         data-ui-name="osType"\n                         data-ui-hidden="true"></div>\n                    <div data-ui-type="Select"\n                         data-ui-width="260"\n                         data-ui-required="required"\n                         data-ui-name="osVersion"\n                         data-ui-required-error-message="${i18n.请选择一个自定义镜像}"\n                         data-ui-id="osVersion"\n                         data-ui-hidden="true"></div>\n                    <div data-ui-type="Label" data-ui-id="osLoading" class="loading">\n                        ${i18n.加载中，请稍候...}\n                    </div>\n                </div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.保留数据分区：}</label>\n                <div class="form-value">\n                    <div data-ui-type="ToggleButton"\n                        data-ui-id="partitionOnOff"\n                        data-ui-checked="true"\n                        data-ui-disabled="true"\n                        class="partition">${i18n.保留}</div>\n                    <span>${i18n.保留}</span>\n                </div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.管理员用户名：}</label>\n                <div class="form-value">\n                    <div data-ui="type:Label;id:adminName;" class="gpu-admin-name">root</div>\n                </div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.管理员新密码：}</label>\n                <div class="form-value">\n                    <input type="password"\n                        data-ui-custom-error-message="${i18n.密码不符合规则}"\n                        data-ui-required="required"\n                        data-ui-required-error-message="${i18n.新密码必填}"\n                        data-ui-type="TextBox"\n                        data-ui-id="adminPass"\n                        data-ui-name="adminPass"\n                        data-ui-width="320" />\n                    <br />\n                    <label data-ui-type="Validity"\n                        data-ui-id="adminPassValidity" ></label>\n                    <div data-ui="type:Label;id:passwordTip;" class="gpu-note">\n                    </div>\n                </div>\n            </div>\n            <div class="form-row">\n                <label>${i18n.确认密码：}</label>\n                <div class="form-value">\n                    <input type="password"\n                        data-ui-type="TextBox"\n                        data-ui-required="required"\n                        data-ui-required-error-message="${i18n.确认密码必填}"\n                        data-ui-id="confirm"\n                        data-ui-name="confirm"\n                        data-ui-width="320" />\n                    <br/>\n                    <label data-ui-type="Validity"\n                        data-ui-id="confirmValidity" ></label>\n                    <div class="gpu-note">${tips.rebuildOs.confirmPwd}</div>\n                </div>\n            </div>\n        </div>\n    </form>\n</div>\n\n\x3c!-- target: TPL_gpu_instance_rebuild_child --\x3e\n\x3c!-- import: TPL_gpu_instance_rebuild --\x3e\n'}),define("gpu/instance/operation/rebuildOs/View",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormView","babel-runtime/helpers/interop-require-default","bat-ria/tpl!./tpl","../../../config"],function(exports,module,e,t,a,i,n,s){var r=function(a){function i(){t["default"](this,i),a.call(this),this.template="TPL_gpu_instance_rebuild"}return e["default"](i,a),i.prototype.getUIProperties=function(){return{imageType:{datasource:[{name:"公共镜像",value:s.gpu.instance.IMAGE_TYPE.COMMON},{name:"自定义镜像",value:s.gpu.instance.IMAGE_TYPE.CUSTOM,disable:!0}]},osType:{datasource:[]},osVersion:{datasource:[]},adminPass:{custom:function(e){return s.rule.INSTANCE.PASSWORD.custom(e)},validityLabel:"adminPassValidity"},passwordTip:{text:s.rule.INSTANCE.PASSWORD.customErrorMessage},confirm:{custom:function(e){return this.viewContext.controls.adminPass.getValue()===this.getValue()},customErrorMessage:"确认密码和新密码不一致",validityLabel:"confirmValidity"},asswordTip:{text:s.rule.INSTANCE.PASSWORD.customErrorMessage}}},i.prototype.getUIEvents=function(){return{"imageType:change":"repaintOs","osType:change":"repaintOsVersion","adminPass:input":function(e){e.target.validate()},"confirm:input":function(e){this.get("adminPass").getValue()!==e.target.getValue()?this.notifyErrors({confirm:"确认密码和新密码不一致"}):e.target.hideValidity()},"authCode:action":function(e){this.fire("SEND_AUTH_CODE")},"submit:click":function(e){this.fire("rebuildOs")}}},i.prototype.getExtraFormData=function(){return{imageId:this.get("osVersion").getSelectedItem().imageId}},i.prototype.repaintOs=function(){var e=this.get("imageType").getValue(),t=this.model.get("osTypeMap");this.get("osLoading").hide(),this.get("osType").setProperties({datasource:t[e],hidden:!1}),this.repaintOsVersion()},i.prototype.repaintOsVersion=function(){var e=this.get("imageType").getValue(),t=this.get("osType").getSelectedItem(),a=this.model.get("osVersionMap");this.get("osVersion").setProperties({datasource:a[e][t.name],hidden:!1}),this.get("adminName").setText(s.gpu.instance.OS[t.value].ADMIN_NAME)},i}(i["default"](a)["default"]);module.exports=r}),define("gpu/instance/permission",["exports","module","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","./operation","../enums"],function(exports,module,e,t,a,i,n){var s,r=a["default"](t),o=a["default"](i),c=o["default"].NAME,l=(s={},s[n.InstanceStatus.ACTIVE]=[c.STOP_INSTANCE,c.REBOOT_INSTANCE,c.EDIT_NAME,c.REBUILD_OS,c.BIND_EIP,c.UNBIND_EIP,c.NETWORK_CHANGE,c.EDIT_DESCRIPTION],s[n.InstanceStatus.SHUTOFF]=[c.START_INSTANCE,c.REBUILD_OS,c.BIND_EIP,c.UNBIND_EIP,c.NETWORK_CHANGE,c.EDIT_DESCRIPTION],s),d=function(){function t(){e["default"](this,t)}return t.prototype.getOperationsByStatus=function(e){return l[e]||[]},t.prototype.isGranted=function(e,t){return r["default"].contains(this.getOperationsByStatus(e),t)},t.prototype.checkIfShouldDisabled=function(e,t){if(r["default"].indexOf(["createInstance","inlineedit"],e)>-1)return!1;if(this.isGranted(t.status,e))switch(e){case o["default"].NAME.NETWORK_CHANGE:return!t.publicIp;default:return!1}return!0},t}();module.exports=new d}),define("gpu/startup",["exports","bat-ria/tpl!../bcc/common.tpl","promise","babel-runtime/helpers/interop-require-default","./config","./config/action"],function(exports,e,t,a,i,n){exports.__esModule=!0;var s=a["default"](t),r=a["default"](i);exports.start=function(){return n.register(),s["default"].resolve(r["default"])}}),define("gpu/util",["exports","module","../dcc/util","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t){var a=t["default"](e);module.exports=a["default"]});
//# sourceMappingURL=startup.js.map