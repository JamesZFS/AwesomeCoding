define("bmr/cluster/config",["exports","module","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","er/controller","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t,a,n){n["default"](a)["default"].registerAction([{path:"/bmr/list",movedTo:"/bmr/cluster/list"},{type:"bmr/cluster/List",path:"/bmr/cluster/list"},{type:"bmr/cluster/create/Create",path:"/bmr/cluster/create"},{path:"/bmr/create",movedTo:"/bmr/cluster/create"},{type:"bmr/cluster/Scale",path:"/bmr/cluster/scale"}]);var i=function(){function a(){t["default"](this,a)}return e["default"](a,[{key:"filter",get:function(){return[{name:"集群名称",value:"SEARCH_CLUSTER_NAME"},{name:"集群ID",value:"SEARCH_CLUSTER_ID"}]}},{key:"BMR_LISTEN_INTERVAL",get:function(){return 6e4}}]),a}();module.exports=new i}),define("bmr/cluster/create/Create",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","common/region","../../enums","./CreateView","./CreateModel","common/util/orderUtil","common/constants","bat-ria/mvc/BaseAction"],function(exports,module,e,t,a,n,i,r,l,s,o,u,d,c){var p=i["default"](n),m=i["default"](r),f=i["default"](s),b=i["default"](o),h=i["default"](u),v=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.initBehavior=function(){n.prototype.initBehavior.call(this),this.view.on("PICK",this.pick,this),this.view.on("REDIRECT_TO_LIST",this.redirectToList,this),this.view.on("RANDOM_PASSWORD",this.randomPass,this),this.model.isCopy()&&this.view.asyncFormState()},i.prototype.pick=function(){var e=this,t={name:this.view.get("clusterName").getValue(),sendMessage:this.view.get("smsToggle").isChecked(),alarmEnabled:this.view.get("alarmToggle").isChecked(),adminPassword:this.view.get("adminPassword").getValue(),availabilityZone:this.view.get("availabilityZone").getValue(),vpcId:this.view.get("vpcId").getValue(),subnetId:this.view.get("subnetId").getValue(),autoTerminate:this.view.get("autoTerminateToggle").isChecked(),systemSecurityGroup:this.view.get("systemSecurityGroup").getValue(),logUri:this.view.get("logToggle").isChecked()?this.view.get("logUri").getValue():null},a=this.view.get("appPanel").action.getFormData();if(p["default"].extend(t,p["default"].pick(a,"imageType","imageVersion","applications")),p["default"].extend(t,this.view.get("flavorPanel").action.getFormData()),p["default"].extend(t,{reminder:this.view.get("reminderPanel").action.getFormData()}),this.view.validate()){var n=function(){var a=e.convertFormData2Order(t);return{v:e.model.validateSubmit(t).then(function(){return e.view.renderOrderConfirm(a,t)})}}();if("object"==typeof n)return n.v}},i.prototype.convertFormData2Order=function(e){var t=null;if(e.payType===l.PayType.PREPAY){t="￥"+(e.price/e.purchaseLength).toFixed(2)+"/月"}else t="￥"+e.price+"/小时";var a={serviceType:"BMR",productType:e.payType,type:"NEW",price:"100",items:[{serviceType:"BMR",productType:e.payType,count:1,time:e.purchaseLength,timeUnit:"MONTH",price:e.price,unitPriceShow:t,chargeType:d.SERVICE_TYPE.BMR.chargeType[e.payType],configuration:["地域："+m["default"].getCurrentRegion().label,"镜像："+e.imageType,"镜像版本："+e.imageVersion]}]};return h["default"].make(a)},i.prototype.redirectToList=function(){this.redirect("/bmr/cluster/list")},i.prototype.randomPass=function(){for(var e="",t=[].concat(p["default"].range(97,122),p["default"].range(65,90),p["default"].range(48,57)),a=["!","@","#","$","%","^","*","(",")"],n=p["default"].random(8,17),i=0;i<n-1;i++){var r=t[p["default"].random(0,t.length-1)];e+=String.fromCharCode(r)}e+=a[p["default"].random(0,a.length-1)],this.view.get("adminPassword").setValue(e),this.view.get("adminPasswordConfirm").setValue(e)},t["default"](i,[{key:"modelType",get:function(){return b["default"]}},{key:"viewType",get:function(){return f["default"]}}]),i}(i["default"](c)["default"]);module.exports=v}),define("bmr/cluster/create/create.tpl",[],function(){return'\x3c!-- target: TPL_bmr_cluster_create --\x3e\n<div class="bmr bmr-cluster-create main-wrap-new">\n    <div class="content-wrap">\n        \x3c!-- use: TPL_bmr_cluster_nav(title="创建集群") --\x3e\n        <div class="create-content">\n            <div data-ui-type="ViewStep"\n                 data-ui-id="buyStep"\n                 data-ui-current-step="1">\n                <ul>\n                    <li bind-for="buyBMR">选择集群配置</li>\n                    <li bind-for="orderConfirm">确认订单</li>\n                    <li>在线支付</li>\n                    <li>支付成功</li>\n                </ul>\n            </div>\n            <div id="buyBMR">\n                <div data-ui-type="Tab"\n                    data-ui-id="productType"\n                    class="bec-tab"></div>\n                <div class="ui-tab-content">\n                    <p class="realname-tip"\n                        data-ui-type="ToastLabel"\n                        data-ui-id="quotaTip"\n                        data-ui-message-type="alert"\n                        data-ui-hidden="true">\n                        您创建的活跃BMR集群数已达到限额，如需增加配额请到<a href="${ticketUrl}">工单</a>申请。\n                    </p>\n                    <p class="realname-tip"\n                        data-ui-type="ToastLabel"\n                        data-ui-id="realNameTip"\n                        data-ui-message-type="alert"\n                        data-ui-hidden="true"\n                        data-auth="verifiedUser"\n                        data-authtype="SHOW">\n                    </p>\n                    <div class="create-main">\n                        <div class="detail-parts-table">\n                            <dl class="detail-create detail-part-1-col">\n                                <dt>\n                                    <h4>集群基础设置</h4>\n                                </dt>\n                                <dd>\n                                    \x3c!-- import: TPL_common_partial_create_current_region --\x3e\n                                </dd>\n                                <dd>\n                                    <label class="required-label">集群名称：</label>\n                                    <div>\n                                        <div data-ui-id="clusterName" data-ui-type="TextBox"></div>\n                                    </div>\n                                </dd>\n                                <dd>\n                                    <label class="required-label">区域：</label>\n                                    <div>\n                                        <div data-ui-type="Select"\n                                            data-ui-id="availabilityZone"\n                                            data-ui-name="availabilityZone"></div>\n                                    </div>\n                                </dd>\n                                <dd>\n                                    <label>管理用户名：</label>\n                                    <span>root</span>\n                                    <span class="row-tip">用户远程SSH到集群进行管理</span>\n                                </dd>\n                                <dd>\n                                    <label class="required-label">管理员密码：</label>\n                                    <div>\n                                        <input type="password"\n                                            data-ui-id="adminPassword"\n                                            data-ui-type="TextBox"\n                                            data-ui-custom-error-message="密码不符合规则"\n                                            data-ui-validity-label="passValidity"\n                                            data-ui-placeholder="请输入管理员密码"></input>\n                                        <button data-ui="id:random;type:Button;skin:stringfy;" class="random-btn">随机生成</button>\n                                        <span class="row-tip">规则：8~17位字符、数字、英文和符号必须同时存在，符号仅限!@#$%^*()</span>\n                                    </div>\n                                    <p data-ui-type="Validity"\n                                           data-ui-id="passValidity"></p>\n                                </dd>\n                                <dd>\n                                    <label class="required-label">确认管理员密码：</label>\n                                    <div>\n                                        <input type="password"\n                                            data-ui-id="adminPasswordConfirm"\n                                            data-ui-type="TextBox"\n                                            data-ui-custom-error-message="确认密码同管理员密码不一致"\n                                            data-ui-placeholder="请再次输入管理员密码"></input>\n                                    </div>\n                                </dd>\n                                <dd>\n                                    <label>日志：</label>\n                                    <div>\n                                        <div data-ui-id="logToggle" data-ui-type="ToggleButton"></div>\n                                        <span class="row-tip">日志可以支持作业自助诊断调优和集群高可用。</span>\n                                        <div data-ui-id="logPanel" data-ui-type="Panel" class="log-panel">\n                                            <div data-ui-type="BucketSelect"\n                                                data-ui-id="logUri"\n                                                data-ui-extension-bucketselect-type="BucketSelectEx">\n                                            </div>\n                                            <p class="row-tip">\n                                                bos://&lt;bucket-name&gt;/&lt;folder&gt;，bucket必须存在，如不存在，请新建;folder可不存在，如不存在，系统会自动创建\n                                            </p>\n                                        </div>\n                                        <p class="advance-link"\n                                            data-ui-id="advance"\n                                            data-ui-type="Button"\n                                            data-ui-skin="stringfy">\n                                            <i class="iconfont icon-downarrow"></i>\n                                            高级设置\n                                        </p>\n                                    </div>\n                                </dd>\n                                <dd class="advance-setting">\n                                    <label>短信开关：</label>\n                                    <div>\n                                        <div data-ui-id="smsToggle" data-ui-type="ToggleButton"></div>\n                                        <span class="row-tip">是否启用免费短信提醒服务，启动后系统将发送报警短信给指定的联系人</span>\n                                    </div>\n                                </dd>\n                                <dd class="advance-setting">\n                                    <label>常用报警策略：</label>\n                                    <div>\n                                        <div data-ui-id="alarmToggle" data-ui-type="ToggleButton"></div>\n                                        <span class="row-tip">当监控项超过阈值时，系统将会发送报警短信和邮件给指定的联系人 。</span>\n                                    </div>\n                                </dd>\n                                <dd class="advance-setting">\n                                    <label>自动终止：</label>\n                                    <div>\n                                        <div data-ui-id="autoTerminateToggle" data-ui-type="ToggleButton"></div>\n                                        <span class="row-tip">开启时，当最后一个作业执行完毕后，自动释放集群，否则集群会一直保持运行，需手动释放。</span>\n                                    </div>\n                                </dd>\n                                <div class="advance-setting"\n                                    data-ui-id="reminderPanel"\n                                    data-ui-type="ActionPanel"></div>\n                            </dl>\n                            <div data-ui-id="appPanel" data-ui-type="ActionPanel"></div>\n                            <dl class="detail-create detail-part-1-col">\n                                <dt>\n                                    <h4>网络</h4>\n                                </dt>\n                                <dd>\n                                    <label class="required-label">网络类型：</label>\n                                    <div class="select-group">\n                                        <div data-ui-type="Select"\n                                            data-ui-id="vpcId"\n                                            data-ui-name="vpcId"></div>\n                                        <div data-ui-type="Select"\n                                            data-ui-id="subnetId"\n                                            data-ui-name="subnetId"></div>\n                                    </div>\n                                </dd>\n                                <dd>\n                                    <label class="required-label">安全组：</label>\n                                    <div>\n                                        <div data-ui-type="Select"\n                                            data-ui-id="systemSecurityGroup"\n                                            data-ui-name="systemSecurityGroup"></div>\n                                    </div>\n                                </dd>\n                            </dl>\n                            <div data-ui-id="flavorPanel" data-ui-type="ActionPanel"></div>\n                            <dl class="detail-create detail-part-1-col">\n                                <dd class="btn-group">\n                                    <button data-ui-id="pick"\n                                        data-ui-type="Button"\n                                        data-ui-skin="ok"\n                                        data-auth="verifiedUser"\n                                        data-authtype="READONLY">完成</button>\n                                    <button data-ui="id:cancel;type:Button;">取消</button>\n                                </dd>\n                            </dl>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div id="orderConfirm">\n                <div class="ui-tab-navigator"></div>\n                <div data-ui="id:orderAction;type:ActionPanel" class="clearfix ui-tab-content ui-tab-orderconfirm"></div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("bmr/cluster/create/CreateModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","common/region","common/constants","common/billing/common","../../config","../../enums","../../util","bat-ria/mvc/BaseModel"],function(exports,module,e,t,a,n,i,r,l,s,o,u,d,c){var p=i["default"](n),m=i["default"](r),f=i["default"](l),b=(i["default"](s),function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.fetchSubNet=function(e){return o.api.bmrSubNetList(e)},i.prototype.fetchSecurityGroup=function(e){return o.api.bmrSecurityGroup(e)},i.prototype.submit=function(e){return o.api.bmrOrderCreate(e)},i.prototype.isCopy=function(){return!(!this.get("clusterId")&&!this.get("templateId"))},i.prototype.validateSubmit=function(e){return o.api.bmrCreateValidate(e)},i.prototype.normalize=function(){var e=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];return p["default"].defaults(p["default"].omit(e,function(e){return p["default"].isNull(e)}),{name:"",payType:u.PayType.POSTPAY,alarmEnabled:!0,sendMessage:!0,autoTerminate:!1,logUri:"bos://",imageType:null,imageVersion:null,applications:[],instanceGroups:[],reminder:{enable:!1,disabled:!0},vpc:{},subnet:{},systemSecurityGroup:{}})},t["default"](i,[{key:"datasource",get:function(){return{getBucketList:function(){return o.api.bmrBucketList},getFolderList:function(){return o.api.bmrFolderList},getObjectList:function(){return o.api.bmrObjectList},createBucket:function(){return o.api.bmrCreateBucket},getBucketLocations:function(){return function(){return{locations:[m["default"].getCurrentRegion().id]}}},balanceEnough:function(){return o.api.bmrCheckBalance()},remainQuota:function(){return o.api.bmrQuota()},ticketUrl:function(){return f["default"].domains.ticket},editData:function(e){return e.get("clusterId")?o.api.bmrClusterDetail({clusterId:e.get("clusterId")}).then(function(t){return e.normalize(t)}):e.get("templateId")?o.api.bmrTemplateDetail({templateId:e.get("templateId")}).then(function(t){return e.normalize(t)}):e.normalize()},zoneList:function(){return o.api.bmrZoneList().then(function(e){return p["default"].map(e,function(e){return p["default"].extend(e,{name:d.formatZone(e.zoneName),value:e.zoneName})})})},vpcData:function(){return o.api.bmrVpcList().then(function(e){var t="";return{datasource:p["default"].map(e,function(e){return e.defaultVpc&&(t=e.vpcId),{name:e.name+"("+e.cidr+")",value:e.vpcId}}),defaultValue:t}})}}}}]),i}(i["default"](c)["default"]));module.exports=b}),define("bmr/cluster/create/CreateView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./create.tpl","jquery","babel-runtime/helpers/interop-require-default","underscore","inf-ria/app/brpc","bat-ria/mvc/BaseView","common/constants","../../enums"],function(exports,module,e,t,a,n,i,r,l,s,o,u,d){var c=r["default"](i),p=r["default"](l),m=r["default"](s),f=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIProperties=function(){var e=this,t=this.model.get("editData"),a=t.name,n=t.logUri,i=t.payType,r=t.sendMessage,l=t.alarmEnabled,s=t.autoTerminate,o=t.availabilityZone,u=t.vpc,c=t.subnet,m=t.systemSecurityGroup,f=p["default"].map(d.PayType.toArray(),function(e){return{title:e.text,panel:e.value}}),b=p["default"].indexOf(p["default"].pluck(f,"panel"),i),h=u.vpcId||this.model.get("vpcData").defaultValue;return{clusterName:{value:a,placeholder:"请输入名称",custom:function(e){return e.trim()&&/^[\S ]{1,255}$/.test(e)},customErrorMessage:"名称不符合规则：长度1-255，字符不能全为空格"},alarmToggle:{checked:l},smsToggle:{checked:r},logToggle:{checked:n},autoTerminateToggle:{checked:s},appPanel:{url:"/bmr/common/image/detail"},flavorPanel:{url:"/bmr/common/flavor",actionOptions:{payType:i}},logUri:{required:"required",requiredErrorMessage:"请选择文件夹",width:250,getBucketList:"@getBucketList",getFolderList:"@getFolderList",getObjectList:"@getObjectList",createBucket:"@createBucket",getBucketLocations:"@getBucketLocations",viewtype:"folder",urlPrefix:"bos://",placeholder:"bos://",value:n},logPanel:{hidden:!1},reminderPanel:{url:"/bmr/common/reminder",actionOptions:{editData:{enabled:!1,disabled:!0}}},pick:{disabled:!this.model.get("remainQuota")},adminPassword:{custom:function(e){return e.length>7&&e.length<18&&/[a-zA-Z]/.test(e)&&/\d/.test(e)&&/[!@#$%^*()]/.test(e)&&/^[a-zA-Z\d!@#$%^*()]+$/.test(e)}},adminPasswordConfirm:{custom:function(t){return t===e.get("adminPassword").getValue()}},productType:{tabs:f,activeIndex:b},availabilityZone:{width:222,value:o,datasource:"@zoneList"},vpcId:{width:222,value:h,datasource:"@vpcData.datasource"},subnetId:{width:222,custom:function(e){return!!e},customErrorMessage:'\n                    该自定义私有网络中没有子网，请先\n                    <a href="/network/#/vpc/subnet/list~vpcId='+h+'">创建子网</a>\n                    或者选择其他私有网络\n                ',value:c.subnetId,emptyText:"暂无可用子网"},systemSecurityGroup:{width:222,value:m.id,emptyText:"暂无可用安全组"}}},i.prototype.getUIEvents=function(){var e=this;return{"table:command":function(t){return e.fire(t.name,t)},"pick:click":function(){return e.fire("PICK")},"cancel:click":function(){return e.fire("REDIRECT_TO_LIST")},"logToggle:change":function(){return e.get("logPanel").toggle()},"autoTerminateToggle:change":function(){return e.asyncAutoTerminateState()},"adminPassword:input":function(e){return e.target.validate()},"adminPasswordConfirm:input":function(e){return e.target.validate()},"random:click":function(){return e.fire("RANDOM_PASSWORD")},"productType:activate":function(t){return e.asyncPayType(t.tab.panel)},"advance:click":function(t){return e.toggleAdvance(t)},"availabilityZone:change":function(){return e.updateSubnet()},"vpcId:change":function(){e.updateSubnet(),e.updateSecurityGroup()},"appPanel@actionloadfail":function(){return e._disableSubmit()},"flavorPanel@actionloadfail":function(){return e._disableSubmit()}}},i.prototype.enterDocument=function(){n.prototype.enterDocument.call(this);var e=this.get("productType").getActiveTab();this.asyncPayType(e.panel),this.updateSubnet(),this.updateSecurityGroup()},i.prototype.updateSubnet=function(){var e=this,t=this.get("vpcId").getValue(),a=this.get("availabilityZone").getValue();this.model.fetchSubNet({vpcId:t,availabilityZone:a}).then(function(t){var a="",n=p["default"].map(t,function(e){return e.defaultSubnet&&(a=e.subnetId),{name:e.name+"("+e.cidr+")",value:e.subnetId}});e.get("subnetId").setProperties({datasource:n,value:a})})},i.prototype.updateSecurityGroup=function(){var e=this,t=this.get("vpcId").getValue();this.model.fetchSecurityGroup({vpcId:t,type:"system"}).then(function(t){var a=p["default"].map(t,function(e){return p["default"].extend(e,{value:e.id})});e.get("systemSecurityGroup").updateDatasource(a)})},i.prototype.asyncAutoTerminateState=function(){this.get("reminderPanel").action.toggle()},i.prototype.validate=function(){return this.get("clusterName").validate()&&(!this.get("logToggle").isChecked()||this.get("logUri").validate())&&this.get("reminderPanel").action.view.get("form").validate()&&this.get("adminPassword").validate()&&this.get("adminPasswordConfirm").validate()&&this.get("subnetId").validate()},i.prototype.asyncFormState=function(){var e=this.model.get("editData"),t=this.get("appPanel"),a=this.get("logPanel"),n=this.get("flavorPanel");e.logUri?a.show():a.hide(),this.get("reminderPanel").reload({editData:p["default"].defaults(e.reminder,{disabled:!e.autoTerminate})}),t.reload(p["default"].pick(e,"imageType","imageVersion","applications")),n.reload(p["default"].reduce(e.instanceGroups,function(e,t){return e[t.type.toLowerCase()]=t,e},{payType:e.payType}))},i.prototype.asyncPayType=function(e){var t=this.get("quotaTip"),a=this.model.get("remainQuota"),n=this.get("autoTerminateToggle"),i=this.model.get("balanceEnough"),r=i.prepayBalance,l=i.postpayBalance;this.get("flavorPanel").reload({payType:e}),t.hide(),e===d.PayType.PREPAY?(n.set("checked",!1),n.disable(),r?a||t.show():(t.setContent('您的账户余额不足，请<a href="/billing/#/account/recharge">立刻充值</a>'),t.show())):(n.enable(),l?a||t.show():(t.setContent('您的账户余额不足，请<a href="/billing/#/account/recharge">立刻充值</a>'),t.show()))},i.prototype.renderOrderConfirm=function(e,t){var a=this,n=this.get("orderAction"),i=this.get("buyStep"),r={order:e,config:t};m["default"].invokeService("billing://order_confirm",n,r).then(function(){n.on("action@prevPage",a.renderBmrConfig,a),i.set("currentStep",2)})},i.prototype.renderBmrConfig=function(){var e=this.get("orderAction");this.get("buyStep").set("currentStep",1),e.disposeAction(),e.un("action@prevPage"),e.main.innerHTML=""},i.prototype.toggleAdvance=function(e){e.target.toggleState("arrow"),c["default"](".advance-setting").fadeToggle(300)},i.prototype._disableSubmit=function(){this.get("pick").disable()},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_cluster_create"}}]),i}(r["default"](o)["default"]);module.exports=f}),define("bmr/cluster/detail/config",["exports","module","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","er/controller","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t,a,n){n["default"](a)["default"].registerAction([{type:"bmr/cluster/detail/StepList",path:"/bmr/cluster/steplist"},{type:"bmr/cluster/detail/Detail",path:"/bmr/cluster/detail"},{type:"bmr/cluster/detail/Monitor",path:"/bmr/cluster/monitor"}]);var i={cpu:{name:"CPU",unit:"百分比",metrics:[{name:"使用率",value:"CPUUsagePercent"},{name:"IO等待时间占比",value:"CPUWaitPercent"},{name:"用户时间占比",value:"CPUUserPercent"},{name:"系统时间占比",value:"CPUSystemPercent"}]},memory:{name:"内存",unit:"字节",metrics:[{name:"总量",value:"MemoryTotalGBytes"},{name:"使用量",value:"MemoryUsageGBytes"}]},disk:{name:"磁盘容量",unit:"字节",metrics:[{name:"总量",value:"DiskTotalGBytes"},{name:"使用量",value:"DiskUsageGBytes"}]},hdfs:{name:"HDFS存储量",unit:"字节",metrics:[{name:"存储总量",value:"HdfsCapacityTotalGBytes"},{name:"存储使用量",value:"HdfsCapacityUsageGBytes"}]},hbaseRegionServer:{name:"HBase RegionServer数量",unit:"个数",filter:"hbase",metrics:[{name:"RegionServer数量",value:"HBaseRegionServerTotalCount",filter:"hbase",filterValue:!1},{name:"RegionServer存活数",value:"HBaseRegionServerAliveCount",filter:"hbase",filterValue:!1}]},hbaseIO:{name:"HBase读写请求量",unit:"次数",filter:"hbase",metrics:[{name:"写请求量",value:"HBaseWriteCount",filter:"hbase",filterValue:!1},{name:"读请求量",value:"HBaseReadCount",filter:"hbase",filterValue:!1}]}},r=function(){function a(){t["default"](this,a)}return e["default"](a,[{key:"BMR_LISTEN_INTERVAL",get:function(){return 6e4}},{key:"monitorMetric",get:function(){return i}}]),a}();module.exports=new r}),define("bmr/cluster/detail/Detail",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","common/region","babel-runtime/helpers/interop-require-default","jquery","saber-cookie","bat-ria/mvc/BaseAction","./DetailModel","./DetailView","../../operation"],function(exports,module,e,t,a,n,i,r,l,s,o,u,d){var c=i["default"](n),p=i["default"](r),m=i["default"](l),f=i["default"](s),b=i["default"](o),h=i["default"](u),v=i["default"](d),g=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.initBehavior=function(){n.prototype.initBehavior.call(this),this.view.on("REFRESH",this.reload,this),this.view.on("TOGGLE_TERMINATE_PROTECT",this.toggleTerminateProtect,this),this.view.on("TOGGLE_REMINDER",this.toggleReminder,this),this.view.on("TERMINATE",this.terminate,this),this.view.on("COPY",this.copy,this),this.view.on("DOWNLOAD_CONF",this.downloadConf,this),this.view.on("RENAME",function(){return p["default"](".edit-name-container").fadeToggle()},this),this.view.on("RENAME_OK",this.rename,this),this.view.on("RENAME_CANCEL",function(){return p["default"](".edit-name-container").fadeToggle()},this)},i.prototype.toggleTerminateProtect=function(){var e=this;this.model.toggleTerminateProtect().then(function(){return e.view.showToast("保存成功")}).ensure(function(){return e.reload()})},i.prototype.toggleReminder=function(){v["default"].editReminder.call(this,{clusterId:this.model.get("clusterId"),editData:this.model.get("clusterDetail").reminder,parentAction:this})},i.prototype.terminate=function(){var e=this;this.model.terminate().then(function(){return e.showToast("释放成功")}).ensure(function(){return e.reload()})},i.prototype.copy=function(){var e=this.model.get("clusterId");this.redirect("#/bmr/cluster/create~clusterId="+e)},i.prototype.rename=function(){var e=this,t=this.view.get("nameInput").getValue().trim(),a=this.model.get("clusterDetail"),n=a.id;t!==a.name&&(/^[\S ]{1,255}$/.test(t)?this.model.rename({clusterId:n,newName:t}).ensure(function(){return e.reload()}):this.view.waitAlert({title:"集群名称错误",content:"名称不符合规则：长度1-255，字符不能全为空格。"}))},i.prototype.downloadConf=function(e){var t=m["default"].get("bce-user-info");t&&(t=t.replace(/"/g,"")),document.querySelector('form input[name="clusterId"]').value=this.model.get("clusterId"),document.querySelector('form input[name="type"]').value=e.category,document.querySelector('form input[name="csrftoken"]').value=t,document.querySelector('form input[name="region"]').value=c["default"].getCurrentRegion("BMR").id;var a=document.querySelector("#download-form");a.action="/api/bmr/download/config",a.submit()},t["default"](i,[{key:"modelType",get:function(){return b["default"]}},{key:"viewType",get:function(){return h["default"]}}]),i}(f["default"]);module.exports=g}),define("bmr/cluster/detail/detail.tpl",[],function(){return'\x3c!-- target: TPL_bmr_cluster_detail --\x3e\n<div class="bmr-cluster-detail bmr-main-wrap main-wrap-new">\n    \x3c!-- use: TPL_bmr_side_bar(menu="cluster") --\x3e\n    <div class="content-wrap">\n        \x3c!-- use: TPL_bmr_cluster_nav(title="集群详情") --\x3e\n        \x3c!-- import: TPL_bmr_cluster_detail_header --\x3e\n        <div class="detail-content">\n            \x3c!--import: TPL_bmr_cluster_detail_tab --\x3e\n            <div class="ui-tab-content">\n                <div class="detail-parts-table">\n                    <dl class="detail-part-1-col">\n                        <dt><h4>基本信息</h4></dt>\n                        <dd>\n                            <div class="detail-cell">\n                                <label>集群ID：</label>\n                                <span>${clusterDetail.id}</span>\n                            </div>\n                            <div class="detail-cell">\n                                <label for="">区域：</label>\n                                <span>${clusterDetail.availabilityZone | bmrFormatZone}</span>\n                            </div>\n                        </dd>\n                        <dd>\n                            <div class="detail-cell">\n                                <label>集群名称：</label>\n                                <span>${clusterDetail.name}</span>\n                                <button data-ui="id:rename;type:Button;" data-ui-skin="stringfy">变更</button>\n                                <span class="edit-name-container">\n                                    <input data-ui-id="nameInput" data-ui-type="TextBox"\n                                            value="${clusterDetail.name}"/>\n                                    <button data-ui-id="renameOk" data-ui-type="Button"\n                                            data-ui-skin="ok">确定</button>\n                                    <button data-ui-id="renameCancel" data-ui-type="Button"\n                                            data-ui-skin="cancel">取消</button>\n                                    <label data-ui-type="Validity" data-ui-id="nameValidity"></label>\n                                </span>\n                            </div>\n                            \x3c!--<div class="detail-cell">\n                                <label>运行状态：</label>\n                                <span class="status ${clusterDetail.status.state.klass}">\n                                    ${clusterDetail.status.state.text}\n                                </span>\n                            </div>--\x3e\n                            <div class="detail-cell">\n                                <label>自动终止：</label>\n                                <span class="no-content">\n                                    \x3c!-- if: ${clusterDetail.autoTerminate} --\x3e\n                                    开启\n                                    \x3c!-- else --\x3e\n                                    关闭\n                                    \x3c!-- /if --\x3e\n                                </span>\n                            </div>\n                        </dd>\n                        <dd>\n                            <div class="detail-cell">\n                                <label>创建时间：</label>\n                                <span>${clusterDetail.status.creationDateTime|formatTime}</span>\n                            </div>\n                            <div class="detail-cell">\n                                <label>运行时间：</label>\n                                <span>\n                                    ${clusterDetail.status.readyDateTime|bmrTimeDiff(${clusterDetail.status.endDateTime})}\n                                    &nbsp;分钟\n                                </span>\n                            </div>\n                        </dd>\n                        <dd>\n                            <div class="detail-cell">\n                                <label>报警设置：</label>\n                                <span class="no-content">\n                                    <label>\n                                        \x3c!-- if: ${clusterDetail.alarmEnabled} --\x3e\n                                        开启\n                                        \x3c!-- else --\x3e\n                                        关闭\n                                        \x3c!-- /if --\x3e\n                                    </label>\n                                </span>\n                            </div>\n                            \x3c!-- if: ${clusterDetail.terminationProtected} === true --\x3e\n                            <div class="detail-cell">\n                                <label>集群释放保护：</label>\n                                <span class="no-content">\n                                    <label>开启</label>\n                                    <button data-ui="id:toggleProtectBtn;type:Button;" data-ui-skin="stringfy">变更</button>\n                                </span>\n                            </div>\n                            \x3c!-- /if --\x3e\n                            <div class="detail-cell">\n                                <label>短信设置：</label>\n                                <span class="no-content">\n                                    <label>\n                                        \x3c!-- if: ${clusterDetail.sendMessage} --\x3e\n                                        开启\n                                        \x3c!-- else --\x3e\n                                        关闭\n                                        \x3c!-- /if --\x3e\n                                    </label>\n                                </span>\n                            </div>\n                        </dd>\n                        <dd>\n                            <div class="detail-cell">\n                                <label>超时提醒设置：</label>\n                                <span>\n                                    \x3c!--if: ${clusterDetail.reminder.enabled} --\x3e\n                                        开启\n                                    \x3c!--else--\x3e\n                                        关闭\n                                    \x3c!--/if--\x3e\n                                </span>\n                                <button data-ui="id:reminderBtn;type:Button;" data-ui-skin="stringfy">变更</button>\n                            </div>\n                            \x3c!--if: ${clusterDetail.reminder.enabled} --\x3e\n                            <div class="detail-cell">\n                                <label>超时时间：</label>\n                                <span>\n                                    ${clusterDetail.reminder.duration}分钟\n                                </span>\n                            </div>\n                        </dd>\n                        <dd>\n                            <div class="detail-cell">\n                                <label>超时提醒方式：</label>\n                                <span>\n                                    ${clusterDetail.reminder.mediaText}\n                                </span>\n                            </div>\n                            \x3c!--/if--\x3e\n                            <div class="detail-cell">\n                                <label>日志URL：</label>\n                                <span>\n                                    \x3c!-- if: ${clusterDetail.logUri}--\x3e\n                                    ${clusterDetail.logUri}\n                                    \x3c!-- else --\x3e\n                                    未开启\n                                    \x3c!-- /if --\x3e\n                                </span>\n                            </div>\n                        </dd>\n                    </dl>\n                    <div class="detail-part-2-col">\n                        <dl>\n                            <dt>\n                                <h4>相关应用</h4>\n                                <dd>\n                                    <div class="detail-cell">\n                                        <label></label>\n                                        <span>\n                                            <label data-ui="id:redirectProxyUrl;type:Label;skin:jumbotron;">\n                                                Hadoop Yarn Web UI\n                                            </label>\n                                            <label data-ui="id:redirectHueUrl;type:Label;skin:jumbotron;">\n                                                Hue Web UI\n                                            </label>\n                                        </span>\n                                    </div>\n                                </dd>\n                            </dt>\n                        </dl>\n                        <dl>\n                            <dt>\n                                <h4>相关工具</h4>\n                                <dd>\n                                    <div class="detail-cell">\n                                        \x3c!-- if: ${clusterDetail.vpnEnabled} --\x3e\n                                            <label></label>\n                                            <span>\n                                                <div data-ui="id:vpnConfDownload;type:Label;skin:jumbotron;">\n                                                    OpenVPN Config\n                                                </div>\n                                                <span data-ui-type="Tip"\n                                                    data-ui-hidden="true"\n                                                    data-ui-content="OpenVPN配置文件，参考\b<a href=\'${openVPNDocLink}\'\n                                                    target=\'_blank\'>使用OpenVPN访问集群</a>"></span>\n                                                <div data-ui="id:hadoopConfDownload;type:Label;skin:jumbotron;">\n                                                    Hadoop Config\n                                                </div>\n                                                <span data-ui-type="Tip"\n                                                    data-ui-hidden="true"\n                                                    data-ui-content="Hadoop配置文件，参考\b<a href=\'${openVPNDocLink}\'\n                                                    target=\'_blank\'>使用OpenVPN访问集群</a>"></span>\n                                            </span>\n                                            <form method="POST" id="download-form" target="_blank" class="state-hidden">\n                                                <input type="hidden" name="clusterId" />\n                                                <input type="hidden" name="type" />\n                                                <input type="hidden" name="csrftoken" />\n                                                <input type="hidden" name="region" />\n                                            </form>\n                                        \x3c!-- else --\x3e\n                                        <label>OpenVPN配置：</label>\n                                        <span>未开启</span>\n                                        \x3c!-- /if --\x3e\n                                    </div>\n                                </dd>\n                            </dt>\n                        </dl>\n                    </div>\n                    <dl class="detail-part-1-col">\n                        <dt><h4>配置信息</h4></dt>\n                        <dd>\n                            <div class="detail-cell">\n                                <label>镜像版本：</label>\n                                <span>${clusterDetail.imageDescription}</span>\n                            </div>\n                            <div class="detail-cell">\n                                <label>应用配置：</label>\n                                <span class="cell-block">\n                                    ${*clusterDetail.applications | bmrFormatClusterApp}\n                                </span>\n                            </div>\n                        </dd>\n                    </dl>\n                    <dl class="detail-part-1-col">\n                        <dt><h4>网络</h4></dt>\n                        <dd>\n                            <div class="detail-cell">\n                                <label>所在网络：</label>\n                                ${*clusterDetail.vpc | bmrFormatNetWork(${clusterDetail.vpc.vpcId})}\n                            </div>\n                            <div class="detail-cell">\n                                <label>安全组：</label>\n                                ${*clusterDetail.systemSecurityGroup | bmrFormatNetWork(${clusterDetail.vpc.vpcId})}\n                            </div>\n                        </dd>\n                        <dd>\n                            <div class="detail-cell">\n                                <label>所在子网：</label>\n                                ${*clusterDetail.subnet | bmrFormatNetWork(${clusterDetail.vpc.vpcId})}\n                            </div>\n                        </dd>\n                    </dl>\n                    <dl class="detail-part-1-col">\n                        <dt><h4>节点信息</h4></dt>\n                        <dd>\n                            <div>\n                                <div data-ui="type:GroupPanel;id:instanceGroup;"></div>\n                            </div>\n                        </dd>\n                    </dl>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n\x3c!-- target: TPL_bmr_cluster_detail_child_talbe --\x3e\n<div data-ui-type="Table" data-ui-id="${tableId}" data-ui-datasource="@tableData"\n    data-ui-order-by="@orderBy" data-ui-order="@order" data-ui-select="@selectMode"\n    data-ui-extension-tip-type="TableTip"\n    data-ui-extension-command-type="Command">\n</div>\n'}),define("bmr/cluster/detail/DetailModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/BaseModel","babel-runtime/helpers/interop-require-default","underscore","../../permission","../../config","../../enums"],function(exports,module,e,t,a,n,i,r,l,s,o){var u=i["default"](n),d=i["default"](r),c=i["default"](l),p=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.toggleTerminateProtect=function(){var e=this.get("clusterDetail");return s.api.bmrTerminateProtection({clusterId:e.id,terminationProtected:!e.terminationProtected})},i.prototype.terminate=function(){var e=this.get("clusterDetail").id;return s.api.bmrTerminateCluster({clusterId:e})},i.prototype.rename=function(e){var t=e.clusterId,a=e.newName;return s.api.bmrClusterRename({clusterId:t,newName:a})},t["default"](i,[{key:"defaultArgs",get:function(){return{pageSize:10}}},{key:"datasource",get:function(){return{detailActive:function(){return"ui-tab-item-active"},clusterDetail:function(e){return s.api.bmrClusterDetail({clusterId:e.get("clusterId")}).then(function(e){return e.status.state=o.CLUSTER_STATUS.fromValue(e.status.state),e.allowScale=c["default"].allowScale(e.status.state.permission),e.reminder.mediaText=d["default"].reduce(e.reminder.media,function(e,t,a){return e+(a>0?"、":"")+o.NOTIFY_TYPE.getTextFromValue(t)},""),e})},instancesList:function(e){return s.api.bmrInstanceGroupList({clusterId:e.get("clusterId")})},NOTIFY_TYPE:function(){return o.NOTIFY_TYPE},openVPNDocLink:function(){return"//bce.baidu.com/doc/BMR/GettingStarted.html#.E4.BD.BF.E7.94.A8OpenVPN.E8.AE.BF.E9.97.AE.E9.9B.86.E7.BE.A4"}}}}]),i}(u["default"]);module.exports=p}),define("bmr/cluster/detail/DetailView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","etpl","babel-runtime/helpers/interop-require-default","underscore","bat-ria/mvc/BaseView","common/util/tableUtil","../../permission","bat-ria/tpl!./detail.tpl","../../enums"],function(exports,module,e,t,a,n,i,r,l,s,o,u,d){var c=i["default"](n),p=i["default"](r),m=i["default"](l),f=i["default"](s),b=i["default"](o),h=[{title:"实例ID",content:function(e){return'<span class="instance-id">'+e.id+"</span>"}},{title:"实例状态",content:function(e){var t=d.INSTANCE_STATUS.fromValue(e.status.state);return'<p class="status '+t.klass+'">'+t.text+"</p>"}},{title:"公网IP/内网IP",content:function(e){return(e.publicIpAddress||"未分配")+"(公)<br/>"+(e.privateIpAddress||"-")+"(内)"}},{title:"硬件配置",content:function(e){var t=e.instanceType,a=t.cpu,n=t.memory,i=t.diskType;return"\n                cpu："+a+"核 |\n                内存："+n+"GB<br/>硬盘："+t.disk+"GB（"+i.toUpperCase()+"）\n            "}}],v=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIProperties=function(){var e=this.model.get("clusterDetail"),t=e.payType,a=e.status,n=e.autoTerminate,i=e.yarnUrl,r=e.hueUrl,l=a.state.permission;return{redirectProxyUrl:{disabled:!i},redirectHueUrl:{disabled:!r},instanceGroup:{datasource:"@instancesList",renderHeader:this.renderInstanceHeader,allowArrow:function(e){return e.instances.length>0},renderContent:this.renderContent},toggleProtectBtn:{disabled:!b["default"].allowModifyStopProtect(l)},reminderBtn:{disabled:!b["default"].allowModifyReminder(l)||!1===n},terminate:{disabled:!b["default"].allowStopCluster(l)||t===d.PayType.PREPAY},vpnConfDownload:{disabled:!b["default"].allowDownloadConf(l)},hadoopConfDownload:{disabled:!b["default"].allowDownloadConf(l)}}},i.prototype.getUIEvents=function(){var e=this;return{"rename:click":function(){return e.fire("RENAME")},"renameOk:click":function(){return e.fire("RENAME_OK")},"renameCancel:click":function(){return e.fire("RENAME_CANCEL")},"refresh:click":function(){return e.fire("REFRESH")},"toggleProtectBtn:click":function(){return e.fire("TOGGLE_TERMINATE_PROTECT")},"redirectProxyUrl:click":function(){return window.open(e.model.get("clusterDetail").yarnUrl)},"redirectHueUrl:click":function(){return window.open(e.model.get("clusterDetail").hueUrl)},"reminderBtn:click":function(){return e.fire("TOGGLE_REMINDER")},"terminate:click":function(){return e.changeConfirm()},"copy:click":function(){return e.fire("COPY")},"vpnConfDownload:click":function(){return e.fire("DOWNLOAD_CONF",{category:"VPN"})},"hadoopConfDownload:click":function(){return e.fire("DOWNLOAD_CONF",{category:"HADOOP"})}}},i.prototype.renderInstanceHeader=function(e){return c["default"].compile('<p>节点类型：${type}<span class="separate">|</span>创建节点数量：${requestedInstanceCount}个<span class="separate">|</span>运行节点数量：${runningInstanceCount}个')(e)},i.prototype.renderContent=function(e,t){var a="groupPanel"+t,n={content:c["default"].render("TPL_bmr_cluster_detail_child_talbe",{tableId:a}),properties:{}};return n.properties[a]=f["default"].tableProperty(h,{select:!1,datasource:p["default"].each(e.instances,function(t){return t.instanceType=e.instanceType})}),n},i.prototype.changeConfirm=function(){var e=this;this.waitConfirm({title:"提示",content:"您确定释放此集群吗？"}).then(function(){return e.fire("TERMINATE")})},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_cluster_detail"}}]),i}(m["default"]);module.exports=v}),define("bmr/cluster/detail/Monitor",["require","bat-ria/mvc/BaseAction","jquery","common/constants","underscore","../../config","inf-ria/utils/mtools","./MonitorModel","./MonitorView","inf-ria/helper","er/util"],function(require){function e(){s.apply(this,arguments)}function t(e){var t=this;c.bmrTerminateCluster({clusterId:this.model.get("clusterId")}).then(function(){t.reload()})}function a(e){var t="#/bmr/cluster/create~clusterId="+this.model.get("clusterId");return this.redirect(t)}function n(e){var t=this.model.get("monitorMetric"),a=e.params,n=p.adjustToChartMetric(t),i=this;d.each(n,function(e,n){a.metricNames=e.metrics,i.view.monitorCharts[n]&&(i.view.monitorCharts[n].dispose(),delete i.view.monitorCharts[n]),o("#js-chart-"+n).data({metricNames:a.metricNames,statistics:a.statistics}),i.model.getMonitorTrends(a).then(function(e){i.view.renderMonitorChart(n,e,t[n],a)},function(e){o("#js-chart-"+n).html('<span class="err-tips">'+e.global+"</span>")})})}function i(e){var t=this.model.get("monitorMetric")[e.chart];this.view.waitActionDialog({title:t.name,width:800,url:"/common/bcm/monitorChart",actionOptions:{scope:this.model.get("monitorScope"),dimensions:this.model.get("dimensions"),statistics:e.statistics,timeRange:e.timeRange,periodInSecond:e.periodInSecond,metric:t,apiType:"metricName"}}).then(function(e){e.target.resize()})}function r(){require("inf-ria/helper").redirectToModule("bcm","/bcm/alarm/rule",{scope:u,dimensions:"ClusterId:"+this.model.get("clusterId")})}function l(e){var t=this;this.model.getAlarmState({scope:u,dimensions:this.model.get("dimensions")}).then(function(e){t.view.refreshAlarmState(e)})}var s=require("bat-ria/mvc/BaseAction"),o=require("jquery"),u=require("common/constants").MONITOR_SCOPE.BMR,d=require("underscore"),c=require("../../config").api,p=require("inf-ria/utils/mtools");return e.prototype.initBehavior=function(){s.prototype.initBehavior.call(this,arguments),this.view.on("TERMINATE",t,this),this.view.on("COPY",a,this),this.view.on("getMonitorTrends",n,this),this.view.on("showDetailTrend",i,this),this.view.on("toAlarmDetail",r,this),this.view.on("getAlarmState",l,this),this.view.initMonitor(),this.on("beforeleave",function(){clearInterval(this.view.timer),o(window).off("resize.bmr"),o(".icon-show-big").off("click")})},e.prototype.modelType=require("./MonitorModel"),e.prototype.viewType=require("./MonitorView"),require("er/util").inherits(e,s),e}),define("bmr/cluster/detail/monitor.tpl",[],function(){return'\x3c!-- target: TPL_bmr_monitor --\x3e\n<div class="bmr-cluter-detail-monitor bmr-main-wrap main-wrap-new">\n    \x3c!-- use: TPL_bmr_side_bar(menu="cluster") --\x3e\n    <div class="content-wrap">\n        \x3c!-- use : TPL_bmr_cluster_nav(name="监控") --\x3e\n        \x3c!-- import : TPL_bmr_cluster_detail_header --\x3e\n        <div class="detail-content">\n            \x3c!--import: TPL_bmr_cluster_detail_tab--\x3e\n            <div id="cluster-monitor" class="itemlist-wrap monitor ui-tab-content">\n                <h2 class="tab-title section-title"><span>监控信息</span></h2>\n                \x3c!-- import: TPL_alarm_state_summary --\x3e\n                \x3c!-- use: monitor_trend_search(type="monitor") --\x3e\n                <div class="monitor-trends">\n                    \x3c!-- for: ${monitorMetric} as ${chartMetric}, ${chart} --\x3e\n                    <div class="monitor-trend-box">\n                        <div class="monitor-trend-wrap" >\n                            <span class="title">${chartMetric.name}</span>\n                            <span class="icon-show-big" data-chart="${chart}"></span>\n                            <div class="chart" id="js-chart-${chart}"></div>\n                        </div>\n                    </div>\n                    \x3c!-- /for --\x3e\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("bmr/cluster/detail/MonitorModel",["require","bat-ria/mvc/BaseModel","underscore","inf-ria/utils/mtools","../../config","../../enums","./config","common/constants","jquery","er/util"],function(require){function e(){t.apply(this,arguments)}var t=require("bat-ria/mvc/BaseModel"),a=require("underscore"),n=require("inf-ria/utils/mtools"),i=require("../../config").api,r=require("../../enums");return e.prototype.datasource={clusterDetail:function(e){return e.getClusterDetail({clusterId:e.get("clusterId")}).then(function(e){return e.status.state=r.CLUSTER_STATUS.fromValue(e.status.state),e})},monitorMetricOrigin:function(e){return require("./config").monitorMetric},monitorActive:function(e){return"ui-tab-item-active"}},e.prototype.prepare=function(){var e=require("common/constants");this.set("monitorScope",e.MONITOR_SCOPE.BMR),this.set("dimensions","ClusterId:"+this.get("clusterId"));var t=a.find(this.get("clusterDetail").applications,function(e,t){return"hbase"===e.name}),i=require("jquery").extend(!0,{},this.get("monitorMetricOrigin"));t||n.filterMetrics(i,"hbase",t),this.set("monitorMetric",i)},e.prototype.getClusterDetail=function(e){return i.bmrClusterDetail(e||{})},e.prototype.getMonitorTrends=function(e){return i.bcmMetricDataMetricName(e)},e.prototype.getAlarmState=function(e){return i.bcmAlarmStateSummary(e)},require("er/util").inherits(e,t),e}),define("bmr/cluster/detail/MonitorView",["require","bat-ria/tpl!./monitor.tpl","bat-ria/mvc/ListView","esui/extension/Command","inf-ria/echarts","underscore","jquery","inf-ria/utils/mtools","common/constants","../../permission","../../enums","er/locator","../../config","er/util"],function(require){function e(){t.apply(this,arguments)}require("bat-ria/tpl!./monitor.tpl");var t=require("bat-ria/mvc/ListView");require("esui/extension/Command");var a=require("inf-ria/echarts"),n=require("underscore"),i=require("jquery"),r=require("inf-ria/utils/mtools"),l=require("common/constants"),s=require("../../permission"),o=require("../../enums");return e.prototype.template="TPL_bmr_monitor",e.prototype.getUIProperties=function(){var e=this.model.get("clusterDetail"),t=e.status.state.permission,a=e.payType;return{stepsPager:{pageSize:10},terminate:{disabled:!s.allowStopCluster(t)||a===o.PayType.PREPAY}}},e.prototype.getUIEvents=function(){var e=this;return{"monitorTimeRange:change":function(){this.getMonitorTrends()},"monitorRefresh:click":function(){this.getMonitorTrends()},"toAlarm:click":function(){this.fire("toAlarmDetail")},"terminate:click":function(){e.changeConfirm()},"copy:click":function(){this.fire("COPY")},"refresh:click":function(){require("er/locator").reload()}}},e.prototype.initMonitor=function(){var e=this;"undefined"==typeof e.monitorCharts?(e.monitorCharts={},e.fire("getAlarmState"),e.registerMonitorEvents(),e.getMonitorTrends(),e.timer=setInterval(function(){e.fire("getAlarmState")},l.ALARM_STATE_QUERY_PERIOD)):n.each(this.monitorCharts,function(e,t){e&&e.resize()})},e.prototype.registerMonitorEvents=function(){var e=this;i(window).on("resize.bmr",function(){n.each(e.monitorCharts,function(e,t){e&&e.resize()})}),i(".icon-show-big").click(function(t){var a=require("../../config"),n=i(this).attr("data-chart"),r=i("#js-chart-"+n).data("statistics"),l=e.get("monitorTimeRange").getValue(),s=a.monitorDefaultPeriod[l]||60;e.fire("showDetailTrend",{chart:n,statistics:r,timeRange:l,periodInSecond:s})})},e.prototype.getMonitorTrends=function(){var e=this.get("monitorTimeRange").getValue(),t=require("../../config"),a=t.monitorDefaultPeriod[e]||60;e=r.getUTCTimeRange(e,a);var n={periodInSecond:a,statistics:t.monitorDefaultStatistics,startTime:e.startTime,endTime:e.endTime,dimensions:this.model.get("dimensions"),scope:this.model.get("monitorScope")};this.fire("getMonitorTrends",{params:n})},e.prototype.renderMonitorChart=function(e,t,n,i){n.statistics=i.statistics,r.adjustSeriesData(t,i.statistics);var l=r.getChartOptions(t,n,{type:"line"},{period:i.periodInSecond});this.monitorCharts[e]=a.init(document.getElementById("js-chart-"+e)),this.monitorCharts[e].setOption(l,!0)},e.prototype.refreshAlarmState=function(e){i("#js-alarm-state-ok").text(e.okStateCount),i("#js-alarm-state-alarm").text(e.alarmStateCount),i("#js-alarm-state-insufficient").text(e.insufficientStateCount)},e.prototype.changeConfirm=function(){var e=this;this.waitConfirm({title:"提示",content:"您确定释放此集群吗？"}).then(function(){e.fire("TERMINATE")})},require("er/util").inherits(e,t),e}),define("bmr/cluster/detail/StepList",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","inf-ria/mvc/ListAction","babel-runtime/helpers/interop-require-default","./StepListModel","./StepListView","../config","../../util"],function(exports,module,e,t,a,n,i,r,l,s,o){var u=i["default"](n),d=i["default"](r),c=i["default"](l),p=i["default"](s),m=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.initBehavior=function(){var e=this;n.prototype.initBehavior.call(this),this.view.on("REFRESH",this.reload,this),this.view.on("SUBROWOPEN",this.subrowopen,this),this.view.on("TERMINATE",this.terminate,this),this.view.on("COPY",this.copy,this),this.timer=setTimeout(function(){return e.reload()},p["default"].BMR_LISTEN_INTERVAL),this.on("beforeleave",function(){return clearInterval(e.timer)})},i.prototype.subrowopen=function(e){this.view.get("table").setSubrowContent(o.formatStepProperties(e.item),e.index)},i.prototype.terminate=function(){var e=this;this.model.terminate().then(function(){return e.showToast("释放成功")}).ensure(function(){return e.reload()})},i.prototype.copy=function(){var e=this.model.get("clusterId");this.redirect("#/bmr/cluster/create~clusterId="+e)},t["default"](i,[{key:"modelType",get:function(){return d["default"]}},{key:"viewType",get:function(){return c["default"]}}]),i}(u["default"]);module.exports=m}),define("bmr/cluster/detail/steplist.tpl",[],function(){return'\x3c!-- target: TPL_bmr_cluster_step_list --\x3e\n<div class="bmr bmr-cluster-step-list bmr-main-wrap main-wrap-new">\n    \x3c!-- use: TPL_bmr_side_bar(menu="cluster") --\x3e\n    <div class="content-wrap">\n        \x3c!-- use: TPL_bmr_cluster_nav(title="作业列表") --\x3e\n        \x3c!-- import: TPL_bmr_cluster_detail_header --\x3e\n        <div class="detail-content">\n            \x3c!-- import: TPL_bmr_cluster_detail_tab --\x3e\n            <div class="ui-tab-content">\n                <div class="table-full-wrap">\n                    \x3c!-- import: listTableWithCommandAndSubrow --\x3e\n                </div>\n                <div class="ui-row clearfix">\n                    \x3c!-- import: listPager --\x3e\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("bmr/cluster/detail/StepListModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","inf-ria/mvc/ListModel","babel-runtime/helpers/interop-require-default","underscore","../../config","../../enums"],function(exports,module,e,t,a,n,i,r,l,s){var o=i["default"](n),u=i["default"](r),d=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.listRequester=function(e){return l.api.bmrStepList(e).then(function(e){return u["default"].each(e.result,function(e){e.status.state=s.STEP_STATUS.fromValue(e.status.state)}),e})},i.prototype.terminate=function(){var e=this.get("clusterDetail").id;return l.api.bmrTerminateCluster({clusterId:e})},t["default"](i,[{key:"defaultArgs",get:function(){return{pageSize:10}}},{key:"datasource",get:function(){return{stepActive:function(){return"ui-tab-item-active"},clusterDetail:function(e){return l.api.bmrClusterDetail({clusterId:e.get("clusterId")}).then(function(e){return e.status.state=s.CLUSTER_STATUS.fromValue(e.status.state),e})}}}}]),i}(o["default"]);module.exports=d}),define("bmr/cluster/detail/StepListView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","er/URL","babel-runtime/helpers/interop-require-default","underscore","moment","common/util/timeUtil","inf-ria/mvc/ListView","common/util/tableUtil","../../permission","../../enums","bat-ria/tpl!./steplist.tpl"],function(exports,module,e,t,a,n,i,r,l,s,o,u,d,c,p){var m=i["default"](n),f=i["default"](r),b=i["default"](l),h=i["default"](s),v=i["default"](o),g=i["default"](u),y=i["default"](d),x=[{title:"作业名称/ID",subEntry:!0,content:function(e){return'\n                <a class="instance-name" href="'+m["default"].withQuery("#/bmr/step/detail",{clusterId:e.clusterId,stepId:e.id})+'">\n                    '+f["default"].escape(e.name)+'\n                </a><br/>\n                <span class="instance-id">\n                    '+e.id+"\n                </span>\n            "}},{title:"创建时间",content:function(e){return e.id?h["default"].toTime(e.status.creationDateTime)||"-":"-"}},{title:"状态",content:function(e){return'<p class="status '+e.status.state.klass+'">'+e.status.state.text+"</p>"}},{title:"运行时间(分钟)",content:function(e){var t=e.status,a=t.startDateTime,n=t.endDateTime;if(null===a||null===n)return"-";var i=b["default"](a,"YYYY-MM-DD HH:mm:ss");return b["default"](n,"YYYY-MM-DD HH:mm:ss").diff(i,"minutes")}}],T=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIProperties=function(){var e=this.model.get("clusterDetail"),t=e.payType,a=e.status;return{table:g["default"].tableProperty(x,{subrow:!0,select:!1,noDataHtml:'<div><p>你还没创建任何作业！</br><a href="#/bmr/step/create">马上创建&gt;&gt;</a></p></div>'}),pager:{pageSizes:[10,30,50,100]},terminate:{disabled:!y["default"].allowStopCluster(a.state.permission)||t===c.PayType.PREPAY}}},i.prototype.getUIEvents=function(){var e=this;return g["default"].getListEvents({table:{command:function(t){return e.fire(t.name,t)},subrowopen:function(t){return e.fire("SUBROWOPEN",t)}},"refresh:click":function(){return e.fire("REFRESH")},"terminate:click":function(){return e.changeConfirm()},"copy:click":function(){return e.fire("COPY")}})},i.prototype.changeConfirm=function(){var e=this;this.waitConfirm({title:"提示",content:"您确定释放此集群吗？"}).then(function(){return e.fire("TERMINATE")})},i.prototype.getSearchArgs=function(){for(var e,t=this.model.get("clusterId"),a=arguments.length,i=Array(a),r=0;r<a;r++)i[r]=arguments[r];var l=(e=n.prototype.getSearchArgs).call.apply(e,[this].concat(i));return f["default"].defaults(l,{clusterId:t})},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_cluster_step_list"}}]),i}(v["default"]);module.exports=T}),define("bmr/cluster/List",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","er/URL","babel-runtime/helpers/interop-require-default","underscore","common/billing/common","./ListView","./ListModel","../config","../storage","./config","../common/mvc/ListAction","../landing/LandingView"],function(exports,module,e,t,a,n,i,r,l,s,o,u,d,c,p){var m=n["default"](a),f=n["default"](i),b=n["default"](r),h=n["default"](l),v=n["default"](s),g=n["default"](u),y=n["default"](c),x=n["default"](p),T=function(a){function n(e){t["default"](this,n),a.call(this,e),this.modelType=v["default"],this.viewType=h["default"]}return e["default"](n,a),n.prototype.initBehavior=function(){var e=this;a.prototype.initBehavior.call(this),this.view.on(o.events.REFRESH,this.reload,this),this.view.on(o.events.FILTER,this.filter,this),this.view.on(o.events.TERMINATE,this.terminate,this),this.view.on(o.events.SCALE,this.scale,this),this.view.on(o.events.COPY,this.copy,this),this.view.on(o.events.RECHARGE,this.recharge,this),this.view.on(o.events.SAVE_EDIT,this.rename,this),this.view.on(o.events.FilterInstance,this.filterInstance,this),this.view.on("REDIRECT_CREATE",this.redirectCreate,this),this.view.on("SAVE_TEMPLATE",this.saveTemplate,this),this.timer=setInterval(function(){return e.reload()},d.BMR_LISTEN_INTERVAL),this.on("beforeleave",function(){return clearInterval(e.timer)})},n.prototype.filter=function(e){var t=f["default"].omit(this.model.getQuery(),"pageSize","pageNo");"ALL"!==e.value?f["default"].extend(t,{clusterStates:e.value}):delete t.clusterStates;var a=m["default"].withQuery("/bmr/cluster/list",t);this.redirect(a)},n.prototype.redirectCreate=function(e){return this.redirect("#/bmr/cluster/create"+(e.query||""))},n.prototype.saveTemplate=function(e){var t=this;this.model.saveAsTemplate({clusterId:e.args}).then(function(){return t.view.showToast("保存模板成功")})},n.prototype.terminate=function(e){var t=this;this.model.terminate({clusterId:e.args}).then(function(){return t.view.showToast("释放成功")}).ensure(function(){return t.reload()})},n.prototype.scale=function(e){this.redirect("#/bmr/cluster/scale~clusterId="+e.args)},n.prototype.copy=function(e){this.redirectCreate({query:"~clusterId="+e.args})},n.prototype.recharge=function(e){b["default"].recharge("BMR",[e.args])},n.prototype.rename=function(e){var t=this,a=e.value,n=e.rowIndex,i=this.view.get("table").datasource[n],r=i.id;a!==i.name&&this.model.rename({clusterId:r,newName:a}).then(function(){t.view.showToast("修改集群名称成功"),t.reload()})},n.prototype.reloadOmitQuery=function(){return g["default"].remove("filterInstance"),a.prototype.reloadOmitQuery.call(this,{force:!0})},n.prototype.filterInstance=function(){var e=this.view.get("filterInstance").getValue();g["default"].update({filterInstance:e}),a.prototype.reloadOmitQuery.call(this,{force:!0})},n.prototype.forwardToView=function(){if(this.model.requireLanding()){this.viewType=x["default"];try{sessionStorage.setItem("BMR_LANDING_VIEW_VISIT",!0)}catch(e){}}a.prototype.forwardToView.call(this)},n}(y["default"]);module.exports=T}),define("bmr/cluster/list.tpl",[],function(){return'\x3c!-- target: TPL_bmr_cluster_list --\x3e\n<div class="bmr bmr-cluster-list bmr-main-wrap main-wrap-new">\n    \x3c!-- use: TPL_bmr_side_bar(menu="cluster") --\x3e\n    <div class="content-wrap">\n        \x3c!-- import: TPL_bmr_cluster_nav --\x3e\n        <div class="list-content">\n            <h2>\n                集群列表\n                \x3c!-- import: TPL_realname_tip --\x3e\n            </h2>\n            <div class="table-full-wrap">\n                <div class="operation-wrap">\n                    <div class="buttons-wrap">\n                        <button data-ui="id:create;type:Button;skin:create"\n                            data-auth="verifiedUser"\n                            data-authtype="READONLY">创建集群</button>\n                    </div>\n                    <div class="buttons-quick-wrap">\n                        <span data-ui-type="BoxGroup"\n                             data-ui-id="filterInstance"\n                             data-ui-box-type="checkbox" ></span>\n                        \x3c!-- import:TPL_bmr_common_search--\x3e\n                        <button data-ui-id="refresh" data-ui-type="Button" data-ui-skin="refresh"></button>\n                    </div>\n                </div>\n                \x3c!-- import: TPL_bmr_listTableWithCommandAndFilter --\x3e\n                <div class="ui-row clearfix">\n                    \x3c!-- import: listPager --\x3e\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("bmr/cluster/ListModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","lodash","babel-runtime/helpers/interop-require-default","../storage","../common/mvc/ListModel","../config"],function(exports,module,e,t,a,n,i,r,l,s){var o=i["default"](n),u=i["default"](r),d=i["default"](l),c=s.enums.PayType,p=s.enums.CLUSTER_STATUS,m=s.enums.CLUSTER_REASON_CODE,f=[{title:"集群名称/ID",content:function(e,t,a){return s.permission.allowCluster2Detail(e.status.state.permission)?s.html.table.tableId({id:e.id,name:e.name,url:"#/bmr/cluster/detail~clusterId="+e.id,editable:{row:t,col:a}}):s.html.table.tableId(e)},editable:function(e){return!!e.id},editContent:function(e){return o["default"].escape(e.name)},editWidth:250,editRules:{required:"required",requiredErrorMessage:"名称必填",custom:function(e){return e.trim()&&/^[\S ]{1,255}$/.test(e)},customErrorMessage:"名称不符合规则：长度1-255，字符不能全为空格"}},{title:"状态",filter:{datasource:o["default"].reduce(p.toArray(),function(e,t){return s.permission.allowFilter(t.permission)&&e.push({name:t.text,value:t.value,style:"status "+t.klass}),e},[{name:"全部状态",value:"ALL",style:"status normal"}]),value:"ALL"},content:function(e){var t=e.status.state;return t.text+=m.getTextFromValue(e.status.code)||"",s.html.table.tableState(t)}},{title:"支付方式",content:function(e){if(e.payType===c.PREPAY){var t=o["default"].isNumber(e.status.expireDates)?e.status.expireDates:"-";switch(e.status.state.value){case p.Starting:case p.CreateError:case p.Initializing:return"预付费";case p.Suspended:case p.Terminated:return"预付费<br />已到期";default:return 0===t?"预付费<br />今天到期":"预付费<br />"+t+"天后到期"}}else if(e.payType===c.POSTPAY)return"后付费";return"-"}},{title:"运行时间(分钟)",content:function(e){return s.helper.timeDiff(e.status.readyDateTime,e.status.endDateTime)}},{title:"创建时间",content:function(e){return s.helper.toTime(e.status.creationDateTime)||"-"}},{title:"操作",content:function(e){var t=e.id,a=e.payType,n=e.status,i=e.copyable,r=s.html.table.linkButton({label:"复制",title:"复制集群",command:s.events.COPY,disabled:!s.permission.allowCopyCluster(n.state.permission)||!i,commandArgs:t}),l=s.html.table.linkButton({label:"配置变更",title:"配置变更",command:s.events.SCALE,disabled:!s.permission.allowScale(n.state.permission)||a===c.PREPAY&&n.expireDates<1,commandArgs:t}),o=s.html.table.linkButton({label:"释放",title:"释放集群",command:s.events.TERMINATE,disabled:!s.permission.allowStopCluster(n.state.permission)||a===c.PREPAY,commandArgs:t}),u=s.html.table.linkButton({label:"保存为模板",title:"保存为模板",command:s.events.SAVE_TEMPLATE,disabled:!i,commandArgs:t});return""+l+o+"<br/>"+r+s.html.table.linkButton({label:"续费",title:"续费",command:s.events.RECHARGE,disabled:!s.permission.allowReCharge(n.state.permission)||a!==c.PREPAY,commandArgs:t})+u}}],b=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.listRequester=function(e,t){return s.api.bmrClusterListSummary(e,t).then(function(e){return o["default"].each(e.result,function(e){e.status.state=p.fromValue(e.status.state)}),e})},i.prototype.saveAsTemplate=function(e){return s.api.bmrClusterSaveAsTemplate(e)},i.prototype.terminate=function(e){return s.api.bmrTerminateCluster(e)},i.prototype.rename=function(e){var t=e.clusterId,a=e.newName;return s.api.bmrClusterRename({clusterId:t,newName:a})},i.prototype.getQuery=function(){var e=n.prototype.getQuery.call(this),t=u["default"].get("filterInstance");if(e.clusterStates)e.clusterStates=[e.clusterStates];else if(t){var a=o["default"].pluck(p.toArray(),"value"),i=[p.CreateError,p.Terminating,p.Terminated,p.TerminatedWithErrors];e.clusterStates=o["default"].difference(a,i)}return e},i.prototype.requireLanding=function(){var e=!1;try{e=sessionStorage.getItem("BMR_LANDING_VIEW_VISIT")}catch(t){}return this.get("landing")&&!e},i.prototype.prepare=function(){var e=this;o["default"].each(f,function(t){t.hasOwnProperty("filter")&&(t.filter.value=e.get("clusterStates")||"ALL")}),this.set("tableFields",f)},t["default"](i,[{key:"datasource",get:function(){return{landing:function(){return s.api.bmrLanding()}}}}]),i}(d["default"]);module.exports=b}),define("bmr/cluster/ListView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","common/storage","bat-ria/tpl!./list.tpl","../common/mvc/ListView","common/util/tableUtil","./config","../config"],function(exports,module,e,t,a,n,i,r,l,s,o,u,d){var c=i["default"](n),p=i["default"](r),m=i["default"](s),f=i["default"](o),b=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIProperties=function(){var e=n.prototype.getUIProperties.call(this),t=p["default"].get("bmr")||{};return e.filterInstance.rawValue=[t.filterInstance],e},i.prototype.getUIEvents=function(){var e=this;return c["default"].extend(n.prototype.getUIEvents.call(this),{"refresh:click":function(){return e.fire(d.events.REFRESH)},table:{filter:function(t){return e.fire(d.events.FILTER,t)},saveedit:function(t){return e.fire(d.events.SAVE_EDIT,t)}},"create:click":function(){return e.fire("REDIRECT_CREATE")},"filterInstance:change":function(){return e.fire(d.events.FilterInstance)}})},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_cluster_list"}},{key:"uiProperties",get:function(){return{table:f["default"].tableProperty("@tableFields",{select:"",editable:1,noDataHtml:d.html.table.noDataHtml({title:"你还没创建集群！",url:"#/bmr/cluster/create"})}),pager:{pageSizes:[10,30,50,100]},keywordType:{datasource:u.filter},keyword:{placeholder:"请输入"+u.filter[0].name+"进行搜索"},filterInstance:{datasource:[{name:"隐藏已释放集群",value:"OmitNoRun"}]}}}},{key:"queryDict",get:function(){return["keyword","clusterStates"]}},{key:"confirmEventMap",get:function(){var e;return e={},e[d.events.TERMINATE]="您确定释放集群吗？",e}}]),i}(m["default"]);module.exports=b}),define("bmr/cluster/Scale",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","./ScaleView","babel-runtime/helpers/interop-require-default","./ScaleModel","../enums","common/region","common/constants","common/util/orderUtil","bat-ria/mvc/FormAction"],function(exports,module,e,t,a,n,i,r,l,s,o,u,d){var c=i["default"](n),p=i["default"](r),m=i["default"](s),f=i["default"](u),b=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.initBehavior=function(){var e=this;n.prototype.initBehavior.call(this),this.view.on("REFRESH_PRICE",this.refreshPrice,this),this.view.on("CANCEL",this.redirectToList,this),this.refreshPrice(),this.model.checkValidation().then(function(t){return e.view.updateValidation(t.status)})},i.prototype.submit=function(e){if(this.model.isPrepay()){var t=this.convertFormData2Order(e);return this.view.renderOrderConfirm(t,e)}return n.prototype.submit.call(this,e)},i.prototype.convertFormData2Order=function(e){var t=this.model.get("price"),a=e.clusterId,n=this.model.get("clusterDetail").status.expireDates,i=this.model.isPrepay()?l.PayType.PREPAY:l.PayType.POSTPAY,r={type:"RESIZE",serviceType:"BMR",productType:i,instanceId:a,price:t,items:[{serviceType:"BMR",productType:i,price:t,time:n,timeUnit:"DAY",unitPriceShow:"￥"+t,chargeType:o.SERVICE_TYPE.BMR.chargeType[i],configuration:["地域："+m["default"].getCurrentRegion().label]}]};return f["default"].make(r)},i.prototype.refreshPrice=function(){var e=this,t=this.view.getFormData(),a=this.model.getSubmitData(t);this.model.getPrice(a.instanceGroups).then(function(t){return e.view.get("cost").setText(t)})},i.prototype.redirectToDetail=function(){this.redirect("#/bmr/cluster/detail~clusterId="+this.model.get("clusterId"))},i.prototype.redirectToList=function(){this.redirect("#/bmr/cluster/list")},i.prototype.redirectAfterSubmit=function(){this.redirectToDetail()},t["default"](i,[{key:"modelType",get:function(){return p["default"]}},{key:"viewType",get:function(){return c["default"]}}]),i}(i["default"](d)["default"]);module.exports=b}),define("bmr/cluster/scale.tpl",[],function(){return'\x3c!-- target: TPL_bmr_cluster_scale --\x3e\r\n<div class="bmr bmr-cluster-scale main-wrap-new">\r\n    <div class="content-wrap">\r\n        \x3c!--use: TPL_bmr_cluster_nav(title="变更配置") --\x3e\r\n        <div class="create-content">\r\n            <div data-ui-type="ViewStep"\r\n                data-ui-id="buyStep"></div>\r\n            <ul class="ui-tab-navigator"></ul>\r\n            <p class="realname-tip"\r\n                data-ui-type="ToastLabel"\r\n                data-ui-id="balanceTip"\r\n                data-ui-message-type="alert"\r\n                data-ui-hidden="true">\r\n                您的账户已欠费，请<a href="${ticketUrl}">充值</a>。\r\n            </p>\r\n            <div class="create-main">\r\n                <div id="bmr-scale-config">\r\n                    <form data-ui-type="Form"\r\n                        data-ui-id="form"\r\n                        data-ui-auto-validate="true">\r\n                        <div class="detail-parts-table">\r\n                            <dl class="detail-part-1-col">\r\n                                <dt>\r\n                                    <h4>基本配置</h4>\r\n                                </dt>\r\n                                <dd>\r\n                                    <div class="detail-cell">\r\n                                        <label>集群ID：</label>\r\n                                        <span>${clusterDetail.id}</span>\r\n                                    </div>\r\n                                    <div class="detail-cell">\r\n                                        <label>集群名称：</label>\r\n                                        <span>${clusterDetail.name}</span>\r\n                                    </div>\r\n                                    <div class="detail-cell">\r\n                                        <label>计费方式：</label>\r\n                                        <span>\r\n                                            \x3c!--if: ${clusterDetail.payType} === \'prepay\' --\x3e\r\n                                                预付费\r\n                                            \x3c!--else--\x3e\r\n                                                后付费\r\n                                            \x3c!--/if--\x3e\r\n                                        </span>\r\n                                    </div>\r\n                                </dd>\r\n                                <dd>\r\n                                    <div class="detail-cell">\r\n                                        <label>集群释放保护：</label>\r\n                                        <span>\r\n                                            \x3c!--if: ${clusterDetail.terminationProtected} === true --\x3e\r\n                                                开启\r\n                                            \x3c!--else--\x3e\r\n                                                关闭\r\n                                            \x3c!--/if--\x3e\r\n                                        </span>\r\n                                    </div>\r\n                                    <div class="detail-cell">\r\n                                        <label>自动终止：</label>\r\n                                        <span>\r\n                                            \x3c!--if: ${clusterDetail.autoTerminate} === true --\x3e\r\n                                                开启\r\n                                            \x3c!--else--\x3e\r\n                                                关闭\r\n                                            \x3c!--/if--\x3e\r\n                                        </span>\r\n                                    </div>\r\n                                    <div class="detail-cell">\r\n                                        <label>运行时间：</label>\r\n                                        <span>\r\n                                            ${clusterDetail.status.readyDateTime|bmrTimeDiff(${clusterDetail.status.endDateTime})}分钟\r\n                                        </span>\r\n                                    </div>\r\n                                </dd>\r\n                                <dd>\r\n                                    <div class="detail-cell">\r\n                                        <label>超时提醒设置：</label>\r\n                                        <span>\r\n                                            \x3c!--if: ${clusterDetail.reminderConfig} != null --\x3e\r\n                                                开启\r\n                                            \x3c!--else--\x3e\r\n                                                关闭\r\n                                            \x3c!--/if--\x3e\r\n                                        </span>\r\n                                    </div>\r\n                                    <div class="detail-cell">\r\n                                        <label>应用：</label>\r\n                                        <span>\r\n                                            \x3c!-- if: ${clusterDetail.applications.length}  > 0 --\x3e\r\n                                                \x3c!-- for: ${clusterDetail.applications} as ${app}--\x3e\r\n                                                ${app.name}(${app.version});\r\n                                                \x3c!-- /for --\x3e\r\n                                            \x3c!-- else --\x3e\r\n                                                -\r\n                                            \x3c!-- /if --\x3e\r\n                                        </span>\r\n                                    </div>\r\n                                    <div class="detail-cell">\r\n                                        <label>日志URL：</label>\r\n                                        <span>\r\n                                            \x3c!--if: ${clusterDetail.logUri} != null --\x3e\r\n                                                ${clusterDetail.logUri}\r\n                                            \x3c!--else--\x3e\r\n                                                -\r\n                                            \x3c!--/if--\x3e\r\n                                        </span>\r\n                                    </div>\r\n                                </dd>\r\n                            </dl>\r\n\r\n                            <dl class="detail-create detail-part-1-col">\r\n                                <dt>\r\n                                    <h4>变更配置</h4>\r\n                                </dt>\r\n                                    \x3c!--for: ${instancesGroups} as ${group},${index} --\x3e\r\n                                    <dd>\r\n                                        <div class="detail-cell">\r\n                                            <label>${group.type}节点数量：</label>\r\n                                            <span data-ui-type="NumberTextline"\r\n                                                data-ui-max="\r\n                                                    \x3c!-- if: ${group.canExpand} --\x3e\r\n                                                        ${group.maxCount}\r\n                                                    \x3c!-- else --\x3e\r\n                                                        ${group.runningInstanceCount}\r\n                                                    \x3c!-- /if --\x3e\r\n                                                "\r\n                                                data-ui-min="\r\n                                                    \x3c!-- if: ${group.canShrink} --\x3e\r\n                                                        ${group.minCount}\r\n                                                    \x3c!-- else --\x3e\r\n                                                        ${group.runningInstanceCount}\r\n                                                    \x3c!-- /if --\x3e\r\n                                                "\r\n                                                data-ui-name="${group.type}"\r\n                                                data-ui-value="${group.runningInstanceCount}"\r\n                                                data-ui-id="${group.type}Num"></span>\r\n                                            <span class="row-tip">\r\n                                                节点配置：CPU：${group.instanceType.cpu}核 |\r\n                                                内存：${group.instanceType.memory}GB |\r\n                                                硬盘：${group.instanceType.disk}GB\r\n                                            </span>\r\n                                        </div>\r\n                                    </dd>\r\n                                    \x3c!--/for--\x3e\r\n                                    <dd>\r\n                                        <label>\r\n                                            \x3c!-- if: ${clusterDetail.payType} === \'postpay\' --\x3e\r\n                                            调整后费用：\r\n                                            \x3c!-- else --\x3e\r\n                                            需支付差价：\r\n                                            \x3c!-- /if --\x3e\r\n                                        </label>\r\n                                        <span data-ui="type:Label;id:cost;" class="price">￥-/小时</span>\r\n                                    </dd>\r\n                                    <dd class="btn-group">\r\n                                        <button data-ui="id:pick;type:Button;skin:ok;disabled:true;"\r\n                                            class="confirm-button">确认调整</button>\r\n                                        <button data-ui="id:cancel;type:Button;" type="button">取消</button>\r\n                                    </dd>\r\n                                </dd>\r\n                            </dl>\r\n                        </div>\r\n                    </form>\r\n                </div>\r\n                <div id="bmr-scale-confirm">\r\n                    <div data-ui="id:orderAction;type:ActionPanel"\r\n                        class="clearfix ui-tab-content ui-tab-orderconfirm"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("bmr/cluster/ScaleModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","../config","../enums","common/util/moneyUtil","bat-ria/mvc/FormModel"],function(exports,module,e,t,a,n,i,r,l,s,o){var u=i["default"](n),d=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.isPrepay=function(){return this.get("clusterDetail").payType===l.PayType.PREPAY},i.prototype.checkValidation=function(){var e=this.get("clusterDetail").payType;return r.api.bmrAccountValidation({serviceType:"BMR",productType:e})},i.prototype.getPrice=function(e){var t=this,a=this.get("clusterId");return r.api.bmrScalePricing({clusterId:a,instanceGroups:e}).then(function(e){var a=t.isPrepay()?e.price:s.convertPrice(e.price).getPriceOfHour();return t.set("price",a),t.isPrepay()?"￥"+a:"￥"+a+"/小时"})},i.prototype.filterData=function(e){var t=this.get("instancesGroups"),a={clusterId:this.get("clusterId"),instanceGroups:[]};return u["default"].each(t,function(t){return a.instanceGroups.push({id:t.id,instanceCount:e[t.type],type:t.type,instanceType:t.instanceType.name})}),a},t["default"](i,[{key:"submitRequester",get:function(){return r.api.bmrScale}},{key:"datasource",get:function(){return{clusterDetail:function(e){return r.api.bmrClusterDetail({clusterId:e.get("clusterId")})},instancesGroups:function(e){return r.api.bmrInstanceGroupList({clusterId:e.get("clusterId")}).then(function(e){return u["default"].map(e,function(e){return e.maxCount=u["default"].max([e.maxCount,e.runningInstanceCount]),e.minCount=u["default"].min([e.minCount,e.runningInstanceCount]),e})})}}}}]),i}(i["default"](o)["default"]);module.exports=d}),define("bmr/cluster/ScaleView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./scale.tpl","underscore","babel-runtime/helpers/interop-require-default","bat-ria/mvc/FormView","inf-ria/app/brpc"],function(exports,module,e,t,a,n,i,r,l,s){var o=r["default"](i),u=r["default"](l),d=r["default"](s),c=[{text:"变更配置",bindFor:"bmr-scale-config"},{text:"确认订单",bindFor:"bmr-scale-confirm"},{text:"变更成功"}],p=[{text:"变更配置"},{text:"变更成功"}],m=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIProperties=function(){return{buyStep:{steps:this.model.isPrepay()?c:p}}},i.prototype.getUIEvents=function(){var e=this,t={"cancel:click":function(t){return e.fire("CANCEL")}};return o["default"].each(this.model.get("instancesGroups"),function(a){t[a.type+"Num:change"]=o["default"].debounce(function(){return e.fire("REFRESH_PRICE")},300)}),t},i.prototype.renderOrderConfirm=function(e,t){var a=this,n=this.get("orderAction"),i=this.get("buyStep"),r={order:e,config:t};d["default"].invokeService("billing://order_confirm",n,r).then(function(){n.on("action@prevPage",a.renderBmrConfig,a),i.set("currentStep",2)})},i.prototype.renderBmrConfig=function(){var e=this.get("orderAction");this.get("buyStep").set("currentStep",1),e.disposeAction(),e.main.innerHTML=""},i.prototype.updateValidation=function(e){var t=this.get("pick");e?t.enable():this.get("balanceTip").show()},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_cluster_scale"}}]),i}(u["default"]);module.exports=m}),define("bmr/common/app/config",["exports","module","babel-runtime/helpers/class-call-check","er/controller","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t,a){a["default"](t)["default"].registerAction([{type:"bmr/common/app/Detail",path:"/bmr/common/app/detail"},{type:"bmr/common/app/Create",path:"/bmr/common/app/create"}]);module.exports=new function n(){e["default"](this,n)}}),define("bmr/common/app/Create",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormAction","babel-runtime/helpers/interop-require-default","underscore","./CreateModel","./CreateView"],function(exports,module,e,t,a,n,i,r,l,s){var o=i["default"](n),u=i["default"](r),d=i["default"](l),c=i["default"](s),p=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.initBehavior=function(){n.prototype.initBehavior.call(this),this.view.on("REFRESH",this.refresh,this)},i.prototype.redirectAfterSubmit=function(){this.fire("CLOSE_DIALOG")},i.prototype.refresh=function(){var e=this.view.getFormData(),t=this.model.getSubmitData(e);this.reload({appType:this.model.get("appType"),appVersions:u["default"].pluck(this.model.get("appVersions"),"value"),editItem:t,requester:this.model.get("requester")})},t["default"](i,[{key:"modelType",get:function(){return d["default"]}},{key:"viewType",get:function(){return c["default"]}}]),i}(o["default"]);module.exports=p}),define("bmr/common/app/create.tpl",[],function(){return'\n\x3c!-- target: TPL_bmr_app_create_hue --\x3e\n<div class="bmr-app-create">\n     <form data-ui-type="Form"\n          data-ui-id="form"\n          data-ui-auto-validate="true">\n        <table class="form-layout">\n            <tr>\n                <th>Hue版本：</th>\n                <td>\n                    <div data-ui-type="Select"\n                        data-ui-name="appVersion"\n                        data-ui-id="appVersion"></div>\n                </td>\n            </tr>\n        </table>\n    </form>\n</div>\n\n\n\x3c!-- target: TPL_bmr_app_create_hive --\x3e\n<div class="bmr-app-create">\n    <form data-ui-type="Form"\n          data-ui-id="form"\n          data-ui-auto-validate="true">\n        <table class="form-layout">\n            <tr>\n                <th>Hive版本：</th>\n                <td>\n                    <div data-ui="type:Select;id:appVersion;name:appVersion;"></div>\n                </td>\n            </tr>\n            <tr>\n                <th>Metastore：</th>\n                <td>\n                    <div data-ui="type:Select;id:metastore;name:metastore"></div>\n                </td>\n            </tr>\n            \x3c!-- if: ${editItem.properties.metastore} === \'mysql\' --\x3e\n            <tr>\n                <th>服务地址：</th>\n                <td>\n                    <div data-ui="type:TextBox;id:host;name:host;">\n                    </div>\n                </td>\n            </tr>\n            <tr>\n                <th>服务端口：</th>\n                <td>\n                    <div data-ui="type:TextBox;id:port;name:port;">\n                    </div>\n                </td>\n            </tr>\n            <tr>\n                <th>数据库：</th>\n                <td>\n                    <div data-ui="type:TextBox;id:database;name:database;">\n                    </div>\n                </td>\n            </tr>\n            <tr>\n                <th>用户名：</th>\n                <td>\n                    <input data-ui="type:TextBox;id:userName;name:userName;"/>\n                </td>\n            </tr>\n            <tr>\n                <th>密码：</th>\n                <td>\n                    <input type="password" data-ui="type:TextBox;id:password;name:password;" />\n                </td>\n            </tr>\n            \x3c!--/if--\x3e\n        </table>\n    </form>\n</div>\n\n\n\x3c!-- target: TPL_bmr_app_create_pig --\x3e\n<div class="bmr-app-create">\n    <form data-ui-type="Form"\n          data-ui-id="form"\n          data-ui-auto-validate="true">\n        <table class="form-layout">\n            <tr>\n                <th>Pig版本：</th>\n                <td>\n                    <div data-ui="type:Select;id:appVersion;name:appVersion;"></div>\n                </td>\n            </tr>\n        </table>\n    </form>\n</div>\n\n\n\x3c!-- target: TPL_bmr_app_create_hbase --\x3e\n<div class="bmr-app-create">\n    <form data-ui-type="Form"\n          data-ui-id="form"\n          data-ui-auto-validate="true">\n        <table class="form-layout">\n            <tr>\n                <th>HBase版本：</th>\n                <td>\n                    <div data-ui-type="Select"\n                        data-ui-name="appVersion"\n                        data-ui-id="appVersion"></div>\n                </td>\n            </tr>\n            <tr>\n                <th></th>\n                <td>\n                    <div data-ui-type="BoxGroup"\n                        data-ui-id="restoreEnabled"\n                        data-ui-name="restoreEnabled"\n                        data-ui-box-type="checkbox" ></div>\n                </td>\n            </tr>\n            \x3c!-- if: ${editItem.properties.restoreEnabled} === \'open\' --\x3e\n            <tr>\n                <th>恢复位置：</th>\n                <td>\n                    <input data-ui-type="BucketSelect"\n                        data-ui-extension-bucketselect-type="BucketSelectEx"\n                        data-ui-id="restoreLocation"\n                        data-ui-mode="text"\n                        data-ui-name="restoreLocation"/>\n                </td>\n            </tr>\n            <tr>\n                <th>恢复版本：</th>\n                <td>\n                    <div data-ui-type="TextBox"\n                        data-ui-name="restoreVersion"\n                        data-ui-id="restoreVersion"></div>\n                </td>\n            </tr>\n            \x3c!-- /if --\x3e\n            <tr>\n                <th>\n                </th>\n                <td>\n                    <div data-ui-type="BoxGroup"\n                        data-ui-id="backupEnabled"\n                        data-ui-name="backupEnabled"\n                        data-ui-box-type="checkbox" ></div>\n                </td>\n            </tr>\n            \x3c!-- if: ${editItem.properties.backupEnabled} === \'open\' --\x3e\n            <tr>\n                <th>备份频率：</th>\n                <td>\n                    <div data-ui="type:TextBox;id:backupIntervalInMinutes;name:backupIntervalInMinutes;"></div>分钟\n                    <label data-ui-type="Validity" data-ui-id="backupIntervalInMinutesValidityLabel"></label>\n                </td>\n            </tr>\n            <tr>\n                <th>备份位置：</th>\n                <td>\n                    <input data-ui-type="BucketSelect"\n                        data-ui-extension-bucketselect-type="BucketSelectEx"\n                        data-ui-id="backupLocation"\n                        data-ui-name="backupLocation"/>\n                </td>\n            </tr>\n            <tr>\n                <th>备份开启时间：</th>\n                <td>\n                    <input data-ui-type="Calendar"\n                        data-ui-id="backupStartDateTime"\n                        data-ui-name="backupStartDateTime"\n                        data-ui-time="true"/>\n                </td>\n            </tr>\n            \x3c!-- /if --\x3e\n        </table>\n    </form>\n</div>\n\n\x3c!-- target: TPL_bmr_app_create_zeppelin --\x3e\n<div class="bmr-app-create">\n     <form data-ui-type="Form"\n          data-ui-id="form"\n          data-ui-auto-validate="true">\n        <table class="form-layout">\n            <tr>\n                <th>Zeppelin版本：</th>\n                <td>\n                    <div data-ui-type="Select"\n                        data-ui-name="appVersion"\n                        data-ui-id="appVersion"></div>\n                </td>\n            </tr>\n        </table>\n    </form>\n</div>\n\n\x3c!-- target: TPL_bmr_app_create_kafka --\x3e\n<div class="bmr-app-create">\n     <form data-ui-type="Form"\n          data-ui-id="form"\n          data-ui-auto-validate="true">\n        <table class="form-layout">\n            <tr>\n                <th>Kafka版本：</th>\n                <td>\n                    <div data-ui-type="Select"\n                        data-ui-name="appVersion"\n                        data-ui-id="appVersion"></div>\n                </td>\n            </tr>\n        </table>\n    </form>\n</div>\n\n\x3c!-- target: TPL_bmr_app_create_mahout --\x3e\n<div class="bmr-app-create">\n     <form data-ui-type="Form"\n          data-ui-id="form"\n          data-ui-auto-validate="true">\n        <table class="form-layout">\n            <tr>\n                <th>Mahout版本：</th>\n                <td>\n                    <div data-ui-type="Select"\n                        data-ui-name="appVersion"\n                        data-ui-id="appVersion"></div>\n                </td>\n            </tr>\n        </table>\n    </form>\n</div>\n\n\x3c!-- target: TPL_bmr_app_create_spark --\x3e\n<div class="bmr-app-create">\n     <form data-ui-type="Form"\n          data-ui-id="form"\n          data-ui-auto-validate="true">\n        <table class="form-layout">\n            <tr>\n                <th>Spark版本：</th>\n                <td>\n                    <div data-ui-type="Select"\n                        data-ui-name="appVersion"\n                        data-ui-id="appVersion"></div>\n                </td>\n            </tr>\n        </table>\n    </form>\n</div>\n'}),define("bmr/common/app/CreateModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormModel","babel-runtime/helpers/interop-require-default","underscore","common/util/timeUtil","common/region","../../config"],function(exports,module,e,t,a,n,i,r,l,s){var o=n["default"](a),u=n["default"](i),d=n["default"](r),c=n["default"](l),p=function(a){function n(){t["default"](this,n),a.apply(this,arguments)}return e["default"](n,a),n.prototype.prepare=function(){this.submitRequester=this.get("requester");var e=this.get("appVersions");e=u["default"].map(e,function(e){return{name:e,value:e}}),this.set("appVersions",e);var t=this.get("editItem");t.properties=t.properties||{},t.properties.backupEnabled&&(t.properties.backupEnabled="open"),t.properties.restoreEnabled&&(t.properties.restoreEnabled="open"),t.properties.backupStartDateTime&&(t.properties.backupStartDateTime=d["default"].toTime(t.properties.backupStartDateTime))},n.prototype.filterData=function(e){var t={version:e.appVersion,name:this.get("appType"),properties:{}};return"hive"===t.name.toLowerCase()&&u["default"].extend(t.properties,{metastore:e.metastore,host:"mysql"===e.metastore?e.host:null,port:"mysql"===e.metastore?+e.port||"":null,database:"mysql"===e.metastore?e.database:null,userName:"mysql"===e.metastore?e.userName:null,password:"mysql"===e.metastore?e.password:null}),"hbase"===t.name.toLowerCase()&&(e.restoreEnabled="open"===e.restoreEnabled[0],e.backupEnabled="open"===e.backupEnabled[0],u["default"].extend(t.properties,{restoreEnabled:e.restoreEnabled,restoreLocation:e.restoreEnabled?e.restoreLocation:null,restoreVersion:e.restoreEnabled?e.restoreVersion:null,backupEnabled:e.backupEnabled,backupLocation:e.backupEnabled?e.backupLocation:null,backupIntervalInMinutes:e.backupEnabled?+e.backupIntervalInMinutes||"":null,backupStartDateTime:e.backupEnabled?d["default"].timeToUtc(e.backupStartDateTime):null})),t},n.prototype.getDatasource=function(){return{metaDatasource:function(){return[{name:"DEFAULT",value:"default"},{name:"MYSQL",value:"mysql"}]},getBucketLocations:function(){return function(){return{locations:[c["default"].getCurrentRegion().id]}}},getBucketList:function(){return s.api.bmrBucketList},getFolderList:function(){return s.api.bmrFolderList},getObjectList:function(){return s.api.bmrObjectList},createBucket:function(){return s.api.bmrCreateBucket}}},n.prototype.validBosUri=function(e){return s.api.bmrLogCheckFolder(e)},n}(o["default"]);module.exports=p}),define("bmr/common/app/CreateView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./create.tpl","bat-ria/mvc/FormView","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t,a,n,i,r){var l=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIEvents=function(){var e=this;return{"backupEnabled:change":function(){return e.fire("REFRESH")},"restoreEnabled:change":function(){return e.fire("REFRESH")},"metastore:change":function(){return e.fire("REFRESH")}}},i.prototype.getTemplateName=function(){return"TPL_bmr_app_create_"+this.model.get("appType")},t["default"](i,[{key:"uiProperties",get:function(){return{appVersion:{datasource:"@appVersions",value:"@editItem.version",width:"200"},metastore:{datasource:"@metaDatasource",value:"@editItem.properties.metastore",width:"200"},host:{value:"@editItem.properties.host",required:"required",requiredErrorMessage:"请输入服务地址",width:"178",placeholder:"MySql服务地址"},port:{value:"@editItem.properties.port",required:"required",requiredErrorMessage:"请输入端口号",pattern:"^[1-9][0-9]*$",patternErrorMessage:"请输入有效地端口号，规则为：[1~65535]",width:"178",placeholder:"3306"},database:{value:"@editItem.properties.database",required:"required",requiredErrorMessage:"请输入数据库名称",width:"178",placeholder:"数据库实例名称"},userName:{value:"@editItem.properties.userName",required:"required",requiredErrorMessage:"请输入用户名",width:"178",placeholder:"用户名"},password:{value:"@editItem.properties.password",required:"required",requiredErrorMessage:"请输入密码",width:"178",placeholder:"密码"},restoreVersion:{value:"@editItem.properties.restoreVersion",width:178,required:"required",requiredErrorMessage:"请输入备份版本"},backupIntervalInMinutes:{value:"@editItem.properties.backupIntervalInMinutes",width:178,required:"required",requiredErrorMessage:"请输入备份频率",pattern:"^[1-9][0-9]*$",patternErrorMessage:"请输入有效地备份频率，规则为：正整数",validityLabel:"backupIntervalInMinutesValidityLabel"},backupEnabled:{datasource:[{name:"定期备份设置",value:"open"}],value:"@editItem.properties.backupEnabled"},restoreEnabled:{datasource:[{name:"从备份中恢复",value:"open"}],value:"@editItem.properties.restoreEnabled"},backupLocation:{required:"required",requiredErrorMessage:"请选择备份输出位置",value:"@editItem.properties.backupLocation",getBucketList:"@getBucketList",getFolderList:"@getFolderList",getObjectList:"@getObjectList",createBucket:"@createBucket",getBucketLocations:"@getBucketLocations",viewtype:"folder",urlPrefix:"bos://",placeholder:"bos://",width:200},restoreLocation:{required:"required",requiredErrorMessage:"请选择恢复输入位置",value:"@editItem.properties.restoreLocation",placeholder:"bos://",getBucketList:"@getBucketList",getFolderList:"@getFolderList",getObjectList:"@getObjectList",createBucket:"@createBucket",getBucketLocations:"@getBucketLocations",viewtype:"folder",urlPrefix:"bos://",width:200},backupStartDateTime:{value:"@editItem.properties.backupStartDateTime"}}}}]),i}(r["default"](i)["default"]);module.exports=l}),define("bmr/common/app/Detail",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/BaseAction","babel-runtime/helpers/interop-require-default","underscore","er/Deferred","./DetailModel","./DetailView","../../operation"],function(exports,module,e,t,a,n,i,r,l,s,o,u){var d=i["default"](n),c=i["default"](r),p=i["default"](l),m=i["default"](s),f=i["default"](o),b=i["default"](u),h=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.initBehavior=function(){n.prototype.initBehavior.call(this),this.view.on("APP_ADD_EVT",this.addApp,this),this.view.on("DELETE",this.deleteApp,this),this.view.on("EDIT",this.editApp,this),this.on("ASYNC",this.asyncTableAndAppSelect,this),this.view.on("RELOAD_APP_SELECT",this.asyncTableAndAppSelect,this),this.view.on("RELOAD_IMAGE_VERSION_SELECT",this.reloadImageVersion,this),this.model.get("applications").length>0&&this.asyncTableAndAppSelect()},i.prototype.editApp=function(e){var t=this.view.get("table").datasource[+e.args],a=this.view.get("imageTypeSelect").getValue(),n=this.view.get("imageVersionSelect").getValue(),i=this.model.getAvailableAppVersions(a,n,t.name);return b["default"].addApp.call(this,{appType:t.name,appVersions:i,editItem:t,requester:c["default"].bind(this.editAppAfter,this)})},i.prototype.addApp=function(){var e=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],t=this.view.get("imageTypeSelect").getValue(),a=this.view.get("imageVersionSelect").getValue(),n=this.view.get("appSelect").getValue(),i=this.model.getAvailableAppVersions(t,a,n);return b["default"].addApp.call(this,{appType:n,appVersions:i,editItem:e,requester:c["default"].bind(this.addAppAfter,this)})},i.prototype.deleteApp=function(e){var t=this.view.get("table");t.setDatasource(c["default"].filter(t.datasource,function(t,a){return a!==+e.args})),this.fire("ASYNC")},i.prototype.addAppAfter=function(){for(var e=this.view.get("table"),t=e.datasource,a=arguments.length,n=Array(a),i=0;i<a;i++)n[i]=arguments[i];return e.setDatasource(t.concat(n)),this.fire("ASYNC"),p["default"].resolved()},i.prototype.editAppAfter=function(e){var t=this.view.get("table"),a=c["default"].map(t.datasource,function(t){return t.name===e.name?e:t});return t.setDatasource(a),this.fire("ASYNC"),p["default"].resolved()},i.prototype.asyncTableAndAppSelect=function(){var e=this.view.get("table").datasource,t=this.view.get("appSelect"),a=this.view.get("addApp"),n=this.view.get("imageTypeSelect").getValue(),i=this.view.get("imageVersionSelect").getValue(),r=this.model.getAvailableImageApp(n,i),l=c["default"].pluck(e,"name"),s=c["default"].filter(r,function(e){return!c["default"].contains(l,e.name)});s.length>0?(t.updateDatasource(s),t.set("selectedIndex",0),t.enable(),a.enable()):(t.updateDatasource([{name:"没有可用的应用",value:""}]),t.set("selectedIndex",0),t.disable(),a.disable())},i.prototype.getFormData=function(){return{imageType:this.view.get("imageTypeSelect").getValue(),imageVersion:this.view.get("imageVersionSelect").getValue(),applications:this.view.get("table").datasource}},i.prototype.reloadImageVersion=function(){var e=this.view.get("imageTypeSelect").getValue(),t=this.model.getAvailableImageVersion(e),a=this.view.get("imageVersionSelect");a.updateDatasource(t),0===a.selectedIndex?this.fire("ASYNC"):a.set("selectedIndex",0)},t["default"](i,[{key:"modelType",get:function(){return m["default"]}},{key:"viewType",get:function(){return f["default"]}}]),i}(d["default"]);module.exports=h}),define("bmr/common/app/detail.tpl",[],function(){return'\x3c!-- target: TPL_bmr_app_detail_child --\x3e\n<div class="bmr-app-detail">\n    <dl class="detail-create detail-part-1-col">\n        <dt>\n            <h4>集群配置</h4>\n        </dt>\n        <dd>\n            <label>镜像类型：</label>\n            <div>\n                <div class="ui-group ui-select-group">\n                    <div data-ui-type="Select" data-ui-id="imageTypeSelect"></div>\n                    <div data-ui-type="Select" data-ui-id="imageVersionSelect"></div>\n                </div>\n            </div>\n        </dd>\n        <dd>\n            <label>添加应用：</label>\n            <div data-ui-id="appSelect" data-ui-type="Select" class="app-select"></div>\n            <button data-ui-id="addApp" data-ui-type="Button" data-ui-skin="create">\n                添加应用\n            </button>\n        </dd>\n        <dd>\n            <div data-ui-type="Table" data-ui-id="table" data-ui-datasource="@tableData"\n                data-ui-order-by="@orderBy" data-ui-order="@order" data-ui-select="@selectMode"\n                data-ui-extension-tip-type="TableTip"\n                data-ui-extension-command-type="Command">\n            </div>\n        </dd>\n    </dl>\n</div>\n'}),define("bmr/common/app/DetailModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/BaseModel","babel-runtime/helpers/interop-require-default","underscore","../../config"],function(exports,module,e,t,a,n,i,r,l){var s=i["default"](n),o=i["default"](r),u=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getAvailableImageVersion=function(e){return o["default"].reduce(this.get("appConfig"),function(t,a){return a.type===e&&t.push({name:a.description,value:a.version}),t},[])},i.prototype.getAvailableImageApp=function(e,t){var a=o["default"].find(this.get("appConfig"),function(a){return a.type===e&&a.version===t})||{};return o["default"].reduce(a.applications,function(e,t){return e.push({name:t.name,value:t.name})&&e},[])},i.prototype.getAvailableAppVersions=function(e,t,a){var n=o["default"].find(this.get("appConfig"),function(a){return a.type===e&&a.version===t})||{},i=o["default"].find(n.applications,function(e){return e.name===a});return i&&i.versions},i.prototype.prepare=function(){var e=o["default"].map(o["default"].uniq(o["default"].pluck(this.get("appConfig"),"type")),function(e){return{name:e,value:e}}),t=this.getAvailableImageVersion(this.get("imageType")||e[0].value),a=this.getAvailableImageApp(e[0].value,t[0].value);this.set("imageTypes",e),this.set("imageVersions",t),this.set("imageApps",a),this.set("applications",this.get("applications")||[])},t["default"](i,[{key:"datasource",get:function(){return{appConfig:function(){return l.api.bmrAppConfig()}}}}]),i}(s["default"]);module.exports=u}),define("bmr/common/app/DetailView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./detail.tpl","bat-ria/mvc/BaseView","babel-runtime/helpers/interop-require-default","etpl"],function(exports,module,e,t,a,n,i,r,l){var s=r["default"](i),o=r["default"](l),u=[{title:"已添加应用名称",content:"name"},{title:"版本",content:"version"},{title:"操作",content:function(e,t){var a='<button data-command="${command}" data-command-args="${args}">${text}</button>',n='<p class="cmds">';return n+=o["default"].compile(a)({command:"EDIT",args:t,text:"编辑"}),n+=o["default"].compile(a)({command:"DELETE",args:t,text:"删除"}),n+="<p>"}}],d=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIEvents=function(){var e=this;return{"table:command":function(t){return e.fire(t.name,t)},"addApp:click":function(t){return e.fire("APP_ADD_EVT",t)},imageTypeSelect:{change:function(){return e.fire("RELOAD_IMAGE_VERSION_SELECT")},beforechange:function(t){return e.changeConfirm(t)}},imageVersionSelect:{change:function(){return e.fire("RELOAD_APP_SELECT")},beforechange:function(t){return e.changeConfirm(t)}}}},i.prototype.changeConfirm=function(e){var t=this.get("table"),a=e.target;t.datasource.length>0&&a.selectedIndex!==+e.index&&(e.preventDefault(),this.waitConfirm({title:"提示",content:"切换镜像类型以及版本会清空已添加的应用，您确认这样做吗？"}).then(function(){t.setDatasource([]),e.target.set("selectedIndex",+e.index)}))},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_app_detail"}},{key:"uiProperties",get:function(){return{table:{datasource:"@applications",fields:u},imageTypeSelect:{datasource:"@imageTypes",width:"90",value:"@imageType"},imageVersionSelect:{datasource:"@imageVersions",width:"170",value:"@imageVersion"},appSelect:{datasource:"@imageApps",width:"260"}}}}]),i}(s["default"]);module.exports=d}),define("bmr/common/common.tpl",[],function(){return'\x3c!-- target: TPL_bmr_side_bar --\x3e\n<ul class="sidebar" id="sidebar" data-menu="${menu}">\n    <li class="menu-header">\n        百度MapReduce\n    </li>\n    <li class="menu-item menu-item-common" sidetype="cluster">\n        <a href="#/bmr/cluster/list">\n            <i class="iconfont icon-bmr-cluster"></i>集群\n        </a>\n    </li>\n    <li class="menu-item menu-item-common" sidetype="template">\n        <a href="#/bmr/template/list">\n            <i class="iconfont icon-bmr-cluster-template"></i>集群模板\n        </a>\n    </li>\n    <li class="menu-item menu-item-common" sidetype="step">\n        <a href="#/bmr/step/list">\n            <i class="iconfont icon-bmr-step"></i>作业\n        </a>\n    </li>\n    <li class="menu-item menu-item-common" sidetype="schedule_plan">\n        <a href="#/bmr/schedule_plan/list">\n            <i class="iconfont icon-bmr-crontask"></i>定时任务\n        </a>\n    </li>\n</ul>\n\n\n\x3c!-- target: TPL_bmr_cluster_nav --\x3e\n<p class="breadcrumb">\n    <span>产品服务</span>\n    <span class="divider">/</span>\n    \x3c!--if: ${title} --\x3e\n    <a href="#/bmr/cluster/list">百度MapReduce-集群列表</a>\n    <span class="divider">/</span>\n    <span class="active">${title}</span>\n    \x3c!-- else --\x3e\n    <span class="active">百度MapReduce-集群列表</span>\n    \x3c!--/if--\x3e\n</p>\n\n\n\x3c!-- target: TPL_bmr_schedule_plan_nav --\x3e\n<p class="breadcrumb">\n    <span>产品服务</span>\n    <span class="divider">/</span>\n    \x3c!--if: ${title} --\x3e\n    <a href="#/bmr/schedule_plan/list">百度MapReduce-定时任务</a>\n    <span class="divider">/</span>\n    <span class="active">${title}</span>\n    \x3c!-- else --\x3e\n    <span class="active">百度MapReduce-定时任务</span>\n    \x3c!--/if--\x3e\n</p>\n\n\n\x3c!-- target: TPL_bmr_template_nav --\x3e\n<p class="breadcrumb">\n    <span>产品服务</span>\n    <span class="divider">/</span>\n    \x3c!--if: ${title} --\x3e\n    <a href="#/bmr/template/list">百度MapReduce-集群模板</a>\n    <span class="divider">/</span>\n    <span class="active">${title}</span>\n    \x3c!-- else --\x3e\n    <span class="active">百度MapReduce-集群模板</span>\n    \x3c!--/if--\x3e\n</p>\n\n\n\x3c!-- target: TPL_bmr_step_nav --\x3e\n<p class="breadcrumb">\n    <span>产品服务</span>\n    <span class="divider">/</span>\n    \x3c!--if: ${title} --\x3e\n    <a href="#/bmr/step/list">百度MapReduce-作业列表</a>\n    <span class="divider">/</span>\n    <span class="active">${title}</span>\n    \x3c!-- else --\x3e\n    <span class="active">百度MapReduce-作业列表</span>\n    \x3c!--/if--\x3e\n</p>\n\n\n\x3c!--target: TPL_bmr_cluster_detail_tab --\x3e\n<ul class="ui-tab-navigator">\n    <li class="ui-tab-item ${detailActive}">\n        <a href="##/bmr/cluster/detail~clusterId=${clusterId}">实例详情</a>\n    </li>\n    <li class="ui-tab-item ${monitorActive}" >\n        <a href="#/bmr/cluster/monitor~clusterId=${clusterId}">监控</a>\n    </li>\n    <li class="ui-tab-item ${stepActive}" >\n        <a href="#/bmr/cluster/steplist~clusterId=${clusterId}">作业</a>\n    </li>\n</ul>\n\n\n\x3c!--target: TPL_bmr_step_detail_tab --\x3e\n<ul class="ui-tab-navigator">\n    <li class="ui-tab-item ${detailActive}">\n        <a href="#/bmr/step/detail~stepId=${stepId}&clusterId=${clusterId}">作业详情</a>\n    </li>\n    \x3c!-- if: ${stepDetail.stderr} || ${stepDetail.stdout} || ${stepDetail.syslog} --\x3e\n    <li class="ui-tab-item ${logActive}">\n        <a href="#/bmr/step/log~stepId=${stepId}&clusterId=${clusterId}">作业日志</a>\n    </li>\n    \x3c!-- /if --\x3e\n</ul>\n\n\n\x3c!-- target: TPL_bmr_status_filter --\x3e\n<label data-ui-type="Label" class="hcell-select" data-command="onFilterDlgEvt" data-command-args="">\n    &nbsp;&nbsp;&nbsp;状态&nbsp;\n    <span  class="arrow"></span>\n</label>\n<ul class="hcell-ul" style="display:none">\n    <li data-command="onFilterEvt" data-command-args="key:ALL">状态(全部)</li>\n    \x3c!-- for : ${bmrConfig.stepStatus} as ${status} --\x3e\n    \x3c!-- if: ${status.permission} & ${bmrConfig.permission.allowFilter}  --\x3e\n    <li data-command="onFilterEvt" data-command-args="key:${status.key}">状态(${status.text})</li>\n    \x3c!-- /if --\x3e\n    \x3c!-- /for --\x3e\n</ul>\n\n\n\x3c!-- target: TPL_bmr_common_search --\x3e\n<span class="ui-group ui-search-group">\n    <span data-ui-type="Select"\n        data-ui-id="keywordType"\n        data-ui-value="@keywordType"></span>\n    <input class="search-box"\n        data-ui-type="TextBox"\n        data-ui-id="keyword"\n        data-ui-value="@keyword" />\n    <button class="btn btn-white"\n        data-ui-type="Button"\n        data-ui-id="searchBtn"></button>\n</span>\n\n\n\x3c!-- target: TPL_bmr_listTableWithCommandAndFilter --\x3e\n<div data-ui-type="Table" data-ui-id="table" data-ui-datasource="@tableData"\n    data-ui-order-by="@orderBy" data-ui-order="@order" data-ui-select="@selectMode"\n    data-ui-extension-command-type="Command"\n    data-ui-extension-tableedit-type="TableEdit"\n    data-ui-extension-tablefilter-type="TableFilter">\n</div>\n\n\n\x3c!-- target: TPL_bmr_cluster_detail_header --\x3e\n<div class="instance-info">\n    <h1>${clusterDetail.name}</h1>\n    <span class="status ${clusterDetail.status.state.klass}">\n        ${clusterDetail.status.state.text}\n    </span>\n    <span class="ui-group ui-button-group">\n        <button data-ui="id:copy;type:Button;">复制</button>\n        <button data-ui="id:terminate;type:Button;">释放</button>\n        <button data-ui="id:refresh;type:Button;skin:refresh;"></button>\n    </span>\n</div>\n\n\x3c!-- target: TPL_bmr_step_detail_header --\x3e\n<div class="instance-info">\n    <h1>${stepDetail.name}</h1>\n    <span class="status ${stepDetail.status.state.klass}">\n        ${stepDetail.status.state.text}\n    </span>\n    <span class="ui-group ui-button-group">\n        <button data-ui="id:refresh;type:Button;skin:refresh;"></button>\n    </span>\n</div>\n\n\x3c!-- target: TPL_bmr_schedule_plan_header --\x3e\n<div class="instance-info">\n    <h1>${detail.name}</h1>\n    \x3c!-- if: ${detail.isEnabled} === true --\x3e\n    <span class="status normal">开启</span>\n    \x3c!-- else --\x3e\n    <span class="status unavailable">关闭</span>\n    \x3c!-- /if --\x3e\n    <span class="ui-group ui-button-group">\n        <button data-ui="id:refresh;type:Button;skin:refresh;"></button>\n    </span>\n</div>\n'}),define("bmr/common/flavor/config",["exports","module","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","er/controller","babel-runtime/helpers/interop-require-default","underscore"],function(exports,module,e,t,a,n,i){var r=n["default"](a),l=n["default"](i);r["default"].registerAction([{type:"bmr/common/flavor/Flavor",path:"/bmr/common/flavor"}]);var s=[{type:"Master",text:"Master Node<br/>集群的主节点"},{type:"Core",text:"Core Node<br/>有hdfs部署的计算节点"},{type:"Task",text:"Task Node<br/>无hdfs的计算节点，适合弹性扩展"}],o=function(){function a(){t["default"](this,a)}return a.prototype.findFlavorType=function(){var e=arguments.length<=0||arguments[0]===undefined?"":arguments[0];return l["default"].find(s,function(t){return t.type.toLowerCase()===e.toLowerCase()})},e["default"](a,[{key:"flavorType",get:function(){return s}}]),a}();module.exports=new o}),define("bmr/common/flavor/Flavor",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","inf-ria/ui/NumberTextline","bat-ria/mvc/BaseAction","./FlavorView","./FlavorModel"],function(exports,module,e,t,a,n,i,r,l,s){var o=n["default"](a),u=n["default"](r),d=n["default"](l),c=n["default"](s),p=function(a){function n(){t["default"](this,n);for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];a.call.apply(a,[this].concat(i)),this.viewType=d["default"],this.modelType=c["default"]}return e["default"](n,a),n.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.view.on("UPDATE_PRICE",this.updatePrice,this),this.updatePrice()},n.prototype.updatePrice=function(){var e=this.view.get("price"),t=this.getFormData();this.model.getPrice(o["default"].pick(t,"instanceGroups","payType","purchaseLength")).then(function(t){return e.setText(t)})},n.prototype.getFormData=function(){var e={instanceGroups:this.view.get("flavorNode").getValue(),payType:this.model.get("payType"),price:this.model.get("price")};if(this.model.isPrepay()){var t=this.view.get("purchaseLength").getValue();e.purchaseLength=t}return e},n}(u["default"]);module.exports=p}),define("bmr/common/flavor/flavor.tpl",[],function(){return'\x3c!-- target: TPL_bmr_flavor_child --\x3e\n<div class="bmr-flavor">\n    <dl class="detail-create detail-part-1-col">\n        <dt>\n            <h4>节点配置</h4>\n        </dt>\n        <dd>\n            <label></label>\n            <div data-ui="type:FlavorNode;id:flavorNode"></div>\n        </dd>\n    </dl>\n    \x3c!-- if: ${payType} === \'prepay\' --\x3e\n    <dl class="detail-create detail-part-1-col">\n        <dt>\n            <h4>购买信息</h4>\n        </dt>\n        <dd>\n            <label>购买时长：</label>\n            <div>\n                <div class="ui-radioselect-pl"\n                    data-ui-id="purchaseLength"\n                    data-ui-name="purchaseLength"\n                    data-ui-type="RadioSelect"></div>\n            </div>\n        </dd>\n    </dl>\n    \x3c!-- /if --\x3e\n    <div>\n        <label class="price-label">配置价格：</label>\n        <span data-ui-id="price" data-ui-type="Label" class="price">￥-/小时</span>\n    </div>\n</div>\n'}),define("bmr/common/flavor/FlavorModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","../../config","../../enums","common/util/moneyUtil","bat-ria/mvc/BaseModel","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t,a,n,i,r,l,s){var o=[{name:"1个月",value:1},{name:"2",value:2},{name:"3",value:3},{name:"4",value:4},{name:"5",value:5},{name:"6",value:6},{name:"7",value:7},{name:"8",value:8},{name:"9",value:9},{name:"1年",value:12,hoverContent:"注：购买10个月赠送2个月"},{name:"2年",value:24,hoverContent:"注：购买20个月赠送4个月"},{name:"3年",value:36,hoverContent:"注：购买30个月赠送6个月"}],u=function(l){function s(){a["default"](this,s),l.apply(this,arguments)}return e["default"](s,l),s.prototype.isPrepay=function(){return this.get("payType")===i.PayType.PREPAY},s.prototype.getPrice=function(e){var t=this;return n.api.bmrPricing(e,{"X-silence":!0}).then(function(e){var a=t.isPrepay()?e.price:r.convertPrice(e.price).getPriceOfHour();return t.set("price",a),t.isPrepay()?"￥"+a:"￥"+a+"/小时"})},t["default"](s,[{key:"datasource",get:function(){return{purchaseLength:function(){return o},flavorDatasource:function(e){return n.api.bmrFlavorConfig({payType:e.get("payType")})}}}}]),s}(s["default"](l)["default"]);module.exports=u}),define("bmr/common/flavor/FlavorView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","bat-ria/tpl!./flavor.tpl","bat-ria/mvc/BaseView"],function(exports,module,e,t,a,n,i,r,l){var s=i["default"](n),o=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIProperties=function(){return{purchaseLength:{datasource:"@purchaseLength"},flavorNode:{datasource:"@flavorDatasource",value:s["default"].pick(this.model.dump(),"master","core","task")}}},i.prototype.getUIEvents=function(){var e=this;return{"flavorNode:change":function(){return e.fire("UPDATE_PRICE")},"purchaseLength:change":function(){return e.fire("UPDATE_PRICE")}}},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_flavor"}}]),i}(i["default"](l)["default"]);module.exports=o}),define("bmr/common/image/config",["exports","er/controller","babel-runtime/helpers/interop-require-default"],function(exports,e,t){t["default"](e)["default"].registerAction([{type:"bmr/common/image/Edit",path:"/bmr/common/image/edit"},{type:"bmr/common/image/Image",path:"/bmr/common/image/detail"}])}),define("bmr/common/image/Image",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","../../operation","er/Deferred","./ImageView","./ImageModel","bat-ria/mvc/BaseAction"],function(exports,module,e,t,a,n,i,r,l,s,o){var u=n["default"](a),d=n["default"](i),c=n["default"](r),p=n["default"](l),m=n["default"](s),f=function(a){function n(e){t["default"](this,n),a.call(this,e),this.viewType=p["default"],this.modelType=m["default"]}return e["default"](n,a),n.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.view.on("APP_CHANGE",this.appChange,this),this.view.on("IMAGE_CHANGE",this.imageChange,this),this.view.on("EDIT_APP",this.editApp,this);var e=this.model.get("applications");e&&this.view.updateSelectApp(e)},n.prototype.imageChange=function(e){var t=this.model.getImageByUnionKey(e.unionKey);this.view.updateSuites(t.suites),this.view.updateAppDatasource(t.applications)},n.prototype.appChange=function(){this.view.get("suite").custom()},n.prototype.getFormData=function(){var e=this.view.get("imageSelect").getSelectedItem(),t=this.view.get("appSet"),a=t.datasource,n=t.getValue();return{applications:u["default"].reduce(a,function(e,t){return u["default"].indexOf(n,t.name)>-1&&e.push(u["default"].pick(t,"name","version","properties")),e},[]),imageType:e.type,imageVersion:e.version}},n.prototype.editApp=function(e){var t=this,a=e.config;return d["default"].editApp.call(this,{appType:a.name,appVersions:[a.version],editItem:a,requester:function(e){return t.editAppAfter(e)}})},n.prototype.editAppAfter=function(e){return this.view.get("appSet").datasource.map(function(t){t.name===e.name&&(t.version=e.version,t.properties=e.properties)}),c["default"].resolved()},n}(n["default"](o)["default"]);module.exports=f}),define("bmr/common/image/image.tpl",[],function(){return'\n\x3c!-- target: TPL_bmr_common_image --\x3e\n\x3c!-- import: TPL_bmr_common_image_child --\x3e\n\n\x3c!-- target: TPL_bmr_common_image_child --\x3e\n<div class="bmr bmr-common-image">\n    <dl class="detail-create detail-part-1-col">\n        <dt>\n            <h4>集群配置</h4>\n        </dt>\n        <dd>\n            <label>镜像版本：</label>\n            <div data-ui-type="Select"\n                data-ui-id="imageSelect"></div>\n        </dd>\n        <dd>\n            <label>内置模板：</label>\n            <div>\n                <div data-ui="type:Suite;id:suite;"></div>\n            </div>\n        </dd>\n        <dd>\n            <label>可选应用：</label>\n             <div data-ui="id:appSet;type:AppCheckBox"></div>\n        </dd>\n    </dl>\n</div>\n'}),define("bmr/common/image/ImageModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","../../config","bat-ria/mvc/BaseModel"],function(exports,module,e,t,a,n,i,r,l){var s=i["default"](n),o=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.prepare=function(){var e=this.get("imageMap"),t=this.get("applications"),a=null,n=s["default"].map(e,function(e){return e.isDefault&&null===a&&(a=e.type+e.version),s["default"].extend({name:e.description,value:e.type+e.version},e)}),i=this.get("copyUnionKey")||a,r=this.getImageByUnionKey(i),l=r.applications,o=r.suites,u=this.wrapApplications(l);t&&s["default"].each(t,function(e){s["default"].each(u,function(t){t.name===e.name&&(t.properties=e.properties)})}),this.set("suiteDatasource",o),this.set("appDatasource",u),this.set("selectValue",i),this.set("selectDatasource",n)},i.prototype.getImageByUnionKey=function(e){return s["default"].find(this.get("imageMap"),function(t){return e===t.type+t.version})},i.prototype.wrapApplications=function(){var e=arguments.length<=0||arguments[0]===undefined?[]:arguments[0];return s["default"].map(e,function(e){var t={},a=e.versions[0];return"hive"===e.name?t={metastore:"default"}:"hbase"===e.name&&(t={backupEnabled:!1,restoreEnabled:!1}),{version:a,properties:t,name:e.name,description:e.name+"("+a+")"}})},t["default"](i,[{key:"datasource",get:function(){return{imageMap:function(){return r.api.bmrAppConfig()},copyUnionKey:function(e){return e.get("imageType")+e.get("imageVersion")}}}}]),i}(i["default"](l)["default"]);module.exports=o}),define("bmr/common/image/ImageView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","bat-ria/tpl!./image.tpl","bat-ria/mvc/BaseView"],function(exports,module,e,t,a,n,i,r,l){var s=i["default"](n),o=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.updateSuites=function(){var e=arguments.length<=0||arguments[0]===undefined?[]:arguments[0];this.get("suite").updateDatasource(e)},i.prototype.updateAppDatasource=function(){var e=arguments.length<=0||arguments[0]===undefined?[]:arguments[0];this.get("appSet").updateDatasource(this.model.wrapApplications(e))},i.prototype.updateSelectApp=function(){var e=arguments.length<=0||arguments[0]===undefined?[]:arguments[0];this.get("appSet").setValue(s["default"].pluck(e,"name"))},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_common_image"}},{key:"uiProperties",get:function(){return{imageSelect:{width:200,value:"@selectValue",datasource:"@selectDatasource"},suite:{datasource:"@suiteDatasource"},appSet:{datasource:"@appDatasource",value:"@appSelectValue"}}}},{key:"uiEvents",get:function(){return{"imageSelect:change":function(e){var t=e.target.getSelectedItem().value;this.fire("IMAGE_CHANGE",{unionKey:t})},appSet:{change:function(e){this.fire("APP_CHANGE")},edit:function(e){this.fire("EDIT_APP",{config:e.config})}},"suite:change":function(e){this.updateSelectApp(e.applications)}}}}]),i}(i["default"](l)["default"]);module.exports=o}),define("bmr/common/log/config",["exports","module","babel-runtime/helpers/class-call-check","er/controller","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t,a){a["default"](t)["default"].registerAction([{type:"bmr/common/log/Log",path:"/bmr/common/log"}]);module.exports=new function n(){e["default"](this,n)}}),define("bmr/common/log/Log",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/BaseAction","babel-runtime/helpers/interop-require-default","./LogModel","./LogView"],function(exports,module,e,t,a,n,i,r,l){var s=i["default"](n),o=i["default"](r),u=i["default"](l),d=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.initBehavior=function(){n.prototype.initBehavior.call(this);var e=this.view.get("logtab").getActiveTab().panel;this.view.renderView(e)},t["default"](i,[{key:"modelType",get:function(){return o["default"]}},{key:"viewType",get:function(){return u["default"]}}]),i}(s["default"]);module.exports=d}),define("bmr/common/log/log.tpl",[],function(){return'\x3c!-- target: TPL_common_log_child --\x3e\n<div class="bmr bmr-common-log">\n    <div data-ui-id="logtab" data-ui-type="Tab" class="ui-smart-tab" >\n        <ul data-role="navigator" class="bec-tab-navigator">\n            <li data-for="syslog">syslog</li>\n            <li data-for="stdout">stdout</li>\n            <li data-for="stderr">stderr</li>\n        </ul>\n        <span class="row-tip">${tip}</span>\n        <div title="syslog" id="syslog" class="ui-tab-content">\n            <pre></pre>\n        </div>\n        <div title="stdout" id="stdout" class="ui-tab-content">\n            <pre></pre>\n        </div>\n        <div title="stderr" id="stderr" class="ui-tab-content">\n            <pre></pre>\n        </div>\n    </div>\n</div>\n\n\x3c!-- target: TPL_common_log --\x3e\n\x3c!-- import: TPL_common_log_child --\x3e\n'}),define("bmr/common/log/LogModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","urijs","babel-runtime/helpers/interop-require-default","bat-ria/mvc/BaseModel","../../config"],function(exports,module,e,t,a,n,i,r){var l=n["default"](a),s=function(a){function n(){t["default"](this,n),a.apply(this,arguments)}return e["default"](n,a),n.prototype.prepare=function(){var e=[],t=this.get("stderr"),a=this.get("stdout"),n=this.get("syslog");t&&e.push({title:t,panel:t}),a&&e.push({title:a,panel:a}),n&&e.push({title:n,panel:n}),this.set("tabDatasource",e)},n.prototype.getLogAccessUrl=function(){var e=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];return r.api.bmrBosApi({bucketName:e.bucketName,objectName:e.objectName,limit:e.limit||5e3})},n.prototype.getLogData=function(){var e=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];return r.api.bmrGetLogData({bucketName:e.bucketName,objectName:e.objectName,limit:e.limit||5e3})},n.prototype.getAuthorization=function(e){var t=l["default"](e),a=t.host(),n=t.path();return r.api.iamGenerateAuthorization({uri:n,method:"GET",headers:{host:a},params:{},expirationPeriodInSeconds:3600})},n}(n["default"](i)["default"]);module.exports=s}),define("bmr/common/log/LogView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","jquery","babel-runtime/helpers/interop-require-default","bat-ria/tpl!./log.tpl","bat-ria/mvc/BaseView"],function(exports,module,e,t,a,n,i,r,l){var s=i["default"](n),o=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIEvents=function(){var e=this;return{"logtab:activate":function(t){return e.renderView(t.tab.panel)}}},i.prototype.renderView=function(e){var t=this,a=this.formatQuery(e);this.model.getLogAccessUrl(a).then(function(n){n.exists?!0===n.overload?(t.showToast("日志超过固定大小，只提供下载服务"),t.model.getAuthorization(n.url).then(function(e){return open(n.url+"?authorization="+e.authorization)})):t.model.getLogData(a).then(function(t){return s["default"]("#"+e+" pre").text(t)}):s["default"]("#"+e+" pre").text(e+"日志正在准备中，请稍后查看")})},i.prototype.formatQuery=function(e){var t=this.model.get(e);if(t){var a=t.split("/").splice(2);return{bucketName:a[0],objectName:a.splice(1).join("/")}}return{}},t["default"](i,[{key:"template",get:function(){return"TPL_common_log"}},{key:"uiProperties",get:function(){return{logtab:{datasource:"@tabDatasource"}}}}]),i}(i["default"](l)["default"]);module.exports=o}),define("bmr/common/mvc/ListAction",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","inf-ria/mvc/ListAction","babel-runtime/helpers/interop-require-default","./ListView","./ListModel","../../config"],function(exports,module,e,t,a,n,i,r,l){var s=n["default"](a),o=n["default"](i),u=n["default"](r),d=function(a){function n(e){t["default"](this,n),a.call(this,e),this.modelType=u["default"],this.viewType=o["default"]}return e["default"](n,a),n.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.view.on(l.events.CLEAR_FILTER,this.reloadOmitQuery,this)},n.prototype.reloadOmitQuery=function(){var e=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],t=this.model.get("url").getPath();this.redirect(t,e)},n.prototype.reload=function(){return a.prototype.asyncListPage?a.prototype.asyncListPage.call(this):a.prototype.reload.call(this)},n}(s["default"]);module.exports=d}),define("bmr/common/mvc/ListModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","inf-ria/mvc/ListModel"],function(exports,module,e,t,a,n,i,r){var l=i["default"](n),s=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.filterQuery=function(e){return l["default"].omit(e,"order","orderBy")},t["default"](i,[{key:"defaultArgs",get:function(){return{pageSize:10}}}]),i}(i["default"](r)["default"]);module.exports=s}),define("bmr/common/mvc/ListView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","inf-ria/mvc/ListView","common/util/tableUtil","../../config"],function(exports,module,e,t,a,n,i,r,l,s){var o=i["default"](n),u=i["default"](r),d=i["default"](l),c=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.updatePageData=function(e,t){var a=this.model.getQuery(),i=o["default"].keys(a);o["default"].intersection(i,this.queryDict).length>0&&0===e.tableData.length&&(t=this.noQueryDataHtml),n.prototype.updatePageData.call(this,e,t)},i.prototype.triggerCommand=function(e,t){try{t=JSON.parse(t)}catch(a){}this.confirmEventMap.hasOwnProperty(e)?this.changeConfirm(e,{args:t},this.confirmEventMap[e]):this.fire(e,{args:t})},i.prototype.getSearchArgs=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return d["default"].getSearchArgs.apply(this,t)},i.prototype.changeConfirm=function(e,t,a){var n=this;this.waitConfirm({title:"提示",content:a}).then(function(){return n.fire(e,t)})},i.prototype.getUIEvents=function(){return d["default"].getListEvents({"table:command":function(e){e.preventDefault(),this.triggerCommand(e.name,e.args)},"keyword:enter":"submitSearch","clearKeyword:click":function(e){this.triggerCommand(s.events.CLEAR_FILTER)}})},t["default"](i,[{key:"queryDict",get:function(){return["keyword"]}},{key:"noQueryDataHtml",get:function(){return s.html.table.noQueryDataHtml({title:"没有搜索到相关信息！"})}},{key:"confirmEventMap",get:function(){var e;return e={},e[s.events.REMOVE]="您确定执行删除操作吗?",e}}]),i}(u["default"]);module.exports=c}),define("bmr/common/reminder/config",["exports","module","babel-runtime/helpers/class-call-check","er/controller","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t,a){a["default"](t)["default"].registerAction([{type:"bmr/common/reminder/Reminder",path:"/bmr/common/reminder"}]);module.exports=new function n(){e["default"](this,n)}}),define("bmr/common/reminder/Reminder",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormAction","babel-runtime/helpers/interop-require-default","./ReminderModel","./ReminderView"],function(exports,module,e,t,a,n,i,r,l){var s=i["default"](n),o=i["default"](r),u=i["default"](l),d=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.initBehavior=function(){n.prototype.initBehavior.call(this),this.view.on("REFRESH",this.refresh,this)},i.prototype.refresh=function(){var e=this.view.getFormData(),t=this.model.getSubmitData(e);this.reload({clusterId:t.clusterId,editData:t.reminderConfig,requester:this.model.get("requester"),parentAction:this.model.get("parentAction")})},i.prototype.toggle=function(){this.reload({clusterId:this.model.get("clusterId"),editData:{disabled:!this.model.get("editData").disabled}})},i.prototype.getFormData=function(){return this.model.getSubmitData(this.view.getFormData()).reminderConfig},i.prototype.redirectAfterSubmit=function(){this.model.get("parentAction").reload()},t["default"](i,[{key:"modelType",get:function(){return o["default"]}},{key:"viewType",get:function(){return u["default"]}}]),i}(s["default"]);module.exports=d}),define("bmr/common/reminder/reminder.tpl",[],function(){return'\x3c!-- target: TPL_bmr_reminder_child--\x3e\n<div class="bmr-reminder">\n    <form data-ui-type="Form"\n          data-ui-id="form"\n          data-ui-auto-validate="true">\n        <dl class="detail-create detail-part-1-col">\n            <dd>\n                <label>超时设置：</label>\n                <div>\n                    <div data-ui-id="reminderToggle"\n                        data-ui-name="enabled"\n                        data-ui-type="ToggleButton"></div>\n                    <span class="row-tip">开启后，可以设置集群的最大运行时间，如果超过，集群会被释放。</span>\n                </div>\n            </dd>\n            \x3c!-- if: ${editData.enabled} --\x3e\n            <dd>\n                <label>超时时间设置：</label>\n                <div>\n                    <div class="ui-group ui-select-group">\n                        <div data-ui-type="TextBox"\n                            data-ui-name="duration"\n                            data-ui-id="duration"></div>\n                        <div data-ui-type="Select"\n                            data-ui-name="durationUnit"\n                            data-ui-id="durationUnit"></div>\n                    </div>\n                    <label data-ui-type="Validity" data-ui-id="durationValidityLabel"></label>\n                </div>\n            </dd>\n            <dd>\n                <label>提醒方式：</label>\n                <div data-ui-type="BoxGroup"\n                     data-ui-id="reminderType"\n                     data-ui-name="media"\n                     data-ui-box-type="checkbox" >\n                </div>\n            </dd>\n            \x3c!-- /if --\x3e\n        </dl>\n    </form>\n</div>\n'}),define("bmr/common/reminder/ReminderModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormModel","babel-runtime/helpers/interop-require-default","../../config"],function(exports,module,e,t,a,n,i,r){var l=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.prepare=function(){this.submitRequester=this.get("requester")||r.api.bmrReminderUpdate;var e=this.get("editData")||{};this.set("editData",{disabled:!!e.disabled,enabled:!e.disabled&&e.enabled,duration:e.duration||30,media:e.media||["SMS","MAIL"]})},i.prototype.filterData=function(e){return e.enabled=!!e.enabled,e.duration=+e.duration,"HOURS"===e.durationUnit&&(e.duration=60*e.duration),delete e.durationUnit,{clusterId:this.get("clusterId"),reminderConfig:e}},t["default"](i,[{key:"datasource",get:function(){return{}}}]),i}(i["default"](n)["default"]);module.exports=l}),define("bmr/common/reminder/ReminderView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./reminder.tpl","bat-ria/mvc/FormView","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t,a,n,i,r){var l=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIEvents=function(){var e=this;return{"reminderToggle:change":function(){return e.fire("REFRESH")}}},t["default"](i,[{key:"uiProperties",get:function(){return{reminderToggle:{checked:"@editData.enabled",disabled:"@editData.disabled"},durationUnit:{width:70,datasource:[{name:"分",value:"MINUTES"},{name:"小时",value:"HOURS"}]},duration:{width:30,value:"@editData.duration",required:"required",requiredErrorMessage:"请输入一个有效的正整数",pattern:"^[1-9][0-9]*$",patternErrorMessage:"请输入一个有效的正整数",validityLabel:"durationValidityLabel"},reminderType:{datasource:[{name:"短信",value:"SMS"},{name:"邮件",value:"MAIL"}],rawValue:"@editData.media"}}}},{key:"template",get:function(){return"TPL_bmr_reminder"}}]),i}(r["default"](i)["default"]);module.exports=l}),define("bmr/common/schedule/Schedule",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormAction","babel-runtime/helpers/interop-require-default","./ScheduleModel","./ScheduleView"],function(exports,module,e,t,a,n,i,r,l){var s=i["default"](n),o=i["default"](r),u=i["default"](l),d=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getFormData=function(){return this.model.getSubmitData(this.view.getFormData())},i.prototype.redirectAfterSubmit=function(){this.model.get("parentAction").reload()},t["default"](i,[{key:"modelType",get:function(){return o["default"]}},{key:"viewType",get:function(){return u["default"]}}]),i}(s["default"]);module.exports=d}),define("bmr/common/schedule/schedule.tpl",[],function(){return'\x3c!-- target: TPL_bmr_common_schedule_child--\x3e\n<div class="bmr-common-schedule">\n    <div class="detail-parts-table">\n        <form data-ui-type="Form"\n              data-ui-id="form"\n              data-ui-auto-validate="true">\n            <dl class="detail-create detail-part-1-col">\n                <dt>\n                    <h4>执行策略</h4>\n                </dt>\n                <dd>\n                    <label>执行频率：</label>\n                    <div>\n                        <span class="row-tip prefix">每</span>\n                        <div class="ui-group ui-select-group">\n                            <div data-ui-type="TextBox"\n                                data-ui-name="period"\n                                data-ui-id="period"></div>\n                            <div data-ui-type="Select"\n                                data-ui-name="periodUnit"\n                                data-ui-id="periodUnit"></div>\n                        </div>\n                        <label data-ui-type="Validity" data-ui-id="periodValidityLabel"></label>\n                    </div>\n                </dd>\n                <dd>\n                    <label>任务开始方式：</label>\n                    <div>\n                        <div data-ui-type="BoxGroup"\n                            data-ui-id="startAction"\n                            data-ui-box-type="radio" >\n                        </div>\n                        <div data-ui-type="Calendar"\n                            data-ui-id="startTime"\n                            data-ui-time="true"\n                            data-ui-name="startTime"></div>\n                    </div>\n                </dd>\n                <dd>\n                    <label>任务结束方式：</label>\n                    <div>\n                        <div data-ui-type="BoxGroup"\n                            data-ui-id="endAction"\n                            data-ui-box-type="radio" >\n                        </div>\n                        <div data-ui-type="Calendar"\n                            data-ui-id="endTime"\n                            data-ui-time="true"\n                            data-ui-name="endTime"></div>\n                    </div>\n                </dd>\n            </dl>\n        </form>\n    </div>\n</div>\n'}),define("bmr/common/schedule/ScheduleModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","common/util/timeUtil","babel-runtime/helpers/interop-require-default","bat-ria/mvc/FormModel"],function(exports,module,e,t,a,n,i){var r=n["default"](a),l=function(a){function n(){t["default"](this,n),a.apply(this,arguments)}return e["default"](n,a),n.prototype.prepare=function(){this.submitRequester=this.get("requester");var e=this.get("editData")||{};this.set("editData",{period:e.period||30,periodUnit:e.periodUnit,startAction:e.startTime?"CUSTOM":"NOW",endAction:e.endTime?"CUSTOM":"NERVER",startTime:r["default"].toTime(e.startTime),endTime:r["default"].toTime(e.endTime)})},n.prototype.filterData=function(e){return e.startTime=e.startTime?r["default"].timeToUtc(e.startTime):null,e.endTime=e.endTime?r["default"].timeToUtc(e.endTime):null,e},n.prototype.getExtraData=function(){return this.get("extraData")||{}},n}(n["default"](i)["default"]);module.exports=l}),define("bmr/common/schedule/ScheduleView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./schedule.tpl","bat-ria/mvc/FormView","babel-runtime/helpers/interop-require-default","../../enums"],function(exports,module,e,t,a,n,i,r,l){var s=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.enterDocument=function(){n.prototype.enterDocument.call(this),"CUSTOM"!==this.get("startAction").getValue()&&this.get("startTime").disable(),"CUSTOM"!==this.get("endAction").getValue()&&this.get("endTime").disable()},t["default"](i,[{key:"uiProperties",get:function(){return{startAction:{datasource:[{name:"立即开始",value:"NOW"},{name:"",value:"CUSTOM"}],value:"@editData.startAction"},endAction:{datasource:[{name:"从不结束",value:"NERVER"},{name:"",value:"CUSTOM"}],value:"@editData.endAction"},period:{width:100,required:"required",requiredErrorMessage:"请输入执行频率",pattern:"^[1-9][0-9]*$",patternErrorMessage:"请输入有效的正整数",validityLabel:"periodValidityLabel",value:"@editData.period"},periodUnit:{width:145,datasource:l.TIME_UNIT.toArray(),value:"@editData.periodUnit"},startTime:{value:"@editData.startTime"},endTime:{value:"@editData.endTime"}}}},{key:"uiEvents",get:function(){return{"startAction:change":function(){this.get("startTime").toggleState("disabled")},"endAction:change":function(){this.get("endTime").toggleState("disabled")}}}},{key:"template",get:function(){return"TPL_bmr_common_schedule"}}]),i}(r["default"](i)["default"]);module.exports=s}),define("bmr/common/step/Add",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormAction","babel-runtime/helpers/interop-require-default","./AddModel","./AddView"],function(exports,module,e,t,a,n,i,r,l){var s=i["default"](n),o=i["default"](r),u=i["default"](l),d=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.initBehavior=function(){n.prototype.initBehavior.call(this),this.view.on("REFRESH",this.refresh,this),this.fire("PICK_CLUSTER",{stepType:this.view.get("stepTypeSelect").getValue()})},i.prototype.refresh=function(){this.reload({editData:{type:this.view.get("stepTypeSelect").getValue(),properties:{}},stepTypeDatasource:this.model.get("stepTypeDatasource"),requester:this.model.get("requester"),parentAction:this.model.get("parentAction")})},i.prototype.redirectAfterSubmit=function(){var e=this.model.get("parentAction");e&&e.reload(),this.fire("CLOSE_DIALOG")},i.prototype.handleSubmitError=function(e){n.prototype.handleSubmitError.call(this,e);this.view.get("form").fire("aftermanualvalidate")},t["default"](i,[{key:"modelType",get:function(){return o["default"]}},{key:"viewType",get:function(){return u["default"]}}]),i}(s["default"]);module.exports=d}),define("bmr/common/step/add.tpl",[],function(){return'\x3c!-- target: TPL_bmr_common_step_add_child --\x3e\r\n<div class="bmr-common-step-add">\r\n    <form data-ui-type="Form"\r\n        data-ui-id="form"\r\n        data-ui-auto-validate="true">\r\n\r\n        <div class="detail-parts-table">\r\n            <dl class="detail-create detail-part-1-col">\r\n                \x3c!-- if: ${editData.type} === ${ENUM_STEP_TYPE.Streaming} --\x3e\r\n                    \x3c!-- import: TPL_bmr_step_hadoop_streamimg_program --\x3e\r\n\r\n                \x3c!-- elif: ${editData.type} === ${ENUM_STEP_TYPE.Hive} --\x3e\r\n                    \x3c!-- import: TPL_bmr_step_hadoop_hive_program --\x3e\r\n\r\n                \x3c!-- elif: ${editData.type} === ${ENUM_STEP_TYPE.Pig} --\x3e\r\n                    \x3c!-- import: TPL_bmr_step_hadoop_pig_program --\x3e\r\n\r\n                \x3c!-- elif: ${editData.type} === ${ENUM_STEP_TYPE.Java} --\x3e\r\n                    \x3c!-- import: TPL_bmr_step_hadoop_java_program --\x3e\r\n\r\n                \x3c!-- elif: ${editData.type} === ${ENUM_STEP_TYPE.Spark} --\x3e\r\n                    \x3c!-- import: TPL_bmr_step_spark_program --\x3e\r\n\r\n                \x3c!-- elif: ${editData.type} === ${ENUM_STEP_TYPE.Script} --\x3e\r\n                    暂不支持\r\n                \x3c!-- /if --\x3e\r\n            </dl>\r\n        </div>\r\n    </form>\r\n</div>\r\n\r\n\r\n\x3c!-- target: TPL_bmr_step_hadoop_streamimg_program --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_type --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_name --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_mapper --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_reducer --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_input --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_output --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_action_on_failure --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_additional_file --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_arguments --\x3e\r\n\r\n\r\n\x3c!-- target: TPL_bmr_step_hadoop_pig_program --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_type --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_name --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_script --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_input --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_output --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_action_on_failure --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_additional_file --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_arguments --\x3e\r\n\r\n\r\n\x3c!-- target: TPL_bmr_step_hadoop_hive_program --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_type --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_name --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_script --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_input --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_output --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_action_on_failure --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_additional_file --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_arguments --\x3e\r\n\r\n\r\n\x3c!-- target: TPL_bmr_step_hadoop_java_program --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_type --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_name --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_jar --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_action_on_failure --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_mainclass --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_additional_file --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_arguments --\x3e\r\n\r\n\r\n\x3c!-- target: TPL_bmr_step_spark_program --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_type --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_name --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_jar --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_action_on_failure --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_spark_submit --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_additional_file --\x3e\r\n\x3c!-- import: TPL_bmr_step_control_arguments --\x3e\r\n\r\n\r\n\x3c!-- target: TPL_bmr_step_control_spark_submit --\x3e\r\n<dd>\r\n    <label>Spark-submit：</label>\r\n    <div>\r\n        <div data-ui-type="TextBox"\r\n            data-ui-name="submitOptions"\r\n            data-ui-id="sparkSubmit">\r\n        </div>\r\n        <span data-ui-type="Validity" data-ui-id="sparkSubmitValidityLabel"></span>\r\n    </div>\r\n</dd>\r\n\r\n\x3c!-- target : TPL_bmr_step_control_type --\x3e\r\n<dd>\r\n    <label>作业类型：</label>\r\n    <div data-ui-type="Select"\r\n        data-ui-name="type"\r\n        data-ui-id="stepTypeSelect"></div>\r\n</dd>\r\n\r\n\x3c!-- target: TPL_bmr_step_control_name--\x3e\r\n<dd>\r\n    <label>作业名称：</label>\r\n    <div>\r\n        <div data-ui-type="TextBox"\r\n            data-ui-name="name"\r\n            data-ui-id="stepName"></div>\r\n        <span data-ui-type="Validity" data-ui-id="nameValidityLabel"></span>\r\n    </div>\r\n</dd>\r\n\r\n\x3c!-- target: TPL_bmr_step_control_mapper --\x3e\r\n<dd>\r\n    <label>Mapper：</label>\r\n    <div>\r\n        <div data-ui-type="BucketSelect"\r\n            data-ui-name="mapper"\r\n            data-ui-id="maperSel"\r\n            data-ui-extension-bucketselect-type="BucketSelectEx">\r\n        </div>\r\n        <span data-ui-type="Validity" data-ui-id="mapperValidityLabel"></span>\r\n        <p class="row-tip">\r\n            Map函数文件的BOS位置或者要运行的hadoop命令名\r\n        </p>\r\n    </div>\r\n</dd>\r\n\r\n\x3c!-- target: TPL_bmr_step_control_reducer --\x3e\r\n<dd>\r\n    <label>Reducer：</label>\r\n    <div>\r\n        <div data-ui-type="BucketSelect"\r\n            data-ui-id="reduceSel"\r\n            data-ui-name="reducer"\r\n            data-ui-extension-bucketselect-type="BucketSelectEx">\r\n        </div>\r\n        <span data-ui-type="Validity" data-ui-id="reducerValidityLabel"></span>\r\n        <p class="row-tip">Reduce函数文件的BOS位置或者要运行的hadoop命令名</p>\r\n    </div>\r\n</dd>\r\n\r\n\x3c!-- target: TPL_bmr_step_control_input --\x3e\r\n<dd>\r\n    <label>bos输入地址：</label>\r\n    <div>\r\n        <div data-ui-type="BucketSelect"\r\n            data-ui-id="inputSel"\r\n            data-ui-name="input"\r\n            data-ui-extension-bucketselect-type="BucketSelectEx">\r\n        </div>\r\n        <span data-ui-type="Validity" data-ui-id="inputValidityLabel"></span>\r\n    </div>\r\n</dd>\r\n\r\n\x3c!-- target: TPL_bmr_step_control_output --\x3e\r\n<dd>\r\n    <label>bos输出地址：</label>\r\n    <div>\r\n        <div data-ui-type="BucketSelect"\r\n            data-ui-id="outputSel"\r\n            data-ui-name="output"\r\n            data-ui-extension-bucketselect-type="BucketSelectEx">\r\n        </div>\r\n        <span data-ui-type="Validity" data-ui-id="outputValidityLabel"></span>\r\n    </div>\r\n</dd>\r\n\r\n\x3c!-- target: TPL_bmr_step_control_script --\x3e\r\n<dd>\r\n    <label>bos脚本地址：</label>\r\n    <div>\r\n        <div data-ui-type="BucketSelect"\r\n            data-ui-id="scriptSel"\r\n            data-ui-name="script"\r\n            data-ui-extension-bucketselect-type="BucketSelectEx">\r\n        </div>\r\n        <span data-ui-type="Validity" data-ui-id="scriptValidityLabel"></span>\r\n    </div>\r\n</dd>\r\n\r\n\x3c!-- target: TPL_bmr_step_control_jar --\x3e\r\n<dd>\r\n    <label>应用程序位置：</label>\r\n    <div>\r\n        <div data-ui-type="BucketSelect"\r\n            data-ui-id="jarSel"\r\n            data-ui-name="jar"\r\n            data-ui-extension-bucketselect-type="BucketSelectEx">\r\n        </div>\r\n        <span data-ui-type="Validity" data-ui-id="jarValidityLabel"></span>\r\n    </div>\r\n</dd>\r\n\r\n\x3c!-- target: TPL_bmr_step_control_mainclass--\x3e\r\n<dd>\r\n    <label>MainClass：</label>\r\n    <div>\r\n        <div data-ui-type="TextBox"\r\n            data-ui-id="mainClass"\r\n            data-ui-name="mainClass">\r\n        </div>\r\n        <span data-ui-type="Validity" data-ui-id="mainClassValidityLabel"></span>\r\n    </div>\r\n</dd>\r\n\r\n\x3c!-- target: TPL_bmr_step_control_action_on_failure--\x3e\r\n<dd>\r\n    <label>失败后操作：</label>\r\n    <div data-ui-type="Select"\r\n        data-ui-id="actionOnFailureSelect"\r\n        data-ui-name="actionOnFailure">\r\n    </div>\r\n</dd>\r\n\r\n\x3c!-- target: TPL_bmr_step_control_additional_file --\x3e\r\n<dd>\r\n    <label>附加文件：</label>\r\n    <div class="additional-file"\r\n        data-ui="type:AdditionalFile;id:additionalFile;name:additionalFile;">\r\n    </div>\r\n</dd>\r\n\r\n\x3c!-- target: TPL_bmr_step_control_arguments--\x3e\r\n<dd>\r\n    <label>应用程序参数：</label>\r\n    <div>\r\n        <textarea data-ui-type="TextBox"\r\n            data-ui-model="textarea"\r\n            data-ui-id="args"\r\n            data-ui-name="arguments">\r\n        </textarea>\r\n    </div>\r\n</dd>\r\n'}),define("bmr/common/step/AddModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormModel","babel-runtime/helpers/interop-require-default","underscore","../../enums","../../config","common/region"],function(exports,module,e,t,a,n,i,r,l,s,o){var u=i["default"](n),d=i["default"](r),c=i["default"](o),p=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.prepare=function(){var e=this.get("requester");e&&(this.submitRequester=e);this.get("editData")||this.set("editData",{type:l.STEP_TYPE.Streaming,properties:{}}),this.set("stepTypeDatasource",this.get("stepTypeDatasource")||[{name:"暂无可使用的作业类型",value:""}])},i.prototype.filterData=function(e){var t={steps:[]};return t.steps.push(d["default"].extend(d["default"].pick(e,"name","type","actionOnFailure"),{properties:d["default"].pick(e,"arguments","input","mapper","output","reducer","jar","mainClass","script","submitOptions")},{additionalFiles:0===e.additionalFile.lenght?null:e.additionalFile})),t},t["default"](i,[{key:"submitRequester",get:function(){return s.api.bmrStepCreate}},{key:"datasource",get:function(){return{ENUM_STEP_TYPE:function(){return l.STEP_TYPE},fetchBucketLocations:function(){return function(){return{locations:[c["default"].getCurrentRegion().id]}}},fetchBucketList:function(){return s.api.bmrBucketList},fetchFolderList:function(){return s.api.bmrFolderList},fetchObjectList:function(){return s.api.bmrObjectList},postCreateBucket:function(){return s.api.bmrCreateBucket}}}}]),i}(u["default"]);module.exports=p}),define("bmr/common/step/AddView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./add.tpl","bat-ria/mvc/FormView","babel-runtime/helpers/interop-require-default","../../enums"],function(exports,module,e,t,a,n,i,r,l){var s=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIEvents=function(){var e=this;return{"stepTypeSelect:change":function(){return e.fire("REFRESH")}}},t["default"](i,[{key:"uiProperties",get:function(){return{stepName:{width:"210",value:"@editData.name",validityLabel:"nameValidityLabel",custom:function(e){return e.trim()&&/^[\S ]{1,255}$/.test(e)},customErrorMessage:"名称不符合规则：长度1-255，字符不能全为空格"},stepTypeSelect:{datasource:"@stepTypeDatasource",value:"@editData.type"},actionOnFailureSelect:{datasource:l.STEP_ACTION_ON_FAILURE.toArray(),value:"@editData.actionOnFailure"},args:{width:"210",value:"@editData.properties.arguments"},maperSel:{value:"@editData.properties.mapper",required:"required",requiredErrorMessage:"请选择文件夹",getBucketList:"@fetchBucketList",getFolderList:"@fetchFolderList",getObjectList:"@fetchObjectList",createBucket:"@postCreateBucket",getBucketLocations:"@fetchBucketLocations",viewtype:"file",urlPrefix:"bos://",placeholder:"bos://",validityLabel:"mapperValidityLabel"},reduceSel:{value:"@editData.properties.reducer",required:"required",requiredErrorMessage:"请选择文件夹",getBucketList:"@fetchBucketList",getFolderList:"@fetchFolderList",getObjectList:"@fetchObjectList",createBucket:"@postCreateBucket",getBucketLocations:"@fetchBucketLocations",viewtype:"file",urlPrefix:"bos://",placeholder:"bos://",validityLabel:"reducerValidityLabel"},inputSel:{value:"@editData.properties.input",required:"required",requiredErrorMessage:"请选择文件夹",getBucketList:"@fetchBucketList",getFolderList:"@fetchFolderList",getObjectList:"@fetchObjectList",createBucket:"@postCreateBucket",getBucketLocations:"@fetchBucketLocations",viewtype:"file",urlPrefix:"bos://",placeholder:"bos://",validityLabel:"inputValidityLabel"},outputSel:{value:"@editData.properties.output",required:"required",requiredErrorMessage:"请选择文件夹",getBucketList:"@fetchBucketList",getFolderList:"@fetchFolderList",getObjectList:"@fetchObjectList",createBucket:"@postCreateBucket",getBucketLocations:"@fetchBucketLocations",viewtype:"file",urlPrefix:"bos://",placeholder:"bos://",validityLabel:"outputValidityLabel"},scriptSel:{value:"@editData.properties.script",required:"required",requiredErrorMessage:"请选择文件夹",getBucketList:"@fetchBucketList",getFolderList:"@fetchFolderList",getObjectList:"@fetchObjectList",createBucket:"@postCreateBucket",getBucketLocations:"@fetchBucketLocations",viewtype:"file",urlPrefix:"bos://",placeholder:"bos://",validityLabel:"scriptValidityLabel"},jarSel:{value:"@editData.properties.jar",required:"required",requiredErrorMessage:"请选择文件夹",getBucketList:"@fetchBucketList",getFolderList:"@fetchFolderList",getObjectList:"@fetchObjectList",createBucket:"@postCreateBucket",getBucketLocations:"@fetchBucketLocations",viewtype:"file",urlPrefix:"bos://",placeholder:"bos://",validityLabel:"jarValidityLabel"},sparkSubmit:{value:"@editData.properties.submitOptions",width:"210",required:"required",requiredErrorMessage:"参数不能为空",validityLabel:"sparkSubmitValidityLabel"},mainClass:{value:"@editData.properties.mainClass",width:"210",required:"required",requiredErrorMessage:"参数不能为空",validityLabel:"mainClassValidityLabel"},additionalFile:{value:"@editData.additionalFiles"}}}},{key:"template",get:function(){return"TPL_bmr_common_step_add"}}]),i}(r["default"](i)["default"]);module.exports=s}),define("bmr/common/step/config",["exports","module","babel-runtime/helpers/class-call-check","er/controller","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t,a){a["default"](t)["default"].registerAction([{type:"bmr/common/step/Add",path:"/bmr/common/step/add"}]);module.exports=new function n(){e["default"](this,n)}}),define("bmr/common/ui/AdditionalFile",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","lodash","babel-runtime/helpers/interop-require-default","jquery","esui","esui/InputControl"],function(exports,module,e,t,a,n,i,r,l,s){var o=i["default"](n),u=i["default"](r),d=i["default"](l),c=function(n){function i(e){a["default"](this,i),n.call(this,e),this.prefix=this.helper.getPrimaryClassName()}return e["default"](i,n),i.prototype.initStructure=function(){this.main.innerHTML='\n            <ul class="path-items"></ul>\n            <div class="block-warpper">\n                <div>\n                    <div data-ui-type="BucketSelect"\n                        data-ui-child-name="remote"\n                        data-ui-viewtype="file"\n                        data-ui-urlPrefix="bos://"\n                        data-ui-placeholder="请输入BOS文件路径"\n                        data-ui-required="required"\n                        data-ui-required-error-message="请输入路径"\n                        data-ui-validity-label="passValidity"\n\n                        data-ui-get-bucket-list="@fetchBucketList"\n                        data-ui-get-folder-list="@fetchFolderList"\n                        data-ui-get-object-list="@fetchObjectList"\n                        data-ui-create-bucket="@postCreateBucket"\n                        data-ui-get-bucket-locations="@fetchBucketLocations"\n\n                        data-ui-extension-bucketselect-type="BucketSelectEx">\n                    </div>\n                    <div data-ui="type:Button;childName:add;">添加</div>\n                </div>\n                <div>\n                    <div data-ui-type="TextBox"\n                        data-ui-width="158"\n                        data-ui-child-name="local"\n                        data-ui-required="required"\n                        data-ui-placeholder="请输入Master节点本地文件路径"\n                        data-ui-required-error-message="请输入路径"\n                        data-ui-validity-label="passValidity">\n                    </div>\n                    <div data-ui-type="Validity" data-ui-id="passValidity"></div>\n            </div>\n        ',this.initChildren(this.main)},i.prototype.initOptions=function(){var e=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];o["default"].defaults(e,{value:[]}),this.setProperties(e)},i.prototype.updateItems=function(){u["default"](".path-items").html(""),this.rawValue.forEach(function(e,t){return u["default"](".path-items").append("\n                <li>\n                    <p>远程路径："+e.remote+"</p>\n                    <p>本地路径："+e.local+'</p>\n                    <i data-index="'+t+'" class="iconfont icon-close"></i>\n                </li>\n            ')})},i.prototype.initEvents=function(){var e=this,t=this.getChild("add"),a=this.getChild("remote"),n=this.getChild("local");t.on("click",function(t){a.validate()&&n.validate()&&(e.rawValue.push({local:n.getValue(),remote:a.getValue()}),a.setValue(""),n.setValue(""),e.updateItems())}),u["default"](".path-items").on("click",function(t){var a=u["default"](t.target);if(a.hasClass("iconfont")){var n=+a.data("index");e.rawValue.splice(n,1),e.updateItems()}}),this.updateItems()},i.prototype.getRawValue=function(){return this.rawValue},i.prototype.getValue=function(){return this.getRawValue()},t["default"](i,[{key:"type",get:function(){return"AdditionalFile"}}]),i}(i["default"](s)["default"]);module.exports=c,d["default"].register(c)}),define("bmr/common/ui/AppCheckBox",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","jquery","babel-runtime/helpers/interop-require-default","esui","underscore","esui/Control"],function(exports,module,e,t,a,n,i,r,l,s){var o=i["default"](n),u=i["default"](r),d=i["default"](l),c=function(n){function i(e){a["default"](this,i),n.call(this,e),this.prefix=this.helper.getPrimaryClassName()}return e["default"](i,n),i.prototype.initStructure=function(){this.main.innerHTML='\n            <ul class="'+this.prefix+'-container">\n                '+this.renderItems()+"\n            </ul>\n        ",this.initChildren(this.main)},i.prototype.initOptions=function(e){var t={datasource:[]};d["default"].extend(t,e),this.setProperties(t)},i.prototype.renderItems=function(){var e=this,t="";return 0===this.datasource.length&&(t="无"),d["default"].map(this.datasource,function(a,n){t+='\n                <label class="'+e.prefix+'-item">\n                    <input type="checkbox" name="'+e.id+'" data-index="'+n+'" value="'+a.name+'" />\n                    '+a.description+'\n                    <label data-ui-type="Label"\n                        data-ui-bind="'+a.name+'"\n                        class="iconfont icon-write '+a.name+'"></label>\n                </label>\n            '}),t},i.prototype.initEvents=function(){var e=this,t=o["default"]("input",this.main);d["default"].each(this.children,function(t){t.on("click",function(a){var n=d["default"].find(e.datasource,function(e){return e.name===t.bind});e.fire("edit",{config:n})})}),t.on("click",function(t){var a=t.target,n=o["default"](a).data("index");d["default"].isNumber(n)&&e.fire("change",e.datasource[n])})},i.prototype.updateDatasource=function(){var e=arguments.length<=0||arguments[0]===undefined?[]:arguments[0];this.setProperties({datasource:e}),this.disposeChildren(),o["default"]("."+this.prefix+"-container",this.main).html(this.renderItems()),this.initChildren(),this.initEvents()},i.prototype.setValue=function(){var e=arguments.length<=0||arguments[0]===undefined?[]:arguments[0];o["default"]("input",this.main).each(function(t,a){o["default"](a).prop("checked",d["default"].indexOf(e,a.value)>-1)})},i.prototype.getValue=function(){var e=[];return o["default"]("input",this.main).each(function(t,a){o["default"](a).is(":checked")&&e.push(a.value)}),e},t["default"](i,[{key:"type",get:function(){return"AppCheckBox"}}]),i}(i["default"](s)["default"]);module.exports=c,u["default"].register(c)}),define("bmr/common/ui/FlavorNode",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","jquery","babel-runtime/helpers/interop-require-default","esui","lodash","esui/lib","esui/Control","../../enums"],function(exports,module,e,t,a,n,i,r,l,s,o,u){var d=i["default"](n),c=i["default"](r),p=i["default"](l),m=i["default"](s),f=function(n){function i(e){a["default"](this,i),n.call(this,e),this.prefix=this.helper.getPrimaryClassName()}return e["default"](i,n),i.prototype.getDesc=function(){switch((arguments.length<=0||arguments[0]===undefined?"":arguments[0]).toLowerCase()){case"master":return"集群的主节点";case"core":return"有hdfs部署的计算节点";case"task":return"无hdfs的计算节点，适合扩展";default:return""}},i.prototype.initStructure=function(){var e=this,t=this.datasource,a=p["default"].map(t,function(t){return'\n            <div class="header-field">\n                <p>'+t.type+'</p>\n                <p class="header-field-desc">'+e.getDesc(t.type)+"</p>\n            </div>\n        "}).join(""),n=p["default"].map(t,function(t,a){return'\n            <div data-ui-type="Panel" data-ui-category="'+t.type+'" data-ui-index="'+a+'">\n                <div data-ui="type:Select;childName:instanceType;skin:dark;"></div>\n                <div class="'+e.prefix+'-summary"></div>\n                <div data-ui="type:NumberTextline;childName:instanceCount;"></div>\n            </div>\n        '}).join("");this.main.innerHTML='\n            <div class="clearfix">'+a+"</div>\n            "+n+"\n        ",this.initChildren(this.main),p["default"].each(this.children,function(a){var n=t[a.index],i=a.getChild("instanceType"),r=a.getChild("instanceCount"),l=p["default"].map(n.instanceTypes,function(e,t){var a=n.instanceTypeConfigs[t].available,i=u.INSTANCE_TYPE.fromValue(e),r=i.text,l=i.xGroup;return{name:a?r:r+"(售罄)",value:e,disabled:!a,xGroup:l}}),s="core"===a.category.toLowerCase()?3:n.minCount;i.setProperties({selectedIndex:p["default"].findIndex(l,function(e){return!e.disabled}),datasource:l}),r.setProperties({max:n.maxCount,min:n.minCount});var o=a.category.toLowerCase();if(o in e.value){var d=e.value[o],c=d.instanceCount,m=d.instanceType;r.setValue(c),i.setValue(m)}else r.setValue(s);i.layer.render=e._fakeSelectLayerRender,i.layer.syncState=e._fakeSelectLayerSyncState})},i.prototype._fakeSelectLayerSyncState=function(e){var t=this.control.helper.getPartClasses("item-selected");e=this.getSearchElement(e);for(var a=p["default"].filter(m["default"].getChildren(e),function(e){return m["default"].hasClass(e,"ui-select-item")}),n=a.length-1;n>=0;n--){var i=a[n];n===this.control.selectedIndex?m["default"].addClasses(i,t):m["default"].removeClasses(i,t)}},i.prototype._fakeSelectLayerRender=function(e){var t="",a={};this.control.search&&this.initSearchStructure(e),e=this.getSearchElement(e);for(var n=0;n<this.control.datasource.length;n++){var i=this.control.datasource[n],r=this.control.helper.getPartClasses("item");i.disabled&&r.push.apply(r,this.control.helper.getPartClasses("item-disabled")),i.hidden&&r.push.apply(r,this.control.helper.getPartClasses("item-hidden")),i.xGroup&&!0!==a[i.xGroup]&&(a[i.xGroup]=!0,t+='<span class="ui-select-x-group-item">'+i.xGroup+"</span>"),t+='<li data-index="'+n+'" class="'+r.join(" ")+'"',i.background&&(t+='style="background:'+i.background+';"'),t+=">",t+=this.control.getItemHTML(i),t+="</li>"}m["default"].addClass(e,"ui-select-x-group"),e.innerHTML=t},i.prototype.initOptions=function(e){var t={datasource:[],value:{}};p["default"].extend(t,e),this.setProperties(t)},i.prototype.initEvents=function(){var e=this;p["default"].each(this.children,function(t){var a=e.datasource[t.index],n=t.getChild("instanceType"),i=t.getChild("instanceCount");n.on("change",function(){e.updateSummary(a,t,n.getValue()),e.fire("change")}),i.on("change",function(){return e.fire("change")}),e.updateSummary(a,t,n.getValue())})},i.prototype.getValue=function(){return this.getRawValue()},i.prototype.getRawValue=function(){return p["default"].map(this.children,function(e){var t=e.getChild("instanceType"),a=e.getChild("instanceCount");return{type:e.category,instanceCount:a.getValue(),instanceType:t.getValue()}})},i.prototype.updateSummary=function(e,t,a){var n=p["default"].find(e.instanceTypeConfigs,function(e){return e.name===a}),i=n.cpu,r=n.memory,l=n.disk,s="ssd"===n.diskType?"(SSD)":"";d["default"]("."+this.prefix+"-summary",t.main).html("CPU:"+i+"核<br />内存:"+r+"GB<br />硬盘:"+l+"GB"+s)},t["default"](i,[{key:"type",get:function(){return"FlavorNode"}}]),i}(i["default"](o)["default"]);module.exports=f,c["default"].register(f)}),define("bmr/common/ui/GroupPanel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","esui/Control","babel-runtime/helpers/interop-require-default","underscore","etpl","esui","esui/painters"],function(exports,module,e,t,a,n,i,r,l,s,o){var u=i["default"](n),d=i["default"](r),c=i["default"](l),p=i["default"](s),m=i["default"](o),f=['<div class="${prefix}-container">','<div class="${prefix}-header">','<label data-ui="type:Label;childName:arrowBtn${index};rowIndex:${index};" ',"\x3c!-- if: ${allowArrow} == false --\x3e",' data-ui-disabled="true" ',"\x3c!-- /if --\x3e",'class="iconfont icon-arrow-right arrow-button"></label>',"${header | raw}","</div>",'<div class="${prefix}-content">',"\x3c!-- if: ${loadAction} --\x3e",'<div data-ui="type:ActionPanel;childName:arrowPanel${index}"></div>',"\x3c!-- else --\x3e",'<div data-ui="type:Panel;childName:arrowPanel${index}"></div>',"\x3c!-- /if --\x3e","</div>","</div>"],b=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.initStructure=function(){var e=this,t=c["default"].compile(f.join("")),a="";d["default"].each(this.datasource,function(n,i){a+=t({prefix:e.helper.getPrimaryClassName(),header:e.renderHeader(n,i)||"",index:i,loadAction:!!e.loadAction,allowArrow:d["default"].isFunction(e.allowArrow)?e.allowArrow(n):!!e.allowArrow})}),a||(a='\n                <div class="grouppanl-nodata">\n                    <img src="https://bce.bdstatic.com/console/img/table-nodata.png" />\n                    <span>暂无可用的数据</span>\n                </div>\n            '),this.main.innerHTML=a,this.initChildren(this.main)},i.prototype.initOptions=function(e){var t={datasource:[],model:"single",renderHeader:d["default"].noop,renderContent:d["default"].noop,allowArrow:!0,loadAction:null};d["default"].extend(t,e),this.setProperties(t)},i.prototype.initEvents=function(){var e=this;d["default"].each(this.children,function(t){t.childName&&-1!==t.childName.indexOf("arrowBtn")&&t.on("click",e.toggleContent,e)})},i.prototype.repaint=function(){return m["default"].createRepaint(u["default"].prototype.repaint)},i.prototype.toggleContent=function(e){var t=this;e.preventDefault();var a=e.target,n=a.rowIndex,i=this.datasource[n];if(!this.fire("arrow",i).isDefaultPrevented())return"multi"===this.model?(a.toggleState("arrow"),this.loadAction?this.toggleActionContent(a.arrow,n):this.toggleStaticContent(a.arrow,n)):void d["default"].each(this.children,function(e){e.childName&&-1!==e.childName.indexOf("arrowBtn")&&(e.childName===a.childName||e.arrow)&&(e.toggleState("arrow"),t.loadAction?t.toggleActionContent(e.arrow,e.rowIndex):t.toggleStaticContent(e.arrow,e.rowIndex))})},i.prototype.toggleStaticContent=function(e,t){var a=this.getChild("arrowPanel"+t),n=this.datasource[t];if(a.helper.disposeChildren(),e){var i=this.renderContent(n,t);d["default"].isString(i)&&(i={content:i,properties:{}}),a.main.innerHTML=i.content,a.helper.initChildren(null,{properties:i.properties})}else a.main.innerHTML=""},i.prototype.toggleActionContent=function(e,t){var a=this.getChild("arrowPanel"+t),n=this.datasource[t],i={};i=d["default"].isFunction(this.loadAction)?this.loadAction(n):this.loadAction,e?a.setProperties({url:i.url,actionOptions:d["default"].extend({},n,i.actionOptions)}):(a.helper.disposeChildren(),a.main.innerHTML="")},t["default"](i,[{key:"type",get:function(){return"GroupPanel"}}]),i}(u["default"]);module.exports=b,p["default"].register(b)}),define("bmr/common/ui/Suite",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","jquery","babel-runtime/helpers/interop-require-default","esui","underscore","esui/Control"],function(exports,module,e,t,a,n,i,r,l,s){var o=i["default"](n),u=i["default"](r),d=i["default"](l),c=function(n){function i(e){a["default"](this,i),n.call(this,e),this.prefix=this.helper.getPrimaryClassName()}return e["default"](i,n),i.prototype.initStructure=function(){this.main.innerHTML='\n            <ul class="'+this.prefix+'-container">\n                '+this.renderItems()+"\n            </ul>\n        ",this.initChildren(this.main)},i.prototype.initOptions=function(e){var t={datasource:[]};d["default"].extend(t,e),this.setProperties(t)},i.prototype.renderItems=function(){var e=this,t="";return d["default"].map(this.datasource,function(a,n){t+='<li class="'+e.prefix+"-item "+a.name+'" data-index="'+n+'">'+a.name+"</li>"}),t+='<li class="'+this.prefix+'-item custom active">自定义</li>'},i.prototype.initEvents=function(){var e=this,t=o["default"]("."+this.prefix+"-item",this.main);t.on("click",function(a){t.each(function(t,n){var i=o["default"](n);if(n===a.target){var r=i.data("index");i.addClass("active"),d["default"].isNumber(r)&&e.fire("change",e.datasource[r])}else i.removeClass("active")})})},i.prototype.updateDatasource=function(){var e=arguments.length<=0||arguments[0]===undefined?[]:arguments[0];this.setProperties({datasource:e}),o["default"]("."+this.prefix+"-container",this.main).html(this.renderItems()),this.initEvents()},i.prototype.custom=function(){o["default"]("."+this.prefix+"-item.custom",this.main).click()},i.prototype.getValue=function(){return"common/monitor ui监控会在触发change后调用此函数"},t["default"](i,[{key:"type",get:function(){return"Suite"}}]),i}(i["default"](s)["default"]);module.exports=c,u["default"].register(c)}),define("bmr/config",["exports","module","underscore","babel-runtime/helpers/interop-require-default","../common/config","./config/html","./config/events","./enums","./config/helper","./permission"],function(exports,module,e,t,a,n,i,r,l,s){var o=t["default"](e),u=t["default"](n),d=t["default"](i),c=t["default"](r),p=t["default"](l),m=t["default"](s),f=a.getConfig(),b=o["default"].extend(f.api,{bmrClusterRename:"/api/bmr/cluster/rename",bmrClusterListSummary:"/api/bmr/cluster/list_summary",bmrClusterList:"/api/bmr/cluster/list",bmrClusterDetail:"/api/bmr/cluster/detail",bmrInstanceGroupList:"/api/bmr/instance_group/detail",bmrClusterSaveAsTemplate:"/api/bmr/cluster/save_template",bmrTerminateCluster:"/api/bmr/cluster/terminate",bmrScale:"/api/bmr/scale",bmrTerminateProtection:"/api/bmr/cluster/terminate_protection",bmrAppConfig:"/api/bmr/config/images",bmrLanding:"/api/bmr/config/landing",bmrFlavorConfig:"/api/bmr/config/flavors",bmrRdsInstanceList:"/api/bmr/rds/instance/list",bmrRdsDatabaseList:"/api/bmr/rds/database/list",bmrPricing:"/api/bmr/order/v2/price",bmrScalePricing:"/api/bmr/order/v2/resizeprice",bmrOrderCreate:"/api/bmr/order/create",bmrReminderUpdate:"/api/bmr/cluster/reminder",bmrQuota:"/api/bmr/check_quota",bmrZoneList:"/api/bmr/zone/list",bmrVpcList:"/api/bmr/network/vpc/list",bmrSubNetList:"/api/bmr/network/subnet/list",bmrSecurityGroup:"/api/bmr/network/securityGroup/list",bmrCreateValidate:"/api/bmr/order/v2/check",bmrTemplateList:"/api/bmr/template/list",bmrTemplateCreate:"/api/bmr/template/create",bmrTemplateDelete:"/api/bmr/template/delete",bmrTemplateDetail:"/api/bmr/template/get",bmrCopyableTemplateList:"/api/bmr/template/list_copyable",bmrBucketList:"/api/bmr/bos/bucket/list",bmrFolderList:"/api/bmr/bos/object/folder",bmrObjectList:"/api/bmr/bos/object/list",bmrCreateBucket:"/api/bmr/bos/create",bmrBosApi:"/api/bmr/bos/object/downLoadUrl",bmrGetLogData:"/api/bmr/bos/logData",bmrAnalysisData:"/api/bmr/bos/analysisData",iamGenerateAuthorization:"/api/iam/authorization/generate",bmrSchedulePlanList:"/api/bmr/execute_plan/list",bmrSchedulePlanCreate:"/api/bmr/execute_plan/create",bmrSchedulePlanDelete:"/api/bmr/execute_plan/delete",bmrSchedulePlanStop:"/api/bmr/execute_plan/stop",bmrSchedulePlanStart:"/api/bmr/execute_plan/start",bmrSchedulePlanGet:"/api/bmr/execute_plan/get",bmrSchedulePlanDetail:"/api/bmr/execute_plan/detail",bmrSchedulePlanHistory:"/api/bmr/execute_plan/history",bmrSchedulePlanUpdate:"/api/bmr/execute_plan/update",bmrStepList:"/api/bmr/step/list",bmrStepDetail:"/api/bmr/step/get",bmrStepCreate:"/api/bmr/step/create",bmrJobList:"/api/bmr/step/jobs",bmrTaskSummaryList:"/api/bmr/step/task_summaries",bmrStepTasksList:"/api/bmr/step/tasks",bmrAttemptsList:"/api/bmr/step/task_attempts",bmrStepCancel:"/api/bmr/step/cancel",bmrValidateStep:"/api/bmr/step/validate",bmrCheckBalance:"/api/bmr/check_balance",bmrAccountValidation:"/api/account/purchase_validation"});module.exports=o["default"].extend(f,{api:b,html:u["default"],events:d["default"],enums:c["default"],helper:p["default"],permission:m["default"],index:"/bmr/cluster/list"})}),define("bmr/config/events",["exports","module","underscore","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t){var a=t["default"](e);module.exports=a["default"].defaults({},{RECHARGE:"recharge",CHANGE:"change",BACKWARD:"backward",LOAD_ERROR:"loaderror",COMMAND:"command",FILTER:"filter",REFRESH:"refresh",CLEAR_FILTER:"clear_filter",SAVE_EDIT:"save_edit"},{CREATE:"create",ADD:"add",REMOVE:"remove",CANCEL:"cancel",COPY:"COPY",SCALE:"SCALE",TERMINATE:"TERMINATE",SAVE_TEMPLATE:"SAVE_TEMPLATE",REOPEN:"REOPEN",DELETE:"DELETE",HISTORY:"HISTORY",FilterInstance:"FilterInstance"})}),define("bmr/config/helper",["exports","moment","babel-runtime/helpers/interop-require-default","common/util/timeUtil"],function(exports,e,t,a){exports.__esModule=!0;var n=t["default"](e),i=t["default"](a);exports.timeDiff=function(e,t){if(!e)return"-";var a=n["default"](e);return n["default"](t||Date.now()).diff(a,"minutes")||"-"};exports.toTime=function(e){return i["default"].toTime(e)||""}}),define("bmr/config/html",["exports","module","underscore","babel-runtime/helpers/interop-require-default","./events"],function(exports,module,e,t,a){var n=t["default"](e),i=t["default"](a);module.exports={error:{inline:function(e){return'<span class="dcc-error">'+e+"</span>"||""}},loading:{inline:function(e){return'<span class="loading">'+e+"</span>"||""}},table:{tableId:function(e){var t="";if(t=e.url?'<a class="instance-name" href="'+e.url+'">'+n["default"].escape(e.name)+"</a> ":'<span class="instance-name">'+n["default"].escape(e.name)+"</span> ",e.editable){var a=e.editable;t+='<span class="ui-table-cell-editentry" data-row="'+a.row+'" data-col="'+a.col+'"></span>'}return t+='<br/><span class="instance-id">'+(e.id||"-")+"</span>"},tableState:function(e){return'<span class="status '+e.klass+'">'+e.text+"</span>"},linkButton:function(e){var t="link-like"+(e.disabled?" state-disabled":"");return e.disabled?'\n                    <span class="opration">\n                        <div title="'+e.title+'" class="'+t+'">\n                            '+e.label+"\n                        </div>\n                    </span>\n                ":'\n                <span class="opration">\n                    <div title="'+e.title+'"\n                        data-command="'+e.command+"\"\n                        data-command-args='"+JSON.stringify(e.commandArgs)+"'\n                        class=\""+t+'">\n                        '+e.label+"\n                    </div>\n                </span>\n            "},noDataHtml:function(e){return e.url?"<div><p>"+e.title+'<br/><a href="'+e.url+'">马上创建 &gt;&gt;</a></p></div>':"<div><p>"+e.title+"</p></div>"},noQueryDataHtml:function(e){return"<div><p>"+e.title+'<br/>\n            <a href="javascript:void(0)" data-command="'+i["default"].CLEAR_FILTER+'">查看全部 &gt;&gt;</a></p></div>'}}}}),define("bmr/enums",["exports","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","inf-ria/EnumX","babel-runtime/helpers/interop-require-default","underscore","./permission"],function(exports,e,t,a,n,i,r){exports.__esModule=!0;var l=n["default"](a),s=n["default"](i),o=new l["default"]({alias:"normal",text:"一般",value:"normal"},{alias:"unavailable",text:"无效",value:"unavailable"},{alias:"error",text:"错误",value:"error"},{alias:"warning",text:"警告",value:"warning"});exports.STATUS_TYPE=o;var u=function(a){function n(){t["default"](this,n),a.apply(this,arguments)}return e["default"](n,a),n.prototype.fromValue=function(e){return s["default"].extend({alias:e,text:e,value:e,klass:o.unavailable,permission:r.P.none},a.prototype.fromValue.call(this,e))},n}(l["default"]),d=new u({alias:"Streaming",text:"Streaming作业",value:"Streaming"},{alias:"Hive",text:"Hive作业",value:"Hive"},{alias:"Pig",text:"Pig作业",value:"Pig"},{alias:"Java",text:"Java作业",value:"Java"},{alias:"Spark",text:"Spark作业",value:"Spark"});exports.STEP_TYPE=d;var c=new u({alias:"Continue",text:"继续",value:"Continue",klass:o.normal},{alias:"CancelAndWait",text:"等待",value:"CancelAndWait",klass:o.normal});exports.STEP_ACTION_ON_FAILURE=c;var p=new u({alias:"MINUTE",text:"分钟",value:"MINUTE"},{alias:"HOUR",text:"小时",value:"HOUR"},{alias:"DAY",text:"天",value:"DAY"});exports.TIME_UNIT=p;var m=new u({alias:"SUCCESS",text:"成功",value:"SUCCESS",klass:o.normal},{alias:"FAIL",text:"失败",value:"FAIL",klass:o.error},{alias:"SCHEDULING",text:"运行中",value:"SCHEDULING",klass:o.normal});exports.HISTORY_STATUS=m;var f=new u({alias:"CREATE_CLUSTER_FAIL",text:"创建失败",value:"CREATE_CLUSTER_FAIL",klass:o.error},{alias:"EXCEED_QUOTA",text:"集群配额超限",value:"EXCEED_QUOTA",klass:o.warning},{alias:"BALANCE_NOT_ENOUGH",text:"余额不足",value:"BALANCE_NOT_ENOUGH",klass:o.warning},{alias:"SCHEDULING",text:"调度中",value:"SCHEDULING",klass:o.normal},{alias:"SCHEDULED",text:"调度完成",value:"SCHEDULED",klass:o.normal},{alias:"EXCEED_INSTANCE_QUOTA",text:"节点配额超限",value:"EXCEED_INSTANCE_QUOTA",klass:o.warning});exports.HISTORY_CODE=f;var b=new u({alias:"SMS",text:"短信",value:"SMS"},{alias:"MAIL",text:"邮件",value:"MAIL"});exports.NOTIFY_TYPE=b;var h=new u({alias:"Resizing",text:"规模调整中",value:"Resizing",klass:o.warning,permission:r.P.allowCluster2Detail|r.P.allowAddStep|r.P.allowCopyCluster|r.P.requireStopProtect|r.P.allowModifyStopProtect|r.P.allowFilter|r.P.allowModifyReminder|r.P.allowDownloadConf},{alias:"CreateError",text:"已失败",value:"CreateError",klass:o.error,permission:r.P.allowCluster2Detail|r.P.allowCopyCluster|r.P.allowFilter},{alias:"Waiting",text:"空闲中",value:"Waiting",klass:o.normal,permission:r.P.allowCluster2Detail|r.P.allowAddStep|r.P.allowStopCluster|r.P.allowCopyCluster|r.P.requireStopProtect|r.P.allowModifyStopProtect|r.P.allowScale|r.P.allowFilter|r.P.allowModifyReminder|r.P.allowDownloadConf|r.P.allowReCharge},{alias:"Starting",text:"初始化中",value:"Starting",klass:o.warning,permission:r.P.allowCopyCluster|r.P.requireStopProtect|r.P.allowAddStep|r.P.allowCluster2Detail|r.P.allowFilter},{alias:"Running",text:"运行中",value:"Running",klass:o.normal,permission:r.P.allowCluster2Detail|r.P.allowAddStep|r.P.allowStopCluster|r.P.allowCopyCluster|r.P.requireStopProtect|r.P.allowModifyStopProtect|r.P.allowScale|r.P.allowFilter|r.P.allowModifyReminder|r.P.allowDownloadConf|r.P.allowReCharge},{alias:"Terminating",text:"释放中",value:"Terminating",klass:o.unavailable,permission:r.P.allowCluster2Detail|r.P.allowCopyCluster},{alias:"Terminated",text:"已释放",value:"Terminated",klass:o.unavailable,permission:r.P.allowCluster2Detail|r.P.allowCopyCluster},{alias:"TerminatedWithErrors",text:"已释放",value:"TerminatedWithErrors",klass:o.unavailable,permission:r.P.allowCluster2Detail|r.P.allowCopyCluster},{alias:"Suspending",text:"停服中",value:"Suspending",klass:o.warning,permission:r.P.allowCluster2Detail|r.P.allowStopCluster|r.P.requireStopProtect|r.P.allowModifyStopProtect|r.P.allowModifyReminder|r.P.allowCopyCluster},{alias:"Suspended",text:"已停服",value:"Suspended",klass:o.warning,permission:r.P.allowCluster2Detail|r.P.allowStopCluster|r.P.requireStopProtect|r.P.allowFilter|r.P.allowModifyStopProtect|r.P.allowModifyReminder|r.P.allowCopyCluster|r.P.allowReCharge},{alias:"Resuming",text:"恢复中",value:"Resuming",klass:o.warning,permission:r.P.allowCluster2Detail|r.P.allowStopCluster|r.P.requireStopProtect|r.P.allowModifyStopProtect|r.P.allowModifyReminder|r.P.allowCopyCluster});exports.CLUSTER_STATUS=h;var v=new u({alias:"Running",text:"运行中",value:"Running",klass:o.normal,permission:r.P.allowStopStep},{alias:"Pending",text:"等待中",value:"Pending",klass:o.warning,permission:r.P.allowStopStep},{alias:"Cancelled",text:"已取消",value:"Cancelled",klass:o.unavailable,permission:r.P.none},{alias:"Completed",text:"已完成",value:"Completed",klass:o.normal,permission:r.P.none},{alias:"Failed",text:"已失败",value:"Failed",klass:o.error,permission:r.P.none});exports.STEP_STATUS=v;var g=new u({alias:"Provisioning",text:"载入中",value:"Provisioning",klass:o.unavailable},{alias:"Configuring",text:"配置中",value:"Configuring",klass:o.unavailable},{alias:"Running",text:"运行中",value:"Running",klass:o.normal},{alias:"Terminated",text:"已释放",value:"Terminated",klass:o.unavailable},{alias:"Deleting",text:"释放中",value:"Deleting",klass:o.unavailable},{alias:"Suspending",text:"停服中",value:"Suspending",klass:o.warning},{alias:"Suspended",text:"已停服",value:"Suspended",klass:o.warning},{alias:"Resuming",text:"恢复中",value:"Resuming",klass:o.warning});exports.INSTANCE_STATUS=g;var y=new u({alias:"TerminatedStepRunFinish",text:"(作业执行结束)",value:"TerminatedStepRunFinish"},{alias:"TerminatedManual",text:"(用户触发)",value:"TerminatedManual"},{alias:"TerminatedTimeout",text:"(运行超时)",value:"TerminatedTimeout"},{alias:"TerminatedOverdue",text:"(欠费)",value:"TerminatedOverdue"},{alias:"TerminatedExpired",text:"(到期)",value:"TerminatedExpired"},{alias:"TerminatedStepRunError",text:"(作业执行失败)",value:"TerminatedStepRunError"},{alias:"TerminatedNoFreeTrialQuota",text:"(体验版已到时)",value:"TerminatedNoFreeTrialQuota"},{alias:"HiveProvisionError",text:"(Hive组件启动失败)",value:"HiveProvisionError"});exports.CLUSTER_REASON_CODE=y;var x=new u({alias:"New",text:"新建",value:"NEW",klass:o.unavailable},{alias:"Inited",text:"初始化",value:"INITED",klass:o.unavailable},{alias:"KillWait",text:"等待终止",value:"KILL_WAIT",klass:o.warning},{alias:"Killed",text:"已终止",value:"KILLED",klass:o.unavailable},{alias:"Error",text:"错误",value:"ERROR",klass:o.error},{alias:"Succeeded",text:"成功",value:"SUCCEEDED",klass:o.normal},{alias:"Failed",text:"失败",value:"FAILED",klass:o.error},{alias:"Finished",text:"完成",value:"FINISHED",klass:o.warning},{alias:"Running",text:"运行中",value:"RUNNING",klass:o.normal});exports.JOB_STATUS=x;var T=new l["default"]({alias:"mapper",text:"Mapper：",value:"mapper"},{alias:"reducer",text:"Reducer：",value:"reducer"},{alias:"input",text:"Bos输入地址：",value:"input"},{alias:"output：",text:"Bos输出地址：",value:"output"},{alias:"jar",text:"应用程序位置：",value:"jar"},{alias:"script",text:"Bos脚本地址：",value:"script"},{alias:"mainClass",text:"MainClass：",value:"mainClass"},{alias:"submitOptions",text:"Submit-Options：",value:"submitOptions"},{alias:"actionOnFailure",text:"失败后操作：",value:"actionOnFailure"},{alias:"arguments",text:"应用程序参数：",value:"arguments"});exports.STEP_PROPERTIES=T;var _=new l["default"]({alias:"gSmall",text:"一般通用型",value:"g.small",xGroup:"初期系列"},{alias:"mMedium",text:"内存最优型",value:"m.medium",xGroup:"初期系列"},{alias:"cLarge",text:"计算最优型",value:"c.large",xGroup:"初期系列"},{alias:"c2xLarge",text:"计算1型",value:"c.2xlarge",xGroup:"初期系列"},{alias:"sMedium",text:"存储最优型",value:"s.medium",xGroup:"初期系列"},{alias:"g1Tiny",text:"迷你配置",value:"g1.tiny",xGroup:"通用I型号"},{alias:"g1Small",text:"初级配置",value:"g1.small",xGroup:"通用I型号"},{alias:"g1Medium",text:"中级配置",value:"g1.medium",xGroup:"通用I型号"},{alias:"g1Large",text:"标准配置",value:"g1.large",xGroup:"通用I型号"},{alias:"g1XLarge",text:"高级配置",value:"g1.xlarge",xGroup:"通用I型号"},{alias:"c1Small",text:"初级配置",value:"c1.small",xGroup:"计算I型号"},{alias:"c1Medium",text:"中级配置",value:"c1.medium",xGroup:"计算I型号"},{alias:"c1Large",text:"标准配置",value:"c1.large",xGroup:"计算I型号"},{alias:"c1XLarge",text:"高级配置",value:"c1.xlarge",xGroup:"计算I型号"},{alias:"d1Small",text:"初级配置",value:"d1.small",xGroup:"存储I型号"},{alias:"d1Medium",text:"中级配置",value:"d1.medium",xGroup:"存储I型号"},{alias:"d1Large",text:"标准配置",value:"d1.large",xGroup:"存储I型号"},{alias:"d1XLarge",text:"高级配置",value:"d1.xlarge",xGroup:"存储I型号"});exports.INSTANCE_TYPE=_;var w=new l["default"]({alias:"PREPAY",text:"预付费",value:"prepay"},{alias:"POSTPAY",text:"后付费",value:"postpay"});exports.PayType=w}),define("bmr/landing/landing.tpl",[],function(){return'\x3c!-- target: TPL_bmr_common_landing --\x3e\n<div class="bmr bmr-common-landing main-wrap-new">\n    <div class="content-wrap">\n        <p class="breadcrumb">\n            <span>产品服务</span>\n            <span class="divider">/</span>\n            <span class="active">百度MapReduce</span>\n        </p>\n        <div class="create-content left">\n            <div class="create-main">\n                <div class="detail-parts-table">\n                    <dl class="detail-create detail-part-1-col">\n                        <dt>\n                            <h4>百度MapReduce简介</h4>\n                        </dt>\n                        <dd class="sub-title">\n                            百度MapReduce（BMR）是全托管的Hadoop/Spark集群，您可以按需部署并弹性扩展集群，\n                            只需专注于大数据处理和分析，集群运维则交给拥有多年大规模分布式计算技术积累的百度技术团队。\n                        </dd>\n                        <dd>\n                            <button data-ui-id="create" data-ui-type="Button" data-ui-skin="create">创建集群</button>\n                        </dd>\n                    </dl>\n                    <dl class="detail-create detail-part-1-col">\n                        <dt>\n                            <h4>百度MapReduce使用流程</h4>\n                        </dt>\n                        <dd>\n                            <div class="jumbotron">\n                                <div class="img-upload"></div>\n                                <h1>上传</h1>\n                                <p>上传数据至BOS对象存储。</p>\n                                <a href="https://cloud.baidu.com/doc/BOS/index.html" target="_blank">\n                                    查看详情&gt;&gt;\n                                </a>\n                            </div>\n                            <div class="jumbotron">\n                                <div class="img-create"></div>\n                                <h1>创建</h1>\n                                <p>指定应用、规模、节点类型以创建集群。</p>\n                                <a href="https://cloud.baidu.com/doc/BMR/QuickGuide.html" target="_blank">\n                                    查看详情&gt;&gt;\n                                </a>\n                            </div>\n                            <div class="jumbotron">\n                                <div class="img-analysis"></div>\n                                <h1>分析</h1>\n                                <p>使用Hue、 定时任务等进行大数据分析。</p>\n                                <a target="_blank"\n                                    href="https://cloud.baidu.com/doc/BMR/ScenarioTutorial.html#.CD.BF.43.74.5B.F8.A7.F6.A9.7E.A2.A2.15.DE.D5.34">\n                                    查看详情&gt;&gt;\n                                </a>\n                            </div>\n                        </dd>\n                    </dl>\n                </div>\n            </div>\n        </div>\n        <div class="create-content right">\n            <h2>相关产品</h2>\n            <div class="recommend recommend-bps">\n                <span class="iconfont icon-bps"></span>\n                <a href="//cloud.baidu.com/product/kafka.html"\n                    target="_blank"\n                    class="recommend-title">百度 Kafka</a>\n                <p class="recommend-description">\n                    基于Apache Kafka的分布式、高可扩展的消息托管服务。\n                </p>\n            </div>\n            <div class="recommend recommend-bls">\n                <span class="iconfont icon-bls"></span>\n                <a href="//cloud.baidu.com/product/bls.html"\n                    target="_blank"\n                    class="recommend-title">百度日志服务 BLS</a>\n                <p class="recommend-description">\n                    托管式日志收集、投递服务，助您从日志中获取洞察力。\n                </p>\n            </div>\n            <div class="recommend recommend-palo">\n                <span class="iconfont icon-palo"></span>\n                <a href="//cloud.baidu.com/product/palo.html"\n                    target="_blank"\n                    class="recommend-title">百度OLAP引擎 Palo</a>\n                <p class="recommend-description">\n                    为客户提供稳定、高效的在线报表和多维分析服务。\n                </p>\n            </div>\n            <div class="separation"></div>\n            <h2>用户指南</h2>\n            <a target="_blank" class="help-link"\n                href="https://cloud.baidu.com/doc/BMR/index.html">\n                帮助文档&gt;&gt;\n            </a>\n        </div>\n    </div>\n</div>\n'}),define("bmr/landing/LandingView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./landing.tpl","../common/mvc/ListView","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t,a,n,i,r){var l=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIEvents=function(){var e=this;return{"create:click":function(){return e.fire("REDIRECT_CREATE")}}},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_common_landing"}},{key:"uiProperties",get:function(){return{table:{noDataHtml:""}}}}]),i}(r["default"](i)["default"]);module.exports=l}),define("bmr/operation",["exports","module","babel-runtime/helpers/class-call-check"],function(exports,module,e){var t=function(e){var t=e.target,a=t.getChild("foot").getChild("btnOk"),n=t.getChild("foot").getChild("btnCancel");a.on("click",function(){var e=t.getAction(),n=e.view.get("form");n.on("aftervalidate",function(e){return!e.isValid&&a.enable()}),n.on("aftermanualvalidate",function(e){return!e.isValid&&a.enable()}),e.on("CLOSE_DIALOG",function(){return t.dispose()}),a.disable(),n.validateAndSubmit()}),n.on("click",function(){t.fire("cancel"),t.dispose()}),t.resize()},a=function(){function a(){e["default"](this,a)}return a.prototype.editApp=function(e){this.view.waitActionDialog({title:"编辑应用",width:600,needFoot:!0,url:"/bmr/common/app/create",actionOptions:e}).then(t)},a.prototype.addStep=function(e){this.view.waitActionDialog({title:"添加作业",width:600,needFoot:!0,url:"/bmr/common/step/add",actionOptions:e}).then(t)},a.prototype.editReminder=function(e){this.view.waitActionDialog({title:"设置超时提醒",width:600,needFoot:!0,url:"/bmr/common/reminder",actionOptions:e}).then(t)},a.prototype.viewLog=function(e){this.view.waitActionDialog({title:"查看日志",width:1e3,url:"/bmr/common/log",actionOptions:e})},a}();module.exports=new a}),define("bmr/permission",["exports","module","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check"],function(exports,module,e,t){var a={none:0,allowScale:1,allowCluster2Detail:2,allowAddStep:4,allowStopCluster:8,allowCopyCluster:16,requireStopProtect:32,allowFilter:64,allowModifyStopProtect:128,allowStopStep:256,allowModifyReminder:1024,allowDownloadConf:2048,allowReCharge:4096},n=function(){function n(){t["default"](this,n)}return n.prototype.allowScale=function(e){return e&this.P.allowScale},n.prototype.allowCluster2Detail=function(e){return e&this.P.allowCluster2Detail},n.prototype.allowAddStep=function(e){return e&this.P.allowAddStep},n.prototype.allowStopCluster=function(e){return e&this.P.allowStopCluster},n.prototype.allowCopyCluster=function(e){return e&this.P.allowCopyCluster},n.prototype.requireStopProtect=function(e){return e&this.P.requireStopProtect},n.prototype.allowFilter=function(e){return e&this.P.allowFilter},n.prototype.allowModifyStopProtect=function(e){return e&this.P.allowModifyStopProtect},n.prototype.allowStopStep=function(e){return e&this.P.allowStopStep},n.prototype.allowModifyReminder=function(e){return e&this.P.allowModifyReminder},n.prototype.allowDownloadConf=function(e){return e&this.P.allowDownloadConf},n.prototype.allowReCharge=function(e){return e&this.P.allowReCharge},e["default"](n,[{key:"P",get:function(){return a}}]),n}();module.exports=new n}),define("bmr/schedule_plan/config",["exports","module","babel-runtime/helpers/class-call-check","er/controller","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t,a){a["default"](t)["default"].registerAction([{type:"bmr/schedule_plan/List",path:"/bmr/schedule_plan/list"},{type:"bmr/schedule_plan/Detail",path:"/bmr/schedule_plan/detail"},{type:"bmr/schedule_plan/History",path:"/bmr/schedule_plan/history"},{type:"bmr/schedule_plan/Create",path:"/bmr/schedule_plan/create"},{type:"bmr/schedule_plan/StepList",path:"/bmr/schedule_plan/steplist"},{type:"bmr/common/schedule/Schedule",path:"/bmr/schedule_plan/update"}]);module.exports=new function n(){e["default"](this,n)}}),define("bmr/schedule_plan/Create",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/FormAction","babel-runtime/helpers/interop-require-default","underscore","./CreateModel","./CreateView","../operation"],function(exports,module,e,t,a,n,i,r,l,s,o){var u=i["default"](n),d=i["default"](r),c=i["default"](l),p=i["default"](s),m=i["default"](o),f=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.initBehavior=function(){var e=this;n.prototype.initBehavior.call(this),this.view.on("CANCEL",function(){return e.redirectToURL({url:"/bmr/schedule_plan/list"})},this),this.view.on("ADD_STEP",this.addStep,this),this.view.on("DELETE",this.deleteStep,this),this.view.on("REDIRECT_TO_URL",this.redirectToURL,this),this.view.on("TEMPLATE_CHANGE",this.templateChange,this),this.view.on("PICK",this.pick,this)},i.prototype.addStep=function(){var e=this,t=this.view.get("templateSelect").getSelectedItem();if(!t)return this.view.showToast("请先选择一个集群模板！");m["default"].addStep.call(this,{stepTypeDatasource:t.stepTypeDatasource,requester:function(t){return e.afterAddStep(t)}})},i.prototype.afterAddStep=function(e){var t=this.view.get("table"),a=t.datasource.concat(e.steps),n=this.view.get("templateSelect").selectedIndex,i=this.model.get("templateData"),r=d["default"].pick(i[n],"imageType","imageVersion","applications");return this.model.valiadStep(d["default"].extend(r,e)).then(function(){return t.setDatasource(a)})},i.prototype.deleteStep=function(e){var t=e.args,a=this.view.get("table");a.datasource.splice(t,1),a.setDatasource(a.datasource)},i.prototype.redirectToURL=function(e){this.redirect(e.url)},i.prototype.templateChange=function(){var e=this.view.get("templateSelect"),t=this.model.get("templateData"),a=this.view.get("table").datasource,n=e.getSelectedItem().stepTypeDatasource;n=d["default"].pluck(n,"value"),a=d["default"].filter(a,function(e){return d["default"].indexOf(n,e.type)>-1}),this.view.get("table").setDatasource(a),this.view.updateTemplateSummaryTip(t[e.selectedIndex])},i.prototype.pick=function(){var e=this.view.get("form");e&&e.validate()&&e.fire("submit")},t["default"](i,[{key:"modelType",get:function(){return c["default"]}},{key:"viewType",get:function(){return p["default"]}}]),i}(u["default"]);module.exports=f}),define("bmr/schedule_plan/create.tpl",[],function(){return'\x3c!-- target: TPL_bmr_schedule_plan_create --\x3e\r\n<div class="bmr bmr-schedule-plan-create main-wrap-new">\r\n    <div class="content-wrap">\r\n        \x3c!--use: TPL_bmr_schedule_plan_nav(title="创建定时任务") --\x3e\r\n        <div class="create-content">\r\n            <h1>\r\n                创建定时任务\r\n                <p class="realname-tip"\r\n                    data-ui-type="ToastLabel"\r\n                    data-ui-message-type="alert"\r\n                    data-ui-hidden="true"\r\n                    data-auth="verifiedUser"\r\n                    data-authtype="SHOW">\r\n                </p>\r\n            </h1>\r\n            <div class="create-main">\r\n                <div class="detail-parts-table">\r\n                    <form data-ui-type="Form"\r\n                        data-ui-id="form"\r\n                        data-ui-auto-validate="true">\r\n                        <dl class="detail-create detail-part-1-col">\r\n                            <dt>\r\n                                <h4>任务参数</h4>\r\n                            </dt>\r\n                            <dd>\r\n                                <label>任务名称：</label>\r\n                                <div>\r\n                                    <div data-ui-id="planName"\r\n                                        data-ui-type="TextBox"\r\n                                        data-ui-name="name"></div>\r\n                                </div>\r\n                            </dd>\r\n                            <dd>\r\n                                <label>集群模板：</label>\r\n                                <div>\r\n                                    <span data-ui-id="templateSelect"\r\n                                        data-ui-type="Select"\r\n                                        data-ui-name="templateId"></span>\r\n                                    <div data-ui-type="Panel"\r\n                                        data-ui-id="templateDetailPanel"\r\n                                        class="template-summary-tip">\r\n                                    </div>\r\n                                </div>\r\n                            </dd>\r\n                        </dl>\r\n                    </form>\r\n                    <div data-ui-type="ActionPanel"\r\n                        data-ui-id="schedulePanel"></div>\r\n                    <dl class="detail-create detail-part-1-col">\r\n                        <dt>\r\n                            <h4>作业设置</h4>\r\n                        </dt>\r\n                        <div class="ui-row">\r\n                            <button type="button"\r\n                                data-ui-type="Button"\r\n                                data-ui-id="addStep"\r\n                                data-ui-skin="create">添加作业\r\n                            </button>\r\n                            <span class="row-tip">一个作业可以包含一个或多个Hadoop作业，或者包含安装或配置一个应用程序的指令。 您可以对一个集群提交多达256个作业。</span>\r\n                        </div>\r\n                        <div data-ui-type="Table" data-ui-id="table" data-ui-datasource="@tableData"\r\n                            data-ui-order-by="@orderBy" data-ui-order="@order" data-ui-select="@selectMode"\r\n                            data-ui-extension-tip-type="TableTip"\r\n                            data-ui-extension-command-type="Command">\r\n                        </div>\r\n\r\n                        <dd class="btn-group">\r\n                            <button data-ui-id="pick"\r\n                                data-ui-type="Button"\r\n                                data-ui-skin="ok"\r\n                                data-auth="verifiedUser"\r\n                                data-authtype="READONLY">完成</button>\r\n                            <button data-ui="id:cancel;type:Button;">取消</button>\r\n                        </dd>\r\n                    </dl>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("bmr/schedule_plan/CreateModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","bat-ria/mvc/FormModel","../enums","../config","../util"],function(exports,module,e,t,a,n,i,r,l,s,o){var u=i["default"](n),d=i["default"](r),c=i["default"](o),p=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.prepare=function(){var e=u["default"].defaults(this.get("copyData"),{clusterTemplate:{}}),t=u["default"].map(this.get("templateData"),function(e){return{name:e.name,value:e.id,stepTypeDatasource:l.STEP_TYPE.toArray.apply(l.STEP_TYPE,c["default"].pickStepType(e))}});this.set("templateDatasource",t),this.set("defaultData",{name:e.name||"我的任务",steps:e.clusterTemplate.steps||[],period:e.period,periodUnit:e.periodUnit,startTime:e.startTime,endTime:e.endTime})},i.prototype.valiadStep=function(e){return s.api.bmrValidateStep(e)},i.prototype.findMatchedTemplate=function(){var e=this.get("templateData"),t=this.get("copyData"),a=c["default"].pickStepType(t.clusterTemplate);return u["default"].find(e,function(e){var t=c["default"].pickStepType(e);return 0===u["default"].difference(a,t).length})},i.prototype.checkTemplateData=function(){return!this.get("schedulePlanId")||!!this.findMatchedTemplate()},t["default"](i,[{key:"submitRequester",get:function(){return s.api.bmrSchedulePlanCreate}},{key:"datasource",get:function(){return{templateData:function(){return s.api.bmrCopyableTemplateList().then(function(e){return e.result})},copyData:function(e){var t=e.get("schedulePlanId");return t?s.api.bmrSchedulePlanDetail({schedulePlanId:t}):{}}}}}]),i}(d["default"]);module.exports=p}),define("bmr/schedule_plan/CreateView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","etpl","babel-runtime/helpers/interop-require-default","underscore","bat-ria/tpl!./create.tpl","bat-ria/mvc/FormView","../util","../enums"],function(exports,module,e,t,a,n,i,r,l,s,o,u){var d=i["default"](n),c=i["default"](r),p=i["default"](s),m=i["default"](o),f=[{title:"作业名称",content:function(e){return e.name}},{title:"失败后操作",content:function(e){return u.STEP_ACTION_ON_FAILURE.getTextFromValue(e.actionOnFailure)}},{title:"作业参数:",minWidth:350,content:function(e){return m["default"].formatStepProperties(e)}},{title:"操作",content:function(e,t){var a='<p class="cmds">';return a+=d["default"].compile('<button data-command="${command}" data-command-args="${args}">${text}</button>')({command:"DELETE",args:t,text:"删除"}),a+="</p>"}}],b=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIProperties=function(){var e=this.model.get("defaultData");return{planName:{width:260,value:e.name,placeholder:"请输入任务名称",custom:function(e){return e.trim()&&/^[\S ]{1,255}$/.test(e)},customErrorMessage:"名称不符合规则：长度1-255，字符不能全为空格"},templateSelect:{width:280,emptyText:"请选择集群模板",datasource:"@templateDatasource"},table:{datasource:e.steps,columnResizable:!0,fields:f},schedulePanel:{url:"/bmr/schedule_plan/update",actionOptions:{editData:c["default"].pick(e,"period","periodUnit","startTime","endTime")}}}},i.prototype.getUIEvents=function(){var e=this;return{"table:command":function(t){return e.fire(t.name,t)},"templateSelect:change":function(){return e.fire("TEMPLATE_CHANGE")},"templateSelect:beforechange":function(t){return e.changeConfirm(t)},"addStep:click":function(){return e.fire("ADD_STEP")},"pick:click":function(){return e.fire("PICK")}}},i.prototype.enterDocument=function(){var e=this;return n.prototype.enterDocument.call(this),0===this.model.get("templateDatasource").length?this.waitConfirm({title:"提示",content:"没有可用的集群模板，想要创建一个模板吗？"}).then(function(){return e.fire("REDIRECT_TO_URL",{url:"/bmr/template/create"})},function(){return e.fire("REDIRECT_TO_URL",{url:"/bmr/schedule_plan/list"})}):this.model.checkTemplateData()?void 0:this.waitConfirm({title:"提示",content:"复制模板并没有找到适配的模板，想要创建一个模板吗"}).then(function(){return e.fire("REDIRECT_TO_URL",{url:"/bmr/template/create"})},function(){return e.fire("REDIRECT_TO_URL",{url:"/bmr/schedule_plan/list"})})},i.prototype.getExtraFormData=function(){var e=this.get("schedulePanel").action.getFormData();return c["default"].extend(e,{steps:this.get("table").datasource})},i.prototype.updateTemplateSummaryTip=function(e){this.get("templateDetailPanel").setContent(m["default"].formatClusterSummary(e))},i.prototype.changeConfirm=function(e){var t=this.get("templateSelect").datasource[e.index],a=c["default"].pluck(this.get("table").datasource,"type"),n=c["default"].pluck(t.stepTypeDatasource,"value");a.length>0&&c["default"].union(a,n).length>n.length&&(e.preventDefault(),this.waitConfirm({title:"提示",content:"新的模板不支持部分已添加的作业，你确认过滤掉不符合的作业吗？"}).then(function(){return e.target.set("selectedIndex",+e.index)}))},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_schedule_plan_create"}}]),i}(p["default"]);module.exports=b}),define("bmr/schedule_plan/Detail",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","common/util/dialog","bat-ria/mvc/BaseAction","./DetailModel","./DetailView","../enums","../util","../operation"],function(exports,module,e,t,a,n,i,r,l,s,o,u,d,c){var p=i["default"](n),m=i["default"](r),f=i["default"](l),b=i["default"](s),h=i["default"](o),v=i["default"](d),g=i["default"](c),y=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.initBehavior=function(){n.prototype.initBehavior.call(this),this.view.on("REFRESH",this.reload,this),this.view.on("UPDATE_SCHEDULE",this.updateSchedule,this),this.view.on("ADD_STEP",this.addStep,this),this.view.on("DELETE_STEP",this.deleteStep,this),this.view.on("EDIT_STEP",this.editStep,this)},i.prototype.updateSchedule=function(e){var t=this;m["default"].waitActionDialog(this.view,{title:"修改策略",width:600,needFoot:!0,url:"/bmr/schedule_plan/update",actionOptions:{editData:p["default"].pick(this.model.get("detail"),"period","periodUnit","startTime","endTime"),requester:function(e){return t.model.updateSchedule({schedule:e})},parentAction:this}})},i.prototype.addStep=function(e){var t=this,a=this.model.get("detail").clusterTemplate,n=this.view.get("table").datasource;g["default"].addStep.call(this,{parentAction:this,stepTypeDatasource:u.STEP_TYPE.toArray.apply(u.STEP_TYPE,v["default"].pickStepType(a)),requester:function(e){return t.model.updateSchedule({steps:n.concat(e.steps)})}})},i.prototype.deleteStep=function(e){var t=this,a=this.view.get("table").datasource;a.splice(+e.rowIndex,1),this.model.updateSchedule({steps:a}).then(function(){return t.reload()})},i.prototype.editStep=function(e){var t=this,a=this.model.get("detail").clusterTemplate,n=this.view.get("table").datasource,i=n[e.rowIndex];g["default"].addStep.call(this,{editData:i,parentAction:this,stepTypeDatasource:u.STEP_TYPE.toArray.apply(u.STEP_TYPE,v["default"].pickStepType(a)),requester:function(a){return n[e.rowIndex]=a.steps[0],t.model.updateSchedule({steps:n})}})},t["default"](i,[{key:"modelType",get:function(){return b["default"]}},{key:"viewType",get:function(){return h["default"]}}]),i}(f["default"]);module.exports=y}),define("bmr/schedule_plan/detail.tpl",[],function(){return'\x3c!-- target: TPL_bmr_schedule_plan_detail --\x3e\n<div class="bmr bmr-schedule-plan-detail bmr-main-wrap main-wrap-new">\n    \x3c!-- use: TPL_bmr_side_bar(menu="schedule_plan") --\x3e\n    <div class="content-wrap">\n        \x3c!-- use: TPL_bmr_schedule_plan_nav(title="定时任务详情") --\x3e\n        \x3c!-- import: TPL_bmr_schedule_plan_header --\x3e\n        <div class="detail-content">\n            <div class="detail-parts-table">\n                <dl class="detail-part-1-col">\n                    <dt>\n                        <h4>任务基本信息</h4>\n                    </dt>\n                    <dd>\n                        <div class="detail-cell">\n                            <label>任务ID：</label>\n                            <span>${detail.id}</span>\n                        </div>\n                        <div class="detail-cell">\n                            <label>任务名称：</label>\n                            <span class="cell-block">${detail.name}</span>\n                        </div>\n                    </dd>\n                    <dd>\n                        <div class="detail-cell">\n                            <label>创建时间：</label>\n                            <span class="no-content">\n                                ${detail.createTime | formatTime}\n                            </span>\n                        </div>\n                        <div class="detail-cell">\n                            <label>任务状态：</label>\n                            <span class="no-content">\n                                \x3c!-- if: ${detail.isEnabled} === true --\x3e\n                                <span class="status normal" >开启</span>\n                                \x3c!-- else --\x3e\n                                <span class="status unavailable">关闭</span>\n                                \x3c!-- /if --\x3e\n                            </span>\n                        </div>\n                    </dd>\n                </dl>\n                <dl class="detail-part-1-col">\n                    <dt>\n                        <h4>集群基本信息</h4>\n                    </dt>\n                    <dd>\n                        <div class="detail-cell">\n                            <label>集群名称：</label>\n                            <span>${detail.name}</span>\n                        </div>\n                        <div class="detail-cell">\n                            <label for="">区域：</label>\n                            <span>${detail.clusterTemplate.availabilityZone | bmrFormatZone}</span>\n                        </div>\n                    </dd>\n                    <dd>\n                        <div class="detail-cell">\n                            <label>报警设置：</label>\n                            <span>\n                                \x3c!-- if: ${detail.clusterTemplate.alarmEnabled} --\x3e\n                                开启\n                                \x3c!-- else --\x3e\n                                关闭\n                                \x3c!-- /if --\x3e\n                            </span>\n                        </div>\n                        <div class="detail-cell">\n                            <label>日志地址：</label>\n                            <span>\n                                \x3c!-- if: ${detail.clusterTemplate.logUri} --\x3e\n                                ${detail.clusterTemplate.logUri}\n                                \x3c!-- else --\x3e\n                                -\n                                \x3c!-- /if --\x3e\n                            </span>\n                        </div>\n                    </dd>\n                    <dd>\n                        <div class="detail-cell">\n                            <label>短信设置：</label>\n                            <span class="no-content">\n                                <label>\n                                    \x3c!-- if: ${detail.clusterTemplate.sendMessage} --\x3e\n                                    开启\n                                    \x3c!-- else --\x3e\n                                    关闭\n                                    \x3c!-- /if --\x3e\n                                </label>\n                            </span>\n                        </div>\n                        <div class="detail-cell">\n                            <label>自动终止：</label>\n                            <span>\n                                \x3c!-- if: ${detail.clusterTemplate.autoTerminate} --\x3e\n                                开启\n                                \x3c!-- else --\x3e\n                                关闭\n                                \x3c!-- /if --\x3e\n                            </span>\n                        </div>\n                    </dd>\n                    <dd>\n                        <div class="detail-cell">\n                            <label>超时提醒配置：</label>\n                            <span>\n                                \x3c!--if: ${detail.clusterTemplate.reminder.enabled} --\x3e\n                                开启\n                                \x3c!-- else --\x3e\n                                关闭\n                                \x3c!-- /if --\x3e\n                            </span>\n                        </div>\n                    \x3c!--if: ${detail.clusterTemplate.reminder.enabled} --\x3e\n                        <div class="detail-cell">\n                            <label>超时时间：</label>\n                            <span>\n                                ${detail.clusterTemplate.reminder.duration}分钟\n                            </span>\n                        </div>\n                    </dd>\n                    <dd>\n                        <div class="detail-cell">\n                            <label>超时提醒方式：</label>\n                            <span>\n                                ${detail.clusterTemplate.reminder.mediaText}\n                            </span>\n                        </div>\n                    \x3c!--/if--\x3e\n                    </dd>\n                </dl>\n                <dl class="detail-part-1-col">\n                    <dt>\n                        <h4>集群配置详情</h4>\n                    </dt>\n                    <dd>\n                        <div class="detail-cell">\n                            <label>镜像版本：</label>\n                            <span>\n                                ${detail.clusterTemplate.imageDescription}\n                            </span>\n                        </div>\n                        <div class="detail-cell">\n                            <label>应用配置：</label>\n                            <span class="cell-block">\n                                ${*detail.clusterTemplate.applications | bmrFormatClusterApp}\n                            </span>\n                        </div>\n                    </dd>\n                    <dd>\n                        <div class="detail-cell">\n                            <label>套餐配置：</label>\n                            <span class="cell-block">\n                                ${*detail.clusterTemplate.instanceGroups | bmrFormatClusterFlavor}\n                            </span>\n                        </div>\n                    </dd>\n                </dl>\n                <dl class="detail-part-1-col">\n                    <dt><h4>网络</h4></dt>\n                    <dd>\n                        <div class="detail-cell">\n                            <label>所在网络：</label>\n                            ${*detail.clusterTemplate.vpc | bmrFormatNetWork(${detail.clusterTemplate.vpc.vpcId})}\n                        </div>\n                        <div class="detail-cell">\n                            <label>安全组：</label>\n                            ${*detail.clusterTemplate.systemSecurityGroup | bmrFormatNetWork(${detail.clusterTemplate.vpc.vpcId})}\n                        </div>\n                    </dd>\n                    <dd>\n                        <div class="detail-cell">\n                            <label>所在子网：</label>\n                            ${*detail.clusterTemplate.subnet | bmrFormatNetWork(${detail.clusterTemplate.vpc.vpcId})}\n                        </div>\n                    </dd>\n                </dl>\n                <dl class="detail-part-1-col">\n                    <dt>\n                        <h4>执行详情</h4>\n                    </dt>\n                    <dd>\n                        <div class="detail-cell">\n                            <label>执行策略：</label>\n                            <div>\n                                <span>\n                                    每${detail.period}${detail.periodUnit | bmrFormatTimeUnit}，\n                                    \x3c!-- if: ${detail.startTime} --\x3e\n                                    开始时间：${detail.startTime | formatTime}，\n                                    \x3c!--else--\x3e\n                                    开始时间：立即开始，\n                                    \x3c!-- /if --\x3e\n                                    \x3c!-- if: ${detail.endTime} --\x3e\n                                    结束时间：${detail.endTime | formatTime}，\n                                    \x3c!--else--\x3e\n                                    结束时间：从不结束，\n                                    \x3c!-- /if --\x3e\n                                </span>\n                                <span data-ui-id="updateSchedule"\n                                    data-ui-type="Button"\n                                    data-ui-skin="stringfy">调整执行策略</span>\n                            </div>\n                        </div>\n                        <div class="detail-cell">\n                            <label>下次执行时间：</label>\n                            <span>${detail.nextExecuteTime | formatTime}</span>\n                        </div>\n                    </dd>\n                </dl>\n                <dl class="detail-part-1-col">\n                    <dt>\n                        <h4>作业信息</h4>\n                    </dt>\n                    <dd>\n                        <div class="table-wrap">\n                            <div class="ui-row">\n                                <button data-ui-type="Button"\n                                    data-ui-id="addStep"\n                                    data-ui-skin="create">添加作业</button>\n                            </div>\n                            \x3c!-- import: listTableWithCommand --\x3e\n                        </div>\n                    </dd>\n                </dl>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("bmr/schedule_plan/DetailModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","bat-ria/mvc/BaseModel","../config","../enums"],function(exports,module,e,t,a,n,i,r,l,s){var o=i["default"](n),u=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.updateSchedule=function(e){return l.api.bmrSchedulePlanUpdate(o["default"].defaults(e,{schedulePlanId:this.get("schedulePlanId")}))},t["default"](i,[{key:"defaultArgs",get:function(){return{pageSize:10}}},{key:"datasource",get:function(){return{detail:function(e){return l.api.bmrSchedulePlanDetail({schedulePlanId:e.get("schedulePlanId")}).then(function(e){return e.clusterTemplate.reminder.mediaText=o["default"].reduce(e.clusterTemplate.reminder.media,function(e,t,a){return e+(a>0?"、":"")+s.NOTIFY_TYPE.getTextFromValue(t)},""),e})}}}}]),i}(i["default"](r)["default"]);module.exports=u}),define("bmr/schedule_plan/DetailView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./detail.tpl","bat-ria/mvc/BaseView","babel-runtime/helpers/interop-require-default","common/util/tableUtil","../util","../enums"],function(exports,module,e,t,a,n,i,r,l,s,o){var u=r["default"](i),d=r["default"](l),c=r["default"](s),p=[{title:"名称",stable:!0,width:150,content:function(e){return e.name}},{title:"失败后操作",stable:!0,width:150,content:function(e){return o.STEP_ACTION_ON_FAILURE.getTextFromValue(e.actionOnFailure)}},{title:"参数",content:function(e){return c["default"].formatStepProperties(e)}},{title:"操作",content:function(e,t){return'\n            <p class="cmds">\n                <button data-command="EDIT_STEP" data-command-args="'+t+'">编辑</button>\n                <button data-command="DELETE_STEP" data-command-args="'+t+'">删除</button>\n            </p>\n        '}}],m=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIEvents=function(){var e=this;return{"refresh:click":function(){return e.fire("REFRESH")},"updateSchedule:click":function(){return e.fire("UPDATE_SCHEDULE")},"table:command":function(t){return e.fire(t.name,{rowIndex:t.args})},"addStep:click":function(){return e.fire("ADD_STEP")}}},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_schedule_plan_detail"}},{key:"uiProperties",get:function(){return{table:d["default"].tableProperty(p,{select:"",datasource:"@detail.clusterTemplate.steps"})}}}]),i}(u["default"]);module.exports=m}),define("bmr/schedule_plan/History",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/ListAction","babel-runtime/helpers/interop-require-default","./HistoryModel","./HistoryView"],function(exports,module,e,t,a,n,i,r,l){var s=i["default"](n),o=i["default"](r),u=i["default"](l),d=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.initBehavior=function(){n.prototype.initBehavior.call(this),this.view.on("refresh",this.reload,this)},t["default"](i,[{key:"modelType",get:function(){return o["default"]}},{key:"viewType",get:function(){return u["default"]}}]),i}(s["default"]);module.exports=d}),define("bmr/schedule_plan/history.tpl",[],function(){return'\x3c!-- target: TPL_bmr_schedule_plan_history --\x3e\n<div class="bmr bmr-schedule-plan-history bmr-main-wrap main-wrap-new">\n    \x3c!-- use: TPL_bmr_side_bar(menu="schedule_plan") --\x3e\n    <div class="content-wrap">\n        \x3c!-- use: TPL_bmr_schedule_plan_nav(title="定时任务执行记录") --\x3e\n        \x3c!-- import: TPL_bmr_schedule_plan_header --\x3e\n        <div class="detail-content">\n            <div class="detail-parts-table">\n                \x3c!-- if: ${historyList.length} === 0 --\x3e\n                <div class="ui-table-body-nodata">\n                    <div>\n                        <p>下次调度时间：\n                            <br/>\n                            ${detail.nextExecuteTime|formatTime}\n                        </p>\n                    </div>\n                </div>\n                \x3c!-- /if --\x3e\n                <div data-ui="type:GroupPanel;id:historyGroup;"></div>\n                <div class="ui-row clearfix">\n                    \x3c!-- import: listPager --\x3e\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("bmr/schedule_plan/HistoryModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/ListModel","babel-runtime/helpers/interop-require-default","underscore","../config"],function(exports,module,e,t,a,n,i,r,l){var s=i["default"](n),o=i["default"](r),u=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getDefaultArgs=function(){return o["default"].extend(n.prototype.getDefaultArgs.call(this),{pageSize:10,schedulePlanId:this.get("schedulePlanId")})},t["default"](i,[{key:"listRequester",get:function(){return l.api.bmrSchedulePlanHistory}},{key:"datasource",get:function(){return{detail:function(e){return l.api.bmrSchedulePlanDetail({schedulePlanId:e.get("schedulePlanId")})}}}}]),i}(s["default"]);module.exports=u}),define("bmr/schedule_plan/HistoryView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./history.tpl","bat-ria/mvc/ListView","babel-runtime/helpers/interop-require-default","common/util/timeUtil","../enums"],function(exports,module,e,t,a,n,i,r,l,s){var o=r["default"](i),u=r["default"](l),d=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIProperties=function(){return{historyGroup:{datasource:"@tableData",renderHeader:this.renderGroupPanelHeader,loadAction:{url:"/bmr/schedule_plan/steplist"},allowArrow:function(e){return!!e.clusterId}}}},i.prototype.getUIEvents=function(){var e=this;return{"refresh:click":function(){return e.fire("refresh")}}},i.prototype.renderGroupPanelHeader=function(e){var t=s.HISTORY_STATUS.fromValue(e.status),a=e.code?"("+s.HISTORY_CODE.getTextFromValue(e.code)+")":"";return"<div>开始调度时间:"+u["default"].toTime(e.startTime)+'<span class="separate">|</span><span class="status '+t.klass+'">'+t.text+a+'</span><span class="separate">|</span>集群名称/ID：'+(e.clusterId?'<a href="#/bmr/cluster/detail~clusterId='+e.clusterId+'">'+e.clusterName+"/"+e.clusterId+"</a>":"-/-")+"</div>"},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_schedule_plan_history"}}]),i}(o["default"]);module.exports=d}),define("bmr/schedule_plan/List",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","./ListView","babel-runtime/helpers/interop-require-default","./ListModel","../config","../common/mvc/ListAction"],function(exports,module,e,t,a,n,i,r,l){var s=n["default"](a),o=n["default"](i),u=function(a){function n(e){t["default"](this,n),a.call(this,e),this.modelType=o["default"],this.viewType=s["default"]}return e["default"](n,a),n.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.view.on(r.events.REFRESH,this.reload,this),this.view.on(r.events.HISTORY,this.redirectToHistory,this),this.view.on(r.events.CREATE,this.create,this),this.view.on(r.events.DELETE,this["delete"],this),this.view.on(r.events.TERMINATE,this.terminatePlan,this),this.view.on(r.events.REOPEN,this.reopenPlan,this),this.view.on(r.events.COPY,this.copyPlan,this)},n.prototype.redirectToHistory=function(e){this.redirect("/bmr/schedule_plan/history~schedulePlanId="+e.args)},n.prototype.create=function(){this.redirect("/bmr/schedule_plan/create")},n.prototype["delete"]=function(e){var t=this;this.model.deletePlan({schedulePlanId:e.args}).then(function(){return t.view.showToast("删除成功")}).ensure(function(){return t.reload()})},n.prototype.terminatePlan=function(e){var t=this;this.model.terminatePlan({schedulePlanId:e.args}).then(function(){return t.view.showToast("关闭成功")}).ensure(function(){return t.reload()})},n.prototype.reopenPlan=function(e){var t=this;this.model.reopenPlan({schedulePlanId:e.args}).ensure(function(){return t.reload()})},n.prototype.copyPlan=function(e){this.redirect("/bmr/schedule_plan/create~schedulePlanId="+e.args)},n}(n["default"](l)["default"]);module.exports=u}),define("bmr/schedule_plan/list.tpl",[],function(){return'\x3c!-- target: TPL_bmr_schedule_plan_list --\x3e\n<div class="bmr bmr-schedule-plan-list bmr-main-wrap main-wrap-new">\n    \x3c!-- use: TPL_bmr_side_bar(menu="schedule_plan") --\x3e\n    <div class="content-wrap">\n        \x3c!-- import: TPL_bmr_schedule_plan_nav --\x3e\n        <div class="list-content">\n            <h2>\n                定时任务列表\n                \x3c!-- import: TPL_realname_tip --\x3e\n            </h2>\n            <div class="table-full-wrap">\n                <div class="operation-wrap">\n                    <div class="buttons-wrap">\n                        <button data-ui="id:create;type:Button;skin:create"\n                            data-auth="verifiedUser"\n                            data-authtype="READONLY">创建定时任务</button>\n                    </div>\n                    <div class="buttons-quick-wrap">\n                        <button data-ui-id="refresh" data-ui-type="Button" data-ui-skin="refresh"></button>\n                    </div>\n                </div>\n                \x3c!-- import: listTableWithCommand --\x3e\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("bmr/schedule_plan/ListModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","../config","../common/mvc/ListModel","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t,a,n,i,r){var l=function(i){function r(){a["default"](this,r),i.apply(this,arguments)}return e["default"](r,i),r.prototype.deletePlan=function(){var e=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];return n.api.bmrSchedulePlanDelete(e)},r.prototype.terminatePlan=function(e){return n.api.bmrSchedulePlanStop(e)},r.prototype.reopenPlan=function(e){return n.api.bmrSchedulePlanStart(e)},t["default"](r,[{key:"listRequester",get:function(){return n.api.bmrSchedulePlanList}}]),r}(r["default"](i)["default"]);module.exports=l}),define("bmr/schedule_plan/ListView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","common/util/tableUtil","bat-ria/tpl!./list.tpl","../common/mvc/ListView","../config"],function(exports,module,e,t,a,n,i,r,l,s,o){var u=i["default"](n),d=i["default"](r),c=[{title:"任务名称/ID",content:function(e){return o.html.table.tableId({id:e.id,name:e.name,url:"#/bmr/schedule_plan/detail~schedulePlanId="+e.id})}},{title:"状态",content:function(e){return e.isEnabled?o.html.table.tableState({text:"开启",klass:"normal"}):o.html.table.tableState({text:"关闭",klass:"unavailable"})}},{title:"执行策略",minWidth:200,content:function(e){return"\n            <p>每"+e.period+o.enums.TIME_UNIT.getTextFromValue(e.periodUnit)+"</p>\n            <p>开始："+(o.helper.toTime(e.startTime)||"立即开始")+"</p>\n            <p>结束："+(o.helper.toTime(e.endTime)||"从不结束")+"</p>\n        "}},{title:"创建时间",content:function(e){return o.helper.toTime(e.createTime)||"-"}},{title:"下次执行时间",content:function(e){return o.helper.toTime(e.nextExecuteTime)||"-"}},{title:"操作",content:function(e){var t=o.html.table.linkButton({label:"查看执行历史",title:"查看执行历史",command:o.events.HISTORY,disabled:!1,commandArgs:e.id});return""+o.html.table.linkButton({label:e.isEnabled?"关闭":"开启",title:e.isEnabled?"关闭":"开启",command:e.isEnabled?o.events.TERMINATE:o.events.REOPEN,disabled:!e.isEnabled&&!e.copyable,commandArgs:e.id})+o.html.table.linkButton({label:"复制",title:"复制",command:o.events.COPY,disabled:!e.copyable,commandArgs:e.id})+o.html.table.linkButton({label:"删除",title:"删除",command:o.events.DELETE,disabled:!e.id,commandArgs:e.id})+"<br/>"+t}}],p=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIEvents=function(){var e=this;return u["default"].extend(n.prototype.getUIEvents.call(this),{"refresh:click":function(){return e.fire(o.events.REFRESH)},"create:click":function(){return e.fire(o.events.CREATE)}})},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_schedule_plan_list"}},{key:"uiProperties",get:function(){return{table:d["default"].tableProperty(c,{select:"",noDataHtml:o.html.table.noDataHtml({title:"你还没创建定时任务！",url:"#/bmr/schedule_plan/create"})}),pager:{pageSizes:[10,30,50,100]}}}},{key:"confirmEventMap",get:function(){var e;return e={},e[o.events.TERMINATE]="您确定关闭定时任务吗？",e[o.events.DELETE]="您确定删除任务吗？",e}}]),i}(i["default"](s)["default"]);module.exports=p}),define("bmr/schedule_plan/StepList",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/ListAction","babel-runtime/helpers/interop-require-default","./StepListModel","./StepListView"],function(exports,module,e,t,a,n,i,r,l){var s=i["default"](n),o=i["default"](r),u=i["default"](l),d=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getURLForPage=function(e){var t=n.prototype.getURLForPage.call(this,e);return this.context.url.getQuery().clusterId||(t+="&clusterId="+this.model.get("clusterId")),t},t["default"](i,[{key:"modelType",get:function(){return o["default"]}},{key:"viewType",get:function(){return u["default"]}}]),i}(s["default"]);module.exports=d}),define("bmr/schedule_plan/steplist.tpl",[],function(){return'\x3c!-- target: TPL_bmr_schedule_plan_step_list_child --\x3e\n<div class="bmr-schedule-plan-step-list bmr-main-wrap">\n    \x3c!-- import: listTable --\x3e\n    <div class="ui-row clearfix">\n    \t\x3c!-- import: listPager --\x3e\n    </div>\n</div>\n'}),define("bmr/schedule_plan/StepListModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/ListModel","babel-runtime/helpers/interop-require-default","underscore","../config","../enums"],function(exports,module,e,t,a,n,i,r,l){var s=n["default"](a),o=n["default"](i),u=function(a){function n(){t["default"](this,n),a.apply(this,arguments)}return e["default"](n,a),n.prototype.listRequester=function(e){return r.api.bmrStepList(e).then(function(e){return o["default"].each(e.result,function(e){e.status.state=l.STEP_STATUS.fromValue(e.status.state)}),e})},n.prototype.getDefaultArgs=function(){var e=a.prototype.getDefaultArgs.call(this);return o["default"].extend({pageSize:10,clusterId:this.get("clusterId")},e)},n.prototype.filterQuery=function(e){return o["default"].omit(e,"schedulePlanId")},n}(s["default"]);module.exports=u}),define("bmr/schedule_plan/StepListView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./steplist.tpl","bat-ria/mvc/ListView","babel-runtime/helpers/interop-require-default","underscore","moment","common/util/tableUtil","common/util/timeUtil"],function(exports,module,e,t,a,n,i,r,l,s,o,u){var d=r["default"](i),c=r["default"](l),p=r["default"](s),m=r["default"](o),f=r["default"](u),b=[{title:"作业名称/ID",subEntry:!0,content:function(e){return'<a href="#/bmr/step/detail~stepId='+e.id+"&clusterId="+e.clusterId+'"\n            class="instance-name" data-redirect="global">'+c["default"].escape(e.name)+'</a><br/>\n            <span class="instance-id">'+e.id+"</span>"}},{title:"创建时间",content:function(e){return e.id?f["default"].toTime(e.status.creationDateTime)||"-":"-"}},{title:"状态",content:function(e){return'<p class="status '+e.status.state.klass+'">'+e.status.state.text+"</p>"}},{title:"运行时间(分钟)",content:function(e){var t=e.status.startDateTime,a=e.status.endDateTime;if(null===t||null===a)return"-";var n=p["default"](t,"YYYY-MM-DD HH:mm:ss");return p["default"](a,"YYYY-MM-DD HH:mm:ss").diff(n,"minutes")}}],h=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),t["default"](i,[{key:"template",get:function(){return"TPL_bmr_schedule_plan_step_list"}},{key:"uiProperties",get:function(){return{table:m["default"].tableProperty(b,{select:!1}),pager:{pageSizes:[10,30,50,100]}}}}]),i}(d["default"]);module.exports=h}),define("bmr/startup",["exports","common/startup","babel-runtime/helpers/interop-require-default","bat-ria/tpl!./common/common.tpl","./tpl_filter","./config","./common/ui/Suite","./common/ui/FlavorNode","./common/ui/GroupPanel","./common/ui/AppCheckBox","./common/ui/AdditionalFile","./common/app/config","./common/flavor/config","./common/reminder/config","./common/step/config","./common/log/config","./common/image/config","./cluster/config","./cluster/detail/config","./template/config","./step/config","./step/detail/config","./step/task/config","./step/attempt/config","./step/diagnosis/config","./schedule_plan/config"],function(exports,e,t,a,n,i,r,l,s,o,u,d,c,p,m,f,b,h,v,g,y,x,T,_,w,k){exports.__esModule=!0,exports.start=function(){return P["default"].start(S["default"])};var P=t["default"](e),S=t["default"](i)}),define("bmr/step/attempt/Attempt",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/ListAction","babel-runtime/helpers/interop-require-default","./AttemptModel","./AttemptView","underscore","../../operation"],function(exports,module,e,t,a,n,i,r,l,s,o){var u=i["default"](n),d=i["default"](r),c=i["default"](l),p=i["default"](s),m=i["default"](o),f=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.initBehavior=function(){n.prototype.initBehavior.call(this),this.view.on("VIEW_LOG",this.viewLog,this)},i.prototype.viewLog=function(e){var t=this.view.get("table").datasource[e.args];return m["default"].viewLog.call(this,p["default"].pick(t,"syslog","stderr","stdout"))},t["default"](i,[{key:"modelType",get:function(){return d["default"]}},{key:"viewType",get:function(){return c["default"]}}]),i}(u["default"]);module.exports=f}),define("bmr/step/attempt/attempt.tpl",[],function(){return'\x3c!-- target: TPL_bmr_step_attempt_child --\x3e\r\n<div class="bmr-step-attempt">\r\n    <p class="inner-breadcrumb">\r\n        <span>Job</span>\r\n        <span class="divider">/</span>\r\n        <a href="#/bmr/step/summary~clusterId=${clusterId}&stepId=${stepId}&jobId=${jobId}">Task总览</a>\r\n        <span class="divider">/</span>\r\n        <span class="active">Attempts</span>\r\n    </p>\r\n    <div class="list-wrap">\r\n        <div class="table-wrap">\r\n            \x3c!-- import: listTableWithCommand --\x3e\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\r\n'}),define("bmr/step/attempt/AttemptModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/ListModel","babel-runtime/helpers/interop-require-default","../../config"],function(exports,module,e,t,a,n,i){var r=function(a){function n(){t["default"](this,n),a.apply(this,arguments)}return e["default"](n,a),n.prototype.listRequester=function(e){return i.api.bmrAttemptsList(e).then(function(e){return{result:e}})},n.prototype.filterQuery=function(e){return delete e.pageNo,e},n}(n["default"](a)["default"]);module.exports=r}),define("bmr/step/attempt/AttemptView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./attempt.tpl","bat-ria/mvc/ListView","babel-runtime/helpers/interop-require-default","common/util/tableUtil","common/util/timeUtil"],function(exports,module,e,t,a,n,i,r,l,s){var o=r["default"](i),u=r["default"](l),d=r["default"](s),c=[{title:"Attempt ID",content:function(e){return'<span class="instance-id">'+e.id+"</span>"}},{title:"状态",content:"state"},{title:"创建时间",content:function(e){return e.createDateTime?d["default"].toTime(e.createDateTime):"-"}},{title:"结束时间",content:function(e){return e.endDateTime?d["default"].toTime(e.endDateTime):"-"}},{title:"操作",content:function(e,t){return e.syslog||e.stdout||e.stderr?'<p class="cmds"><button data-command="VIEW_LOG" data-command-args="'+t+'">查看日志</button></p>':"-"}}],p=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIEvents=function(){var e=this;return u["default"].getListEvents({"table:command":function(t){return e.fire(t.name,t)},"create:click":function(){return e.fire("CREATE_STEP")},"refresh:click":function(t){return e.fire("REFRESH")}})},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_step_attempt"}},{key:"uiProperties",get:function(){return{table:u["default"].tableProperty(c,{select:""})}}}]),i}(o["default"]);module.exports=p}),define("bmr/step/attempt/config",["exports","module","babel-runtime/helpers/class-call-check","er/controller","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t,a){a["default"](t)["default"].registerAction([{type:"bmr/step/attempt/Attempt",path:"/bmr/step/attempt"},{type:"bmr/step/detail/Log",path:"/bmr/attempt/log"}]);module.exports=new function n(){e["default"](this,n)}}),define("bmr/step/config",["exports","module","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","er/controller","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t,a,n){n["default"](a)["default"].registerAction([{type:"bmr/step/List",path:"/bmr/step/list"},{type:"bmr/step/Create",path:"/bmr/step/create"}]);var i=function(){function a(){t["default"](this,a)}return e["default"](a,[{key:"filter",get:function(){return[{name:"作业名称",value:"SEARCH_STEP_NAME"},{name:"作业ID",value:"SEARCH_STEP_ID"}]}},{key:"BMR_LISTEN_INTERVAL",get:function(){return 6e4}}]),a}();module.exports=new i}),define("bmr/step/Create",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/BaseAction","babel-runtime/helpers/interop-require-default","underscore","./CreateModel","./CreateView"],function(exports,module,e,t,a,n,i,r,l,s){var o=i["default"](n),u=i["default"](r),d=i["default"](l),c=i["default"](s),p=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.initBehavior=function(){n.prototype.initBehavior.call(this),this.view.on("CANCEL",this.redirectToList,this),this.view.on("PICK",this.pick,this),this.view.on("PICK_CLUSTER",this.pickCluster,this),this.view.on("REDIRECT_TO_UTL",this.redirectToURL,this)},i.prototype.pickCluster=function(e){var t=this.pickClusterDatasource(e.stepType);this.view.updateCluster(t)},i.prototype.redirectToList=function(){this.redirect("#/bmr/cluster/detail~clusterId="+this.model.get("clusterId"))},i.prototype.pick=function(){var e=this,t=this.view.get("addStepPanel").action;t.redirectAfterSubmit=function(){return e.redirectToURL({url:"#/bmr/step/list"})},t.view.get("form").validateAndSubmit()},i.prototype.redirectToURL=function(e){this.redirect(e.url)},i.prototype.pickClusterDatasource=function(e){var t=this.model.get("clusterDatasource");return u["default"].filter(t,function(t){return u["default"].find(t.stepTypeDatasource,function(t){return t.value===e})})},t["default"](i,[{key:"modelType",get:function(){return d["default"]}},{key:"viewType",get:function(){return c["default"]}}]),i}(o["default"]);module.exports=p}),define("bmr/step/create.tpl",[],function(){return'\x3c!-- target: TPL_bmr_step_create --\x3e\r\n<div class="bmr bmr-step-create main-wrap-new">\r\n    <div class="content-wrap">\r\n        \x3c!--use: TPL_bmr_step_nav(title="创建作业") --\x3e\r\n        <div class="create-content">\r\n            <h1>\r\n                创建作业\r\n            </h1>\r\n            <div class="create-main">\r\n                <div class="detail-parts-table">\r\n                    <dl class="detail-create detail-part-1-col">\r\n                        <dt>\r\n                            <h4>作业参数</h4>\r\n                        </dt>\r\n                        <div data-ui-type="ActionPanel" data-ui-id="addStepPanel"></div>\r\n                    </dl>\r\n                    <dl class="detail-create detail-part-1-col">\r\n                        <dt>\r\n                            <h4>集群适配</h4>\r\n                        </dt>\r\n                        <dd>\r\n                            <label>选择集群：</label>\r\n                            <div data-ui-id="clusterSelect"\r\n                                data-ui-type="Select"\r\n                                data-ui-name="clusterId"></div>\r\n                        </dd>\r\n                        <dd class="btn-group">\r\n                            <button data-ui="id:pick;type:Button;skin:ok;">完成</button>\r\n                            <button data-ui="id:cancel;type:Button;" type="button">取消</button>\r\n                        </dd>\r\n                    </dl>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'}),define("bmr/step/CreateModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/BaseModel","babel-runtime/helpers/interop-require-default","underscore","../enums","../config","../util"],function(exports,module,e,t,a,n,i,r,l,s,o){var u=i["default"](n),d=i["default"](r),c=i["default"](o),p=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.prepare=function(){var e=d["default"].map(this.get("clusterDatasource"),function(e){return{name:e.name,value:e.id,stepTypeDatasource:l.STEP_TYPE.toArray.apply(l.STEP_TYPE,c["default"].pickStepType(e))}});this.set("clusterDatasource",e)},i.prototype.submitStep=function(e){return s.api.bmrStepCreate(e)},t["default"](i,[{key:"submitRequester",get:function(){return s.api.bmrStepCreate}},{key:"datasource",get:function(){return{clusterDatasource:function(){return s.api.bmrClusterList({clusterStates:[l.CLUSTER_STATUS.Resizing,l.CLUSTER_STATUS.Running,l.CLUSTER_STATUS.Waiting,l.CLUSTER_STATUS.Starting]})},copyStepData:function(e){var t=e.get("clusterId"),a=e.get("stepId");if(t&&a)return s.api.bmrStepDetail({stepId:a,clusterId:t})},stepType:function(){return l.STEP_TYPE.Streaming},ENUM_STEP_TYPE:function(){return l.STEP_TYPE}}}}]),i}(u["default"]);module.exports=p}),define("bmr/step/CreateView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./create.tpl","bat-ria/mvc/BaseView","babel-runtime/helpers/interop-require-default","underscore","er/locator","../enums"],function(exports,module,e,t,a,n,i,r,l,s,o){var u=r["default"](i),d=r["default"](l),c=r["default"](s),p=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIProperties=function(){var e=this,t=this.model.get("copyStepData");return{clusterSelect:{datasource:[]},addStepPanel:{url:"/bmr/common/step/add",actionOptions:{stepTypeDatasource:o.STEP_TYPE.toArray(),editData:t,requester:function(t){return e.model.submitStep(e.mergeQueryData(t))}}}}},i.prototype.getUIEvents=function(){var e=this;return{"pick:click":function(){return e.fire("PICK")},"cancel:click":function(){return c["default"].redirect("#/bmr/step/list")},"addStepPanel:action@PICK_CLUSTER":function(t){return e.fire("PICK_CLUSTER",t)}}},i.prototype.updateCluster=function(){var e=this,t=arguments.length<=0||arguments[0]===undefined?[]:arguments[0];0===t.length&&(this.waitConfirm({title:"提示",content:"您选择的作业类型没有适配的运行集群，想要新建一个集群吗？"}).then(function(){return e.fire("REDIRECT_TO_UTL",{url:"/bmr/cluster/create"})},function(){return e.get("pick").disable()}),t.push({name:"作业类型没有适配的集群",value:""})),this.get("clusterSelect").updateDatasource(t),this.get("pick").enable()},i.prototype.mergeQueryData=function(e){return d["default"].extend(e,{clusterId:this.get("clusterSelect").getValue()})},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_step_create"}}]),i}(u["default"]);module.exports=p}),define("bmr/step/detail/config",["exports","module","babel-runtime/helpers/class-call-check","er/controller","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t,a){a["default"](t)["default"].registerAction([{type:"bmr/step/detail/Detail",path:"/bmr/step/detail"},{type:"bmr/step/detail/Log",path:"/bmr/step/log"}]);module.exports=new function n(){e["default"](this,n)}}),define("bmr/step/detail/Detail",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/BaseAction","babel-runtime/helpers/interop-require-default","underscore","./DetailModel","./DetailView"],function(exports,module,e,t,a,n,i,r,l,s){var o=i["default"](n),u=i["default"](r),d=i["default"](l),c=i["default"](s),p=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.initBehavior=function(){n.prototype.initBehavior.call(this),this.view.on("REFRESH",this.reload,this),this.view.on("DISGNOSE",this.disgnose,this),this.view.on("PROFILING",this.profiling,this)},i.prototype.disgnose=function(e){var t=u["default"].find(this.view.get("jobGroup").datasource,function(t){return t.id===e.args});this.view.waitActionDialog({title:"诊断",width:1e3,url:"/bmr/step/diagnose",actionOptions:t})},i.prototype.profiling=function(e){var t=u["default"].find(this.view.get("jobGroup").datasource,function(t){return t.id===e.args});this.view.waitActionDialog({title:"调优",width:1e3,url:"/bmr/step/profiling",actionOptions:t})},t["default"](i,[{key:"modelType",get:function(){return d["default"]}},{key:"viewType",get:function(){return c["default"]}}]),i}(o["default"]);module.exports=p}),define("bmr/step/detail/detail.tpl",[],function(){return'\x3c!-- target: TPL_bmr_step_detail --\x3e\n<div class="bmr bmr-step-detail bmr-main-wrap main-wrap-new">\n    \x3c!-- use: TPL_bmr_side_bar(menu="step") --\x3e\n    <div class="content-wrap">\n        \x3c!-- use: TPL_bmr_step_nav(title="作业详情") --\x3e\n        \x3c!-- import: TPL_bmr_step_detail_header --\x3e\n        <div class="detail-content">\n            \x3c!--import: TPL_bmr_step_detail_tab --\x3e\n            <div class="ui-tab-content">\n                <div class="detail-parts-table">\n                    <dl class="detail-part-1-col">\n                        <dt><h4>基本信息</h4></dt>\n                        <dd>\n                            <div class="detail-cell">\n                                <label>作业ID：</label>\n                                <span>${stepDetail.id}</span>\n                            </div>\n                            <div class="detail-cell">\n                                <label>作业名称：</label>\n                                <span class="cell-block">${stepDetail.name}</span>\n                            </div>\n                        </dd>\n                        <dd>\n                            <div class="detail-cell">\n                                <label>作业类型：</label>\n                                <span>${stepDetail.type}</span>\n                            </div>\n                            <div class="detail-cell">\n                                <label>运行状态：</label>\n                                <span class="status ${stepDetail.status.state.klass}">\n                                    ${stepDetail.status.state.text}\n                                </span>\n                            </div>\n                        </dd>\n                        <dd>\n                            <div class="detail-cell">\n                                <label>创建时间：</label>\n                                <span>${stepDetail.status.creationDateTime|formatTime}</span>\n                            </div>\n                            <div class="detail-cell">\n                                <label>运行时间：</label>\n                                <span>\n                                    ${stepDetail.status.startDateTime|bmrTimeDiff(${stepDetail.status.endDateTime})}分钟\n                                </span>\n                            </div>\n                        </dd>\n                        <dd>\n                            <div class="detail-cell">\n                                <label for="">失败后操作：</label>\n                                <span>${stepDetail.actionOnFailure.text}</span>\n                            </div>\n                        </dd>\n                        <dd>\n                            <div class="detail-cell table-content">\n                                <label>运行参数：</label>\n                                <div>\n                                ${*stepDetail | bmrFormatStepProperties}\n                                </div>\n                            </div>\n                        </dd>\n\n                    </dl>\n                    <dl class="detail-part-1-col">\n                        <dt>\n                            <h4>Job详情</h4>\n                        </dt>\n                        <dd>\n                            <div data-ui="type:GroupPanel;id:jobGroup;"\n                                data-ui-extension-command-type="Command">\n                            </div>\n                        </dd>\n                    </dl>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("bmr/step/detail/DetailModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/BaseModel","babel-runtime/helpers/interop-require-default","underscore","../../config","../../enums"],function(exports,module,e,t,a,n,i,r,l,s){var o=i["default"](n),u=i["default"](r),d=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),t["default"](i,[{key:"defaultArgs",get:function(){return{pageSize:10}}},{key:"datasource",get:function(){return{detailActive:function(){return"ui-tab-item-active"},stepDetail:function(e){return l.api.bmrStepDetail({stepId:e.get("stepId"),clusterId:e.get("clusterId")}).then(function(e){return e.status.state=s.STEP_STATUS.fromValue(e.status.state),e.actionOnFailure=s.STEP_ACTION_ON_FAILURE.fromValue(e.actionOnFailure),e})},jobList:function(e){return l.api.bmrJobList({stepId:e.get("stepId"),clusterId:e.get("clusterId")}).then(function(e){return u["default"].each(e,function(e){return e.state=s.JOB_STATUS.fromValue(e.state)})})}}}}]),i}(o["default"]);module.exports=d}),define("bmr/step/detail/DetailView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./detail.tpl","bat-ria/mvc/BaseView","babel-runtime/helpers/interop-require-default","etpl","er/URL","common/util/tableUtil","./config"],function(exports,module,e,t,a,n,i,r,l,s,o,u){var d=r["default"](i),c=r["default"](l),p=r["default"](s),m=r["default"](o),f=r["default"](u),b=[{title:"实例ID",content:function(e){return'<span class="instance-id">'+e.id+"</span>"}},{title:"实例状态",content:function(e){return'<p class="status '+e.status.state.klass+'">'+e.status.state.text+"</p>"}},{title:"实例类型",content:function(e){var t=f["default"].findFlavorType(e.instanceConfig.name);return e.type+"("+t.text+")"}},{title:"公网IP/内网IP",content:function(e){return(e.publicIpAddress||"未分配")+"(公)<br/>"+(e.privateIpAddress||"-")+"(内)"}},{title:"硬件配置",content:function(e){return"cpu："+e.instanceConfig.cpu+"核 |\n            内存："+e.instanceConfig.memory+"GB<br/>硬盘："+e.instanceConfig.disk+"GB"}}],h=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIProperties=function(){var e=this;return{table:m["default"].tableProperty(b,{select:"",datasource:"@instancesList"}),jobGroup:{datasource:"@jobList",allowArrow:function(e){return"launcher"!==e.type},renderHeader:this.renderHeader,loadAction:function(t){return{url:p["default"].withQuery("/bmr/step/summary",{clusterId:e.model.get("clusterId"),stepId:e.model.get("stepId"),jobId:t.id})}}}}},i.prototype.getUIEvents=function(){var e=this;return{"refresh:click":function(){return e.fire("REFRESH")},"jobGroup:command":function(t){return e.fire(t.name,t)}}},i.prototype.renderHeader=function(e){var t=['<p>Job ID：${id}<span class="separate">|</span>创建时间：${createDateTime|formatTime}','<span class="separate">|</span>结束时间：${endDateTime|formatTime}','<span class="separate">|</span>状态：<span class="status ${state.klass}">${state.text}</span>','<span class="separate"></span>'];return e.diagnose&&t.push('<a data-ui-type="Button" data-command="DISGNOSE" data-command-args="${id}">诊断</a>'),(e.profiling||e.counter)&&t.push('<a data-ui-type="Button" data-command="PROFILING" data-command-args="${id}">调优</a>'),c["default"].compile(t.join(""))(e)},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_step_detail"}}]),i}(d["default"]);module.exports=h}),define("bmr/step/detail/Log",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/BaseAction","babel-runtime/helpers/interop-require-default","./LogModel","./LogView"],function(exports,module,e,t,a,n,i,r,l){var s=i["default"](n),o=i["default"](r),u=i["default"](l),d=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.initBehavior=function(){n.prototype.initBehavior.call(this),this.view.on("REFRESH",this.reload,this)},t["default"](i,[{key:"modelType",get:function(){return o["default"]}},{key:"viewType",get:function(){return u["default"]}}]),i}(s["default"]);module.exports=d}),define("bmr/step/detail/log.tpl",[],function(){return'\x3c!-- target: TPL_bmr_step_log_list --\x3e\n<div class="bmr bmr-step-log bmr-main-wrap main-wrap-new">\n    \x3c!-- use: TPL_bmr_side_bar(menu="step") --\x3e\n    <div class="content-wrap">\n        \x3c!-- use: TPL_bmr_step_nav(title="作业日志") --\x3e\n        \x3c!-- import: TPL_bmr_step_detail_header --\x3e\n        <div class="detail-content">\n            \x3c!-- import: TPL_bmr_step_detail_tab --\x3e\n            <div class="ui-tab-content">\n                <div data-ui-type="ActionPanel" data-ui-id="logPanel"></div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("bmr/step/detail/LogModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/BaseModel","babel-runtime/helpers/interop-require-default","underscore","../../config","../../enums"],function(exports,module,e,t,a,n,i,r,l){var s=n["default"](a),o=n["default"](i),u=function(a){function n(){t["default"](this,n),a.apply(this,arguments)}return e["default"](n,a),n.prototype.getDatasource=function(){return{logActive:function(){return"ui-tab-item-active"},stepDetail:function(e){return r.api.bmrStepDetail({stepId:e.get("stepId"),clusterId:e.get("clusterId")}).then(function(e){return e.status.state=l.STEP_STATUS.fromValue(e.status.state),e})}}},n.prototype.prepare=function(){var e=this.get("stepDetail");this.set("tabDatasource",o["default"].map(o["default"].pick(e,"stderr","stdout","syslog"),function(e){return{title:e,panel:e}}))},n}(s["default"]);module.exports=u}),define("bmr/step/detail/LogView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./log.tpl","bat-ria/mvc/BaseView","babel-runtime/helpers/interop-require-default","underscore"],function(exports,module,e,t,a,n,i,r,l){var s=r["default"](i),o=r["default"](l),u=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIProperties=function(){return{logPanel:{url:"/bmr/common/log",actionOptions:o["default"].defaults(o["default"].pick(this.model.get("stepDetail"),"stdout","stderr","syslog"),{tip:"（“作业日志”内容为执行日志，不是具体Map和Reduce日志）"})}}},i.prototype.getUIEvents=function(){var e=this;return{"refresh:click":function(){return e.fire("REFRESH")}}},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_step_log_list"}}]),i}(s["default"]);module.exports=u}),define("bmr/step/diagnosis/config",["exports","module","babel-runtime/helpers/class-call-check","er/controller","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t,a){a["default"](t)["default"].registerAction([{type:"bmr/step/diagnosis/Diagnose",path:"/bmr/step/diagnose"},{type:"bmr/step/diagnosis/Profiling",path:"/bmr/step/profiling"}]);module.exports=new function n(){e["default"](this,n)}}),define("bmr/step/diagnosis/Diagnose",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/ListAction","babel-runtime/helpers/interop-require-default","./DiagnoseModel","./DiagnoseView"],function(exports,module,e,t,a,n,i,r,l){var s=i["default"](n),o=i["default"](r),u=i["default"](l),d=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),t["default"](i,[{key:"modelType",get:function(){return o["default"]}},{key:"viewType",get:function(){return u["default"]}}]),i}(s["default"]);module.exports=d}),define("bmr/step/diagnosis/diagnose.tpl",[],function(){return'\x3c!-- target: TPL_bmr_step_diagnose_child --\x3e\r\n<div class="bmr-step-diagnosis">\r\n    \x3c!-- import: listTableWithCommand --\x3e\r\n</div>\r\n\r\n\r\n'}),define("bmr/step/diagnosis/DiagnoseModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/ListModel","babel-runtime/helpers/interop-require-default","../../config"],function(exports,module,e,t,a,n,i){var r=function(a){function n(){t["default"](this,n),a.apply(this,arguments)}return e["default"](n,a),n.prototype.listRequester=function(e){return this.getDiagnoseData(e)},n.prototype.filterQuery=function(e){return delete e.pageNo,e},n.prototype.getDiagnoseData=function(){var e=this.get("diagnose").split("/").splice(2);return i.api.bmrAnalysisData({bucketName:e[0],objectName:e.splice(1).join("/"),limit:5e3}).then(function(e){return{result:e}})},n}(n["default"](a)["default"]);module.exports=r}),define("bmr/step/diagnosis/DiagnoseView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./diagnose.tpl","bat-ria/mvc/ListView","babel-runtime/helpers/interop-require-default","common/util/tableUtil"],function(exports,module,e,t,a,n,i,r,l){var s=r["default"](i),o=r["default"](l),u=[{title:"问题名称",content:"title"},{title:"数量",content:"count"},{title:"原因",content:"reason"},{title:"建议",content:"advise"}],d=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIEvents=function(){return{}},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_step_diagnose"}},{key:"uiProperties",get:function(){return{table:o["default"].tableProperty(u,{select:""})}}}]),i}(s["default"]);module.exports=d}),define("bmr/step/diagnosis/Profiling",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/BaseAction","babel-runtime/helpers/interop-require-default","./ProfilingModel","./ProfilingView"],function(exports,module,e,t,a,n,i,r,l){var s=i["default"](n),o=i["default"](r),u=i["default"](l),d=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),t["default"](i,[{key:"modelType",get:function(){return o["default"]}},{key:"viewType",get:function(){return u["default"]}}]),i}(s["default"]);module.exports=d}),define("bmr/step/diagnosis/profiling.tpl",[],function(){return'\x3c!-- target: TPL_bmr_step_profiling_child --\x3e\r\n<div class="bmr-step-profiling">\r\n    <div class="list-wrap">\r\n        <div class="ui-tab-content">\r\n            <esui-tab data-ui-id="smartTab" class="ui-smart-tab">\r\n                <ul data-role="navigator">\r\n                    <li data-for="profiling">Profiling</li>\r\n                    <li data-for="counter">Counter</li>\r\n                </ul>\r\n                <div id="profiling">\r\n                    <div class="table-wrap">\r\n                        <div data-ui-type="Table" data-ui-id="profilingTable" data-ui-datasource="@tableData"\r\n                            data-ui-order-by="@orderBy" data-ui-order="@order" data-ui-select="@selectMode"\r\n                            data-ui-extension-tip-type="TableTip">\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div id="counter">\r\n                    <div class="table-wrap">\r\n                        <div data-ui-type="Table" data-ui-id="counterTable" data-ui-datasource="@tableData"\r\n                            data-ui-order-by="@orderBy" data-ui-order="@order" data-ui-select="@selectMode"\r\n                            data-ui-extension-tip-type="TableTip">\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </esui-tab>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\r\n\r\n'}),define("bmr/step/diagnosis/ProfilingModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/BaseModel","babel-runtime/helpers/interop-require-default","../../config"],function(exports,module,e,t,a,n,i){var r=function(a){function n(){t["default"](this,n),a.apply(this,arguments)}return e["default"](n,a),n.prototype.getDatasource=function(){var e=this;return{profilingTableData:function(){return e.getDiagnoseData("profiling")},counterTableData:function(){return e.getDiagnoseData("counter")}}},n.prototype.getDiagnoseData=function(e){var t=this.get(e).split("/").splice(2);return i.api.bmrAnalysisData({bucketName:t[0],objectName:t.splice(1).join("/"),limit:5e3})},n}(n["default"](a)["default"]);module.exports=r}),define("bmr/step/diagnosis/ProfilingView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./profiling.tpl","bat-ria/mvc/ListView","babel-runtime/helpers/interop-require-default","common/util/tableUtil"],function(exports,module,e,t,a,n,i,r,l){var s=r["default"](i),o=r["default"](l),u=[{title:"问题名称",stable:!0,width:100,content:"title"},{title:"结果",stable:!0,width:80,content:"test_result"},{title:"严重性",stable:!0,width:80,content:"severity"},{title:"参考",content:"references"},{title:"调优建议",content:"prescription"}],d=[{title:"Counters",content:"title"},{title:"MAP",content:"map"},{title:"REDUCE",content:"reduce"},{title:"TOTAL",content:"total"}],c=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),t["default"](i,[{key:"template",get:function(){return"TPL_bmr_step_profiling"}},{key:"uiProperties",get:function(){return{profilingTable:o["default"].tableProperty(u,{select:"",datasource:"@profilingTableData"}),counterTable:o["default"].tableProperty(d,{select:"",datasource:"@counterTableData"})}}}]),i}(s["default"]);module.exports=c}),define("bmr/step/List",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","er/URL","babel-runtime/helpers/interop-require-default","./ListView","./ListModel","../config","./config","../common/mvc/ListAction"],function(exports,module,e,t,a,n,i,r,l,s,o){var u=n["default"](a),d=n["default"](i),c=n["default"](r),p=function(a){function n(e){t["default"](this,n),a.call(this,e),this.modelType=c["default"],this.viewType=d["default"]}return e["default"](n,a),n.prototype.initBehavior=function(){var e=this;a.prototype.initBehavior.call(this),this.view.on(l.events.COPY,this.copy,this),this.view.on(l.events.CANCEL,this.cancel,this),this.view.on(l.events.REFRESH,this.reload,this),this.view.on("CREATE_STEP",this.redirectToCreate,this),this.timer=setInterval(function(){return e.reload()},s.BMR_LISTEN_INTERVAL),this.on("beforeleave",function(){return clearInterval(e.timer)})},n.prototype.redirectToCreate=function(){var e=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];this.redirect(u["default"].withQuery("#/bmr/step/create",e))},n.prototype.cancel=function(e){var t=this,a=this.view.get("table").datasource[e.args];this.model.stopStep({stepId:a.id,clusterId:a.clusterId}).then(function(){return t.showTotast("操作成功")}).ensure(function(){return t.reload()})},n.prototype.copy=function(e){var t=this.view.get("table").datasource[e.args];this.redirectToCreate({stepId:t.id,clusterId:t.clusterId})},n}(n["default"](o)["default"]);module.exports=p}),define("bmr/step/list.tpl",[],function(){return'\x3c!-- target: TPL_bmr_step_list --\x3e\n<div class="bmr bmr-step-list bmr-main-wrap main-wrap-new">\n    \x3c!-- use: TPL_bmr_side_bar(menu="step") --\x3e\n    <div class="content-wrap">\n        \x3c!-- import: TPL_bmr_step_nav --\x3e\n        <div class="list-content">\n            <h2>\n                作业列表\n                \x3c!-- import: TPL_realname_tip --\x3e\n            </h2>\n            <div class="table-full-wrap">\n                <div class="operation-wrap">\n                    <div class="buttons-wrap">\n                        <button data-ui="id:create;type:Button;skin:create"\n                            data-auth="verifiedUser"\n                            data-authtype="READONLY">创建作业</button>\n                    </div>\n                    <div class="buttons-quick-wrap">\n                        \x3c!-- import: TPL_bmr_common_search --\x3e\n                        <button data-ui-id="refresh" data-ui-type="Button" data-ui-skin="refresh"></button>\n                    </div>\n                </div>\n                \x3c!-- import: listTableWithCommand --\x3e\n                <div class="ui-row clearfix">\n                    \x3c!-- import: listPager --\x3e\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("bmr/step/ListModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","../config","../common/mvc/ListModel"],function(exports,module,e,t,a,n,i,r){var l=n["default"](a),s=function(a){function n(){t["default"](this,n),a.apply(this,arguments)}return e["default"](n,a),n.prototype.listRequester=function(e,t){return i.api.bmrStepList(e,t).then(function(e){return l["default"].each(e.result,function(e){e.status.state=i.enums.STEP_STATUS.fromValue(e.status.state)}),e})},n.prototype.stopStep=function(e){return i.api.bmrStepCancel(e)},n}(n["default"](r)["default"]);module.exports=s}),define("bmr/step/ListView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","common/util/tableUtil","./config","bat-ria/tpl!./list.tpl","../common/mvc/ListView","../config"],function(exports,module,e,t,a,n,i,r,l,s,o,u){var d=i["default"](n),c=i["default"](r),p=[{title:"作业名称/ID",content:function(e){return u.html.table.tableId({name:e.name,id:e.id,url:"#/bmr/step/detail~stepId="+e.id+"&clusterId="+e.clusterId})}},{title:"集群ID",content:function(e){return'<a class="instance-id" href="#/bmr/cluster/detail~clusterId='+e.clusterId+'">\n            '+d["default"].escape(e.clusterId)+"</a>"}},{title:"状态",content:function(e){return u.html.table.tableState(e.status.state)}},{title:"启动时间",content:function(e){return u.helper.toTime(e.status.creationDateTime)||"-"}},{title:"运行时间(分钟)",content:function(e){return u.helper.timeDiff(e.status.startDateTime,e.status.endDateTime)}},{title:"操作",content:function(e,t){return u.html.table.linkButton({label:"复制",title:"复制作业",command:u.events.COPY,commandArgs:t})+u.html.table.linkButton({label:"终止",title:"终止作业",command:u.events.CANCEL,disabled:!u.permission.allowStopStep(e.status.state.permission),commandArgs:t})}}],m=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIEvents=function(){var e=this;return d["default"].extend(n.prototype.getUIEvents.call(this),{"refresh:click":function(){return e.triggerCommand(u.events.REFRESH)},"create:click":function(){return e.triggerCommand("CREATE_STEP")}})},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_step_list"}},{key:"uiProperties",get:function(){return{table:c["default"].tableProperty(p,{select:"",noDataHtml:u.html.table.noDataHtml({title:"你还没创建作业！",url:"#/bmr/step/create"})}),pager:{pageSizes:[10,30,50,100]},keywordType:{datasource:l.filter},keyword:{placeholder:"请输入"+l.filter[0].name+"进行搜索"}}}},{key:"confirmEventMap",get:function(){var e;return e={},e[u.events.CANCEL]="您确定取消作业吗？",e}}]),i}(i["default"](o)["default"]);module.exports=m}),define("bmr/step/task/config",["exports","module","babel-runtime/helpers/class-call-check","er/controller","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t,a){a["default"](t)["default"].registerAction([{type:"bmr/step/task/Summary",path:"/bmr/step/summary"},{type:"bmr/step/task/TaskList",path:"/bmr/step/tasklist"}]);module.exports=new function n(){e["default"](this,n)}}),define("bmr/step/task/Summary",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/ListAction","babel-runtime/helpers/interop-require-default","er/URL","./SummaryModel","./SummaryView"],function(exports,module,e,t,a,n,i,r,l,s){var o=i["default"](n),u=i["default"](r),d=i["default"](l),c=i["default"](s),p=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.initBehavior=function(){n.prototype.initBehavior.call(this),this.view.on("VIEW_TASK",this.redirectToTask,this)},i.prototype.redirectToTask=function(e){this.redirect(u["default"].withQuery("#/bmr/step/tasklist",{clusterId:this.model.get("clusterId"),stepId:this.model.get("stepId"),jobId:this.model.get("jobId")})+"&"+e.args)},t["default"](i,[{key:"modelType",get:function(){return d["default"]}},{key:"viewType",get:function(){return c["default"]}}]),i}(o["default"]);module.exports=p}),define("bmr/step/task/summary.tpl",[],function(){return'\x3c!-- target: TPL_bmr_step_task_summary_child --\x3e\r\n<div class="bmr-step-task-summary">\r\n    <p class="inner-breadcrumb">\r\n        <span>Job</span>\r\n        <span class="divider">/</span>\r\n        <span class="active">Task总览</span>\r\n    </p>\r\n    <div class="list-wrap">\r\n        <div class="table-wrap">\r\n            <div class="actionwrap-bottom">\r\n                <div class="table-warp">\r\n                    \x3c!-- import: listTableWithCommandAndSubrow --\x3e\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n'}),define("bmr/step/task/SummaryModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","bat-ria/mvc/ListModel","babel-runtime/helpers/interop-require-default","../../config"],function(exports,module,e,t,a,n,i){var r=function(a){function n(){t["default"](this,n),a.apply(this,arguments)}return e["default"](n,a),n.prototype.listRequester=function(e){return i.api.bmrTaskSummaryList(e).then(function(e){return{result:e}})},n.prototype.filterQuery=function(e){return delete e.pageNo,e},n}(n["default"](a)["default"]);module.exports=r}),define("bmr/step/task/SummaryView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./summary.tpl","bat-ria/mvc/ListView","babel-runtime/helpers/interop-require-default","etpl","common/util/tableUtil"],function(exports,module,e,t,a,n,i,r,l,s){var o=r["default"](i),u=r["default"](l),d=r["default"](s),c=function(e,t){var a="type="+e.type+(t?"&state="+t:""),n=t?e.statesCount[t]||0:e.totalNum;return 0==+n?n:u["default"].compile('<p class="cmds"><button data-command="${command}" data-command-args="${args}">${text}</button></p>')({command:"VIEW_TASK",args:a,text:n})},p=[{title:"种类",content:function(e){return e.type}},{title:"全部任务",content:function(e){return c(e)}},{title:"新建任务",content:function(e){return c(e,"NEW")}},{title:"启动任务",content:function(e){return c(e,"SCHEDULED")}},{title:"成功任务",content:function(e){return c(e,"SUCCEEDED")}},{title:"运行任务",content:function(e){return c(e,"RUNNING")}},{title:"失败任务",content:function(e){return c(e,"FAILED")}},{title:"等待任务",content:function(e){return c(e,"KILL_WAIT")}},{title:"终止任务",content:function(e){return c(e,"KILLED")}}],m=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIEvents=function(){var e=this;return d["default"].getListEvents({"table:command":function(t){return e.fire(t.name,t)},"create:click":function(){return e.fire("CREATE_STEP")},"refresh:click":function(t){return e.fire("REFRESH")}})},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_step_task_summary"}},{key:"uiProperties",get:function(){return{table:d["default"].tableProperty(p,{select:""})}}}]),i}(o["default"]);module.exports=m}),define("bmr/step/task/task.tpl",[],function(){return'\x3c!-- target: TPL_bmr_step_tasklist_child --\x3e\r\n<div class="bmr-step-tasklist">\r\n    <p class="inner-breadcrumb">\r\n        <span>Job</span>\r\n        <span class="divider">/</span>\r\n        <a href="#/bmr/step/summary~clusterId=${clusterId}&stepId=${stepId}&jobId=${jobId}">Task总览</a>\r\n        <span class="divider">/</span>\r\n        <span class="active">Task</span>\r\n    </p>\r\n    <div class="list-wrap">\r\n        <div class="table-wrap">\r\n            \x3c!-- import: listTableWithCommand --\x3e\r\n            <div class="ui-row clearfix">\r\n                \x3c!-- import: listPager --\x3e\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\r\n'}),define("bmr/step/task/TaskList",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","er/URL","babel-runtime/helpers/interop-require-default","underscore","bat-ria/mvc/ListAction","./TaskModel","./TaskView"],function(exports,module,e,t,a,n,i,r,l,s,o){var u=i["default"](n),d=i["default"](r),c=i["default"](l),p=i["default"](s),m=i["default"](o),f=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.initBehavior=function(){n.prototype.initBehavior.call(this),this.view.on("VIEW_ATTEMPT",this.redirectToAttempt,this)},i.prototype.redirectToAttempt=function(e){this.redirect(u["default"].withQuery("#/bmr/step/attempt",{clusterId:this.model.get("clusterId"),stepId:this.model.get("stepId"),jobId:this.model.get("jobId"),taskId:e.args}))},i.prototype.redirectForSearch=function(e){var t=this.model.getQuery();return n.prototype.redirectForSearch.call(this,d["default"].extend(t,e))},t["default"](i,[{key:"modelType",get:function(){return p["default"]}},{key:"viewType",get:function(){return m["default"]}}]),i}(c["default"]);module.exports=f}),define("bmr/step/task/TaskModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/ListModel","babel-runtime/helpers/interop-require-default","../../config"],function(exports,module,e,t,a,n,i,r){var l=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),t["default"](i,[{key:"listRequester",get:function(){return r.api.bmrStepTasksList}},{key:"defaultArgs",get:function(){return{pageSize:10}}}]),i}(i["default"](n)["default"]);module.exports=l}),define("bmr/step/task/TaskView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./task.tpl","bat-ria/mvc/ListView","babel-runtime/helpers/interop-require-default","etpl","common/util/tableUtil","common/util/timeUtil"],function(exports,module,e,t,a,n,i,r,l,s,o){var u=r["default"](i),d=r["default"](l),c=r["default"](s),p=r["default"](o),m=[{title:"TaskID",content:function(e){return'<p class="instance-id">'+e.id+"</p>"}},{title:"类型",content:"type"},{title:"状态",content:"state"},{title:"调度时间",minWidth:250,content:function(e){return"<p>创建时间："+p["default"].toTime(e.createDateTime)+"</p>\n            <p>结束时间："+(e.endDateTime?p["default"].toTime(e.endDateTime):"-")+"</p>"}},{title:"操作",content:function(e){var t='<p class="cmds">';return t+=d["default"].compile('<button data-command="${command}" data-command-args="${args}">${text}</button>')({command:"VIEW_ATTEMPT",args:e.id,text:"查看Attempt"}),t+="</p>"}}],f=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIProperties=function(){return{table:c["default"].tableProperty(m,{select:""}),pager:{pageSizes:[10,30,50,100]}}},i.prototype.getUIEvents=function(){var e=this;return{"table:command":function(t){return e.fire(t.name,t)}}},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_step_tasklist"}}]),i}(u["default"]);module.exports=f}),define("bmr/storage",["exports","underscore","babel-runtime/helpers/interop-require-default","common/storage"],function(exports,e,t,a){exports.__esModule=!0,exports.update=function(){var e=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],t=i["default"].get("bmr")||{};i["default"].set("bmr",n["default"].extend(t,e))},exports.clear=function(){i["default"].set("bmr",{})},exports.get=function(){var e=arguments.length<=0||arguments[0]===undefined?"":arguments[0];return(i["default"].get("bmr")||{})[e]},exports.remove=function(){var e=arguments.length<=0||arguments[0]===undefined?"":arguments[0],t=i["default"].get("bmr")||{};delete t[e],i["default"].set("bmr",t)};var n=t["default"](e),i=t["default"](a)}),define("bmr/template/config",["exports","module","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","er/controller","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t,a,n){n["default"](a)["default"].registerAction([{type:"bmr/template/List",path:"/bmr/template/list"},{type:"bmr/template/create/Create",path:"/bmr/template/create"},{type:"bmr/template/Detail",path:"/bmr/template/detail"}]);var i=function(){function a(){t["default"](this,a)}return e["default"](a,[{key:"filter",get:function(){return[{name:"模板名称",value:"SEARCH_TEMPLATE_NAME"},{name:"模板ID",value:"SEARCH_TEMPLATE_ID"}]}}]),a}();module.exports=new i}),define("bmr/template/create/Create",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/BaseAction","babel-runtime/helpers/interop-require-default","underscore","./CreateModel","./CreateView"],function(exports,module,e,t,a,n,i,r,l,s){var o=i["default"](n),u=i["default"](r),d=i["default"](l),c=i["default"](s),p=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.initBehavior=function(){n.prototype.initBehavior.call(this),this.view.on("PICK",this.pick,this),this.view.on("REDIRECT_TO_LIST",this.redirectToList,this),this.model.isCopy()&&this.view.asyncFormState()},i.prototype.pick=function(){var e=this,t={name:this.view.get("clusterName").getValue(),sendMessage:this.view.get("smsToggle").isChecked(),alarmEnabled:this.view.get("alarmToggle").isChecked(),availabilityZone:this.view.get("availabilityZone").getValue(),availabilityZone:this.view.get("availabilityZone").getValue(),vpcId:this.view.get("vpcId").getValue(),subnetId:this.view.get("subnetId").getValue(),systemSecurityGroup:this.view.get("systemSecurityGroup").getValue(),autoTerminate:this.view.get("autoTerminateToggle").isChecked(),logUri:this.view.get("logToggle").isChecked()?this.view.get("logUri").getValue():null},a=this.view.get("appPanel").action.getFormData();u["default"].extend(t,u["default"].pick(a,"imageType","imageVersion","applications")),u["default"].extend(t,this.view.get("flavorPanel").action.getFormData()),u["default"].extend(t,{reminder:this.view.get("reminderPanel").action.getFormData()}),this.view.validate()&&this.model.submit(t).then(function(){return e.redirectToList()})},i.prototype.redirectToList=function(){return this.redirect("/bmr/template/list")},t["default"](i,[{key:"modelType",get:function(){return d["default"]}},{key:"viewType",get:function(){return c["default"]}}]),i}(o["default"]);module.exports=p}),define("bmr/template/create/create.tpl",[],function(){return'\x3c!-- target: TPL_bmr_template_create --\x3e\n<div class="bmr bmr-template-create main-wrap-new">\n    <div class="content-wrap">\n        \x3c!-- use: TPL_bmr_template_nav(title="创建模板") --\x3e\n        <div class="create-content">\n            <h1>\n                创建模板\n                <p class="realname-tip"\n                    data-ui-type="ToastLabel"\n                    data-ui-message-type="alert"\n                    data-ui-hidden="true"\n                    data-auth="verifiedUser"\n                    data-authtype="SHOW">\n                </p>\n            </h1>\n            <div class="create-main">\n                <div class="detail-parts-table">\n                    <dl class="detail-create detail-part-1-col">\n                        <dt>\n                            <h4>集群基础设置</h4>\n                        </dt>\n                        <dd>\n                            <label class="require-label">模板名称：</label>\n                            <div>\n                                <div data-ui-id="clusterName" data-ui-type="TextBox"></div>\n                            </div>\n                        </dd>\n                        <dd>\n                            <label class="required-label">区域：</label>\n                            <div>\n                                <div data-ui-type="Select"\n                                    data-ui-id="availabilityZone"\n                                    data-ui-name="availabilityZone"></div>\n                            </div>\n                        </dd>\n                        <dd>\n                            <label>日志：</label>\n                            <div>\n                            <div data-ui-id="logToggle" data-ui-type="ToggleButton"></div>\n                                <span class="row-tip">日志可以支持作业自助诊断调优和集群高可用。</span>\n                                <div data-ui-id="logPanel" data-ui-type="Panel" class="log-panel">\n                                    <div data-ui-type="BucketSelect"\n                                        data-ui-id="logUri"\n                                        data-ui-extension-bucketselect-type="BucketSelectEx">\n                                    </div>\n                                    <p class="row-tip">\n                                        bos://&lt;bucket-name&gt;/&lt;folder&gt;，bucket必须存在，如不存在，请新建;folder可不存在，如不存在，系统会自动创建\n                                    </p>\n                                </div>\n                                <p class="advance-link"\n                                    data-ui-id="advance"\n                                    data-ui-type="Button"\n                                    data-ui-skin="stringfy">\n                                    <i class="iconfont icon-downarrow"></i>\n                                    高级设置\n                                </p>\n                            </div>\n                        </dd>\n                        <dd class="advance-setting">\n                            <label>短信开关：</label>\n                            <div>\n                                <div data-ui-id="smsToggle" data-ui-type="ToggleButton"></div>\n                                <span class="row-tip">是否启用免费短信提醒服务，启动后系统将发送报警短信给指定的联系人</span>\n                            </div>\n                        </dd>\n                        <dd class="advance-setting">\n                            <label>常用报警策略：</label>\n                            <div>\n                                <div data-ui-id="alarmToggle" data-ui-type="ToggleButton"></div>\n                                <span class="row-tip">当监控项超过阈值时，系统将会发送报警短信和邮件给指定的联系人 。</span>\n                            </div>\n                        </dd>\n                        <dd class="advance-setting">\n                            <label>自动终止：</label>\n                            <div>\n                                <div data-ui-id="autoTerminateToggle" data-ui-type="ToggleButton"></div>\n                                <span class="row-tip">开启时，当最后一个作业执行完毕后，自动释放集群，否则集群会一直保持运行，需手动释放。</span>\n                            </div>\n                        </dd>\n                        <div class="advance-setting"\n                            data-ui-id="reminderPanel"\n                            data-ui-type="ActionPanel"></div>\n                    </dl>\n                    <div data-ui-id="appPanel" data-ui-type="ActionPanel"></div>\n                    <dl class="detail-create detail-part-1-col">\n                        <dt>\n                            <h4>网络</h4>\n                        </dt>\n                        <dd>\n                            <label class="required-label">网络类型：</label>\n                            <div class="select-group">\n                                <div data-ui-type="Select"\n                                    data-ui-id="vpcId"\n                                    data-ui-name="vpcId"></div>\n                                <div data-ui-type="Select"\n                                    data-ui-id="subnetId"\n                                    data-ui-name="subnetId"></div>\n                            </div>\n                        </dd>\n                        <dd>\n                            <label class="required-label">安全组：</label>\n                            <div>\n                                <div data-ui-type="Select"\n                                    data-ui-id="systemSecurityGroup"\n                                    data-ui-name="systemSecurityGroup"></div>\n                            </div>\n                        </dd>\n                    </dl>\n                    <div data-ui-id="flavorPanel" data-ui-type="ActionPanel"></div>\n                    <dl class="detail-create detail-part-1-col">\n                        <dd class="btn-group">\n                            <button data-ui-id="pick"\n                                data-ui-type="Button"\n                                data-ui-skin="ok"\n                                data-auth="verifiedUser"\n                                data-authtype="READONLY">完成</button>\n                            <button data-ui="id:cancel;type:Button;">取消</button>\n                        </dd>\n                    </dl>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("bmr/template/create/CreateModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/BaseModel","babel-runtime/helpers/interop-require-default","underscore","common/region","common/constants","../../config"],function(exports,module,e,t,a,n,i,r,l,s,o){var u=i["default"](n),d=i["default"](r),c=i["default"](l),p=i["default"](s),m=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.fetchSubNet=function(e){return o.api.bmrSubNetList(e)},i.prototype.fetchSecurityGroup=function(e){return o.api.bmrSecurityGroup(e)},i.prototype.submit=function(e){return o.api.bmrTemplateCreate(e)},i.prototype.isCopy=function(){return!!this.get("templateId")},i.prototype.normalize=function(){var e=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];return d["default"].defaults(e,{name:"",alarmEnabled:!0,sendMessage:!0,autoTerminate:!1,logUri:"bos://",imageType:null,imageVersion:null,applications:[],instanceGroups:[],reminder:{enable:!1,disabled:!0}})},t["default"](i,[{key:"datasource",get:function(){return{getBucketList:function(){return o.api.bmrBucketList},getFolderList:function(){return o.api.bmrFolderList},getObjectList:function(){return o.api.bmrObjectList},createBucket:function(){return o.api.bmrCreateBucket},getBucketLocations:function(){return function(){return{locations:[c["default"].getCurrentRegion().id]}}},editData:function(e){var t=e.get("templateId");return t?o.api.bmrTemplateDetail({templateId:t}).then(function(t){return e.normalize(t)}):e.normalize()},ticketUrl:function(){return p["default"].domains.ticket},zoneList:function(){return o.api.bmrZoneList().then(function(e){return d["default"].map(e,function(e){return d["default"].extend(e,{name:e.zoneName.replace("zone","可用区"),value:e.zoneName})})})},vpcData:function(){return o.api.bmrVpcList().then(function(e){var t="";return{datasource:d["default"].map(e,function(e){return e.defaultVpc&&(t=e.vpcId),{name:e.name+"("+e.cidr+")",value:e.vpcId}}),defaultValue:t}})}}}}]),i}(u["default"]);module.exports=m}),define("bmr/template/create/CreateView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","jquery","babel-runtime/helpers/interop-require-default","underscore","bat-ria/mvc/BaseView","../../enums","bat-ria/tpl!./create.tpl"],function(exports,module,e,t,a,n,i,r,l,s,o){var u=i["default"](n),d=i["default"](r),c=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIProperties=function(){return{clusterName:{value:"@editData.name",placeholder:"请输入名称",custom:function(e){return e.trim()&&/^[\S ]{1,255}$/.test(e)},customErrorMessage:"名称不符合规则：长度1-255，字符不能全为空格"},alarmToggle:{checked:"@editData.alarmEnabled"},smsToggle:{checked:"@editData.sendMessage"},logToggle:{checked:"@editData.logUri"},autoTerminateToggle:{checked:"@editData.autoTerminate"},appPanel:{url:"/bmr/common/image/detail"},flavorPanel:{url:"/bmr/common/flavor",actionOptions:{payType:s.PayType.POSTPAY}},logUri:{required:"required",requiredErrorMessage:"请选择文件夹",width:250,getBucketList:"@getBucketList",getFolderList:"@getFolderList",getObjectList:"@getObjectList",createBucket:"@createBucket",getBucketLocations:"@getBucketLocations",viewtype:"folder",urlPrefix:"bos://",placeholder:"bos://",value:"@editData.logUri"},logPanel:{hidden:!1},reminderPanel:{url:"/bmr/common/reminder",actionOptions:{editData:{enabled:!1,disabled:!0}}},availabilityZone:{width:222,datasource:"@zoneList"},vpcId:{width:222,value:"@vpcData.defaultValue",datasource:"@vpcData.datasource"},subnetId:{width:222,custom:function(e){return!!e},customErrorMessage:"该自定义私有网络中没有子网，请先创建子网或者选择其他私有网络",emptyText:"暂无可用子网"},systemSecurityGroup:{width:222,emptyText:"暂无可用安全组"}}},i.prototype.getUIEvents=function(){var e=this;return{"table:command":function(t){return e.fire(t.name,t)},"pick:click":function(){return e.fire("PICK")},"cancel:click":function(){return e.fire("REDIRECT_TO_LIST")},"logToggle:change":function(){return e.get("logPanel").toggle()},"autoTerminateToggle:change":function(){return e.asyncAutoTerminateState()},"advance:click":function(t){return e.toggleAdvance(t)},"availabilityZone:change":function(){return e.updateSubnet()},"vpcId:change":function(){e.updateSubnet(),e.updateSecurityGroup()},"appPanel@actionloadfail":function(){return e._disableSubmit()},"flavorPanel@actionloadfail":function(){return e._disableSubmit()}}},i.prototype.enterDocument=function(){n.prototype.enterDocument.call(this),this.updateSubnet(),this.updateSecurityGroup()},i.prototype.updateSubnet=function(){var e=this,t=this.get("vpcId").getValue(),a=this.get("availabilityZone").getValue();this.model.fetchSubNet({vpcId:t,availabilityZone:a}).then(function(t){var a="",n=d["default"].map(t,function(e){return e.defaultSubnet&&(a=e.subnetId),{name:e.name+"("+e.cidr+")",value:e.subnetId}});e.get("subnetId").setProperties({datasource:n,value:a})})},i.prototype.updateSecurityGroup=function(){var e=this,t=this.get("vpcId").getValue();this.model.fetchSecurityGroup({vpcId:t,type:"system"}).then(function(t){var a=d["default"].map(t,function(e){return d["default"].extend(e,{value:e.id})});e.get("systemSecurityGroup").updateDatasource(a)})},i.prototype.asyncAutoTerminateState=function(){this.get("reminderPanel").action.toggle()},i.prototype.validate=function(){return this.get("clusterName").validate()&&(!this.get("logToggle").isChecked()||this.get("logUri").validate())&&this.get("reminderPanel").action.view.get("form").validate()&&this.get("subnetId").validate()},i.prototype.asyncFormState=function(){var e=this.model.get("editData"),t=this.get("appPanel"),a=this.get("logPanel"),n=this.get("flavorPanel");e.logUri?a.show():a.hide(),this.get("reminderPanel").reload({editData:d["default"].defaults(e.reminder,{disabled:!e.autoTerminate})}),t.reload(d["default"].pick(e,"imageType","imageVersion","applications")),n.reload(d["default"].reduce(e.instanceGroups,function(e,t){return e[t.type.toLowerCase()]=t,e},{}))},i.prototype.toggleAdvance=function(e){e.target.toggleState("arrow"),u["default"](".advance-setting").fadeToggle(300)},i.prototype._disableSubmit=function(){this.get("pick").disable()},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_template_create"}}]),i}(i["default"](l)["default"]);module.exports=c}),define("bmr/template/Detail",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/BaseAction","babel-runtime/helpers/interop-require-default","./DetailModel","./DetailView"],function(exports,module,e,t,a,n,i,r,l){var s=i["default"](n),o=i["default"](r),u=i["default"](l),d=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.initBehavior=function(){n.prototype.initBehavior.call(this),this.view.on("REFRESH",this.reload,this)},t["default"](i,[{key:"modelType",get:function(){return o["default"]}},{key:"viewType",get:function(){return u["default"]}}]),i}(s["default"]);module.exports=d}),define("bmr/template/detail.tpl",[],function(){return'\x3c!-- target: TPL_bmr_template_detail --\x3e\n<div class="bmr bmr-template-detail bmr-main-wrap main-wrap-new">\n    \x3c!-- use: TPL_bmr_side_bar(menu="template") --\x3e\n    <div class="content-wrap">\n        \x3c!-- use: TPL_bmr_template_nav(title="模板详情") --\x3e\n        <div class="detail-content">\n            <h1>模板详情</h1>\n            <div class="detail-parts-table">\n                <dl class="detail-part-1-col">\n                    <dt><h4>基本信息</h4></dt>\n                    <dd>\n                        <div class="detail-cell">\n                            <label>模板ID：</label>\n                            <span>${templateDetail.id}</span>\n                        </div>\n                        <div class="detail-cell">\n                            <label for="">区域：</label>\n                            <span>${templateDetail.availabilityZone | bmrFormatZone}</span>\n                        </div>\n                    </dd>\n                    <dd>\n                        <div class="detail-cell">\n                            <label>模板名称：</label>\n                            <span class="cell-block">${templateDetail.name}</span>\n                        </div>\n                        <div class="detail-cell">\n                            <label>日志URL：</label>\n                            <span>\n                                \x3c!--if: ${templateDetail.logUri} --\x3e\n                                ${templateDetail.logUri}\n                                \x3c!--else--\x3e\n                                -\n                                \x3c!--/if--\x3e\n                            </span>\n                        </div>\n                    </dd>\n                    <dd>\n                        <div class="detail-cell">\n                            <label>自动终止：</label>\n                            <span>\n                                \x3c!-- if: ${templateDetail.autoTerminate} --\x3e\n                                开启\n                                \x3c!-- else --\x3e\n                                关闭\n                                \x3c!-- /if --\x3e\n                            </span>\n                        </div>\n                        <div class="detail-cell">\n                            <label>报警设置：</label>\n                            <span>\n                                <label>\n                                    \x3c!-- if: ${templateDetail.alarmEnabled} --\x3e\n                                    开启\n                                    \x3c!-- else --\x3e\n                                    关闭\n                                    \x3c!-- /if --\x3e\n                                </label>\n                            </span>\n                        </div>\n                    </dd>\n                    <dd>\n                        <div class="detail-cell">\n                            <label>短信设置：</label>\n                            <span class="no-content">\n                                <label>\n                                    \x3c!-- if: ${templateDetail.sendMessage} --\x3e\n                                    开启\n                                    \x3c!-- else --\x3e\n                                    关闭\n                                    \x3c!-- /if --\x3e\n                                </label>\n                            </span>\n                        </div>\n                        <div class="detail-cell">\n                            <label>超时提醒设置：</label>\n                            <span>\n                                \x3c!--if: ${templateDetail.reminder.enabled} --\x3e\n                                    开启\n                                \x3c!--else--\x3e\n                                    关闭\n                                \x3c!--/if--\x3e\n                            </span>\n                        </div>\n                    </dd>\n                    \x3c!--if: ${templateDetail.reminder.enabled} --\x3e\n                    <dd>\n                        <div class="detail-cell">\n                            <label>超时时间：</label>\n                            <span>\n                                ${templateDetail.reminder.duration}分钟\n                            </span>\n                        </div>\n                        <div class="detail-cell">\n                            <label>超时提醒方式：</label>\n                            <span>\n                                ${templateDetail.reminder.mediaText}\n                            </span>\n                        </div>\n                    </dd>\n                    \x3c!--/if--\x3e\n                </dl>\n                <dl class="detail-part-1-col">\n                    <dt><h4>网络</h4></dt>\n                    <dd>\n                        <div class="detail-cell">\n                            <label>所在网络：</label>\n                            ${*templateDetail.vpc | bmrFormatNetWork(${templateDetail.vpc.vpcId})}\n                        </div>\n                        <div class="detail-cell">\n                            <label>安全组：</label>\n                            ${*templateDetail.systemSecurityGroup | bmrFormatNetWork(${templateDetail.vpc.vpcId})}\n                        </div>\n                    </dd>\n                    <dd>\n                        <div class="detail-cell">\n                            <label>所在子网：</label>\n                            ${*templateDetail.subnet | bmrFormatNetWork(${templateDetail.vpc.vpcId})}\n                        </div>\n                    </dd>\n                </dl>\n                <dl class="detail-part-1-col">\n                    <dt>\n                        <h4>配置设置</h4>\n                    </dt>\n                    <dd>\n                        <div class="detail-cell">\n                            <label>镜像版本：</label>\n                            <span>${templateDetail.imageDescription}</span>\n                        </div>\n                        <div class="detail-cell">\n                            <label>应用配置：</label>\n                            <span class="cell-block">\n                                ${*templateDetail.applications | bmrFormatClusterApp}\n                            </span>\n                        </div>\n                    </dd>\n                    <dd>\n                        <div class="detail-cell">\n                            <label>节点数量：</label>\n                            <span class="cell-block">\n                                ${*templateDetail.instanceGroups | bmrFormatClusterFlavor}\n                            </span>\n                        </div>\n                    </dd>\n                </dl>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("bmr/template/DetailModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/mvc/BaseModel","babel-runtime/helpers/interop-require-default","underscore","../config","../enums"],function(exports,module,e,t,a,n,i,r,l,s){var o=i["default"](n),u=i["default"](r),d=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),t["default"](i,[{key:"datasource",get:function(){return{templateDetail:function(e){return l.api.bmrTemplateDetail({templateId:e.get("templateId")}).then(function(e){return e.reminder.mediaText=u["default"].reduce(e.reminder.media,function(e,t,a){return e+(a>0?"、":"")+s.NOTIFY_TYPE.getTextFromValue(t)},""),e})}}}}]),i}(o["default"]);module.exports=d}),define("bmr/template/DetailView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","bat-ria/tpl!./detail.tpl","bat-ria/mvc/BaseView","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t,a,n,i,r){var l=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIProperties=function(){return{}},i.prototype.getUIEvents=function(){return{}},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_template_detail"}}]),i}(r["default"](i)["default"]);module.exports=l}),define("bmr/template/List",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/class-call-check","./ListView","babel-runtime/helpers/interop-require-default","./ListModel","../config","../common/mvc/ListAction"],function(exports,module,e,t,a,n,i,r,l){var s=n["default"](a),o=n["default"](i),u=function(a){function n(e){t["default"](this,n),a.call(this,e),this.modelType=o["default"],this.viewType=s["default"]}return e["default"](n,a),n.prototype.initBehavior=function(){a.prototype.initBehavior.call(this),this.view.on(r.events.REFRESH,this.reload,this),this.view.on(r.events.CREATE,this.crateTemplate,this),this.view.on(r.events.DELETE,this.deleteTemplate,this),this.view.on(r.events.COPY,this.copy,this)},n.prototype.crateTemplate=function(){this.redirect("#/bmr/template/create")},n.prototype.deleteTemplate=function(e){var t=this;this.model.deleteTemplate(e.args).then(function(){return t.view.showToast("删除成功")}).ensure(function(){return t.reload()})},n.prototype.copy=function(e){this.redirect("#/bmr/cluster/create~templateId="+e.args)},n}(n["default"](l)["default"]);module.exports=u}),define("bmr/template/list.tpl",[],function(){return'\x3c!-- target: TPL_bmr_template_list --\x3e\n<div class="bmr bmr-template-list bmr-main-wrap main-wrap-new">\n    \x3c!-- use: TPL_bmr_side_bar(menu="template") --\x3e\n    <div class="content-wrap">\n        \x3c!-- import: TPL_bmr_template_nav --\x3e\n        <div class="list-content">\n            <h2>\n                模板列表\n                \x3c!-- import: TPL_realname_tip --\x3e\n            </h2>\n            <div class="table-full-wrap">\n                <div class="operation-wrap">\n                    <div class="buttons-wrap">\n                        <button data-ui="id:create;type:Button;skin:create"\n                            data-auth="verifiedUser"\n                            data-authtype="READONLY">创建模板</button>\n                    </div>\n                    <div class="buttons-quick-wrap">\n                        <button data-ui-id="refresh" data-ui-type="Button" data-ui-skin="refresh"></button>\n                    </div>\n                </div>\n                \x3c!-- import: listTableWithCommand --\x3e\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("bmr/template/ListModel",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","../config","../common/mvc/ListModel","babel-runtime/helpers/interop-require-default"],function(exports,module,e,t,a,n,i,r){var l=function(i){function r(){a["default"](this,r),i.apply(this,arguments)}return e["default"](r,i),r.prototype.deleteTemplate=function(e){return n.api.bmrTemplateDelete({templateId:e})},t["default"](r,[{key:"listRequester",get:function(){return n.api.bmrTemplateList}}]),r}(r["default"](i)["default"]);module.exports=l}),define("bmr/template/ListView",["exports","module","babel-runtime/helpers/inherits","babel-runtime/helpers/create-class","babel-runtime/helpers/class-call-check","underscore","babel-runtime/helpers/interop-require-default","common/util/tableUtil","bat-ria/tpl!./list.tpl","../config","../common/mvc/ListView"],function(exports,module,e,t,a,n,i,r,l,s,o){var u=i["default"](n),d=i["default"](r),c=[{title:"模板名称/ID",content:function(e){return s.html.table.tableId({name:e.name,id:e.id,url:"#/bmr/template/detail~templateId="+e.id})}},{title:"模板类型",content:function(e){return e.shared?"系统预定义":"用户自定义"}},{title:"镜像类型",stable:!0,width:200,content:function(e){return e.imageDescription}},{title:"应用列表",content:function(e){return u["default"].pluck(e.applications,"name").join("、")||"-"}},{title:"节点个数",content:function(e){return u["default"].map(e.instanceGroups,function(e){return"<span>"+e.type+":"+e.instanceCount+"个</span>"}).join("、")}},{title:"操作",content:function(e){return s.html.table.linkButton({label:"创建集群",title:"创建集群",disabled:!e.copyable,command:s.events.COPY,commandArgs:e.id})+s.html.table.linkButton({label:"删除",title:"删除",command:s.events.DELETE,disabled:e.shared,commandArgs:e.id})}}],p=function(n){function i(){a["default"](this,i),n.apply(this,arguments)}return e["default"](i,n),i.prototype.getUIEvents=function(){var e=this;return u["default"].extend(n.prototype.getUIEvents.call(this),{"refresh:click":function(){return e.triggerCommand(s.events.REFRESH)},"create:click":function(){return e.triggerCommand(s.events.CREATE)}})},t["default"](i,[{key:"template",get:function(){return"TPL_bmr_template_list"}},{key:"uiProperties",get:function(){return{table:d["default"].tableProperty(c,{select:""})}}},{key:"confirmEventMap",get:function(){var e;return e={},e[s.events.DELETE]="您确定删除模板吗？",e}}]),i}(i["default"](o)["default"]);module.exports=p}),define("bmr/tpl_filter",["exports","etpl","babel-runtime/helpers/interop-require-default","./util"],function(exports,e,t,a){var n=t["default"](e);n["default"].addFilter("bmrFormatStepProperties",a.formatStepProperties),n["default"].addFilter("bmrFormatClusterSummary",a.formatClusterSummary),n["default"].addFilter("bmrFormatClusterFlavor",a.formatClusterFlavor),n["default"].addFilter("bmrTimeDiff",a.timeDiff),n["default"].addFilter("bmrFormatTimeUnit",a.formatTimeUnit),n["default"].addFilter("bmrFormatClusterApp",a.formatClusterApp),n["default"].addFilter("bmrFormatZone",a.formatRegionZone),n["default"].addFilter("bmrFormatNetWork",a.formatNetwork)}),define("bmr/util",["exports","moment","babel-runtime/helpers/interop-require-default","etpl","underscore","common/region","./enums"],function(exports,e,t,a,n,i,r){exports.__esModule=!0;var l=t["default"](e),s=t["default"](a),o=t["default"](n),u=t["default"](i);exports.formatStepProperties=function(){var e=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],t=e.additionalFiles,a=e.properties,n='<table class="bmr-step-properties">';return o["default"].each(r.STEP_PROPERTIES.toArray(),function(e){a.hasOwnProperty(e.value)&&(n+=s["default"].compile("<tr><th>${title}</th><td>${text}</td></tr>")({title:e.text,text:a[e.value]||"-"}))}),t.forEach(function(e){n+="\n            <tr>\n                <th>附加文件：</th>\n                <td>\n                    <p>远程文件："+e.remote+"</p>\n                    <p>本地文件："+e.local+"</p>\n                </td>\n            </tr>\n        "}),n+="</table>"};var d=function(){var e=arguments.length<=0||arguments[0]===undefined?[]:arguments[0];return"套餐配置："+o["default"].map(e,function(e){return"\n            "+e.type+"("+r.INSTANCE_TYPE.getTextFromValue(e.instanceType)+"，"+e.instanceCount+"台)\n        "}).join('<span class="separate">|</span>')};exports.formatClusterFlavor=d;var c=function(){var e=arguments.length<=0||arguments[0]===undefined?[]:arguments[0];return o["default"].map(e,function(e){return e.name+"("+e.version+")"}).join('<span class="separate">|</span>')||"-"};exports.formatClusterApp=c;exports.formatClusterSummary=function(){var e=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],t=c(e.applications),a=d(e.instanceGroups);return["<p>镜像类型："+e.imageDescription+"</p>","<p>应用列表："+(t||"-")+"</p>"].join("")+a};exports.timeDiff=function(e,t){if(!e)return"-";var a=l["default"](e);return l["default"](t||Date.now()).diff(a,"minutes")||"-"};exports.pickStepType=function(){var e=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],t=[r.STEP_TYPE.Streaming,r.STEP_TYPE.Java];return"spark"===e.imageType&&t.push(r.STEP_TYPE.Spark),o["default"].reduce(e.applications,function(e,t){switch(t.name){case"hive":e.push(r.STEP_TYPE.Hive);break;case"pig":e.push(r.STEP_TYPE.Pig);break;case"spark":case"spark2":e.push(r.STEP_TYPE.Spark)}return e},t),t};exports.formatTimeUnit=function(e){return r.TIME_UNIT.getTextFromValue(e)||e};exports.formatZone=function(e){return e.replace("zone","可用区")};exports.formatRegionZone=function(e){return e.replace("zone",u["default"].getCurrentRegion().label+"，可用区")};exports.formatNetwork=function(e,t){return e?e.subnetId?e.name+" ("+e.cidr+")":e.vpcId?e.name+" ("+e.cidr+")":e.id?e.name:"-":"-"}});
//# sourceMappingURL=startup.js.map